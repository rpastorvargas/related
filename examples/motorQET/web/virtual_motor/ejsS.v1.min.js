function Matrix(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=hasFloat32Array?new Float32Array(e):e}function Vector(e,t,r){"object"==typeof e?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=r||0)}var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.AnalyticCurve={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setNumPoints(e.getNumPoints()),t.setMinimun(e.getMinimun()),t.setMaximun(e.getMaximun()),t.setVariable(e.getVariable()),t.setFunctionX(e.getFunctionX()),t.setFunctionY(e.getFunctionY())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints,e.getNumPoints),t.registerProperty("Minimum",e.setMinimun,e.getMinimun),t.registerProperty("Maximum",e.setMaximun,e.getMaximun),t.registerProperty("Variable",e.setVariable,e.getVariable),t.registerProperty("FunctionX",e.setFunctionX,e.getFunctionX),t.registerProperty("FunctionY",e.setFunctionY,e.getFunctionY),t.registerAction("OnError")}},EJSS_DRAWING2D.analyticCurve=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i="t",o="t",s="0",a={},l=5*screen.width;return n.getClass=function(){return"ElementAnalyticCurve"},n.setParameters=function(e){for(var t in e)a[t]=e[t];n.setChanged(!0)},n.getParameters=function(){return a},n.getBounds=function(e){var u,g,c=n.getX(),S=n.getY(),d=n.getSizeX(),f=n.getSizeY(),E=d/2,p=f/2,h=n.getRelativePositionOffset(d,f),m=EJSS_DRAWING2D.functionsParser(),A=!1;try{u=m.parse(o)}catch(y){console.log("Analytic curve error parsing FunctionX: "+o),A=!0}if(!A)try{g=m.parse(s)}catch(D){console.log("Analytic curve error parsing FunctionY: "+s),A=!0}if(A)return n.getController().invokeAction("OnError"),{left:c+h[0]-E-d,right:c+h[0]-E+d,top:S+h[1]-p+f,bottom:S+h[1]-p-f};var v="undefined"==typeof t||null===t?n.getPanel().getRealWorldXMin():t,P="undefined"==typeof r||null===r?n.getPanel().getRealWorldXMax():r,I=(P-v)/l,_=[],R={};for(var C in a)R[C]=a[C];try{for(var T=0,N=v;P>N;N+=I){R[i]=N;var O=u.evaluate(R),M=g.evaluate(R);isNaN(O)||isNaN(M)||(_[T]=[],_[T][0]=O,_[T++][1]=M)}}catch(b){return n.getController().invokeAction("OnError"),{left:c+h[0]-E-d,right:c+h[0]-E+d,top:S+h[1]-p+f,bottom:S+h[1]-p-f}}var G=0,x=0,L=0,J=0;if(_.length>0){G=_[0][0],L=_[0][0],x=_[0][1],J=_[0][1];for(var w=0;w<_.length;w++)_[w][0]>G&&(G=_[w][0]),_[w][0]<L&&(L=_[w][0]),_[w][1]>x&&(x=_[w][1]),_[w][1]<J&&(J=_[w][1])}return{left:c+h[0]-E+L*d,right:c+h[0]-E+G*d,top:S+h[1]-p+x*f,bottom:S+h[1]-p+J*f}},n.setNumPoints=function(e){l!=e&&(l=e,n.setChanged(!0))},n.getNumPoints=function(){return l},n.setMinimun=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getMinimun=function(){return t},n.setMaximun=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getMaximun=function(){return r},n.setVariable=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getVariable=function(){return i},n.setFunctionX=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getFunctionX=function(){return o},n.setFunctionY=function(e){s!=e&&(s=e,n.setChanged(!0))},n.getFunctionY=function(){return s},n.registerProperties=function(e){EJSS_DRAWING2D.AnalyticCurve.registerProperties(n,e)},n.setSize([1,1]),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Arrow={NONE:0,ANGLE:1,CIRCLE:2,RECTANGLE:3,LINE:4,CURVE:5,TRIANGLE:6,DIAMOND:7,WEDGE:8,POINTED:9,INVANGLE:10,INVTRIANGLE:11,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setMarkEnd(e.getMarkEnd()),t.setMarkStart(e.getMarkStart())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition),t.registerProperty("MarkEnd",e.setMarkEnd),t.registerProperty("MarkEndWidth",e.setMarkEndWidth),t.registerProperty("MarkEndHeight",e.setMarkEndHeight),t.registerProperty("MarkEndDiameter",e.setMarkEndDiameter),t.registerProperty("MarkEndColor",e.setMarkEndColor),t.registerProperty("MarkEndStroke",e.setMarkEndStroke),t.registerProperty("MarkEndOrient",e.setMarkEndOrient),t.registerProperty("MarkStart",e.setMarkStart),t.registerProperty("MarkStartWidth",e.setMarkStartWidth),t.registerProperty("MarkStartHeight",e.setMarkStartHeight),t.registerProperty("MarkStartDiameter",e.setMarkStartDiameter),t.registerProperty("MarkStartColor",e.setMarkStartColor),t.registerProperty("MarkStartStroke",e.setMarkStartStroke),t.registerProperty("MarkStartOrient",e.setMarkStartOrient),t.registerProperty("MarkMiddle",e.setMarkMiddle),t.registerProperty("MarkMiddleWidth",e.setMarkMiddleWidth),t.registerProperty("MarkMiddleHeight",e.setMarkMiddleHeight),t.registerProperty("MarkMiddleDiameter",e.setMarkMiddleDiameter),t.registerProperty("MarkMiddleColor",e.setMarkMiddleColor),t.registerProperty("MarkMiddleColorSnd",e.setMarkMiddleColorSnd),t.registerProperty("MarkMiddleStroke",e.setMarkMiddleStroke),t.registerProperty("MarkMiddleOrient",e.setMarkMiddleOrient),t.registerProperty("MarkProportion",e.setMarkProportion)}},EJSS_DRAWING2D.arrow=function(e){var t=EJSS_DRAWING2D.element(e),r=(EJSS_DRAWING2D.Style,.5),n=EJSS_DRAWING2D.Arrow.NONE,i="none",o=12,s=10,a=-1,l="auto",u=EJSS_DRAWING2D.Arrow.ANGLE,g="none",c=12,S=12,d=-1,f="auto",E=EJSS_DRAWING2D.Arrow.NONE,p="none",h="none",m=12,A=10,y=-1,D="auto";return t.getClass=function(){return"ElementArrow"},t.setMarkProportion=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getMarkProportion=function(){return r},t.setMarkStart=function(e){n="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkStart=function(){return n},t.setMarkStartColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setChanged(!0)),t},t.getMarkStartColor=function(){return i},t.setMarkStartStroke=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarkStartStroke=function(){return a},t.setMarkStartWidth=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getMarkStartWidth=function(){return o},t.setMarkStartHeight=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarkStartHeight=function(){return s},t.setMarkStartDiameter=function(e){(s!=e||o!=e)&&(s=e,o=e,t.setChanged(!0))},t.getMarkStartOrient=function(){return l},t.setMarkStartOrient=function(e){l!=e&&(l=e,t.setChanged(!0))},t.setMarkEnd=function(e){u="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkEnd=function(){return u},t.setMarkEndColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=g&&(g=e,t.setChanged(!0)),t},t.getMarkEndColor=function(){return g},t.setMarkEndStroke=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getMarkEndStroke=function(){return d},t.setMarkEndWidth=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getMarkEndWidth=function(){return c},t.setMarkEndHeight=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getMarkEndHeight=function(){return S},t.setMarkEndDiameter=function(e){(S!=e||c!=e)&&(S=e,c=e,t.setChanged(!0))},t.getMarkEndOrient=function(){return f},t.setMarkEndOrient=function(e){f!=e&&(f=e,t.setChanged(!0))},t.setMarkMiddle=function(e){E="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkMiddle=function(){return E},t.setMarkMiddleColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=p&&(p=e,t.setChanged(!0)),t},t.getMarkMiddleColor=function(){return p},t.setMarkMiddleStroke=function(e){y!=e&&(y=e,t.setChanged(!0))},t.getMarkMiddleStroke=function(){return y},t.setMarkMiddleColorSnd=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=h&&(h=e,t.setChanged(!0)),t},t.getMarkMiddleColorSnd=function(){return h},t.setMarkMiddleWidth=function(e){m!=e&&(m=e,t.setChanged(!0))},t.getMarkMiddleWidth=function(){return m},t.setMarkMiddleHeight=function(e){A!=e&&(A=e,t.setChanged(!0))},t.getMarkMiddleHeight=function(){return A},t.setMarkMiddleDiameter=function(e){(A!=e||m!=e)&&(A=e,m=e,t.setChanged(!0))},t.getMarkMiddleOrient=function(){return D},t.setMarkMiddleOrient=function(e){D!=e&&(D=e,t.setChanged(!0))},t.registerProperties=function(e){EJSS_DRAWING2D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Arrow.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.ArrowSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("MarkEnd",function(t){e.setToEach(function(e,t){e.setMarkEnd(t)},t)}),t.registerProperty("MarkEndWidth",function(t){e.setToEach(function(e,t){e.setMarkEndWidth(t)},t)}),t.registerProperty("MarkEndHeight",function(t){e.setToEach(function(e,t){e.setMarkEndHeight(t)},t)}),t.registerProperty("MarkEndDiameter",function(t){e.setToEach(function(e,t){e.setMarkEndDiameter(t)},t)}),t.registerProperty("MarkEndColor",function(t){e.setToEach(function(e,t){e.setMarkEndColor(t)},t)}),t.registerProperty("MarkEndStroke",function(t){e.setToEach(function(e,t){e.setMarkEndStroke(t)},t)}),t.registerProperty("MarkEndRotate",function(t){e.setToEach(function(e,t){e.setMarkEndRotate(t)},t)}),t.registerProperty("MarkEndOrient",function(t){e.setToEach(function(e,t){e.setMarkEndOrient(t)},t)}),t.registerProperty("MarkStart",function(t){e.setToEach(function(e,t){e.setMarkStart(t)},t)}),t.registerProperty("MarkStartWidth",function(t){e.setToEach(function(e,t){e.setMarkStartWidth(t)},t)}),t.registerProperty("MarkStartHeight",function(t){e.setToEach(function(e,t){e.setMarkStartHeight(t)},t)}),t.registerProperty("MarkStartDiameter",function(t){e.setToEach(function(e,t){e.setMarkStartDiameter(t)},t)}),t.registerProperty("MarkStartColor",function(t){e.setToEach(function(e,t){e.setMarkStartColor(t)},t)}),t.registerProperty("MarkStartStroke",function(t){e.setToEach(function(e,t){e.setMarkStartStroke(t)},t)}),t.registerProperty("MarkStartRotate",function(t){e.setToEach(function(e,t){e.setMarkStartRotate(t)},t)}),t.registerProperty("MarkStartOrient",function(t){e.setToEach(function(e,t){e.setMarkStartOrient(t)},t)}),t.registerProperty("MarkMiddle",function(t){e.setToEach(function(e,t){e.setMarkMiddle(t)},t)}),t.registerProperty("MarkMiddleWidth",function(t){e.setToEach(function(e,t){e.setMarkMiddleWidth(t)},t)}),t.registerProperty("MarkMiddleHeight",function(t){e.setToEach(function(e,t){e.setMarkMiddleHeight(t)},t)}),t.registerProperty("MarkMiddleDiameter",function(t){e.setToEach(function(e,t){e.setMarkMiddleDiameter(t)},t)}),t.registerProperty("MarkMiddleColor",function(t){e.setToEach(function(e,t){e.setMarkMiddleColor(t)},t)}),t.registerProperty("MarkMiddleColorSnd",function(t){e.setToEach(function(e,t){e.setMarkMiddleColorSnd(t)},t)}),t.registerProperty("MarkMiddleStroke",function(t){e.setToEach(function(e,t){e.setMarkMiddleStroke(t)},t)}),t.registerProperty("MarkMiddleRotate",function(t){e.setToEach(function(e,t){e.setMarkMiddleRotate(t)},t)}),t.registerProperty("MarkProportion",function(t){e.setToEach(function(e,t){e.setMarkProportion(t)},t)}),t.registerProperty("MarkMiddleOrient",function(t){e.setToEach(function(e,t){e.setMarkMiddleOrient(t)},t)})}},EJSS_DRAWING2D.arrowSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.arrow,e),r=EJSS_DRAWING2D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Axis={AXIS_VERTICAL:0,AXIS_HORIZONTAL:1,TICKS_UP:2,TICKS_DOWN:3,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("TickStep",e.setTickStep,e.getTickStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("AutoTicks",e.setAutoTicks,e.getAutoTicks),t.registerProperty("FixedTick",e.setFixedTick,e.getFixedTick),t.registerProperty("Orient",e.setOrient,e.getOrient),t.registerProperty("Scale",e.setScale,e.getScale),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode),t.registerProperty("TicksSize",e.setTicksSize,e.getTicksSize),t.registerProperty("AutoStepMin",e.setAutoStepMin,e.getAutoStepMin),t.registerProperty("AutoTicksRange",e.setAutoTicksRange,e.getAutoTicksRange),t.registerProperty("TextPosition",e.setTextPosition,e.getTextPosition),t.registerProperty("ScalePrecision",e.setScalePrecision,e.getScalePrecision),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("FontOutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FontFillColor",e.getFont().setFillColor),t.registerProperty("Show",e.setShow,e.getShow)}},EJSS_DRAWING2D.axis=function(e){var t=EJSS_DRAWING2D.segment(e),r=!0,n=0,i=20,o=0,s=Number.NaN,a=EJSS_DRAWING2D.Axis.AXIS_VERTICAL,l=[-1,1],u=!1,g=EJSS_DRAWING2D.Axis.SCALE_NUM,c=EJSS_DRAWING2D.Axis.TICKS_UP,S=10,d=1,f=EJSS_DRAWING2D.font(e),E=40,p=[5,10,20],h=!0;return t.getClass=function(){return"ElementAxis"},t.setShow=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getShow=function(){return h},t.getFont=function(){return f},t.setAutoTicksRange=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getAutoTicksRange=function(){return p},t.setAutoStepMin=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getAutoStepMin=function(){return E},t.setFixedTick=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getFixedTick=function(){return s},t.setAutoTicks=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicks=function(){return r},t.setStep=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getStep=function(){return i},t.setTickStep=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTickStep=function(){return o},t.setTicks=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getTicks=function(){return n},t.setTicksMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),g!=e&&(g=e,t.setChanged(!0))},t.getTicksMode=function(){return g},t.setTextPosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),c!=e&&(c=e,t.setChanged(!0))},t.getTextPosition=function(){return c},t.setOrient=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),a!=e&&(a=e,t.setChanged(!0))},t.getOrient=function(){return a},t.setScale=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getScale=function(){return l},t.setScalePrecision=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getScalePrecision=function(){return d},t.setTicksSize=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getTicksSize=function(){return S},t.setInvertedScaleY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getInvertedScaleY=function(){return u},t.registerProperties=function(e){EJSS_DRAWING2D.Axis.registerProperties(t,e)},f.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ByteRaster={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate),t.registerProperty("RGBData",e.setRGBData)}},EJSS_DRAWING2D.byteRaster=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=[],i=!1,o=!0,s=!1;return t.getClass=function(){return"ElementByteRaster"},t.setData=function(e){(o||n!=e)&&(n=e,i=!0,t.setChanged(!0))},t.getData=function(){return n},t.setRGBData=function(e){s=e,o&&(i=!0)},t.isRGBData=function(){return s},t.setAutoupdate=function(e){o=e,o&&(i=!0)},t.setColorMapper=function(e){r!=e&&(r=e,i=!0,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setIndexedColor=function(e){var n=e.color,i=void 0===n[3]?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgb("+n[0]+","+n[1]+","+n[2]+","+n[3]+")";console.log(t.getName()+": setIndexedColor("+e.index+","+i+")");var o=r.getColors();o[e.index]=i},t.getDataChanged=function(){return i},t.setDataChanged=function(e){i=e},t.invalidate=function(){i=!0},t.registerProperties=function(e){EJSS_DRAWING2D.ByteRaster.registerProperties(t,e)},r.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.CellLattice={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("ShowGrid",e.setShowGrid,e.getShowGrid),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType)}},EJSS_DRAWING2D.cellLattice=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=!0,i=[];return t.getClass=function(){return"ElementCellLattice"},t.setData=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getData=function(){return i},t.setColorMapper=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setShowGrid=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getShowGrid=function(){return n},t.setStepY=function(e){mStepY!=e&&(mStepY=e,t.setChanged(!0))},t.getStepY=function(){return mStepY},t.setTicksX=function(e){mTicksX!=e&&(mTicksX=e,t.setChanged(!0))},t.getTicksX=function(){return mTicksX},t.setTicksY=function(e){mTicksY!=e&&(mTicksY=e,t.setChanged(!0))},t.getTicksY=function(){return mTicksY},t.setTicksXMode=function(e){var r=EJSS_DRAWING2D.CellLattice.TICKS_NUM;"string"==typeof e&&(r=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksXMode!=r&&(mTicksXMode=r,t.setChanged(!0))},t.getTicksXMode=function(){return mTicksXMode},t.setTicksYMode=function(e){var r=EJSS_DRAWING2D.CellLattice.TICKS_NUM;"string"==typeof e&&(r=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksYMode!=r&&(mTicksYMode=r,t.setChanged(!0))},t.getTicksYMode=function(){return mTicksYMode},t.registerProperties=function(e){EJSS_DRAWING2D.CellLattice.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Cursor={HORIZONTAL:0,VERTICAL:1,CROSSHAIR:2,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("CursorType",e.setCursorType,e.getCursorType)}},EJSS_DRAWING2D.cursor=function(e){var t,r=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Cursor;return r.getClass=function(){return"ElementCursor"},r.setCursorType=function(e){var i=EJSS_DRAWING2D.InteractionTarget,o=r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION);switch(t="string"==typeof e?EJSS_DRAWING2D.Cursor[e.toUpperCase()]:e){default:o.setSensitivityType(i.SENSITIVITY_ANY);break;case n.HORIZONTAL:o.setSensitivityType(i.SENSITIVITY_HORIZONTAL);break;case n.VERTICAL:o.setSensitivityType(i.SENSITIVITY_VERTICAL)}},r.getCursorType=function(){return t},r.isChanged=function(){return!0},r.registerProperties=function(e){n.registerProperties(r,e)},r.setMeasured(!1),t=n.CROSSHAIR,r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivityType(EJSS_DRAWING2D.InteractionTarget.SENSITIVITY_ANY),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Custom={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t)}},EJSS_DRAWING2D.custom=function(e){var t,r=EJSS_DRAWING2D.element(e);return r.getClass=function(){return"ElementCustom"},r.registerProperties=function(e){EJSS_DRAWING2D.Custom.registerProperties(r,e)},r.setFunction=function(e){t=e},r.getFunction=function(){return t},r.setSize([1,1]),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.DrawingPanel={MOUSE_ENTERED:0,MOUSE_EXITED:1,MOUSE_PRESSED:2,MOUSE_DRAGGED:3,MOUSE_RELEASED:4,GRAPHICS2D_SVG:0,GRAPHICS2D_CANVAS:1,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){e.setController(t),t.registerProperty("AutoScale",e.setAutoScale,e.getAutoScale),t.registerProperty("AutoScaleX",e.setAutoScaleX,e.getAutoScaleX),t.registerProperty("AutoScaleY",e.setAutoScaleY,e.getAutoScaleY),t.registerProperty("InvertedScaleY",e.setInvertedScaleY,e.getInvertedScaleY),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("ScaleXType",function(t){e.setTypeScaleX(t),e.scale()},e.getTypeScaleX),t.registerProperty("ScaleYType",function(t){e.setTypeScaleY(t),e.scale()},e.getTypeScaleY),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",function(t){e.getGraphics().setWidth(t)&&e.scale()},e.getGraphics().getWidth),t.registerProperty("Height",function(t){e.getGraphics().setHeight(t)&&e.scale()},e.getGraphics().getHeight),t.registerProperty("SquareAspect",e.setSquareAspect),t.registerProperty("GraphicsMode",e.setGraphicsMode),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("StopGestures",e.setStopGestures),t.registerProperty("Gutters",e.setGutters),t.registerProperty("GuttersLineColor",e.getGuttersStyle().setLineColor),t.registerProperty("GuttersLineWidth",e.getGuttersStyle().setLineWidth),t.registerProperty("GuttersDrawLines",e.getGuttersStyle().setDrawLines),t.registerProperty("GuttersColor",e.getGuttersStyle().setFillColor),t.registerProperty("GuttersFill",e.getGuttersStyle().setDrawFill),t.registerProperty("GuttersRendering",e.getStyle().setShapeRendering),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerProperty("TRMessage",e.getMessageDecoration("TR").setText),t.registerProperty("TLMessage",e.getMessageDecoration("TL").setText),t.registerProperty("BRMessage",e.getMessageDecoration("BR").setText),t.registerProperty("BLMessage",e.getMessageDecoration("BL").setText),t.registerProperty("CoordinatesFormat",e.getCoordinates().setFormat),t.registerProperty("ShowCoordinates",e.setShowCoordinates),t.registerProperty("ShowAreaRectangle",e.setShowAreaRectangle),t.registerProperty("CursorTypeForMove",e.getInteraction().setCursorTypeForMove),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint,e.getOnMoveHandler),t.registerAction("OnPress",e.getInteraction().getInteractionPoint,e.getOnPressHandler),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds,e.getOnReleaseHandler),t.registerAction("OnResize",e.getInteraction().getInteractionBounds,e.scale),t.registerAction("OnOrientationChange",e.getInteraction().getOrientation,e.scale)}},EJSS_DRAWING2D.drawingPanel=function(e){var t,r={},n=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG,i=EJSS_GRAPHICS.svgGraphics(e),o=EJSS_DRAWING2D.style(e),s=[],a=[],l=!1,u=!1,g=!1,c=!1,S=0,d=0,f=[],E=!0,p=!0,h=[],m=-1,A=1,y=-1,D=1,v={xminPreferred:NaN,xmaxPreferred:NaN,yminPreferred:NaN,ymaxPreferred:NaN,xminMeasured:NaN,xmaxMeasured:NaN,yminMeasured:NaN,ymaxMeasured:NaN,xmargin:0,ymargin:0,xmin:-1,xmax:1,ymin:-1,ymax:1,squareAspect:!1,xorigin:0,yorigin:0,xscale:1,yscale:1},P={left:0,right:0,top:0,bottom:0,visible:!1},I=EJSS_DRAWING2D.style(e+" gutters"),_=!0,R=!0,C={propertiesChanged:function(){},invokeAction:function(){}};r.getName=function(){return e},r.getGraphics=function(){return i},r.importGraphics=function(e){return i.importSVG?i.importSVG(e):null},r.getStyle=function(){return o},r.getGraphicsMode=function(){return n},r.getGraphicsModeName=function(){switch(n){case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS:return"CANVAS";default:case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG:return"SVG"}},r.setGraphicsMode=function(t){if("string"==typeof t&&(0!=t.indexOf("GRAPHICS2D_")&&(t="GRAPHICS2D_"+t),t=EJSS_DRAWING2D.DrawingPanel[t.toUpperCase()]),t!=n){t!=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS&&(t=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG),n=t;var r=i.getParent(),o=i.getWidth(),s=i.getHeight(),a=document.getElementById(e);a.parentNode.removeChild(a),t==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG?i=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS?i=EJSS_GRAPHICS.canvasGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported"),i.setParent(r),i.setWidth(o+1),i.setHeight(s+1),l=!0}},r.getAutoScale=function(){return u||g},r.setAutoScale=function(e){r.setAutoScaleX(e),r.setAutoScaleY(e)},r.setAutoScaleX=function(e){u=e},r.getAutoScaleX=function(){return u},r.setAutoScaleY=function(e){g=e},r.getAutoScaleY=function(){return g},r.setInvertedScaleY=function(e){if(c!=e){c=e,c&&(d=EJSS_DRAWING2D.DrawingPanel.SCALE_NUM);var t=r.reportDecorations("bounds");t&&(_=!0)}},r.getInvertedScaleY=function(){return c},r.setTypeScaleX=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),S=e},r.getTypeScaleX=function(){return S},r.setTypeScaleY=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),d=e,d==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG&&(c=!1)},r.getTypeScaleY=function(){return d},r.setWorldXMin=function(e){e!==v.xminPreferred&&(v.xminPreferred=e)},r.getWorldXMin=function(){return v.xminPreferred},r.setWorldXMax=function(e){e!==v.xmaxPreferred&&(v.xmaxPreferred=e)},r.getWorldXMax=function(){return v.xmaxPreferred},r.setWorldYMin=function(e){e!==v.yminPreferred&&(v.yminPreferred=e)},r.getWorldYMin=function(){return v.yminPreferred},r.setWorldYMax=function(e){e!==v.ymaxPreferred&&(v.ymaxPreferred=e)},r.getWorldYMax=function(){return v.ymaxPreferred},r.setWorldCoordinates=function(e){r.setWorldXMin(e[0]),r.setWorldXMax(e[1]),r.setWorldYMin(e[2]),r.setWorldYMax(e[3])},r.getWorldCoordinates=function(){return[r.getWorldXMin(),r.getWorldXMax(),r.getWorldYMin(),r.getWorldYMax()]},r.getRealWorldCoordinates=function(){return[v.xmin,v.xmax,v.ymin,v.ymax]},r.getRealWorldXMin=function(){return v.xmin},r.getRealWorldXMax=function(){return v.xmax},r.getRealWorldYMin=function(){return v.ymin},r.getRealWorldYMax=function(){return v.ymax},r.setSquareAspect=function(e){e!==v.squareAspect&&(v.squareAspect=e,R=!0)},r.setMarginX=function(e){v.xmargin!=e&&(v.xmargin=e,R=!0)},r.getMarginX=function(){return v.xmargin},r.setMarginY=function(e){v.ymargin!=e&&(v.ymargin=e,R=!0)},r.getMarginY=function(){return v.ymargin},r.setShowCoordinates=function(e){E=e},r.setShowAreaRectangle=function(e){p=e},r.addDecoration=function(e,t,n){return n?EJSS_TOOLS.addToArray(f,e,t):EJSS_TOOLS.addToArray(s,e,t),e.setPanel&&e.setPanel(r),r},r.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(s,e),EJSS_TOOLS.removeFromArray(f,e),e.setPanel&&e.setPanel(null),r},r.addElement=function(e,t){EJSS_TOOLS.addToArray(a,e,t),e.setPanel(r),e.dataCollected&&h.push(e),l=!0},r.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(h,e),l=!0},r.getElements=function(){return a},r.indexOfElement=function(e){return a.indexOf(e)},r.setGutters=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=!1;t!==P.left&&(P.left=t,o=!0),r!==P.top&&(P.top=r,o=!0),n!==P.right&&(P.right=n,o=!0),i!==P.bottom&&(P.bottom=i,o=!0),o&&(P.visible=P.left>0||P.top>0||P.right>0||P.bottom>0,_=!0,R=!0)},r.getGutters=function(){return P},r.getGuttersStyle=function(){return I},r.toPixelAxisY=function(e){return v.yorigin-e-v.yscale*v.ymin},r.toPixelAxisX=function(e){return v.xorigin+e-v.xscale*v.xmin},r.toPixelPosition=function(e,t){var n="undefined"!=typeof t?t:S,i="undefined"!=typeof t?t:d,o=[];return n==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[0]=r.toPixelLogScale(e[0],v.xorigin,v.xmin,v.xmax,v.xscale):o[0]=v.xorigin+v.xscale*(e[0]-v.xmin),i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[1]=r.toPixelLogScale(e[1],v.yorigin,v.ymin,v.ymax,v.yscale):c?o[1]=P.top+v.yscale*(v.ymin-e[1]):o[1]=v.yorigin+v.yscale*(e[1]-v.ymin),o},r.toPixelMod=function(e){var t=[];return t[0]=e[0]*v.xscale,t[1]=e[1]*v.yscale,t},r.toPanelPosition=function(e,t){var n="undefined"!=typeof t?t:S,i="undefined"!=typeof t?t:d,o=[];return n==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[0]=r.toPanelLogScale(e[0],v.xorigin,v.xmin,v.xmax,v.xscale):o[0]=v.xmin+(e[0]-v.xorigin)/v.xscale,i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[1]=r.toPanelLogScale(e[1],v.yorigin,v.ymin,v.ymax,v.yscale):c?o[1]=v.ymin-(e[1]-P.top)/v.yscale:o[1]=v.ymin+(e[1]-v.yorigin)/v.yscale,o},r.toPanelMod=function(e){var t=[];return t[0]=0==v.xscale?0:e[0]/v.xscale,t[1]=0==v.yscale?0:e[1]/v.yscale,t},r.toPixelLogScale=function(e,t,r,n,i){var o=0>=r?1:Math.log(r)/Math.log(10),s=0>=n?1:Math.log(n)/Math.log(10),a=(n-r)*i,l=s-o,u=a/l,g=0>=e?0:Math.log(e)/Math.log(10);return t+u*(g-o)},r.toPanelLogScale=function(e,t,r,n,i){var o=0>r?0:Math.log(r)/Math.log(10),s=0>n?0:Math.log(n)/Math.log(10),a=(n-r)*i,l=s-o,u=a/l;return Math.pow(10,o+(e-t)/u)},r.getPixelPositionWorldOrigin=function(){return[v.xorigin,v.yorigin]},r.scale=function(){R=!0,l=!0},r.touch=function(){R=!0,l=!0;for(var e=0,t=a.length;t>e;e++)a[e].setChanged(!0)},r.recomputeScales=function(){var e,t,n=!1,o=(v.xmaxMeasured-v.xminMeasured)/2,s=(v.ymaxMeasured-v.yminMeasured)/2,l=v.xminMeasured-Math.abs(o*v.xmargin/100),u=v.xmaxMeasured+Math.abs(o*v.xmargin/100),g=v.yminMeasured-Math.abs(s*v.ymargin/100),c=v.ymaxMeasured+Math.abs(s*v.ymargin/100),S=i.getWidth()-(P.left+P.right),d=i.getHeight()-(P.bottom+P.top),f=S/(u-l),E=d/(c-g);if(v.squareAspect&&(e=Math.abs(f/E),e>=1?(e=Math.min(e,S),t=(u-l)*(e-1)/2,l-=t,u+=t,f=S/(u-l)):(e=Math.max(e,1/d),t=(c-g)*(1/e-1)/2,g-=t,c+=t,E=d/(c-g))),n=v.xscale!=f||v.yscale!=-E,v.xscale=f,v.yscale=-E,v.xorigin=P.left+.5,v.yorigin=d+P.top+.5,R=!1,v.xmin!==l||v.xmax!==u||v.ymin!==g||v.ymax!==c){v.xmin=l,v.xmax=u,v.ymin=g,v.ymax=c;var p=r.reportDecorations("bounds");p&&(_=!0),n=!0}if(n)for(var h=0,m=a.length;m>h;h++)a[h].setMustProject(!0)},r.reportDecorations=function(e){var t,r,n=!1;for(t=0,r=s.length;r>t;t++)n|=s[t].panelChangeListener&&s[t].panelChangeListener("bounds");for(t=0,r=f.length;r>t;t++)f[t].panelChangeListener&&f[t].panelChangeListener("bounds");return n},r.checkMeasure=function(){var e=Number.MAX_VALUE,t=-Number.MAX_VALUE,n=Number.MAX_VALUE,i=-Number.MAX_VALUE;if(r.getAutoScaleY()||r.getAutoScaleX())for(var o=0,s=a.length;s>o;o++)if(a[o].isMeasured()&&!a[o].isGroup())if(a[o].isPixelSize()){var l=a[o].getPosition();e=Math.min(e,l[0]),t=Math.max(t,l[0]),n=Math.min(n,l[1]),i=Math.max(i,l[1])}else{var u=a[o].getBounds();e=Math.min(e,u.left),t=Math.max(t,u.right),n=Math.min(n,u.bottom),i=Math.max(i,u.top)}var g=!1;r.getAutoScaleX()?(isNaN(v.xminPreferred)||(e=Math.min(e,v.xminPreferred)),isNaN(v.xmaxPreferred)||(t=Math.max(t,v.xmaxPreferred)),e>=t?(g=v.xminMeasured!=m||v.xmaxMeasured!=A,v.xminMeasured=m,v.xmaxMeasured=A):(g=v.xminMeasured!=e||v.xmaxMeasured!=t,v.xminMeasured=e,v.xmaxMeasured=t)):isNaN(v.xminPreferred)||isNaN(v.xmaxPreferred)?(g=v.xminMeasured!=m||v.xmaxMeasured!=A,v.xminMeasured=m,v.xmaxMeasured=A):(g=v.xminMeasured!=v.xminPreferred||v.xmaxMeasured!=v.xmaxPreferred,v.xminMeasured=v.xminPreferred,v.xmaxMeasured=v.xmaxPreferred);var c=!1;return r.getAutoScaleY()?(isNaN(v.yminPreferred)||(n=Math.min(n,v.yminPreferred)),
isNaN(v.ymaxPreferred)||(i=Math.max(i,v.ymaxPreferred)),n>=i?(c=v.yminMeasured!=y||v.ymaxMeasured!=D,v.yminMeasured=y,v.ymaxMeasured=D):(c=v.yminMeasured!=n||v.ymaxMeasured!=i,v.yminMeasured=n,v.ymaxMeasured=i)):isNaN(v.yminPreferred)||isNaN(v.ymaxPreferred)?(c=v.yminMeasured!=y||v.ymaxMeasured!=D,v.yminMeasured=y,v.ymaxMeasured=D):(c=v.yminMeasured!=v.yminPreferred||v.ymaxMeasured!=v.ymaxPreferred,v.yminMeasured=v.yminPreferred,v.ymaxMeasured=v.ymaxPreferred),g||c},r.reset=function(){i.reset()},r.render=function(){var e=!1;(i.setImageData||l)&&(i.reset(),e=!0,l=!1);for(var t=0,n=h.length;n>t;t++)h[t].dataCollected();var o=r.checkMeasure();(R||o)&&r.recomputeScales(),(_||e)&&(i.drawPanel(r),i.draw(s)),i.draw(a,e),(_||e)&&i.drawGutters(r),i.draw(f),_=!1;for(var t=0,n=a.length;n>t;t++)a[t].setChanged(!1)},r.setEnabled=function(e){t.setEnabled(e)},r.setStopGestures=function(e){t.setStopGestures(e)},r.getPanelInteraction=function(){return t},r.getController=function(){return C},r.setController=function(e){C=e},r.getOnMoveHandler=null,r.getOnPressHandler=function(){if(E){var e=t.getInteractionPoint(),n=r.getRealWorldCoordinates();n[0]<e[0]&&n[1]>e[0]&&n[3]>e[1]&&n[2]<e[1]&&(G.setText(e),G.setVisible(!0),G.getController().propertiesChanged("Visible","Text"))}},r.getOnDragHandler=function(){if(E){var e=t.getInteractionPoint(),n=r.getRealWorldCoordinates();n[0]<e[0]&&n[1]>e[0]&&n[3]>e[1]&&n[2]<e[1]&&(G.setText(e),G.setVisible(!0),G.getController().propertiesChanged("Visible","Text"))}if(p){var i=t.getInteractionBounds();i.length>0&&S==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM&&d==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM?(T.setBounds(i),T.setVisible(!0),T.getController().propertiesChanged("Position","X","Y","Size","SizeX","SizeY","Visible")):(T.setVisible(!1),T.getController().propertiesChanged("Visible"))}},r.getOnReleaseHandler=function(){E&&(G.setVisible(!1),G.getController().propertiesChanged("Visible")),p&&(T.setVisible(!1),T.getController().propertiesChanged("Visible"))},r.getMessageDecoration=function(e){switch(e){case"TL":return N;case"BR":return M;case"BL":return O}return b},r.getCoordinates=function(){return G},r.getInteraction=function(){return t},r.registerProperties=function(e){EJSS_DRAWING2D.DrawingPanel.registerProperties(r,e)},r.serialize=function(){return{mStyle:o.serialize(),mTopDecorations:f,mBottomDecorations:s,mElements:a,mCollectersList:h,mAutoScaleX:u,mAutoScaleY:g,mInvertedScaleY:c,mTypeScaleX:S,mTypeScaleY:d,mShowCoordinates:E,xmindef:m,xmaxdef:A,ymindef:y,ymaxdef:D,mWorld:v,mGutters:P,mGuttersStyle:I.serialize()}},r.unserialize=function(e){o.unserialize(e.mStyle),u=e.mAutoScaleX,g=e.mAutoScaleY,c=e.mInvertedScaleY,S=e.mTypeScaleX,d=e.mTypeScaleY,E=e.mShowCoordinates,m=e.xmindef,A=e.xmaxdef,y=e.ymindef,D=e.ymaxdef,v=e.mWorld,P=e.mGutters,I.unserialize(e.mGuttersStyle),_=!0},o.setLineColor("black"),o.setFillColor("rgb(239,239,255)"),o.setChangeListener(function(e){_=!0}),I.setChangeListener(function(e){_=!0});var T=EJSS_DRAWING2D.shape(e+"__cursorBox__");T.setShapeType(EJSS_DRAWING2D.Shape.RECTANGLE),T.getStyle().setDrawFill(!1),T.getStyle().setLineColor("black"),T.setRelativePosition("CENTER"),T.setVisible(!1),r.addDecoration(T,0,!0);var N=EJSS_DRAWING2D.text(e+"__tlmessage__");N.setRelativePosition("NORTH_WEST"),N.getStyle().setDrawLines(!0),N.getStyle().setDrawFill(!0),N.getStyle().setFillColor("yellow"),N.getStyle().setLineColor("black"),N.getFont().setFontSize(12),N.setPosition([v.xmin,v.ymax]),N.setFramed(!0),N.panelChangeListener=function(e){"bounds"==e&&(r.getInvertedScaleY()?N.setPosition([v.xmin,v.ymin]):N.setPosition([v.xmin,v.ymax]))},r.addDecoration(N,0,!0);var O=EJSS_DRAWING2D.text(e+"__blmessage__");O.setRelativePosition("SOUTH_WEST"),O.getStyle().setDrawLines(!0),O.getStyle().setDrawFill(!0),O.getStyle().setFillColor("yellow"),O.getStyle().setLineColor("black"),O.getFont().setFontSize(12),O.setPosition([v.xmin,v.ymin]),O.setFramed(!0),O.panelChangeListener=function(e){"bounds"==e&&(r.getInvertedScaleY()?O.setPosition([v.xmin,v.ymax]):O.setPosition([v.xmin,v.ymin]))},r.addDecoration(O,0,!0);var M=EJSS_DRAWING2D.text(e+"__brmessage__");M.setRelativePosition("SOUTH_EAST"),M.getStyle().setDrawLines(!0),M.getStyle().setDrawFill(!0),M.getStyle().setFillColor("yellow"),M.getStyle().setLineColor("black"),M.getFont().setFontSize(12),M.setPosition([v.xmax,v.ymin]),M.setFramed(!0),M.panelChangeListener=function(e){"bounds"==e&&(r.getInvertedScaleY()?M.setPosition([v.xmax,v.ymax]):M.setPosition([v.xmax,v.ymin]))},r.addDecoration(M,0,!0);var b=EJSS_DRAWING2D.text(e+"__trmessage__");b.setRelativePosition("NORTH_EAST"),b.getStyle().setDrawLines(!0),b.getStyle().setDrawFill(!0),b.getStyle().setFillColor("yellow"),b.getStyle().setLineColor("black"),b.getFont().setFontSize(12),b.setPosition([v.xmax,v.ymax]),b.setFramed(!0),b.panelChangeListener=function(e){"bounds"==e&&(r.getInvertedScaleY()?b.setPosition([v.xmax,v.ymin]):b.setPosition([v.xmax,v.ymax]))},r.addDecoration(b,0,!0);var G=EJSS_DRAWING2D.infoText(e+"__coor__");return G.setRelativePosition("SOUTH_WEST"),G.getFont().setFontSize(12),G.getStyle().setFillColor("yellow"),G.setPosition([v.xmin,v.ymin]),G.setFormat("x:0.##,y:0.##"),G.setFramed(!0),G.setVisible(!1),G.panelChangeListener=function(e){"bounds"==e&&(r.getInvertedScaleY()?G.setPosition([v.xmin,v.ymax]):G.setPosition([v.xmin,v.ymin]))},r.addDecoration(G,0,!0),r.getGuttersStyle().setLineColor("black"),r.getGuttersStyle().setFillColor("rgb(239,239,255)"),r.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),t=EJSS_DRAWING2D.panelInteraction(r),i.getEventContext().addEventListener("dblclick",function(e){return e.preventDefault(),e.stopPropagation(),!1},!0),r.setStopGestures(!0),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Element={CENTER:0,NORTH:1,SOUTH:2,EAST:3,WEST:4,NORTH_EAST:5,NORTH_WEST:6,SOUTH_EAST:7,SOUTH_WEST:8,registerProperties:function(e,t){var r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE,i=e.getStyle();e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("PixelPosition",e.setPixelPosition,e.getPixelPosition),t.registerProperty("Diameter",function(t){e.setSize([t,t])}),t.registerProperty("Radius",function(t){e.setSize([2*t,2*t])}),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("PixelSize",e.setPixelSize,e.getPixelSize),t.registerProperty("Bounds",e.setBounds,e.getBounds),t.registerProperty("RelativePosition",e.setRelativePosition,e.getRelativePosition),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("LineColor",i.setLineColor,i.getLineColor),t.registerProperty("LineWidth",i.setLineWidth,i.getLineWidth),t.registerProperty("DrawLines",i.setDrawLines,i.getDrawLines),t.registerProperty("FillColor",i.setFillColor,i.getFillColor),t.registerProperty("DrawFill",i.setDrawFill,i.getDrawFill),t.registerProperty("ShapeRendering",i.setShapeRendering,i.getShapeRendering),t.registerProperty("Attributes",i.setAttributes,i.getAttributes),t.registerProperty("EnabledPosition",function(t){e.getInteractionTarget(r).setMotionEnabled(t)}),t.registerProperty("MovesGroup",function(t){e.getInteractionTarget(r).setAffectsGroup(t)}),t.registerProperty("EnabledSize",function(t){e.getInteractionTarget(n).setMotionEnabled(t)}),t.registerProperty("ResizesGroup",function(t){e.getInteractionTarget(n).setAffectsGroup(t)}),t.registerProperty("Sensitivity",function(t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition)},copyTo:function(e,t){var r=EJSS_DRAWING2D.InteractionTarget,n=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,i=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;EJSS_DRAWING2D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setPixelPosition(e.isPixelPosition()),t.setSize(e.getSize()),t.setPixelSize(e.isPixelSize()),t.setTransformation(e.getTransformation()),t.setRelativePosition(e.getRelativePosition()),r.copyTo(e.getInteractionTarget(n),t.getInteractionTarget(n)),r.copyTo(e.getInteractionTarget(i),t.getInteractionTarget(i)),t.setParent(e.getParent())},getRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=0,o=0;break;case EJSS_DRAWING2D.Element.NORTH:i=0,o=-(r/2);break;case EJSS_DRAWING2D.Element.SOUTH:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.EAST:i=-(t/2),o=0;break;case EJSS_DRAWING2D.Element.WEST:i=t/2,o=0;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-(t/2),o=-(r/2);break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=t/2,o=-(r/2);break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-(t/2),o=r/2;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=t/2,o=r/2}return"undefined"!=typeof n&&n&&(o=-o),[i,o]},getSWRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=-(t/2),o=r/2;break;case EJSS_DRAWING2D.Element.NORTH:i=-(t/2),o=r;break;case EJSS_DRAWING2D.Element.SOUTH:i=-(t/2),o=0;break;case EJSS_DRAWING2D.Element.EAST:i=-t,o=r/2;break;case EJSS_DRAWING2D.Element.WEST:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-t,o=r;break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=0,o=r;break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-t,o=0;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=0,o=0}return"undefined"!=typeof n&&n&&(o=-o),[i,o]}},EJSS_DRAWING2D.element=function(e){var t={},r=EJSS_DRAWING2D.Element,n=EJSS_DRAWING2D.PanelInteraction,i=EJSS_DRAWING2D.style(e),o=!0,s=!0,a=r.CENTER,l=0,u=0,g=!1,c=1,S=1,d=!1,f=0,E={positionTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_POSITION,r.CENTER),sizeTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_SIZE,r.NORTH_EAST)},p=null,h=null,m=null,A=-1,y=[],D=[],v=!0,P=!0,I={propertiesChanged:function(){},invokeAction:function(){}};return t.getName=function(){return e},t.setParent=function(e){e.render?(t.setGroup(null),e.addElement(t),t.setPanel(e)):"ElementGroup"==e.getClass()?(t.setGroup(e),t.getGroupPanel().addElement(t),t.setPanel(t.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},t.getParent=function(){var e;return e=null!==h?t.getGroup():t.getPanel()},t.isGroup=function(){return!1},t.getStyle=function(){return i},t.setX=function(e,t){l!=e&&(l=e,P=!0)},t.getX=function(){return l},t.setY=function(e){u!=e&&(u=e,P=!0)},t.getY=function(){return u},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1])},t.getPosition=function(){return[l,u]},t.setPixelPosition=function(e){g!=e&&(g=e,P=!0)},t.isPixelPosition=function(){return g},t.setSizeX=function(e){c!=e&&(c=e,P=!0)},t.getSizeX=function(){return c},t.setSizeY=function(e){S!=e&&(S=e,P=!0)},t.getSizeY=function(){return S},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1])},t.getSize=function(){return[t.getSizeX(),t.getSizeY()]},t.setPixelSize=function(e){d!=e&&(d=e,P=!0)},t.isPixelSize=function(){return d},t.setBounds=function(e){var r,n,i,o;e.left?(r=e.left,n=e.right,i=e.top,o=e.bottom):(r=e[0],n=e[1],i=e[2],o=e[3]);var s=n-r,a=o-i,l=t.getRelativePositionOffset(s,a),u=s/2,g=a/2,c=r+u-l[0],S=i+g-l[1];t.setX(c),t.setY(S),t.setSizeX(s),t.setSizeY(a)},t.getBounds=function(){var e=d?p.toPanelMod([c,-S]):[c,S],r=e[0]/2,n=e[1]/2,i=t.getRelativePositionOffset(e[0],e[1]);return{left:l+i[0]-r,right:l+i[0]+r,top:u+i[1]+n,bottom:u+i[1]-n}},t.setRelativePosition=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),a!=e&&(a=e,P=!0)},t.getRelativePosition=function(){return a},t.getRelativePositionOffset=function(e,t){var n,i;Array.isArray(e)?(n=e[0],i=e[1]):(n=e,i=t);var o=p.getInvertedScaleY?p.getInvertedScaleY():!1;return r.getRelativePositionOffset(a,n,i,o)},t.setVisible=function(e){e!=o&&(o=e,P=!0)},t.isVisible=function(){return o},t.isGroupVisible=function(){for(var e=h;"undefined"!=typeof e&&null!==e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},t.setMeasured=function(e){s=e},t.isMeasured=function(){return s},t.setTransformation=function(e){"undefined"==typeof e||null===e?f=0:Array.isArray(e)&&e.length>5?EJSS_TOOLS.compareArrays(f,e)||(f=e,P=!0):f!=e&&(f=e,P=!0)},t.getTransformation=function(){return f},t.getInfo=function(){var e="x="+l.toFixed(2)+" y="+u.toFixed(2);return e},t.setPanel=function(e){p=e,v=!0},t.getPanel=function(){return p},t.getGroupPanel=function(){for(var e=t;e.getGroup();)e=e.getGroup();return e.getPanel()},t.setGroup=function(e){h=e,P=!0},t.getGroup=function(){return h},t.setSet=function(e,t){m=e,A=t},t.getSet=function(){return m},t.getSetIndex=function(){return A},t.isChanged=function(){return P},t.setChanged=function(e){P=e},t.isGroupChanged=function(){for(var e=t.getGroup();"undefined"!=typeof e&&null!==e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},t.setMustProject=function(e){v=e},t.isMustProject=function(){return v},t.getPixelPosition=function(){return(t.isChanged()||t.isGroupChanged()||t.isMustProject())&&(y=t.getPixelPositionOf(l,u),D=t.getPixelSizeOf(c,S),t.setMustProject(!1)),y},t.getPixelSizes=function(){return(t.isChanged()||t.isGroupChanged()||t.isMustProject())&&(y=t.getPixelPositionOf(l,u),D=t.getPixelSizeOf(c,S),t.setMustProject(!1)),D},t.getAbsoluteSize=function(){var e=d?p.toPanelMod([c,-S]):[c,S];return t.toGroupSpaceMod(e)},t.getAbsolutePosition=function(){var e;return e=g?null===h?p.toPanelPosition([l,u]):p.toPanelPosition([l,u],EJSS_DRAWING2D.DrawingPanel.SCALE_NUM):[l,u],t.toGroupSpace(e)},t.getPixelSizeOf=function(e,r){return d?[e,-r]:t.getGroupPanel().toPixelMod(t.toGroupSpaceMod([e,r]))},t.getPixelPositionOf=function(e,r){var n;return n=g?[t.getGroupPanel().toPixelAxisX(e),t.getGroupPanel().toPixelAxisY(r)]:null===h?t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r])):t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r]),EJSS_DRAWING2D.DrawingPanel.SCALE_NUM)},t.toGroupSpaceMod=function(e){for(var t=h;"undefined"!=typeof t&&null!==t;)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),t=t.getGroup();return e},t.toGroupSpace=function(e){for(var t=h;"undefined"!=typeof t&&null!==t;)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),e[0]+=t.getX(),e[1]+=t.getY(),t=t.getGroup();return e},t.getController=function(){return I},t.setController=function(e){I=e},t.getInteractionTarget=function(e){switch(e){case n.TARGET_POSITION:return E.positionTarget;case n.TARGET_SIZE:return E.sizeTarget}return null},t.getInteractionTargets=function(){return[E.positionTarget,E.sizeTarget]},t.registerProperties=function(e){EJSS_DRAWING2D.Element.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Element.copyTo(t,e)},t.serialize=function(){return{mStyle:i.serialize(),mVisible:o,mMeasured:s,mRelativePosition:a,mX:l,mY:u,mPixelPosition:g,mSizeX:c,mSizeY:S,mPixelSize:d,mTransformation:f,mInteraction:{},mPanel:p?p.getName():p,mGroup:h?h.getName():h,mSet:m?m.getName():m,mIndexInSet:A,mProjectedPosition:y,mProjectedSize:D}},t.unserialize=function(e){i.unserialize(e.mStyle),o=e.mVisible,s=e.mMeasured,a=e.mRelativePosition,l=e.mX,u=e.mY,g=e.mPixelPosition,c=e.mSizeX,S=e.mSizeY,d=e.mPixelSize,f=e.mTransformation,A=e.mIndexInSet,y=e.mProjectedPosition,D=e.mProjectedSize,P=!0},i.setChangeListener(function(e){P=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ElementSet={registerProperties:function(e,t){var r=(EJSS_DRAWING2D.Element,EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION),n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("PixelPosition",function(t){e.setToEach(function(e,t){e.setPixelPosition(t)},t)}),t.registerProperty("Diameter",function(t){e.setToEach(function(e,t){e.setSize([t,t])},t)}),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setSize([2*t,2*t])},t)}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("PixelSize",function(t){e.setToEach(function(e,t){e.setPixelSize(t)},t)}),t.registerProperty("Bounds",function(t){var r=function(e,t){e.setX(t[0]),e.setY(t[2]),e.setSizeX(t[1]-t[0]),e.setSizeY(t[3]-t[2])};e.setToEach(r,t)},function(){var t=function(e){return[e.getX(),e.getX()+e.getSizeX(),e.getY(),e.getY()+e.getSizeY()]};return e.getFromEach(t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("RelativePosition",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("Attributes",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ShapeRendering",function(t){e.setToEach(function(e,t){e.getStyle().setShapeRendering(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setMotionEnabled(t)},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setAffectsGroup(t)},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){e.getInteractionTarget(n).setMotionEnabled(t)},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(n).setAffectsGroup(t)},t)}),t.registerProperty("Sensitivity",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)},t)});var i=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",i),t.registerAction("OnExit",i),t.registerAction("OnPress",i),t.registerAction("OnDrag",i),t.registerAction("OnRelease",i)}},EJSS_DRAWING2D.elementSet=function(e,t){var r=EJSS_DRAWING2D.group(t),n=EJSS_DRAWING2D.ElementSet,i=[],o=-1,s=[];r.setNumberOfElements=function(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){s=i.splice(t,o);for(var a=0;a<s.length;a++){var l=s[a].getPanel();l&&l.removeElement(s[a])}}else if(0>o){s=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;t>c;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}},r.getElements=function(){return i},r.getElement=function(e){return i[e]},r.getLastElements=function(){var e=s.slice();return s=[],e},r.setElementInteracted=function(e){o=e},r.getElementInteracted=function(){return o};var a=r.setPanel;r.setPanel=function(e){a(e);for(var t=0,r=i.length;r>t;t++)i[t].setPanel(e)},r.setToEach=function(e,t){if(Array.isArray(t)){1==i.length&&r.setNumberOfElements(t.length);for(var n=0,o=Math.min(i.length,t.length);o>n;n++)e(i[n],t[n])}else for(var n=0,o=i.length;o>n;n++)e(i[n],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;n>r;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var l=e(t+"[0]");return l.setController(r.getController()),l.setSet(r,0),i.push(l),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Grid={SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("StepX",e.setStepX,e.getStepX),t.registerProperty("StepY",e.setStepY,e.getStepY),t.registerProperty("TicksX",e.setTicksX,e.getTicksX),t.registerProperty("TicksY",e.setTicksY,e.getTicksY),t.registerProperty("TickStepX",e.setTickStepX,e.getTickStepX),t.registerProperty("TickStepY",e.setTickStepY,e.getTickStepY),t.registerProperty("TicksXMode",e.setTicksXMode,e.getTicksXMode),t.registerProperty("TicksYMode",e.setTicksYMode,e.getTicksYMode),t.registerProperty("ShowX",e.setShowX,e.getShowX),t.registerProperty("ShowY",e.setShowY,e.getShowY),t.registerProperty("FixedTickX",e.setFixedTickX,e.getFixedTickX),t.registerProperty("FixedTickY",e.setFixedTickY,e.getFixedTickY),t.registerProperty("ScaleX",e.setScaleX,e.getScaleX),t.registerProperty("ScaleY",e.setScaleY,e.getScaleY),t.registerProperty("ScalePrecisionX",e.setScalePrecisionX,e.getScalePrecisionX),t.registerProperty("ScalePrecisionY",e.setScalePrecisionY,e.getScalePrecisionY),t.registerProperty("AutoTicksX",e.setAutoTicksX,e.getAutoTicksX),t.registerProperty("AutoTicksY",e.setAutoTicksY,e.getAutoTicksY),t.registerProperty("AutoStepXMin",e.setAutoStepXMin,e.getAutoStepXMin),t.registerProperty("AutoStepYMin",e.setAutoStepYMin,e.getAutoStepYMin),t.registerProperty("AutoTicksXRange",e.setAutoTicksXRange,e.getAutoTicksXRange),t.registerProperty("AutoTicksYRange",e.setAutoTicksYRange,e.getAutoTicksYRange),t.registerProperty("LineColorX",e.setLineColorX,e.getLineColorX),t.registerProperty("LineWidthX",e.setLineWidthX,e.getLineWidthX),t.registerProperty("ShapeRenderingX",e.setShapeRenderingX,e.getShapeRenderingX),t.registerProperty("LineColorY",e.setLineColorY,e.getLineColorY),t.registerProperty("LineWidthY",e.setLineWidthY,e.getLineWidthY),t.registerProperty("ShapeRenderingY",e.setShapeRenderingY,e.getShapeRenderingY)}},EJSS_DRAWING2D.grid=function(e){var t=EJSS_DRAWING2D.element(e),r=!0,n=!0,i=0,o=0,s=0,a=0,l=0,u=0,g=!0,c=!0,S=Number.NaN,d=Number.NaN,f=[-1,1],E=[-1,1],p=1,h=1,m=EJSS_DRAWING2D.Grid.SCALE_NUM,A=EJSS_DRAWING2D.Grid.SCALE_NUM,y=40,D=40,v=[5,10,20],P=[5,10,20],I="black",_=.5,R=EJSS_DRAWING2D.Style.RENDER_AUTO,C="black",T=.5,N=EJSS_DRAWING2D.Style.RENDER_AUTO;return t.getClass=function(){return"ElementGrid"},t.setAutoTicksRangeY=function(e){P!=e&&(P=e,t.setChanged(!0))},t.getAutoTicksRangeY=function(){return P},t.setAutoTicksRangeX=function(e){v!=e&&(v=e,t.setChanged(!0))},t.getAutoTicksRangeX=function(){return v},t.setAutoStepYMin=function(e){D!=e&&(D=e,t.setChanged(!0))},t.getAutoStepYMin=function(){return D},t.setAutoStepXMin=function(e){y!=e&&(y=e,t.setChanged(!0))},t.getAutoStepXMin=function(){return y},t.setScaleY=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getScaleY=function(){return E},t.setScaleX=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getScaleX=function(){return f},t.setScalePrecisionX=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getScalePrecisionX=function(){return p},t.setScalePrecisionY=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getScalePrecisionY=function(){return h},t.setFixedTickX=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getFixedTickX=function(){return S},t.setFixedTickY=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getFixedTickY=function(){return d},t.setAutoTicksX=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicksX=function(){return r},t.setAutoTicksY=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getAutoTicksY=function(){return n},t.setStepX=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getStepX=function(){return s},t.setStepY=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getStepY=function(){return a},t.setTickStepX=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getTickStepX=function(){return l},t.setTickStepY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getTickStepY=function(){return u},t.setTicksX=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getTicksX=function(){return i},t.setTicksY=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTicksY=function(){return o},t.setTicksXMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),m!=e&&(m=e,t.setChanged(!0))},t.getTicksXMode=function(){return m},t.setTicksYMode=function(e){"string"==typeof e&&(ticksXMode=EJSS_DRAWING2D.Grid[e.toUpperCase()]),A!=e&&(A=e,t.setChanged(!0))},t.setShowX=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getShowX=function(){return g},t.setShowY=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getShowY=function(){return c},t.getTicksYMode=function(){return A},t.setLineColorX=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=I&&(I=e,t.setChanged(!0)),t},t.getLineColorX=function(){return I},t.setLineWidthX=function(e){e!=_&&(_=e,t.setChanged(!0))},t.getLineWidthX=function(){return _},t.setShapeRenderingX=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),R!=e&&(R=e,t.setChanged(!0))},t.getShapeRenderingX=function(){return R},t.setLineColorY=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=C&&(C=e,t.setChanged(!0)),t},t.getLineColorY=function(){return C},t.setLineWidthY=function(e){e!=T&&(T=e,t.setChanged(!0))},t.getLineWidthY=function(){return T},t.setShapeRenderingY=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),N!=e&&(N=e,t.setChanged(!0))},t.getShapeRenderingY=function(){return N},t.registerProperties=function(e){EJSS_DRAWING2D.Grid.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Group={},EJSS_DRAWING2D.group=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t},EJSS_DRAWING2D.GroupSet={},EJSS_DRAWING2D.groupSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.group,e);return t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Histogram={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setInput(e.getInput()),t.setEnabled(e.getEnabled()),t.setOccurrences(e.getOccurrences()),t.setClearAtInput(e.getClearAtInput()),t.setDiscrete(e.getDiscrete()),t.setNormalized(e.getNormalized()),t.setBinWidth(e.getBinWidth())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Input",e.addInput),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("Occurrences",e.setOccurrences,e.getOccurrences),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Discrete",e.setDiscrete,e.getDiscrete),t.registerProperty("Normalized",e.setNormalized,e.getNormalized),t.registerProperty("BinWidth",e.setBinWidth,e.getBinWidth),t.registerProperty("FixBin",e.setFixBin,e.getFixBin)}},EJSS_DRAWING2D.histogram=function(e){var t=EJSS_DRAWING2D.element(e),r=[],n=!0,i=1,o=!1,s=!1,a=!1,l=1,u=0,g=null;return t.getClass=function(){return"ElementHistogram"},t.dataCollected=function(){},t.getInput=function(){return r},t.addInput=function(e){if(n){o&&t.clear();for(var s=0;i>s;s++)e instanceof Array?r=r.concat(e):r.push(e);g=null,t.setChanged(!0)}},t.clear=function(){r=[],g=null,t.setChanged(!0)},t.getClearAtInput=function(){return o},t.setClearAtInput=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getActive=function(){return n},t.setActive=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getOccurrences=function(){return i},t.setOccurrences=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getDiscrete=function(){return s},t.setDiscrete=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getNormalized=function(){return a},t.setNormalized=function(e){a!=e&&(a=e,g=null,t.setChanged(!0))},t.getBinWidth=function(){return l},t.setBinWidth=function(e){l!=e&&(l=e,g=null,t.setChanged(!0))},t.getFixBin=function(){return u},t.setFixBin=function(e){u!=e&&(u=e,g=null,t.setChanged(!0))},t.getBars=function(){if(null!=g)return g;if(0==r.length)return g=[[0,0]];g=[],r=r.sort(function(e,t){return e-t});var e,t=l/2;e=0==l?r[0]:u-t>r[0]?u-(Math.floor((u-t-r[0])/l)+1)*l:u+t<r[0]?u+Math.floor((r[0]-u-t)/l)*l:u;for(var n=e,i=0,o=r.length,s=0;o>s;s++)r[s]<=n+t?i++:(i>0&&(a&&(i/=o),g.push([n,i])),0==l?n=r[s]:n+=(Math.floor((r[s]-n-t)/l)+1)*l,i=1);return i>0&&(a&&(i/=o),g.push([n,i])),g},t.getBounds=function(e){t.getBars();for(var r=g.length,n=g[0][0],i=g[r-1][0],o=0,s=0,a=0;r>a;a++)s=Math.max(s,g[a][1]);var l=t.getX(),u=t.getY(),c=t.getSizeX(),S=t.getSizeY(),d=c/2,f=S/2,E=t.getRelativePositionOffset(c,S);return{left:l+E[0]-d+n*c,right:l+E[0]-d+i*c,top:u+E[1]-f+s*S,bottom:u+E[1]-f+o*S}},t.getBoundsOld=function(e){var n,i,o,s,l=r.length;if(0==l)n=i=o=s=0;else{console.log("mCurrentInput="+r);var u=r.sort(function(e,t){return e-t}),g=u.length;n=u[0],i=u[g-1],s=0,o=0;var c=[];if(u.forEach(function(e){c[e]=(c[e]||0)+1}),a)for(var S in c)c[S]/=g;for(var S in c)c[S]>s&&(s=c[S])}var d=t.getX(),S=t.getY(),f=t.getSizeX(),E=t.getSizeY(),p=f/2,h=E/2,m=t.getRelativePositionOffset(f,E);return{left:d+m[0]-p+n*f,right:d+m[0]-p+i*f,top:S+m[1]-h+s*E,bottom:S+m[1]-h+o*E}},t.registerProperties=function(e){EJSS_DRAWING2D.Histogram.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Histogram.copyTo(t,e)},t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Image={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setImageUrl(e.getImageUrl())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Encode",e.setEncode)}},EJSS_DRAWING2D.image=function(e){var t=EJSS_DRAWING2D.element(e),r="",n="",i=!1;return t.getClass=function(){return"ElementImage"},t.setImageUrl=function(e){var n=t.getSet(),i=null!=n?n.getResourcePath:t.getResourcePath;null!=i?e=i(e):console.log("No getResourcePath function for "+t.getName()+". Texture = "+e),r!=e&&(r=e,t.setChanged(!0),t.setChangedImage(!0))},t.getImageUrl=function(){return r},t.forceImageUrl=function(e){console.log("Setting image to "+e),r=e,t.setChanged(!0),t.setChangedImage(!0)},t.setChangedImage=function(e){i=e},t.getChangedImage=function(){return i},t.setEncode=function(e){n.length!=e.length&&(n=e,t.setChanged(!0),t.setChangedImage(!0))},t.getEncode=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Image.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Image.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ImageSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("ImageUrl",function(t){e.setToEach(function(e,t){e.setImageUrl(t)},t)})}},EJSS_DRAWING2D.imageSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.image,e),r=EJSS_DRAWING2D.ImageSet;return t.registerProperties=function(e){r.registerProperties(t,e);
},t};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.byteRaster=function(e,t){if(t.getDataChanged()){var r=t.getData(),n=t.getColorMapper().getColors(),i=r.length,o=r[0].length,s=t.getColorMapper().getNumberOfColors(),a=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=a[0]+u[0],c=a[1]+u[1],S=(Math.abs(l[0]/2),Math.abs(l[1]/2)),d=e.canvas.id;EJSS_SVGGRAPHICS.Utils.ImageDataCanvas(i,o,s,r,n,function(t){var r=document.getElementById(d);e=r.getContext("2d"),e.putImageData(t,g-S,c-S)}),t.setDataChanged(!1)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.ellipse=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],s=r[1]+i[1],a=Math.abs(n[0]),l=Math.abs(n[1]),u=.5522848,g=o-a/2,c=s-l/2;ox=a/2*u,oy=l/2*u,xe=g+a,ye=c+l,e.beginPath(),e.moveTo(g,s),e.bezierCurveTo(g,s-oy,o-ox,c,o,c),e.bezierCurveTo(o+ox,c,xe,s-oy,xe,s),e.bezierCurveTo(xe,s+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,g,s+oy,g,s);var S=t.getStyle();S.getDrawFill()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.point=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],s=r[1]+i[1];e.beginPath(),e.arc(o,s,2,0,2*Math.PI);var a=t.getStyle();e.fillStyle=a.getFillColor(),e.fill()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.rectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],s=r[1]+i[1],a=Math.abs(n[0]),l=Math.abs(n[1]);e.beginPath(),e.rect(o-a/2,s-l/2,a,l);var u=t.getStyle();u.getDrawFill()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.roundRectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],s=r[1]+i[1],a=Math.abs(n[0]),l=Math.abs(n[1]),u=o-a/2,g=s-l/2,c=Math.abs(t.getCornerRadius());e.beginPath(),e.moveTo(u+c,g),e.lineTo(u+a-c,g),e.quadraticCurveTo(u+a,g,u+a,g+c),e.lineTo(u+a,g+l-c),e.quadraticCurveTo(u+a,g+l,u+a-c,g+l),e.lineTo(u+c,g+l),e.quadraticCurveTo(u,g+l,u,g+l-c),e.lineTo(u,g+c),e.quadraticCurveTo(u,g,u+c,g),e.closePath();var S=t.getStyle();S.getDrawFill()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.segment=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],s=r[1]+i[1],a=Math.abs(n[0]/2),l=Math.abs(n[1]/2);e.beginPath(),e.moveTo(o-a,s-l),e.lineTo(o+a,s+l);var u=t.getStyle();u.getDrawFill()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trail=function(e,t){function r(t,r,n,i,o,s,a){if(!(0>=r)){e.beginPath();for(var l=0;r>l;l++){var u=t[l],g=i+u[0]*s,c=o+u[1]*a,S=u[2];0==l||0==S?e.moveTo(g,c):e.lineTo(g,c)}n.getDrawLines()&&(e.lineWidth=n.getLineWidth(),e.strokeStyle=n.getLineColor(),e.stroke())}}var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),s=n[0]+o[0],a=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=s-l,c=a-u,S=i[0],d=i[1],f=t.getSegmentsCount();if(f>0)for(var E=0;f>E;E++){var p=t.getSegmentPoints(E).length;r(t.getSegmentPoints(E),p,t.getSegmentStyle(E),g,c,S,d)}var p=t.getCurrentPoints().length;r(t.getCurrentPoints(),p,t.getStyle(),g,c,S,d)};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.CanvasGraphics={getOffsetRect:function(e){var t,r,n,i,o=e.getAttribute("width"),s=e.getAttribute("height");t=parseFloat(o);var a=!isNaN(t)&&isFinite(o);r=parseFloat(s);var l=!isNaN(r)&&isFinite(s);if(e.getBoundingClientRect){var u=e.getElementById?e.getElementById(".myPanel"):null;if(u&&u.childElementCount>0)var g=u.getBoundingClientRect();else var g=e.getBoundingClientRect();n=g.top,i=g.left,a||(t=g.width),l||(r=g.height)}else if(void 0!==e.offsetTop)n=e.offsetTop,i=e.offsetLeft,a||(t=e.offsetWidth),l||(r=e.offsetHeight);else{for(var c=e.parentNode||document.getElementById(e.id).parentNode;c&&!c.offsetTop&&c&&!c.previousElementSibling&&!c.nextElementSibling;)c=c.parentNode;n=c.offsetTop,i=c.offsetLeft,a||(t=c.offsetWidth),l||(r=c.offsetHeight)}var S=document.body,d=document.documentElement,f=d.clientTop||S.clientTop||0,E=d.clientLeft||S.clientLeft||0;return n-=f,i-=E,{top:n,left:i,width:t,height:r,bottom:n+r,right:i+t}}},EJSS_GRAPHICS.canvasGraphics=function(e){var t=EJSS_INTERFACE.canvas(e),r=t.getDOMElement(),n=t.getContext();return t.getEventContext=function(){return r},t.getWidth=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r).width-1},t.getHeight=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r).height-1},t.getOffsetLeft=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r).left},t.getOffsetTop=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r).top},t.reset=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r);n.clearRect(0,0,e.width,e.height)},t.draw=function(e,r){for(var n=0,i=e.length;i>n;n++){var o=e[n];o.isGroupVisible()&&t.drawElement(o)}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape;switch(e.getClass()){case"ElementCustom":var r=e.getFunction();r&&r(n,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:EJSS_CANVASGRAPHICS.ellipse(n,e);break;case t.RECTANGLE:EJSS_CANVASGRAPHICS.rectangle(n,e);break;case t.ROUND_RECTANGLE:EJSS_CANVASGRAPHICS.roundRectangle(n,e);break;case t.NONE:case t.POINT:EJSS_CANVASGRAPHICS.point(n,e)}break;case"ElementSegment":EJSS_CANVASGRAPHICS.segment(n,e);break;case"ElementTrail":EJSS_CANVASGRAPHICS.trail(n,e);break;case"ElementByteRaster":EJSS_CANVASGRAPHICS.byteRaster(n,e)}},t.transformElement=function(e,t){console.log("Transformations are not supported!")},t.drawGutters=function(e){var r=e.getGutters();if(r.visible){var i=(EJSS_SVGGRAPHICS.Utils,e.getRealWorldCoordinates());if(e.getInvertedScaleY())var o=e.toPixelPosition([i[1],i[2]]);else var o=e.toPixelPosition([i[1],i[3]]);var s=e.toPixelMod([i[1]-i[0],i[3]-i[2]]),a=o[0],l=o[1],u=s[0],g=s[1],c=.5,S=.5,d=t.getWidth(),f=t.getHeight(),E=e.getGuttersStyle(),p=e.getStyle();E.getDrawFill()&&(n.beginPath(),n.moveTo(c,S),n.lineTo(c,S+f),n.lineTo(c+d,S+f),n.lineTo(c+d,S),n.lineTo(c,S),n.moveTo(a-u,l),n.lineTo(a,l),n.lineTo(a,l-g),n.lineTo(a-u,l-g),n.lineTo(a-u,l),n.moveTo(c,S),n.closePath(),n.fillStyle=E.getFillColor(),n.fill()),E.getDrawLines()&&(n.beginPath(),n.moveTo(c,S),n.lineTo(c,S+f),n.lineTo(c+d,S+f),n.lineTo(c+d,S),n.lineTo(c,S),n.closePath(),n.lineWidth=E.getLineWidth(),n.strokeStyle=E.getLineColor(),n.stroke()),E.getDrawLines()&&(n.beginPath(),n.moveTo(a-u,l),n.lineTo(a,l),n.lineTo(a,l-g),n.lineTo(a-u,l-g),n.lineTo(a-u,l),n.closePath(),n.lineWidth=p.getLineWidth(),n.strokeStyle=p.getLineColor(),n.stroke())}},t.drawGuttersNO=function(e){var r=e.getGutters();if(r.visible){var i=(EJSS_SVGGRAPHICS.Utils,e.getRealWorldCoordinates());if(e.getInvertedScaleY())var o=e.toPixelPosition([i[1],i[2]]);else var o=e.toPixelPosition([i[1],i[3]]);var s=e.toPixelMod([i[1]-i[0],i[3]-i[2]]),a=o[0],l=o[1],u=s[0],g=s[1],c=.5,S=.5,d=t.getWidth(),f=t.getHeight();n.beginPath(),n.moveTo(c,S),n.lineTo(c,S+f),n.lineTo(c+d,S+f),n.lineTo(c+d,S),n.lineTo(c,S),n.moveTo(a-u,l),n.lineTo(a,l),n.lineTo(a,l-g),n.lineTo(a-u,l-g),n.lineTo(a-u,l),n.moveTo(c,S),n.closePath();var E=e.getGuttersStyle();n.fillStyle=E.getFillColor(),n.fill(),E.getDrawLines()&&(n.lineWidth=E.getLineWidth(),n.strokeStyle=E.getLineColor(),n.stroke())}},t.drawPanel=function(e){var i=(EJSS_CANVASGRAPHICS.Utils,t.getWidth(),t.getHeight(),EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(r));n.beginPath(),n.rect(0,0,i.width,i.height);var o=e.getStyle();n.fillStyle=o.getFillColor(),n.fill(),o.getDrawLines()&&(n.lineWidth=o.getLineWidth(),n.strokeStyle=o.getLineColor(),n.stroke())},t};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.analyticCurve=function(e,t){function r(e,t,r,n,i){for(var o="",s=0;s<e.length;s++){var a=e[s],l=t+a[0]*n,u=r+a[1]*i,g=a[2];o+=0==s||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),n.appendChild(o));var s,a,l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=u[0]/2,f=u[1]/2,E=t.getNumPoints(),p=t.getMinimun(),h=t.getMaximun(),m="undefined"==typeof p||null===p?t.getPanel().getRealWorldXMin():p,A="undefined"==typeof h||null===h?t.getPanel().getRealWorldXMax():h,y=t.getVariable(),D=t.getFunctionX(),v=t.getFunctionY(),P=EJSS_DRAWING2D.functionsParser(),I=!1;try{s=P.parse(D)}catch(_){console.log("Analytic curve error parsing FunctionX: "+D),I=!0}if(!I)try{a=P.parse(v)}catch(R){console.log("Analytic curve error parsing FunctionY: "+v),I=!0}if(I)return void t.getController().invokeAction("OnError");var C=(A-m)/(E-1),T=[],N={},O=t.getParameters();for(var M in O)N[M]=O[M];try{for(var b=0,G=m;A>=G;G+=C){N[y]=G;var x=s.evaluate(N),L=a.evaluate(N);isNaN(x)||isNaN(L)||(T[b]=[],T[b][0]=x,T[b++][1]=L)}}catch(J){t.getController().invokeAction("OnError")}var w=r(T,c-d,S-f,u[0],u[1]);if(""!==w){o.setAttribute("d",w);var W=t.getStyle();W.getDrawFill()?o.setAttribute("fill",W.getFillColor()):o.setAttribute("fill","none"),W.getDrawLines()?(o.setAttribute("stroke",W.getLineColor()),o.setAttribute("stroke-width",W.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",W.getShapeRendering());var k=W.getAttributes();for(var V in k)o.setAttribute(V,k[V])}return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.arrow=function(e,t){function r(t,r,n,i,s,a,l,u,g,c){var S,d,f=e.getElementById(t);null===f?(f=document.createElementNS("http://www.w3.org/2000/svg","marker"),f.setAttribute("id",t),S=document.createElementNS("http://www.w3.org/2000/svg","path"),S.setAttribute("id",t+".markpath"),f.appendChild(S),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("id",t+".markpath2"),f.appendChild(d),e.getElementsByTagName("defs")[0].appendChild(f)):(S=e.getElementById(t+".markpath"),d=e.getElementById(t+".markpath2"),e.getElementsByTagName("defs")[0].insertBefore(f,f));var E=i+2*a,p=s+2*a;switch(f.setAttribute("viewBox",-a+" "+-a+" "+E+" "+p),f.setAttribute("refX",i/2),f.setAttribute("refY",s/2),f.setAttribute("markerUnits","userSpaceOnUse"),f.setAttribute("markerWidth",E),f.setAttribute("markerHeight",p),f.setAttribute("orient",n),S.setAttribute("fill",l),S.setAttribute("stroke",l),S.setAttribute("stroke-width",a),S.setAttribute("style","  marker-start :none;   marker-end :none; "),d.setAttribute("fill",u),d.setAttribute("stroke",u),d.setAttribute("stroke-width",a),d.setAttribute("style","  marker-start :none;   marker-end :none; "),r){case o.TRIANGLE:var h="M 0 0 L "+i+" "+s/2+" L 0 "+s+" z";S.setAttribute("d",h);break;case o.INVTRIANGLE:var h="M "+i+" 0 L 0 "+s/2+" L "+i+" "+s+" z";S.setAttribute("d",h);break;case o.ANGLE:f.setAttribute("markerHeight",s),f.setAttribute("refX",i);var m=-(a-1),A=s+(a-1),h="M 0 "+m+" L "+i+" "+s/2+" L 0 "+A;S.setAttribute("d",h),S.setAttribute("fill","none");break;case o.INVANGLE:f.setAttribute("markerHeight",s),f.setAttribute("refX",1);var m=-(a-1),A=s+(a-1),h="M "+i+" "+m+" L 0 "+s/2+" L "+i+" "+A;S.setAttribute("d",h),S.setAttribute("fill","none");break;case o.LINE:var h="M "+i/2+" 0 L "+i/2+" "+s+" z";S.setAttribute("d",h);break;case o.RECTANGLE:var h="M 0 0 L "+i+" 0 L "+i+" "+s+" L 0 "+s+" z";S.setAttribute("d",h);break;case o.DIAMOND:var h="M "+i/2+" 0 L "+i+" "+s/2+" L "+i/2+" "+s+" L 0 "+s/2+" z";S.setAttribute("d",h);break;case o.CIRCLE:var y=s>i?i:s;y/=2;var h="M "+i/2+" "+s/2+" m "+-y+", 0 a "+y+","+y+" 0 1,0 "+2*y+",0 a "+y+","+y+" 0 1,0 "+2*-y+",0";S.setAttribute("d",h);break;case o.WEDGE:S.setAttribute("stroke-width",0),d.setAttribute("stroke-width",.5);var D="undefined"==typeof c||0===c?0:Math.atan(g/c),y=s>i?i:s;y/=2;var v=i/2,P=s/2,I=v+y*Math.cos(D),_=P-y*Math.sin(D),R=v+y*Math.cos(Math.PI/3.25-D),C=P+y*Math.sin(Math.PI/3.25-D),T=" M "+v+" "+P+" L "+I+","+_+" A "+y+","+y+" 0 0,1 "+R+","+C,N="M "+v+" "+P+" m "+-y+", 0 a "+y+","+y+" 0 1,0 "+2*y+",0 a "+y+","+y+" 0 1,0 "+2*-y+",0 ";S.setAttribute("d",N),d.setAttribute("d",T);break;case o.POINTED:f.setAttribute("refX",i),S.setAttribute("stroke-width",0);var h="M 0 0 L "+i+" "+s/2+" L 0 "+s+" L "+i/2+" "+s/2+" L 0 0 z";S.setAttribute("d",h);break;case o.CURVE:f.setAttribute("refX",i),S.setAttribute("stroke-width",0);var O=3*i,M=s/2.5,h="M 0 0  A "+O+","+O+" 1 0,0 "+i+","+s/2+" A "+O+","+O+" 1 0,0  0,"+s+" A "+M+","+M+" 1 0,0  0,"+s/2+" A "+M+","+M+" 1 0,0  0,0 z";S.setAttribute("d",h)}}var n,i=EJSS_SVGGRAPHICS.Utils,o=EJSS_DRAWING2D.Arrow,s=t.getGroup();n=null!==s?e.getElementById(s.getName()):e;var a=e.getElementById(t.getName());null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()),n.appendChild(a));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=u[0]/2,f=u[1]/2;if(0!=u[0]||0!=u[1]){if(t.getMarkEnd()!=o.NONE){var E=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),p=0!=E&&E<t.getMarkEndWidth()?E:t.getMarkEndWidth(),h=0!=E&&E<t.getMarkEndHeight()?E:t.getMarkEndHeight(),m="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),A=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();r(t.getName()+".end",t.getMarkEnd(),t.getMarkEndOrient(),p,h,A,m),a.setAttribute("marker-end","url(#"+t.getName()+".end)")}if(t.getMarkMiddle()!=o.NONE){var y=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),D=0!=y&&y<t.getMarkMiddleWidth()?y:t.getMarkMiddleWidth(),v=0!=y&&y<t.getMarkMiddleHeight()?y:t.getMarkMiddleHeight(),m="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),P="none"==t.getMarkMiddleColorSnd()?t.getStyle().getLineColor():t.getMarkMiddleColorSnd(),A=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();r(t.getName()+".mid",t.getMarkMiddle(),t.getMarkMiddleOrient(),D,v,A,m,P,u[0],u[1]),a.setAttribute("marker-mid","url(#"+t.getName()+".mid)")}if(t.getMarkStart()!=o.NONE){var I=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),_=0!=I&&I<t.getMarkStartWidth()?I:t.getMarkStartWidth(),R=0!=I&&I<t.getMarkStartHeight()?I:t.getMarkStartHeight(),m="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),A=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();r(t.getName()+".start",t.getMarkStart(),t.getMarkStartOrient(),_,R,A,m),a.setAttribute("marker-start","url(#"+t.getName()+".start)")}}var C=t.getStyle();"crispEdges"==C.getShapeRendering()?t.getMarkMiddle()!=o.NONE?a.setAttribute("d","M "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c)+" "+i.crispValue(S)+" L "+i.crispValue(c+d)+" "+i.crispValue(S+f)):a.setAttribute("d","M "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c+d)+" "+i.crispValue(S+f)):t.getMarkMiddle()!=o.NONE?a.setAttribute("d","M "+(c-d)+" "+(S-f)+" L "+c+" "+S+" L "+(c+d)+" "+(S+f)):a.setAttribute("d","M "+(c-d)+" "+(S-f)+" L "+(c+d)+" "+(S+f)),C.getDrawFill()?a.setAttribute("fill",C.getFillColor()):a.setAttribute("fill","none"),C.getDrawLines()?(a.setAttribute("stroke",C.getLineColor()),a.setAttribute("stroke-width",C.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("shapeRendering",C.getShapeRendering());var T=C.getAttributes();for(var N in T)a.setAttribute(N,T[N]);return a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.axis=function(e,t){function r(e,t,r,n,i,o,s,a){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l),s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(a&&(i=-i,r=-r),"crispEdges"==o.getShapeRendering()?l.setAttribute("d","M "+g.crispValue(t)+" "+g.crispValue(r-.5-i)+" L "+g.crispValue(t)+" "+g.crispValue(r-.5+i)):l.setAttribute("d","M "+t+" "+(r-i)+" L "+t+" "+(r+i))):"crispEdges"==o.getShapeRendering()?l.setAttribute("d","M "+g.crispValue(t+.5-n)+" "+g.crispValue(r)+" L "+g.crispValue(t+.5+n)+" "+g.crispValue(r)):l.setAttribute("d","M "+(t-n)+" "+r+" L "+(t+n)+" "+r)}function n(e,t,r,n,i,o){if(o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==i.getShapeRendering()?s.setAttribute("d","M "+g.crispValue(t-n/2)+" "+g.crispValue(r)+" L "+g.crispValue(t+n/2)+" "+g.crispValue(r)):s.setAttribute("d","M "+(t-n/2)+" "+r+" L "+(t+n/2)+" "+r)}else{var s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==i.getShapeRendering()?s.setAttribute("d","M "+g.crispValue(r)+" "+g.crispValue(h-n/2)+" L "+g.crispValue(r)+" "+g.crispValue(h+n/2)):s.setAttribute("d","M "+r+" "+(h-n/2)+" L "+r+" "+(h+n/2))}}function i(e,t,r,i,o,s,a,l,u,c,S){var d=t-i,f=t+i,E=r+o,p=r-o,h=(g.crispValue(d),g.crispValue(f)),m=(g.crispValue(E),g.crispValue(p));if(c==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var A=m-l;A>=E-.5;A-=a)n(e,t,A,s,u,c);else for(var A=d+l;h+.5>=A;A+=a)n(e,t,A,s,u,c)}function o(e,t,r,n,i,o,s,a,u,c,S,d,f,E,p,h){var m=t-n,A=t+n,y=r+i,D=r-i,v=(g.crispValue(m),g.crispValue(A)),P=(g.crispValue(y),g.crispValue(D));if(p==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var I=0,_=P-s;_>=y-.5;_-=o,I++){if(h)var R=a[1]-S-c*I;else var R=a[0]+S+c*I;var C=parseFloat(R.toFixed(u)).toFixed(u);if(f==EJSS_DRAWING2D.Axis.TICKS_DOWN){var N=T/2;l(e,t+N,_,C,d,!1)}else{var N=C.length*Math.floor(d.getFontSize()/2);N+=C.length*d.getNumberLetterSpacing(),N+=Math.floor(T/2),l(e,t-N,_,C,d,!1)}}else for(var I=0,_=m+s;v+.5>=_;_+=o,I++){var R=a[0]+S+c*I,C=parseFloat(R.toFixed(u)).toFixed(u);if(f==EJSS_DRAWING2D.Axis.TICKS_DOWN){var O=Math.floor(T/2)+2;l(e,_,r-T,C,d,!0)}else{var O=d.getFontSize()+Math.floor(T/2);l(e,_,r+O,C,d,!0)}}}function s(e,t,r,n,i,o,s,a,l,u,c){var S=t-n,d=t+n,f=r+i,E=r-i,p=(g.crispValue(S),g.crispValue(d),g.crispValue(f),g.crispValue(E));if(c==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var h=Math.log(a[0])/Math.log(10),m=Math.log(a[1])/Math.log(10),A=m-h,y=Math.ceil(A),D=o/A,v=0;y>=v;v++)for(var P=Math.pow(10,v+h),I=Math.pow(10,v+h+1),_=I/l,R=0;l-1>R;R++){var C=P+R*_;if(0!=C&&C>=a[0]&&C<=a[1]){var T=Math.log(C)/Math.log(10),N=p-(T-h)*D,O=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(O),"crispEdges"==u.getShapeRendering()?O.setAttribute("d","M "+g.crispValue(t-s/2)+" "+g.crispValue(N)+" L "+g.crispValue(t+s/2)+" "+g.crispValue(N)):O.setAttribute("d","M "+(t-s/2)+" "+N+" L "+(t+s/2)+" "+N)}}else for(var h=Math.log(a[0])/Math.log(10),m=Math.log(a[1])/Math.log(10),A=m-h,y=Math.ceil(A),D=o/A,v=0;y>=v;v++)for(var P=Math.pow(10,v+h),I=Math.pow(10,v+h+1),_=I/l,R=0;l-1>R;R++){var C=P+R*_;if(0!=C&&C>=a[0]&&C<=a[1]){var T=Math.log(C)/Math.log(10),N=S+(T-h)*D,O=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(O),"crispEdges"==u.getShapeRendering()?O.setAttribute("d","M "+g.crispValue(N)+" "+g.crispValue(r-s/2)+" L "+g.crispValue(N)+" "+g.crispValue(r+s/2)):O.setAttribute("d","M "+N+" "+(r-s/2)+" L "+N+" "+(r+s/2))}}}function a(e,t,r,n,i,o,s,a,u,c,S,d){var f=t-n,E=t+n,p=r+i,h=r-i,m=(g.crispValue(f),g.crispValue(E),g.crispValue(p),g.crispValue(h));if(d==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var A=Math.log(s[0])/Math.log(10),y=Math.log(s[1])/Math.log(10),D=y-A,v=Math.ceil(D),I=P/D,_=0;v>=_;_++)for(var R=Math.pow(10,_+A),C=Math.pow(10,_+A+1),N=C/o,O=0;o-1>O;O++){var M=R+O*N;if(0!=M&&M>=s[0]&&M<=s[1]){var b=Math.log(M)/Math.log(10),G=m-(b-A)*I;if(0==O)var x=M.toExponential(a);else var x=parseFloat((M/R).toFixed(a)).toFixed(a);if(c==EJSS_DRAWING2D.Axis.TICKS_DOWN){var L=T/2;l(e,t+L,G,x,u,!1)}else{var L=x.length*Math.floor(u.getFontSize()/2);L+=x.length*u.getNumberLetterSpacing(),L+=Math.floor(T/2),l(e,t-L,G,x,u,!1)}}}else for(var A=Math.log(s[0])/Math.log(10),y=Math.log(s[1])/Math.log(10),D=y-A,v=Math.ceil(D),I=P/D,_=0;v>=_;_++)for(var R=Math.pow(10,_+A),C=Math.pow(10,_+A+1),N=C/o,O=0;o-1>O;O++){var M=R+O*N;if(0!=M&&M>=s[0]&&M<=s[1]){var b=Math.log(M)/Math.log(10),G=f+(b-A)*I;if(0==O)var x=M.toExponential(a);else var x=parseFloat((M/R).toFixed(a)).toFixed(a);if(c==EJSS_DRAWING2D.Axis.TICKS_DOWN){var J=Math.floor(T/2)+2;l(e,G,r-T,x,u,!0)}else{var J=u.getFontSize()+Math.floor(T/2);l(e,G,r+J,x,u,!0)}}}}function l(e,t,r,n,i,o){var s=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(s);var a=document.createElementNS("http://www.w3.org/2000/svg","text");s.appendChild(a),a.setAttribute("font-family",i.getFontFamily()),a.setAttribute("font-size",i.getFontSizeString()),a.setAttribute("fill",i.getFillColor()),a.setAttribute("stroke",i.getOutlineColor()),a.setAttribute("stroke-width",i.getFontWeight()),a.setAttribute("letterSpacing",i.getLetterSpacing()),a.textContent=n,o?t-=a.getComputedTextLength()/2+.5:r+=i.getFontSize()/2,a.setAttribute("x",t),a.setAttribute("y",r)}var u,g=EJSS_SVGGRAPHICS.Utils,c=t.getGroup();u=null!==c?e.getElementById(c.getName()):e;var S=e.getElementById(t.getName());if(null!==S&&u.removeChild(S),t.getShow()){S=document.createElementNS("http://www.w3.org/2000/svg","g"),S.setAttribute("id",t.getName()),u.appendChild(S);var d=t.getPixelPosition(),f=t.getPixelSizes(),E=t.getRelativePositionOffset(f),p=d[0]+E[0],h=d[1]+E[1],m=f[0]/2,A=f[1]/2,y=t.getStyle(),D=t.getOrient(),v=t.getInvertedScaleY();r(S,p,h,m,A,y,D,v);var P=D==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(f[1]):Math.abs(f[0]),I=t.getTicksMode();if(I==EJSS_DRAWING2D.Axis.SCALE_LOG){var _=t.getScale();if(_[0]>0&&_[1]>0){var R=t.getTicks(),C=t.getScalePrecision(),T=t.getTicksSize();s(S,p,h,m,A,P,T,_,R,y,D);var N=t.getFont(),O=t.getTextPosition();a(S,p,h,m,A,R,_,C,N,O,y,D)}}else if(I==EJSS_DRAWING2D.Axis.SCALE_NUM){var M=0,b=0;if(t.getAutoTicks())for(var G=t.getAutoStepMin(),x=t.getAutoTicksRange(),L=x.length-1;L>=0&&(M=Math.abs(P/x[L]),!(1.001*M>=G));L--);else{var R=t.getTicks();0!=R?M=P/R:(M=t.getStep(),b=t.getTickStep())}var C=t.getScalePrecision(),_=t.getScale();if(0==b)var J=Math.abs((_[1]-_[0])*M/P);else{var J=b;M=Math.abs(J*P/(_[1]-_[0]))}var w=Math.pow(10,C),W=Math.round(J*w)/w;W>0&&(J=W,M=Math.abs(W*P/(_[1]-_[0])));var k=t.getFixedTick(),V=_[1];isNaN(k)||(V=k<_[0]?k+(Math.floor((_[0]-k)/J)+1)*J:k>_[1]?k-(Math.floor((k-_[1])/J)+1)*J:k);var F=Math.abs((_[0]-V)%J),B=Math.abs(F-J);(.001>F||.001>B)&&(F=0);var z=P*F/Math.abs(_[1]-_[0]),T=t.getTicksSize();i(S,p,h,m,A,T,M,z,y,D,v);var N=t.getFont(),O=t.getTextPosition();o(S,p,h,m,A,M,z,_,C,J,F,N,O,y,D,v)}y.getDrawFill()?S.setAttribute("fill",y.getFillColor()):S.setAttribute("fill","none"),y.getDrawLines()?(S.setAttribute("stroke",y.getLineColor()),S.setAttribute("stroke-width",y.getLineWidth())):(S.setAttribute("stroke","none"),S.setAttribute("stroke-width",0)),S.setAttribute("shapeRendering",y.getShapeRendering());var H=y.getAttributes();for(var Y in H)S.setAttribute(Y,H[Y])}return S};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.byteRaster=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());if(null==o?(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o),i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("id",t.getName()+".img"),o.appendChild(i)):i=e.getElementById(t.getName()+".img"),t.getDataChanged()){var s=t.getData(),a=t.getColorMapper().getColors(),l=s.length;if(l>0){var u=s[0].length,g=t.getColorMapper().getNumberOfColors();EJSS_SVGGRAPHICS.Utils.PNGCanvas(l,u,g,s,a,function(e){i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e)})}t.setDataChanged(!1)}var c=t.getPixelPosition(),S=t.getPixelSizes(),d=t.getRelativePositionOffset(S),f=c[0]+d[0],E=c[1]+d[1],p=Math.abs(S[0]/2),h=Math.abs(S[1]/2);i.setAttribute("x",f-p),i.setAttribute("y",E-h),i.setAttribute("width",Math.abs(S[0])),i.setAttribute("height",Math.abs(S[1]));var m=t.getStyle(),A=m.getAttributes();for(var y in A)i.setAttribute(y,A[y]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cellLattice=function(e,t){function r(e,t,r,n,i,o){var s="",l=a.crispValue(e),u=a.crispValue(r),g=a.crispValue(t),c=a.crispValue(n);0==i&&(i=Math.abs(r-e));for(var S=e;S<=Math.max(r,u)+.5;S+=i)s+=" M "+a.crispValue(S)+" "+g+" L "+a.crispValue(S)+" "+c;0==o&&(o=Math.abs(t-n));for(var S=n;S>=Math.min(t,g)-.5;S-=o)s+=" M "+l+" "+a.crispValue(S)+" L "+u+" "+a.crispValue(S);return s}function n(e,t,r,n,i,o){var s="";0==i&&(i=Math.abs(r-e));for(var a=e;r>=a;a+=i)s+=" M "+a+" "+t+" L "+a+" "+n;0==o&&(o=Math.abs(t-n));for(var a=n;a>=t;a-=o)s+=" M "+e+" "+a+" L "+r+" "+a;return s}function i(e,t,r,n,i,o,s){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);var u=n/2,g=i/2;"crispEdges"==o?l.setAttribute("d","M "+a.crispValue(t-u)+" "+a.crispValue(r+g)+" L "+a.crispValue(t+u)+" "+a.crispValue(r+g)+" L "+a.crispValue(t+u)+" "+a.crispValue(r-g)+" L "+a.crispValue(t-u)+" "+a.crispValue(r-g)+" z"):l.setAttribute("d","M "+(t-u)+" "+(r+g)+" L "+(t+u)+" "+(r+g)+" L "+(t+u)+" "+(r-g)+" L "+(t-u)+" "+(r-g)+" z"),l.setAttribute("fill",s),l.setAttribute("stroke",s)}function o(e,t,i,o,s,a,l,u){var g=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(g);var c=o/2,S=s/2,d=t-c,f=t+c,E=i+S,p=i-S;"crispEdges"==u.getShapeRendering()?g.setAttribute("d",r(d,E,f,p,a,l)):g.setAttribute("d",n(d,E,f,p,a,l)),u.getDrawLines()?(g.setAttribute("stroke",u.getLineColor()),g.setAttribute("stroke-width",u.getLineWidth())):(g.setAttribute("stroke","none"),g.setAttribute("stroke-width",0));var h=u.getAttributes();for(var m in h)g.setAttribute(m,h[m])}var s,a=EJSS_SVGGRAPHICS.Utils,l=t.getGroup();s=null!==l?e.getElementById(l.getName()):e;var u=e.getElementById(t.getName());null!==u&&s.removeChild(u),u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",t.getName()),s.appendChild(u);for(var g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=c[0]/2,p=c[1]/2,h=t.getStyle(),m=t.getData(),A=t.getColorMapper().getColors(),y=m.length,D=m[0].length,v=Math.abs(c[0]/y),P=Math.abs(c[1]/D),I=d-E+v/2,_=f-p-P/2,R=0;D>R;R++)for(var C=0;y>C;C++)i(u,I+v*C,_-P*R,v,P,h.getShapeRendering(),A[m[C][R]]);var T=t.getShowGrid();return T&&o(u,d,f,c[0],c[1],v,P,h),u};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cursor=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,s=e.getElementById(t.getName());null===s?(s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s),i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",t.getName()+".line1"),s.appendChild(i),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".line2"),s.appendChild(o)):(i=e.getElementById(t.getName()+".line1"),o=e.getElementById(t.getName()+".line2"));var a=t.getPixelPosition(),l=t.getCursorType(),u=t.getGroupPanel(),g=u.getRealWorldCoordinates(),c=u.toPixelPosition([g[0],g[2]]),S=u.toPixelPosition([g[1],g[3]]),d=t.getStyle();if(i.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.VERTICAL){var f=c[0],E=S[0],p=a[1];p>c[1]?p=c[1]:p<S[1]&&(p=S[1]),"crispEdges"==d.getShapeRendering()?i.setAttribute("d","M "+UTILS.crispValue(f)+" "+UTILS.crispValue(p)+" L "+UTILS.crispValue(E)+" "+UTILS.crispValue(p)):i.setAttribute("d","M "+f+" "+p+" L "+E+" "+p),i.setAttribute("stroke-width",d.getLineWidth())}if(o.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var h=a[0],m=c[1],A=S[1];h<c[0]?h=c[0]:h>S[0]&&(h=S[0]),"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+UTILS.crispValue(h)+" "+UTILS.crispValue(m)+" L "+UTILS.crispValue(h)+" "+UTILS.crispValue(A)):o.setAttribute("d","M "+h+" "+m+" L "+h+" "+A),o.setAttribute("stroke-width",d.getLineWidth())}d.getDrawFill()?s.setAttribute("fill",d.getFillColor()):s.setAttribute("fill","none"),s.setAttribute("stroke",d.getLineColor()),s.setAttribute("shapeRendering",d.getShapeRendering());var y=d.getAttributes();for(var D in y)s.setAttribute(D,y[D]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.ellipse=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1],g=Math.abs(s[0]/2),c=Math.abs(s[1]/2);i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",g),i.setAttribute("ry",c);var S=t.getStyle();S.getDrawFill()?i.setAttribute("fill",S.getFillColor()):i.setAttribute("fill","none"),S.getDrawLines()?(i.setAttribute("stroke",S.getLineColor()),i.setAttribute("stroke-width",S.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",S.getShapeRendering());var d=S.getAttributes();for(var f in d)i.setAttribute(f,d[f]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.grid=function(e,t){function r(e,t,r,n,i,s,a,l){var u=o.crispValue(e),g=o.crispValue(r),c=o.crispValue(t),S=o.crispValue(n),d="";if(-1==l)if(0==s&&(s=Math.abs(c-S)),"crispEdges"==a)for(var f=S-i;f>=c-.5;f-=s)d+=" M "+u+" "+o.crispValue(f)+" L "+g+" "+o.crispValue(f);else for(var f=S-i;f>=t-.5;f-=s)d+=" M "+e+" "+f+" L "+r+" "+f;else if(0==s&&(s=Math.abs(g-u)),"crispEdges"==a)for(var f=e+i;g+.5>=f;f+=s)d+=" M "+o.crispValue(f)+" "+c+" L "+o.crispValue(f)+" "+S;else for(var f=e+i;g+.5>=f;f+=s)d+=" M "+f+" "+t+" L "+f+" "+n;return d}function n(e,t,r,n,i,s,a,l){var u=o.crispValue(e),g=o.crispValue(r),c=o.crispValue(t),S=o.crispValue(n),d="",f=Math.log(s[0])/Math.log(10),E=Math.log(s[1])/Math.log(10),p=E-f,h=Math.ceil(p);if(-1==l)var m=(S-c)/p;else var m=(g-u)/p;for(var A=0;h>=A;A++)for(var y=Math.pow(10,A+f),D=Math.pow(10,A+f+1),v=D/i,P=0;i-1>P;P++){var I=y+P*v;if(0!=I&&I>=s[0]&&I<=s[1]){var _=Math.log(I)/Math.log(10);if(-1==l){var R=S-(_-f)*m;d+="crispEdges"==a?" M "+u+" "+o.crispValue(R)+" L "+g+" "+o.crispValue(R):" M "+u+" "+R+" L "+g+" "+R}else{var R=u+(_-f)*m;d+="crispEdges"==a?" M "+o.crispValue(R)+" "+c+" L "+o.crispValue(R)+" "+S:" M "+R+" "+c+" L "+R+" "+S}}}return d}var i,o=EJSS_SVGGRAPHICS.Utils,s=t.getGroup();i=null!==s?e.getElementById(s.getName()):e;var a=e.getElementById(t.getName());null!==a&&i.removeChild(a),a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("id",t.getName()),i.appendChild(a);var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("id",t.getName()+"X"),a.appendChild(l);var u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("id",t.getName()+"Y"),a.appendChild(u);var g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=c[0]/2,p=c[1]/2,h=t.getShowX(),m=t.getShowY(),A="",y="";if(h){var D=t.getTicksXMode();if(D==EJSS_DRAWING2D.Grid.SCALE_LOG){var v=t.getScaleX();if(v[0]>0&&v[1]>0){var P=t.getTicksX(),I=t.getShapeRenderingX(),_=d-E,R=d+E,C=f+p,T=f-p;A=n(_,C,R,T,P,v,I,1)}}else if(D==EJSS_DRAWING2D.Grid.SCALE_NUM){var N=0,O=0;if(t.getAutoTicksX())for(var M=t.getAutoStepXMin(),b=t.getAutoTicksRangeX(),G=b.length-1;G>=0&&(N=Math.abs(c[0]/b[G]),!(N>=M));G--);else{var P=t.getTicksX();0!=P?N=Math.abs(c[0]/P):(N=t.getStepX(),O=t.getTickStepX());
}var x=t.getScalePrecisionX(),v=t.getScaleX();if(0==O)var L=Math.abs((v[1]-v[0])*N/c[0]);else{var L=O;N=Math.abs(L*c[0]/(v[1]-v[0]))}var J=Math.pow(10,x),w=Math.round(L*J)/J;w>0&&(L=w,N=Math.abs(w*c[0]/(v[1]-v[0])));var W=t.getFixedTickX(),k=v[1];isNaN(W)||(k=W<v[0]?W+(Math.floor((v[0]-W)/L)+1)*L:W>v[1]?W-(Math.floor((W-v[1])/L)+1)*L:W);var V=Math.abs((v[0]-k)%L),F=Math.abs(V-L);(.001>V||.001>F)&&(V=0);var B=Math.abs(c[0]*V/(v[1]-v[0])),I=t.getShapeRenderingX(),_=d-E,R=d+E,C=f+p,T=f-p;A=r(_,C,R,T,B,N,I,1)}}if(m){var z=t.getTicksYMode();if(z==EJSS_DRAWING2D.Grid.SCALE_LOG){var H=t.getScaleY();if(H[0]>0&&H[1]>0){var Y=t.getTicksY(),I=t.getShapeRenderingY(),_=d-E,R=d+E,C=f+p,T=f-p;y=n(_,C,R,T,Y,H,I,-1)}}else if(z==EJSS_DRAWING2D.Grid.SCALE_NUM){var U=0,X=0;if(t.getAutoTicksY())for(var Z=t.getAutoStepYMin(),j=t.getAutoTicksRangeY(),G=j.length-1;G>=0&&(U=Math.abs(c[1]/j[G]),!(U>=Z));G--);else{var Y=t.getTicksY();0!=Y?U=Math.abs(c[1]/Y):(U=t.getStepY(),X=t.getTickStepY())}var q=t.getScalePrecisionY(),H=t.getScaleY();if(0==X)var K=Math.abs((H[1]-H[0])*U/c[1]);else{var K=X;U=Math.abs(K*c[1]/(H[1]-H[0]))}var $=Math.pow(10,q),Q=Math.round(K*$)/$;Q>0&&(K=Q,U=Math.abs(Q*c[1]/(H[1]-H[0])));var W=t.getFixedTickY(),k=H[1];isNaN(W)||(k=W<H[0]?W+(Math.floor((H[0]-W)/K)+1)*K:W>H[1]?W-(Math.floor((W-H[1])/K)+1)*K:W);var V=Math.abs((H[0]-k)%K),F=Math.abs(V-K);(.001>V||.001>F)&&(V=0);var ee=Math.abs(c[1]*V/(H[1]-H[0])),I=t.getShapeRenderingY(),_=d-E,R=d+E,C=f+p,T=f-p;y=r(_,C,R,T,ee,U,I,-1)}}A.length>0&&(l.setAttribute("d",A),l.setAttribute("shapeRendering",t.getShapeRenderingX()),l.setAttribute("stroke",t.getLineColorX()),l.setAttribute("stroke-width",t.getLineWidthX())),y.length>0&&(u.setAttribute("d",y),u.setAttribute("shapeRendering",t.getShapeRenderingY()),u.setAttribute("stroke",t.getLineColorY()),u.setAttribute("stroke-width",t.getLineWidthY()));var te=t.getStyle().getAttributes();for(var re in te)l.setAttribute(re,te[re]),u.setAttribute(re,te[re]);return a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.group=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());return null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),r.appendChild(i)),i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.histogram=function(e,t){function r(e,t,r,n,i,o){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+n+" L "+r+" "+n+" L "+r+" "+i+" z"),o.getDrawFill()?e.setAttribute("fill",o.getFillColor()):e.setAttribute("fill","none"),o.getDrawLines()?(e.setAttribute("stroke",o.getLineColor()),e.setAttribute("stroke-width",o.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",o.getShapeRendering())}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());if(null===o)o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),n.appendChild(o);else{var s=e.getElementById(t.getName()+".bars");o.removeChild(s)}var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("id",t.getName()+".bars"),o.appendChild(s);for(var a=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=a[0]+u[0],c=a[1]+u[1],S=l[0]/2,d=l[1]/2,f=t.getStyle(),E=t.getDiscrete(),p=t.getBinWidth()/2,h=t.getBars(),m=t.getGroupPanel().getPixelPositionWorldOrigin()[1],A=0;A<h.length;A++){var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("id",t.getName()+".bar"+A),s.appendChild(y);var D,v,P=h[A][0];E?D=v=g-S+P*l[0]:(D=g-S+(P-p)*l[0],v=g-S+(P+p)*l[0]);var I=c-d+h[A][1]*l[1];r(y,D,v,I,m,f)}var _=f.getAttributes();for(var R in _)o.setAttribute(R,_[R]);return o},EJSS_SVGGRAPHICS.histogramOld=function(e,t){function r(e,t,r,n,i,o){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+n+" L "+r+" "+n+" L "+r+" "+i+" z"),o.getDrawFill()?e.setAttribute("fill",o.getFillColor()):e.setAttribute("fill","none"),o.getDrawLines()?(e.setAttribute("stroke",o.getLineColor()),e.setAttribute("stroke-width",o.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",o.getShapeRendering())}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());if(null===o)o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),n.appendChild(o);else{var s=e.getElementById(t.getName()+".bars");o.removeChild(s)}var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("id",t.getName()+".bars"),o.appendChild(s);var a,l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=u[0]/2,f=u[1]/2,E=t.getStyle(),p=t.getFixBin(),h=t.getNormalized(),m=t.getDiscrete(),A=t.getInput(),y=t.getBinWidth(),A=A.sort(function(e,t){return e-t}),D=y/2;a=0==y?A[0]:p-D>A[0]?p-(Math.floor((p-D-A[0])/y)+1)*y:p+D<A[0]?p+Math.floor((A[0]-p-D)/y)*y:p;for(var v=t.getGroupPanel().getPixelPositionWorldOrigin()[1],P=a,I=0,_=A.length,R=0;R<A.length;R++)if(A[R]<=P+D)I++;else{if(I>0){var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("id",t.getName()+".bar"+R),s.appendChild(C);var T,N;m?T=N=c-d+P*u[0]:(T=c-d+(P-D)*u[0],N=c-d+(P+D)*u[0]),h&&(I/=_);var O=S-f+I*u[1];r(C,T,N,O,v,E)}0==y?P=A[R]:P+=(Math.floor((A[R]-P-D)/y)+1)*y,I=1}if(I>0){var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("id",t.getName()+".bar"+R),s.appendChild(C);var T,N;m?T=N=c-d+P*u[0]:(T=c-d+(P-D)*u[0],N=c-d+(P+D)*u[0]),h&&(I/=_);var O=S-f+I*u[1];r(C,T,N,O,v,E)}var M=E.getAttributes();for(var b in M)o.setAttribute(b,M[b]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.image=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1],g=Math.abs(s[0]/2),c=Math.abs(s[1]/2),S=i.getAttributeNS("http://www.w3.org/1999/xlink","href");if(!S||t.getChangedImage()){var d=t.getEncode();d.length>0?i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","data:png;base64,"+d):i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.getImageUrl()),t.setChangedImage(!1)}i.setAttribute("preserveAspectRatio","none"),i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(s[0])),i.setAttribute("height",Math.abs(s[1]));var f=t.getStyle();f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)i.setAttribute(p,E[p]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.mesh=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return Math.sqrt(t)}function n(e,t,r,n,i){var o=e.length;S=new Array(o),d=new Array(o);for(var s=0;o>s;s++)S[s]=t+e[s][0]*n,d[s]=r+e[s][1]*i}function i(e,t,n){if(null!=e&&e.length>0){var i=e.length;f=new Array(i),E=new Array(i),p=new Array(i),h=new Array(i);var o=1;null!=t&&(o=n?t[0][0].length:t[0].length);for(var s=0;i>s;s++){var a=e[s],l=a.length;f[s]=new Array(l),E[s]=new Array(l),p[s]=new Array(l),h[s]=new Array(l);for(var u=0;l>u;u++){var g=a[u];f[s][u]=S[g],E[s][u]=d[g]}if(null!=t)if(n)for(var c=t[s],u=0;l>u;u++){p[s][u]=1>=o?c[u][0]:r(c[u]),h[s][u]=new Array(o);for(var m=0;o>m;m++)h[s][u][m]=c[u][m]}else for(var u=0;l>u;u++){var g=a[u];p[s][u]=1>=o?t[g][0]:r(t[g]),h[s][u]=new Array(o);for(var m=0;o>m;m++)h[s][u][m]=t[g][m]}}}}function o(e){if(null!=e&&e.length>0){var t=e.length;m=new Array(t),A=new Array(t);for(var r=0;t>r;r++){var n=e[r],i=n.length;m[r]=new Array(i),A[r]=new Array(i);for(var o=0;i>o;o++){var s=n[o];m[r][o]=S[s],A[r][o]=d[s]}}}}function s(e,t){for(var r="",n=0,i=e.length-1;i>n;n++)r+=0==n?" M "+e[n]+" "+t[n]:" L "+e[n]+" "+t[n];return r+=" L "+e[n]+" "+t[n]+" Z"}function a(e,t,r){for(var n="",i=0;r>i;i++)n+=e[i]+","+t[i]+" ";return n+=e[0]+","+t[0]+" "}function l(e,t,r,n){for(var i=t.length,o=new Array(i),s=Number.MAX_VALUE,l=Number.MIN_VALUE,u=0;i>u;u++){var g=e.doubleToIndex(n[u]);s=Math.min(g,s),l=Math.max(g,l),o[u]=g}for(var c=e.getColorThresholds(),S=new Array(2*i),d=new Array(2*i),f=s;l>=f;f++){for(var E=0,p=0;i>p;p++){var h=(p+1)%i;if(o[p]<=f&&o[h]>=f){if(o[p]==f)S[E]=t[p],d[E]=r[p],E++;else{var m=(c[f]-n[p])/(n[h]-n[p]);S[E]=Math.round(t[p]+m*(t[h]-t[p])),d[E]=Math.round(r[p]+m*(r[h]-r[p])),E++}if(o[h]>f){var m=(c[f+1]-n[p])/(n[h]-n[p]);S[E]=Math.round(t[p]+m*(t[h]-t[p])),d[E]=Math.round(r[p]+m*(r[h]-r[p])),E++}}else if(o[p]>=f&&o[h]<=f){if(o[p]==f)S[E]=t[p],d[E]=r[p],E++;else{var m=(c[f+1]-n[p])/(n[h]-n[p]);S[E]=Math.round(t[p]+m*(t[h]-t[p])),d[E]=Math.round(r[p]+m*(r[h]-r[p])),E++}if(o[h]<f){var m=(c[f]-n[p])/(n[h]-n[p]);S[E]=Math.round(t[p]+m*(t[h]-t[p])),d[E]=Math.round(r[p]+m*(r[h]-r[p])),E++}}}if(E>0){var A=document.createElementNS("http://www.w3.org/2000/svg","polygon");v.appendChild(A),A.setAttribute("points",a(S,d,E));var y=e.indexToColor(f);A.setAttribute("fill",y),A.setAttribute("stroke",y),A.setAttribute("stroke-width",1.25)}}}function u(e,r,n){var i=document.createElementNS("http://www.w3.org/2000/svg","path");v.appendChild(i),i.setAttribute("d",s(e,r));var o=t.getStyle();n&&o.getDrawFill()?i.setAttribute("fill",o.getFillColor()):i.setAttribute("fill","none"),o.getDrawLines()?(i.setAttribute("stroke",o.getLineColor()),i.setAttribute("stroke-width",o.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",o.getShapeRendering())}function g(e,t,r,n){var i=document.createElementNS("http://www.w3.org/2000/svg","path");v.appendChild(i),i.setAttribute("d",s(e,t)),i.setAttribute("fill","none"),i.setAttribute("stroke",r),i.setAttribute("stroke-width",n+.5)}function c(e,t,r,n){var i=document.createElementNS("http://www.w3.org/2000/svg","g");v.appendChild(i);for(var o=0;o<e.length;o++){var s=document.createElementNS("http://www.w3.org/2000/svg","g");i.appendChild(s);var a=document.createElementNS("http://www.w3.org/2000/svg","path");s.appendChild(a);var l=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.appendChild(l);var u=e[o],g=t[o],c=r[o][0],S=r[o][1],d=EJSS_TOOLS.Mathematics.norm([c,S]),f=c*n/d,E=S*n/d,p="M "+u+" "+g+" L "+(u+f)+" "+(g+E);if(a.setAttribute("d",p),0!=f||0!=E){var h,m=12,A=.3,d=EJSS_TOOLS.Mathematics.norm([f,E]);h=d*A,h>m&&(h=m);var y=u+f,D=g+E,P=y+","+D+" "+(y-h)+","+(D+h/3)+" "+(y-h)+","+(D-h/3);l.setAttribute("points",P);var I=Math.atan2(f,-E);I=180*I/Math.PI,l.setAttribute("transform","rotate("+(I-90)+" "+y+" "+D+")")}s.setAttribute("stroke","black"),s.setAttribute("stroke-width",.5)}}var S,d,f,E,p,h,m,A,y,D=(EJSS_SVGGRAPHICS.Utils,t.getGroup());y=null!==D?e.getElementById(D.getName()):e;var v=document.createElementNS("http://www.w3.org/2000/svg","g");v.setAttribute("id",t.getName());var P=e.getElementById(t.getName());null!==P?P.parentNode.replaceChild(v,P):y.appendChild(v);var I=t.getPixelPosition(),_=t.getPixelSizes(),R=t.getRelativePositionOffset(_),C=I[0]+R[0],T=I[1]+R[1],N=_[0]/2,O=_[1]/2,M=t.getPoints();if(null!=M){n(M,C-N,T-O,_[0],_[1]);var b=t.getCells(),G=t.getFieldAtPoints();if(G?i(b,G,!1):(G=t.getFieldAtCells(),i(b,G,!0)),null!=b)if(null!=G)for(var x=0,L=b.length;L>x;x++){var J=t.getColorCoded();l(J,f[x],E[x],p[x]),u(f[x],E[x],!1)}else for(var x=0,L=b.length;L>x;x++)u(f[x],E[x],!0);var w=t.getBoundary();if(t.getDrawBoundary()&&null!=w){var W=t.getBoundaryLabels(),k=t.getBoundaryColors(),V=t.getBoundaryLineWidth();o(w);for(var F="black",x=0,L=w.length;L>x;x++){if(null!=W){var B=W[x];null!=k&&B<k.length&&(F=k[B])}g(m[x],A[x],F,V)}}if(t.getDataType()>=4&&null!=G)for(var z=t.getVectorLength()*_[0],x=0,L=b.length;L>x;x++)c(f[x],E[x],G[x],z);var H=t.getStyle().getAttributes();for(var Y in H)v.setAttribute(Y,H[Y]);return v}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.pipe=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o));var s=e.getElementById(t.getName()+":container");null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+":container"),o.appendChild(s));var a=e.getElementById(t.getName()+":liquid");null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()+":liquid"),o.appendChild(a));var l=t.getPoints();if(l&&!(l.length<=0)){var u,g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=Math.abs(c[0]),p=Math.abs(c[1]),h=d-E/2,m=f+p/2,A=t.getStyle(),y="crispEdges"==A.getShapeRendering(),D="",v="";u=y?"M "+n.crispValue(h)+" "+n.crispValue(m):"M "+h+" "+m,D=u,v=u;for(var P=0,I=l.length;I>P;P++){var _=l[P],d=Math.round(_[0]*E),f=Math.round(-_[1]*p);u=y?" l "+n.crispValue(d)+" "+n.crispValue(f):" l "+d+" "+f,D+=u,v+=u}s.setAttribute("d",D),a.setAttribute("d",v),A.getDrawFill()?(a.setAttribute("stroke",A.getFillColor()),a.setAttribute("stroke-width",t.getPipeWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("fill","none"),a.setAttribute("shapeRendering",A.getShapeRendering()),A.getDrawLines()?(s.setAttribute("stroke",A.getLineColor()),s.setAttribute("stroke-width",2*A.getLineWidth()+t.getPipeWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("fill","none"),s.setAttribute("shapeRendering",A.getShapeRendering());var R=A.getAttributes();for(var C in R)a.setAttribute(C,R[C]),s.setAttribute(C,R[C]);return o}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.point=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1];i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",2),i.setAttribute("ry",2);var g=t.getStyle();i.setAttribute("fill",g.getFillColor());var c=g.getAttributes();for(var S in c)i.setAttribute(S,c[S]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.polygon=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","polygon"),i.setAttribute("id",t.getName()),r.appendChild(i));for(var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1],g=s[0]/2,c=s[1]/2,S=t.getPoints(),d="",f=0;f<S.length;f++){var E=S[f],p=l-g+E[0]*s[0],h=u-c+E[1]*s[1];d+=p+","+h+" "}if(""!==d){i.setAttribute("points",d);var m=t.getStyle();m.getDrawFill()?i.setAttribute("fill",m.getFillColor()):i.setAttribute("fill","none"),m.getDrawLines()?(i.setAttribute("stroke",m.getLineColor()),i.setAttribute("stroke-width",m.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",m.getShapeRendering());var A=m.getAttributes();for(var y in A)i.setAttribute(y,A[y])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.rectangle=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),r.appendChild(o));var s=t.getPixelPosition(),a=t.getPixelSizes(),l=t.getRelativePositionOffset(a),u=s[0]+l[0],g=s[1]+l[1],c=a[0]/2,S=a[1]/2,d=t.getStyle();"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" z"):o.setAttribute("d","M "+(u-c)+" "+(g+S)+" L "+(u+c)+" "+(g+S)+" L "+(u+c)+" "+(g-S)+" L "+(u-c)+" "+(g-S)+" z"),d.getDrawFill()?o.setAttribute("fill",d.getFillColor()):o.setAttribute("fill","none"),d.getDrawLines()?(o.setAttribute("stroke",d.getLineColor()),o.setAttribute("stroke-width",d.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)o.setAttribute(E,f[E]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.roundRectangle=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1],g=Math.abs(s[0]/2),c=Math.abs(s[1]/2),S=Math.abs(t.getCornerRadius());i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(s[0])),i.setAttribute("height",Math.abs(s[1])),i.setAttribute("rx",S),i.setAttribute("ry",S);var d=t.getStyle();d.getDrawFill()?i.setAttribute("fill",d.getFillColor()):i.setAttribute("fill","none"),d.getDrawLines()?(i.setAttribute("stroke",d.getLineColor()),i.setAttribute("stroke-width",d.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)i.setAttribute(E,f[E]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.segment=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),r.appendChild(o));var s=t.getPixelPosition(),a=t.getPixelSizes(),l=t.getRelativePositionOffset(a),u=s[0]+l[0],g=s[1]+l[1],c=a[0]/2,S=a[1]/2,d=t.getStyle();"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)):o.setAttribute("d","M "+(u-c)+" "+(g-S)+" L "+(u+c)+" "+(g+S)),d.getDrawFill()?o.setAttribute("fill",d.getFillColor()):o.setAttribute("fill","none"),d.getDrawLines()?(o.setAttribute("stroke",d.getLineColor()),o.setAttribute("stroke-width",d.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)o.setAttribute(E,f[E]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.spring=function(e,t){function r(e,t,r,n,i,o,s,a,l){var u="",g=e*t,c=2*Math.PI/t;0>r&&(c*=-1);for(var S=t/2,d=[a,l,0],f=EJSS_TOOLS.Mathematics.normalTo(d),E=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct(d,f)),p=0;g>=p;p++){var h;h=i?S>p?0:t>p?p-S:p>g-S?0:p>g-t?g-p-S:S:S;var m=Math.PI/2+p*c,A=Math.cos(m),y=Math.sin(m),D=o+p*a/g+h*r*(A*f[0]+y*E[0])/S,v=s+p*l/g+h*r*(A*f[1]+y*E[1])/S;if(0!=n){var P=h*Math.cos(2*p*Math.PI/t)/S;D+=n*P*a,v+=n*P*l}u+=0==p?" M "+D+" "+v:" L "+D+" "+v}return u}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),n.appendChild(o));var s=t.getPixelPosition(),a=t.getPixelSizes(),l=t.getRelativePositionOffset(a),u=s[0]+l[0],g=s[1]+l[1],c=a[0]/2,S=a[1]/2,d=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0],f=r(t.getLoops(),t.getPointsPerLoop(),d,t.getSolenoid(),t.getThinExtremes(),u-c,g-S,a[0],a[1]);if(""!==f){o.setAttribute("d",f);var E=t.getStyle();E.getDrawFill()?o.setAttribute("fill",E.getFillColor()):o.setAttribute("fill","none"),E.getDrawLines()?(o.setAttribute("stroke",E.getLineColor()),o.setAttribute("stroke-width",E.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",E.getShapeRendering());var p=E.getAttributes();for(var h in p)o.setAttribute(h,p[h])}return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.tank=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o));var s=e.getElementById(t.getName()+":container");null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+":container"),o.appendChild(s));var a=e.getElementById(t.getName()+":liquid");null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()+":liquid"),o.appendChild(a));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=Math.abs(u[0]/2),f=Math.abs(u[1]/2),E=t.getPixelSizeOf(0,t.getLevel()),p=c-d,h=c+d,m=S+f,A=S-f,y=m+E[1],D=t.getStyle();"crispEdges"==D.getShapeRendering()?(a.setAttribute("d","M "+n.crispValue(xlevel)+" "+n.crispValue(y)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(xlevel)+" "+n.crispValue(y)+" Z"),D.getDrawFill()?s.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A)+" Z"):s.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A))):(a.setAttribute("d","M "+(p+E[0])+" "+y+" L "+p+" "+m+" L "+h+" "+m+" L "+(h+E[0])+" "+y+" Z"),D.getDrawFill()?s.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A+" Z"):s.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A)),a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0),a.setAttribute("fill",t.getLevelColor()),a.setAttribute("shapeRendering",D.getShapeRendering()),D.getDrawFill()?s.setAttribute("fill",D.getFillColor()):s.setAttribute("fill","none"),s.setAttribute("stroke",D.getLineColor()),s.setAttribute("stroke-width",D.getLineWidth()),s.setAttribute("shapeRendering",D.getShapeRendering());var v=D.getAttributes();for(var P in v)a.setAttribute(P,v[P]),s.setAttribute(P,v[P]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.text=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,s,a=e.getElementById(t.getName());null===a?(a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("id",t.getName()),r.appendChild(a),i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()+".inner"),a.appendChild(i),s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+".box"),i.appendChild(s),o=document.createElementNS("http://www.w3.org/2000/svg","text"),o.setAttribute("id",t.getName()+".text"),i.appendChild(o)):(i=e.getElementById(t.getName()+".inner"),o=e.getElementById(t.getName()+".text"),s=e.getElementById(t.getName()+".box"));var l=t.getFont();o.setAttribute("font-style",l.getFontStyle()),o.setAttribute("font-weight",l.getFontWeight()),o.setAttribute("font-size",l.getFontSizeString()),o.setAttribute("font-family",l.getFontFamily()),o.setAttribute("fill",l.getFillColor()),o.setAttribute("stroke",l.getOutlineColor()),o.setAttribute("letterSpacing",l.getLetterSpacing()),o.textContent=t.getText();var u=t.getPixelPosition(),g=t.getFramed()?4:0,c=[1.15*o.getComputedTextLength()+2*g,l.getFontSize()+2*g],S=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),c[0],c[1]),d=t.getMarginX(),f=t.getMarginY(),E=u[0]+S[0]+d+g,p=u[1]+S[1]+f-g;if(o.setAttribute("x",E),o.setAttribute("y",p),t.getFramed()){var h=g,m=g,A=c[0]-2*g,y=c[1]-2*g;if(A>0){var D=p+h,v=p-y-h,P=E-m,I=E+A+h;s.setAttribute("d","M "+P+" "+D+" L "+I+" "+D+" L "+I+" "+v+" L "+P+" "+v+" z");var _=t.getStyle();_.getDrawFill()?s.setAttribute("fill",_.getFillColor()):s.setAttribute("fill","none"),_.getDrawLines()?(s.setAttribute("stroke",_.getLineColor()),s.setAttribute("stroke-width",_.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0));var R=_.getAttributes();for(var C in R)mShape.setAttribute(C,R[C])}else s.setAttribute("stroke","none"),s.setAttribute("fill","none")}var T=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:T=90;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:T=180;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:T=270;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:T=0}return i.setAttribute("transform","rotate("+T+" "+(u[0]+d)+" "+(u[1]+f)+")"),a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trace=function(e,t){function r(e,t,r,n,i){for(var o="",s=0;s<e.length;s++){var a=e[s],l=t+a[0]*n,u=r+a[1]*i,g=a[2];o+=0==s||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}function n(e,t,r,n,i){var o=t,s=r,a=Math.abs(n[0]/2),l=Math.abs(n[1]/2);e.setAttribute("cx",o),e.setAttribute("cy",s),e.setAttribute("rx",a),e.setAttribute("ry",l),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function i(e,t,r,n,i){var o=t,s=r,a=Math.abs(n[0]/2),l=Math.abs(n[1]/2);O.setAttribute("d","M "+(o-a)+" "+(s+l)+" L "+(o+a)+" "+(s+l)+" L "+(o+a)+" "+(s-l)+" L "+(o-a)+" "+(s-l)+" z"),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function o(e,t,r,n,i,o,s){O.setAttribute("d","M "+t+" "+o+" L "+t+" "+r+" L "+n+" "+i+" L "+n+" "+o+" z"),s.getDrawFill()?e.setAttribute("fill",s.getFillColor()):e.setAttribute("fill","none"),s.getDrawLines()?(e.setAttribute("stroke",s.getLineColor()),e.setAttribute("stroke-width",s.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",s.getShapeRendering())}var s,a=t.getGroup();s=null!==a?e.getElementById(a.getName()):e;var l,u=e.getElementById(t.getName());if(null===u)u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",t.getName()),s.appendChild(u),l=document.createElementNS("http://www.w3.org/2000/svg","path"),l.setAttribute("id",t.getName()+".trail"),u.appendChild(l);else{l=e.getElementById(t.getName()+".trail");var g=e.getElementById(t.getName()+".marks");u.removeChild(g)}var g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("id",t.getName()+".marks"),u.appendChild(g);var c=t.getPixelPosition(),S=t.getPixelSizes(),d=t.getRelativePositionOffset(S),f=c[0]+d[0],E=c[1]+d[1],p=S[0]/2,h=S[1]/2,m=r(t.getPoints(),f-p,E-h,S[0],S[1]);if(""!==m){l.setAttribute("d",m);var A=t.getStyle();A.getDrawFill()?l.setAttribute("fill",A.getFillColor()):l.setAttribute("fill","none"),A.getDrawLines()?(l.setAttribute("stroke",A.getLineColor()),l.setAttribute("stroke-width",A.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",A.getShapeRendering());for(var y,D,v=t.getPoints(),P=0;P<v.length;P++){var I=v[P],_=f-p+I[0]*S[0],R=E-h+I[1]*S[1],C=I[3],T=I[4],N=[I[5],I[6]];if(C==EJSS_DRAWING2D.Trace.ELLIPSE){var O=document.createElementNS("http://www.w3.org/2000/svg","ellipse");O.setAttribute("id",t.getName()+".mark"+P),g.appendChild(O),n(O,_,R,N,T)}else if(C==EJSS_DRAWING2D.Trace.RECTANGLE){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+P),g.appendChild(O),i(O,_,R,N,T)}else if(C==EJSS_DRAWING2D.Trace.BAR){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+P),g.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1];N[1]=M-R,R+=N[1]/2,i(O,_,R,N,T)}else if(C==EJSS_DRAWING2D.Trace.AREA){if(0!=P){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+P),g.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1],b=f-p+y*S[0],G=E-h+D*S[1];o(O,b,G,_,R,M,T)}y=I[0],D=I[1]}}var x=A.getAttributes();for(var L in x)u.setAttribute(L,x[L])}return u};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail=function(e,t){function r(e,t,r,n,i,o,s,a){if(!(0>=r)){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);for(var u="",g=0;r>g;g++){var c=t[g],S=i+c[0]*s,d=o+c[1]*a,f=c[2];u+=0==g||0==f?" M "+S+" "+d:" L "+S+" "+d}l.setAttribute("d",u),n.getDrawFill()?l.setAttribute("fill",n.getFillColor()):l.setAttribute("fill","none"),n.getDrawLines()?(l.setAttribute("stroke",n.getLineColor()),l.setAttribute("stroke-width",n.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",n.getShapeRendering());var E=n.getAttributes();for(var p in E)l.setAttribute(p,E[p])}}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=document.createElementNS("http://www.w3.org/2000/svg","g");n.appendChild(o);var s=e.getElementById(t.getName());null!==s&&(n.insertBefore(o,s),n.removeChild(s)),o.setAttribute("id",t.getName());var a=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=a[0]+u[0],c=a[1]+u[1],S=l[0]/2,d=l[1]/2,f=g-S,E=c-d,p=l[0],h=l[1],m=t.getSegmentsCount();if(m>0)for(var A=0;m>A;A++){var y=t.getSegmentPoints(A).length;r(o,t.getSegmentPoints(A),y,t.getSegmentStyle(A),f,E,p,h)}var y=t.getCurrentPoints().length;return r(o,t.getCurrentPoints(),y,t.getStyle(),f,E,p,h),o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail_original=function(e,t){function r(e,t,r,n,i){for(var o="",s=0;s<e.length;s++){var a=e[s],l=t+a[0]*n,u=r+a[1]*i,g=a[2];o+=0==s||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),n.appendChild(o));var s=t.getPixelPosition(),a=t.getPixelSizes(),l=t.getRelativePositionOffset(a),u=s[0]+l[0],g=s[1]+l[1],c=a[0]/2,S=a[1]/2;t.addTmpPoints();var d=r(t.getPoints(),u-c,g-S,a[0],a[1]);if(""!==d){o.setAttribute("d",d);var f=t.getStyle();f.getDrawFill()?o.setAttribute("fill",f.getFillColor()):o.setAttribute("fill","none"),f.getDrawLines()?(o.setAttribute("stroke",f.getLineColor()),o.setAttribute("stroke-width",f.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)o.setAttribute(p,E[p])}return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.Utils={},EJSS_SVGGRAPHICS.Utils.crispValue=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.crispTop=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.round=function(e){return+e.toFixed(4)},EJSS_SVGGRAPHICS.Utils.hsl2rgb=function(e){var t,r,n,i=e[0],o=e[1],s=e[2],a=(1-Math.abs(2*s-1))*o,l=i/60,u=a*(1-Math.abs(l%2-1));void 0===i||isNaN(i)||null===i?t=r=n=0:l>=0&&1>l?(t=a,
r=u,n=0):l>=1&&2>l?(t=u,r=a,n=0):l>=2&&3>l?(t=0,r=a,n=u):l>=3&&4>l?(t=0,r=u,n=a):l>=4&&5>l?(t=u,r=0,n=a):l>=5&&6>l&&(t=a,r=0,n=u);var g,c,S,d=s-a/2;return g=255*(t+d),c=255*(r+d),S=255*(n+d),g=Math.round(g),c=Math.round(c),S=Math.round(S),{r:g,g:c,b:S}},EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker=function(e){function t(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function r(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function n(e,t,r,n,i,o,s){u=4*(t+r*e.width),e.data[u+0]=n,e.data[u+1]=i,e.data[u+2]=o,e.data[u+3]=s}for(var i=e.data.params.imageData,o=e.data.params.width,s=e.data.params.height,a=(e.data.params.depth,e.data.params.data),l=e.data.params.colors,u=e.data.id,g=l[0],c=l[l.length-1],S=0;o>S;S++)for(var d=0;s>d;d++){var u=a[S][s-d-1],f=0>u?g:u<l.length?l[u]:c;"undefined"==typeof f&&(f=g),"rgb"==f.substring(0,3)?rgb=t(f):"hsl"==f.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(r(f))),n(i,S,d,rgb.r,rgb.g,rgb.b,255)}self.postMessage({result:i,id:u})},EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker=function(e,t,r,n,i,o){function s(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function a(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function l(e,t,r,n,i,o,s){d=4*(t+r*e.width),e.data[d+0]=n,e.data[d+1]=i,e.data[d+2]=o,e.data[d+3]=s}for(var u=o[0],g=o[o.length-1],c=0;t>c;c++)for(var S=0;r>S;S++){var d=i[c][r-S-1],f=0>d?u:d<o.length?o[d]:g;"undefined"==typeof f&&(f=u),"rgb"==f.substring(0,3)?rgb=s(f):"hsl"==f.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(a(f))),l(e,c,S,rgb.r,rgb.g,rgb.b,255)}},EJSS_SVGGRAPHICS.Utils.PNGCanvas=function(e,t,r,n,i,o){var s=document.createElement("canvas");s.setAttribute("width",e),s.setAttribute("height",t);var a=s.getContext("2d"),l=a.createImageData(e,t);EJSS_TOOLS.Worker.runFunction?EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){a.putImageData(e.result,0,0),o(s.toDataURL())}):(EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker(l,e,t,r,n,i),a.putImageData(l,0,0),o(s.toDataURL()))},EJSS_SVGGRAPHICS.Utils.ImageDataCanvas=function(e,t,r,n,i,o){var s=document.createElement("canvas");s.setAttribute("width",e),s.setAttribute("height",t);var a=s.getContext("2d"),l=a.createImageData(e,t);EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){o(e)})};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.video=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?(o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),o.setAttribute("id",t.getName()),r.appendChild(o),i=document.createElement("video"),i.setAttribute("id",t.getName()+".video"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&t.getWebCam()?navigator.getUserMedia({video:!0},function(e){i.src=window.URL.createObjectURL(e)},function(e){}):i.src=t.getVideoUrl(),o.appendChild(i)):i=document.getElementById(t.getName()+".video");var s=t.getPixelPosition(),a=t.getPixelSizes(),l=t.getRelativePositionOffset(a),u=s[0]+l[0],g=s[1]+l[1],c=Math.abs(a[0]/2),S=Math.abs(a[1]/2);i.loop=t.getLoop(),i.type=t.getType(),i.poster=t.getPoster(),i.autoplay=t.getAutoPlay(),i.controls=t.getControls(),!isNaN(i.duration)&&i.duration>=t.getCurrentTime()&&(i.currentTime=t.getCurrentTime()),i.width=Math.abs(a[0]),i.height=Math.abs(a[1]),o.setAttribute("x",u-c),o.setAttribute("y",g-S),t.isPlay()?i.play():i.pause();var d=t.getStyle().getAttributes();for(var f in d)o.setAttribute(f,d[f]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.web=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null!==i&&r.removeChild(i),i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),r.appendChild(i);var o=t.getPixelPosition(),s=t.getPixelSizes(),a=t.getRelativePositionOffset(s),l=o[0]+a[0],u=o[1]+a[1],g=(s[0]/2,s[1]/2,stepx=t.getStep()),c=t.getTicks();0!=c&&(stepx=Math.abs(s[0]/c),g=Math.abs(s[1]/c));for(var S=0,d=0,f=0;d<=s[0];d+=stepx,f+=g,S++)mShape=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),mShape.setAttribute("id",t.getName()+".ellipse"+S),i.appendChild(mShape),mShape.setAttribute("cx",l),mShape.setAttribute("cy",u),mShape.setAttribute("rx",d/2),mShape.setAttribute("ry",f/2);var E=t.getStyle();E.getDrawFill()?i.setAttribute("fill",E.getFillColor()):i.setAttribute("fill","none"),E.getDrawLines()?(i.setAttribute("stroke",E.getLineColor()),i.setAttribute("stroke-width",E.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",E.getShapeRendering());var p=E.getAttributes();for(var h in p)i.setAttribute(h,p[h]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.wheel=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,s=e.getElementById(t.getName());null===s?(s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s),i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()+".circle"),s.appendChild(i),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".cross"),s.appendChild(o)):(i=e.getElementById(t.getName()+".circle"),o=e.getElementById(t.getName()+".cross"));var a=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=a[0]+u[0],c=a[1]+u[1],S=l[0]/2,d=l[1]/2;i.setAttribute("cx",g),i.setAttribute("cy",c),i.setAttribute("rx",Math.abs(S)),i.setAttribute("ry",Math.abs(d)),o.setAttribute("d","M "+(g-S)+" "+c+" L "+(g+S)+" "+c+" M "+g+" "+(c-d)+" L "+g+" "+(c+d));var f=t.getStyle();f.getDrawFill()?s.setAttribute("fill",f.getFillColor()):s.setAttribute("fill","none"),f.getDrawLines()?(s.setAttribute("stroke",f.getLineColor()),s.setAttribute("stroke-width",f.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)s.setAttribute(p,E[p]);return s};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.SvgGraphics={getOffsetRect:function(e){var t,r,n,i,o=e.getAttribute("width"),s=e.getAttribute("height");t=parseFloat(o);var a=!isNaN(t)&&isFinite(o);r=parseFloat(s);var l=!isNaN(r)&&isFinite(s);if(e.getBoundingClientRect){var u=e.getElementById?e.getElementById(".myPanel"):null;if(u&&u.childElementCount>0)var g=u.getBoundingClientRect();else var g=e.getBoundingClientRect();n=g.top,i=g.left,a||(t=g.width),l||(r=g.height)}else if(void 0!==e.offsetTop)n=e.offsetTop,i=e.offsetLeft,a||(t=e.offsetWidth),l||(r=e.offsetHeight);else{for(var c=e.parentNode||document.getElementById(e.id).parentNode;c&&!c.offsetTop&&c&&!c.previousElementSibling&&!c.nextElementSibling;)c=c.parentNode;n=c.offsetTop,i=c.offsetLeft,a||(t=c.offsetWidth),l||(r=c.offsetHeight)}var S=document.body,d=document.documentElement,f=d.clientTop||S.clientTop||0,E=d.clientLeft||S.clientLeft||0;return n-=f,i-=E,{top:n,left:i,width:t,height:r,bottom:n+r,right:i+t}}},EJSS_GRAPHICS.svgGraphics=function(e){var t=EJSS_INTERFACE.svgGraphics(e),r=t.getDOMElement();return t.getEventContext=function(){return r},t.getWidth=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(r).width-1},t.getHeight=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(r).height-1},t.getOffsetLeft=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(r).left},t.getOffsetTop=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(r).top},t.remove=function(e){var t=r.getElementById(e);return null!==t?(r.removeChild(t),!0):!1},t.reset=function(){for(;r.firstChild;)r.removeChild(r.firstChild);var e=document.createElementNS("http://www.w3.org/2000/svg","defs");r.appendChild(e)},t.draw=function(e,n){for(var i=0,o=e.length;o>i;i++){var s=e[i];if(s.getElements)for(var a=s.getLastElements(),l=0,u=a.length;u>l;l++){var g=r.getElementById(a[l].getName());g&&g.parentNode.removeChild(g)}if(n||s.isChanged()||s.isGroupChanged()||s.isMustProject()){var c=t.drawElement(s);"undefined"!=typeof c&&null!=c&&t.transformElement(s,c)}}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape,n=null;switch(e.getClass()){case"ElementCustom":var i=e.getFunction();i&&(n=i(r,e));break;case"ElementGroup":n=EJSS_SVGGRAPHICS.group(r,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:n=EJSS_SVGGRAPHICS.ellipse(r,e);break;case t.RECTANGLE:n=EJSS_SVGGRAPHICS.rectangle(r,e);break;case t.ROUND_RECTANGLE:n=EJSS_SVGGRAPHICS.roundRectangle(r,e);break;case t.WHEEL:n=EJSS_SVGGRAPHICS.wheel(r,e);break;case t.NONE:case t.POINT:n=EJSS_SVGGRAPHICS.point(r,e)}break;case"ElementSegment":n=EJSS_SVGGRAPHICS.segment(r,e);break;case"ElementImage":n=EJSS_SVGGRAPHICS.image(r,e);break;case"ElementVideo":n=EJSS_SVGGRAPHICS.video(r,e);break;case"ElementArrow":n=EJSS_SVGGRAPHICS.arrow(r,e);break;case"ElementText":n=EJSS_SVGGRAPHICS.text(r,e);break;case"ElementSpring":n=EJSS_SVGGRAPHICS.spring(r,e);break;case"ElementTrail":n=EJSS_SVGGRAPHICS.trail(r,e);break;case"ElementTrace":n=EJSS_SVGGRAPHICS.trace(r,e);break;case"ElementGrid":n=EJSS_SVGGRAPHICS.grid(r,e);break;case"ElementAxis":n=EJSS_SVGGRAPHICS.axis(r,e);break;case"ElementWeb":n=EJSS_SVGGRAPHICS.web(r,e);break;case"ElementCursor":n=EJSS_SVGGRAPHICS.cursor(r,e);break;case"ElementPolygon":n=EJSS_SVGGRAPHICS.polygon(r,e);break;case"ElementAnalyticCurve":n=EJSS_SVGGRAPHICS.analyticCurve(r,e);break;case"ElementCellLattice":n=EJSS_SVGGRAPHICS.cellLattice(r,e);break;case"ElementByteRaster":n=EJSS_SVGGRAPHICS.byteRaster(r,e);break;case"ElementMesh":n=EJSS_SVGGRAPHICS.mesh(r,e);break;case"ElementTank":n=EJSS_SVGGRAPHICS.tank(r,e);break;case"ElementPipe":n=EJSS_SVGGRAPHICS.pipe(r,e);break;case"ElementHistogram":n=EJSS_SVGGRAPHICS.histogram(r,e)}return n&&(e.isGroupVisible()?n.setAttribute("visibility","visible"):n.setAttribute("visibility","hidden")),n},t.transformElement=function(e,t){var r,n=e.getTransformation();if(Array.isArray(n))r="matrix("+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" "+n[4]+" "+n[5]+")";else if("string"==typeof n)r=n;else if("number"==typeof n){var i=e.getPixelPosition(),o=EJSS_TOOLS.Mathematics.degrees(-n);r="rotate("+o+" "+i[0]+" "+i[1]+")"}r&&t.setAttribute("transform",r)},t.drawGutters=function(e){var n=e.getGutters();if(n.visible){var i=EJSS_SVGGRAPHICS.Utils,o=r.getElementById(".myGutters"),s=r.getElementById(".myOuterBorder"),a=r.getElementById(".myInnerBorder");null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",".myGutters"),o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0),r.appendChild(o),s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",".myOuterBorder"),s.setAttribute("fill","none"),r.appendChild(s),a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",".myInnerBorder"),a.setAttribute("fill","none"),r.appendChild(a));var l=e.getRealWorldCoordinates();if(e.getInvertedScaleY())var u=e.toPixelPosition([l[1],l[2]]);else var u=e.toPixelPosition([l[1],l[3]]);var g=e.toPixelMod([l[1]-l[0],l[3]-l[2]]),c=u[0],S=u[1],d=g[0],f=g[1],E=.5,p=.5,h=t.getWidth(),m=t.getHeight(),A=e.getGuttersStyle(),y=e.getStyle();"crispEdges"==y.getShapeRendering()?(o.setAttribute("d","M "+i.crispValue(E)+" "+i.crispValue(p)+" L "+i.crispValue(E)+" "+i.crispValue(p+m)+" L "+i.crispValue(E+h)+" "+i.crispValue(p+m)+" L "+i.crispValue(E+h)+" "+i.crispValue(p)+" L "+i.crispValue(E)+" "+i.crispValue(p)+" M "+i.crispValue(c-d)+" "+i.crispValue(S)+" L "+i.crispValue(c)+" "+i.crispValue(S)+" L "+i.crispValue(c)+" "+i.crispValue(S-f)+" L "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c-d)+" "+i.crispValue(S)+" z"),s.setAttribute("d","M "+i.crispValue(E)+" "+i.crispValue(p)+" L "+i.crispValue(E)+" "+i.crispValue(p+m)+" L "+i.crispValue(E+h)+" "+i.crispValue(p+m)+" L "+i.crispValue(E+h)+" "+i.crispValue(p)+" L "+i.crispValue(E)+" "+i.crispValue(p)+" z"),a.setAttribute("d","M "+i.crispValue(c-d)+" "+i.crispValue(S)+" L "+i.crispValue(c)+" "+i.crispValue(S)+" L "+i.crispValue(c)+" "+i.crispValue(S-f)+" L "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c-d)+" "+i.crispValue(S)+" z")):(o.setAttribute("d","M "+E+" "+p+" L "+E+" "+(p+m)+" L "+(E+h)+" "+(p+m)+" L "+(E+h)+" "+p+" L "+E+" "+p+" M "+(c-d)+" "+S+" L "+c+" "+S+" L "+c+" "+(S-f)+" L "+(c-d)+" "+(S-f)+" L "+(c-d)+" "+S+" z"),s.setAttribute("d","M "+E+" "+p+" L "+E+" "+(p+m)+" L "+(E+h)+" "+(p+m)+" L "+(E+h)+" "+p+" L "+E+" "+p+" z"),a.setAttribute("d","M "+(c-d)+" "+S+" L "+c+" "+S+" L "+c+" "+(S-f)+" L "+(c-d)+" "+(S-f)+" L "+(c-d)+" "+S+" z")),A.getDrawFill()?o.setAttribute("fill",A.getFillColor()):o.setAttribute("fill","none"),A.getDrawLines()?(s.setAttribute("stroke",A.getLineColor()),s.setAttribute("stroke-width",A.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),y.getDrawLines()?(a.setAttribute("stroke",y.getLineColor()),a.setAttribute("stroke-width",y.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",y.getShapeRendering()),s.setAttribute("shapeRendering",A.getShapeRendering()),a.setAttribute("shapeRendering",y.getShapeRendering())}},t.drawPanel=function(e){var n=EJSS_SVGGRAPHICS.Utils,i=r.getElementById(".myPanel");null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",".myPanel"),r.appendChild(i));var o=.5,s=.5,a=t.getWidth(),l=t.getHeight(),u=e.getStyle();"crispEdges"==u.getShapeRendering()?i.setAttribute("d","M "+n.crispValue(o)+" "+n.crispValue(s)+" L "+n.crispValue(o)+" "+n.crispValue(s+l)+" L "+n.crispValue(o+a)+" "+n.crispValue(s+l)+" L "+n.crispValue(o+a)+" "+n.crispValue(s)+" z"):i.setAttribute("d","M "+o+" "+s+" L "+o+" "+(s+l)+" L "+(o+a)+" "+(s+l)+" L "+(o+a)+" "+s+" z"),u.getDrawFill()?i.setAttribute("fill",u.getFillColor()):i.setAttribute("fill","none"),u.getDrawLines()?(i.setAttribute("stroke",u.getLineColor()),i.setAttribute("stroke-width",u.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",u.getShapeRendering())},t.drawGuttersOLD=function(e){var n=e.getGutters();if(n.visible){var i=EJSS_SVGGRAPHICS.Utils,o=r.getElementById(".myGutters");null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",".myGutters"),r.appendChild(o));var s=e.getRealWorldCoordinates();if(e.getInvertedScaleY())var a=e.toPixelPosition([s[1],s[2]]);else var a=e.toPixelPosition([s[1],s[3]]);var l=e.toPixelMod([s[1]-s[0],s[3]-s[2]]),u=a[0],g=a[1],c=l[0],S=l[1],d=.5,f=.5,E=t.getWidth(),p=t.getHeight(),h=e.getGuttersStyle(),m=e.getStyle();"crispEdges"==m.getShapeRendering()?o.setAttribute("d","M "+i.crispValue(d)+" "+i.crispValue(f)+" L "+i.crispValue(d)+" "+i.crispValue(f+p)+" L "+i.crispValue(d+E)+" "+i.crispValue(f+p)+" L "+i.crispValue(d+E)+" "+i.crispValue(f)+" L "+i.crispValue(d)+" "+i.crispValue(f)+" M "+i.crispValue(u-c)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g-S)+" L "+i.crispValue(u-c)+" "+i.crispValue(g-S)+" L "+i.crispValue(u-c)+" "+i.crispValue(g)+" z"):o.setAttribute("d","M "+d+" "+f+" L "+d+" "+(f+p)+" L "+(d+E)+" "+(f+p)+" L "+(d+E)+" "+f+" L "+d+" "+f+" M "+(u-c)+" "+g+" L "+u+" "+g+" L "+u+" "+(g-S)+" L "+(u-c)+" "+(g-S)+" L "+(u-c)+" "+g+" z"),h.getDrawFill()?o.setAttribute("fill",h.getFillColor()):o.setAttribute("fill","none"),m.getDrawLines()?(o.setAttribute("stroke",m.getLineColor()),o.setAttribute("stroke-width",m.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",m.getShapeRendering())}},t.drawPanelNO=function(e){var n=EJSS_SVGGRAPHICS.Utils,i=r.getElementById(".myPanel");null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",".myPanel"),r.appendChild(i));var o=.5,s=.5,a=t.getWidth(),l=t.getHeight(),u=e.getStyle();"crispEdges"==u.getShapeRendering()?i.setAttribute("d","M "+n.crispValue(o)+" "+n.crispValue(s)+" L "+n.crispValue(o)+" "+n.crispValue(s+l)+" L "+n.crispValue(o+a)+" "+n.crispValue(s+l)+" L "+n.crispValue(o+a)+" "+n.crispValue(s)+" z"):i.setAttribute("d","M "+o+" "+s+" L "+o+" "+(s+l)+" L "+(o+a)+" "+(s+l)+" L "+(o+a)+" "+s+" z"),u.getDrawFill()?i.setAttribute("fill",u.getFillColor()):i.setAttribute("fill","none"),u.getDrawLines()?(i.setAttribute("stroke",u.getLineColor()),i.setAttribute("stroke-width",u.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",u.getShapeRendering())},t.importSVG=function(e){var r=(new XMLSerializer).serializeToString(t.getDOMElement()),n=document.createElement("canvas");n.width=t.getWidth()+1,n.height=t.getHeight()+1;var i=n.getContext("2d"),o=new Image;return o.src="data:image/svg+xml;utf8,"+r,o.onload=function(){i.drawImage(o,0,0),e&&e(n.toDataURL("image/png"))},o.src},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InfoText={registerProperties:function(e,t){EJSS_DRAWING2D.Text.registerProperties(e,t),t.registerProperty("Info",e.setInfo),t.registerProperty("Format",e.setFormat)}},EJSS_DRAWING2D.infoText=function(e){function t(e,t){if(!Array.isArray(t)||"undefined"==typeof n)return t;for(var r="",i=e,o=e.match(/[0-9]*\.(\^|#)+/g),s=0;s<o.length;s++){var a=o[s].split("#").length-1;r=isNaN(t[s])?t[s]:t[s].toFixed(a),i=i.replace(o[s],r)}return i}var r,n,i=EJSS_DRAWING2D.text(e),o=i.getText;return i.setInfo=function(e){r=e},i.getText=function(){if("undefined"==typeof r){var e=o();return t(n,e)}return r.getInfo?r.getInfo():"function"==typeof r?r():void 0},i.setFormat=function(e){n=e},i.isChanged=function(){return!0},i.registerProperties=function(e){EJSS_DRAWING2D.InfoText.registerProperties(i,e)},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Mesh={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData),t.registerProperty("DataType",e.setDataType),t.registerProperty("Mesh",e.setMesh),t.registerProperty("Points",e.setPoints),t.registerProperty("Cells",e.setCells),t.registerProperty("FieldAtPoints",e.setFieldAtPoints),t.registerProperty("FieldAtCells",e.setFieldAtCells),t.registerProperty("VectorLength",e.setVectorLength),t.registerProperty("Boundary",e.setBoundary),t.registerProperty("BoundaryLabels",e.setBoundaryLabels),t.registerProperty("BoundaryColors",e.setBoundaryColors),t.registerProperty("BoundaryWidth",e.setBoundaryLineWidth),t.registerProperty("DrawBoundary",e.setDrawBoundary)}},EJSS_DRAWING2D.mesh=function(e){var t,r,n,i,o,s,a=EJSS_DRAWING2D.element(e),l=(EJSS_DRAWING2D.Style,-1),u=!0,g=.03,c=null,S=1,d=!0,f=EJSS_DRAWING2D.colorCoded(16,EJSS_DRAWING2D.ColorMapper.SPECTRUM);return a.getClass=function(){return"ElementMesh"},a.setDataType=function(e){switch(e){case"MESH_2D":l=0;break;case"MESH_3D":l=1;break;case"SCALAR_2D_FIELD":l=2;break;case"SCALAR_3D_FIELD":l=3;break;case"VECTOR_2D_FIELD":l=4;break;case"VECTOR_3D_FIELD":l=5;break;default:l=e}a.setChanged(!0)},a.getDataType=function(){return l},a.setData=function(e){if(!e)return!1;var t=l;switch((0>t||t>5)&&(t=e.type),t){case 0:case 1:return a.setMesh(e.problem_mesh),!0;case 2:case 3:case 4:case 5:return a.setMesh(e.solution_mesh),a.setFieldAtCells(e.solution_values),!0}return!1},a.setMesh=function(e){a.setPoints(e.points),a.setCells(e.cells),a.setBoundary(e.boundary),a.setBoundaryLabels(e.boundary_labels),a.setChanged(!0)},a.setPoints=function(e){t=e,a.setChanged(!0)},a.getPoints=function(){return t},a.setFieldAtPoints=function(e){r=e,n=null,null!=r&&f.setAutoscaleArray2(r),a.setChanged(!0)},a.getFieldAtPoints=function(){return r},a.setCells=function(e){i=e,a.setChanged(!0)},a.getCells=function(){return i},a.setFieldAtCells=function(e){n=e,r=null,null!=n&&f.setAutoscaleArray3(n),a.setChanged(!0)},a.getFieldAtCells=function(){return n},a.setVectorLength=function(e){g!==e&&(g=e,a.setChanged(!0))},a.getVectorLength=function(){return g},a.setBoundary=function(e){o=e,a.setChanged(!0)},a.getBoundary=function(){return o},a.setBoundaryLabels=function(e){s=e,a.setChanged(!0)},a.getBoundaryLabels=function(){return s},a.setBoundaryColors=function(e){c=e,a.setChanged(!0)},a.getBoundaryColors=function(){return c},a.setBoundaryLineWidth=function(e){S=Math.max(1,e),a.setChanged(!0)},a.getBoundaryLineWidth=function(){return S},a.setBoundaryStroke=function(e){S=e,a.setChanged(!0)},a.getBoundaryStroke=function(){return S},a.setDrawBoundary=function(e){d=e,a.setChanged(!0)},a.getDrawBoundary=function(){return d},a.getColorCoded=function(){return f},a.setAutoscaleZ=function(e,t,i){u=e,u?null!=r?f.setAutoscaleArray2(r):null!=n&&f.setAutoscaleArray3(n):f.setScale(t,i),a.setChanged(!0)},a.isAutoscaleZ=function(){return u},a.getBounds=function(e){var t=0,r=0,n=0,i=0,o=a.getPoints();if(o&&o.length>0){var s=o.length;r=t=o[0][0],i=n=o[0][1];for(var l=1;s>l;l++){var u=o[l][0],g=o[l][1];u>r&&(r=u),g>i&&(i=g),t>u&&(t=u),n>g&&(n=g)}}var u=a.getX(),g=a.getY(),c=a.getSizeX(),S=a.getSizeY(),d=c/2,f=S/2,E=a.getRelativePositionOffset(c,S),p={left:u+E[0]-d+t*c,right:u+E[0]-d+r*c,top:g+E[1]-f+i*S,bottom:g+E[1]-f+n*S};return p},a.registerProperties=function(e){EJSS_DRAWING2D.Mesh.registerProperties(a,e)},a.setSize([1,1]),a.setRelativePosition("SOUTH_WEST"),a};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Pipe={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PipeWidth",e.setPipeWidth,e.getPipeWidth)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints()),t.setPipeWidth(e.getPipeWidth())}},EJSS_DRAWING2D.pipe=function(e){var t=EJSS_DRAWING2D.element(e),r=[],n=5;EJSS_DRAWING2D.Style,EJSS_DRAWING2D.Element;return t.getClass=function(){return"ElementPipe"},t.setPoints=function(e){r=e,t.setChanged(!0)},t.getPoints=function(){return r},t.setPipeWidth=function(e){n=e,t.setChanged(!0)},t.getPipeWidth=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Pipe.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Pipe.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t.getStyle().setLineWidth(1),t.getStyle().setFillColor("Blue"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PlottingPanel={registerProperties:function(e,t){EJSS_DRAWING2D.DrawingPanel.registerProperties(e,t),t.registerProperty("Title",e.getTitle().setText),t.registerProperty("TitleFont",e.getTitle().getFont().setFont),t.registerProperty("TitleColor",e.getTitle().getFont().setFillColor),t.registerProperty("TitleMargin",e.getTitle().setMarginY),t.registerProperty("TitleX",e.getTitleX().setText),t.registerProperty("TitleXFont",e.getTitleX().getFont().setFont),t.registerProperty("TitleXColor",e.getTitleX().getFont().setFillColor),t.registerProperty("TitleXMargin",e.getTitleX().setMarginY),t.registerProperty("TitleY",e.getTitleY().setText),t.registerProperty("TitleYFont",e.getTitleY().getFont().setFont),t.registerProperty("TitleYColor",e.getTitleY().getFont().setFillColor),t.registerProperty("TitleYMargin",e.getTitleY().setMarginX),t.registerProperty("GridXShow",e.getGrid().setShowX,e.getGrid().getShowX),t.registerProperty("GridXTicks",e.getGrid().setTicksX,e.getGrid().getTicksX),t.registerProperty("GridXStep",e.getGrid().setStepX,e.getGrid().getStepX),t.registerProperty("GridXAutoStepMin",e.getGrid().setAutoStepXMin,e.getGrid().getAutoStepXMin),t.registerProperty("GridXAutoTicksRange",e.getGrid().setAutoTicksXRange,e.getGrid().getAutoTicksXRange),t.registerProperty("GridXScale",e.getGrid().setScaleX,e.getGrid().getScaleX),t.registerProperty("GridXScalePrecision",e.getGrid().setScalePrecisionX,e.getGrid().getScalePrecisionX),t.registerProperty("GridXFixedTick",e.getGrid().setFixedTickX,e.getGrid().getFixedTickX),t.registerProperty("GridXAutoTicks",e.getGrid().setAutoTicksX,e.getGrid().getAutoTicksX),t.registerProperty("GridXLineColor",e.getGrid().setLineColorX),t.registerProperty("GridXLineWidth",e.getGrid().setLineWidthX),t.registerProperty("GridXShapeRendering",e.getGrid().setShapeRenderingX),t.registerProperty("GridYShow",e.getGrid().setShowY,e.getGrid().getShowY),t.registerProperty("GridYTicks",e.getGrid().setTicksY,e.getGrid().getTicksY),t.registerProperty("GridYStep",e.getGrid().setStepY,e.getGrid().getStepY),t.registerProperty("GridYAutoStepMin",e.getGrid().setAutoStepYMin,e.getGrid().getAutoStepYMin),t.registerProperty("GridYAutoTicksRange",e.getGrid().setAutoTicksYRange,e.getGrid().getAutoTicksYRange),t.registerProperty("GridYScale",e.getGrid().setScaleY,e.getGrid().getScaleY),t.registerProperty("GridYScalePrecision",e.getGrid().setScalePrecisionY,e.getGrid().getScalePrecisionY),t.registerProperty("GridYFixedTick",e.getGrid().setFixedTickY,e.getGrid().getFixedTickY),t.registerProperty("GridYAutoTicks",e.getGrid().setAutoTicksY,e.getGrid().getAutoTicksY),t.registerProperty("GridYLineColor",e.getGrid().setLineColorY),t.registerProperty("GridYLineWidth",e.getGrid().setLineWidthY),t.registerProperty("GridYShapeRendering",e.getGrid().setShapeRenderingY),t.registerProperty("AxisXShow",e.getAxisX().setShow),t.registerProperty("AxisXLineColor",e.getAxisX().getStyle().setLineColor),t.registerProperty("AxisXLineWidth",e.getAxisX().getStyle().setLineWidth),t.registerProperty("AxisXShapeRendering",e.getAxisX().getStyle().setShapeRendering),t.registerProperty("AxisXFixedTick",e.getAxisX().setFixedTick,e.getAxisX().getFixedTick),t.registerProperty("AxisXAutoTicks",e.getAxisX().setAutoTicks,e.getAxisX().getAutoTicks),t.registerProperty("AxisXTicks",e.getAxisX().setTicks,e.getAxisX().getTicks),t.registerProperty("AxisXStep",e.getAxisX().setStep,e.getAxisX().getStep),t.registerProperty("AxisXTickStep",e.getAxisX().setTickStep,e.getAxisX().getTickStep),t.registerProperty("AxisXAutoStepMin",e.getAxisX().setAutoStepMin,e.getAxisX().getAutoStepMin),t.registerProperty("AxisXAutoTicksRange",e.getAxisX().setAutoTicksRange,e.getAxisX().getAutoTicksRange),t.registerProperty("AxisXScale",e.getAxisX().setScale,e.getAxisX().getScale),t.registerProperty("AxisXScalePrecision",e.getAxisX().setScalePrecision,e.getAxisX().getScalePrecision),t.registerProperty("AxisXFont",e.getAxisX().getFont().setFont),t.registerProperty("AxisXFontColor",e.getAxisX().getFont().setFillColor),t.registerProperty("AxisYShow",e.getAxisY().setShow),t.registerProperty("AxisYLineColor",e.getAxisY().getStyle().setLineColor),t.registerProperty("AxisYLineWidth",e.getAxisY().getStyle().setLineWidth),t.registerProperty("AxisYShapeRendering",e.getAxisY().getStyle().setShapeRendering),t.registerProperty("AxisYFixedTick",e.getAxisY().setFixedTick,e.getAxisY().getFixedTick),t.registerProperty("AxisYAutoTicks",e.getAxisY().setAutoTicks,e.getAxisY().getAutoTicks),t.registerProperty("AxisYTicks",e.getAxisY().setTicks,e.getAxisY().getTicks),t.registerProperty("AxisYStep",e.getAxisY().setStep,e.getAxisY().getStep),t.registerProperty("AxisYTickStep",e.getAxisY().setTickStep,e.getAxisY().getTickStep),t.registerProperty("AxisYAutoStepMin",e.getAxisY().setAutoStepMin,e.getAxisY().getAutoStepMin),t.registerProperty("AxisYAutoTicksRange",e.getAxisY().setAutoTicksRange,e.getAxisY().getAutoTicksRange),t.registerProperty("AxisYScale",e.getAxisY().setScale,e.getAxisY().getScale),t.registerProperty("AxisYScalePrecision",e.getAxisY().setScalePrecision,e.getAxisY().getScalePrecision),t.registerProperty("AxisYFont",e.getAxisY().getFont().setFont),t.registerProperty("AxisYFontColor",e.getAxisY().getFont().setFillColor),t.registerProperty("XFixedTick",function(t){e.getAxisX().setFixedTick(t),e.getGrid().setFixedTickX(t)}),t.registerProperty("YFixedTick",function(t){e.getAxisY().setFixedTick(t),e.getGrid().setFixedTickY(t)}),t.registerProperty("XTicks",function(t){e.getAxisX().setTicks(t),e.getGrid().setTicksX(t)}),t.registerProperty("YTicks",function(t){e.getAxisY().setTicks(t),e.getGrid().setTicksY(t)}),t.registerProperty("XStep",function(t){e.getAxisX().setStep(t),e.getGrid().setStepX(t)}),t.registerProperty("YStep",function(t){e.getAxisY().setStep(t),e.getGrid().setStepY(t)}),t.registerProperty("XTickStep",function(t){e.getAxisX().setTickStep(t),e.getGrid().setTickStepX(t)}),t.registerProperty("YTickStep",function(t){e.getAxisY().setTickStep(t),e.getGrid().setTickStepY(t)}),t.registerProperty("XAutoStepMin",function(t){e.getAxisX().setAutoStepMin(t),e.getGrid().setAutoStepXMin(t)}),t.registerProperty("YAutoStepMin",function(t){e.getAxisY().setAutoStepMin(t),e.getGrid().setAutoStepYMin(t)}),t.registerProperty("XAutoTicksRange",function(t){e.getAxisX().setAutoTicksRange(t),e.getGrid().setAutoTicksXRange(t)}),t.registerProperty("YAutoTicksRange",function(t){e.getAxisY().setAutoTicksRange(t),e.getGrid().setAutoTicksyRange(t)}),t.registerProperty("XScale",function(t){e.getAxisX().setScale(t),e.getGrid().setScaleX(t)}),t.registerProperty("YScale",function(t){e.getAxisY().setScale(t),e.getGrid().setScaleY(t)}),t.registerProperty("XScalePrecision",function(t){e.getAxisX().setScalePrecision(t),e.getGrid().setScalePrecisionX(t)}),t.registerProperty("YScalePrecision",function(t){e.getAxisY().setScalePrecision(t),e.getGrid().setScalePrecisionY(t)}),t.registerProperty("XAutoTicks",function(t){e.getAxisX().setAutoTicks(t),e.getGrid().setAutoTicksX(t)}),t.registerProperty("YAutoTicks",function(t){e.getAxisY().setAutoTicks(t),e.getGrid().setAutoTicksY(t)})}},EJSS_DRAWING2D.plottingPanel=function(e){var t=EJSS_DRAWING2D.drawingPanel(e);t.getGrid=function(){return n},t.getAxisX=function(){return o},t.getAxisY=function(){return s},t.getTitleX=function(){return a},t.getTitleY=function(){return l},t.getTitle=function(){return u},t.registerProperties=function(e){EJSS_DRAWING2D.PlottingPanel.registerProperties(t,e)};var r=EJSS_DRAWING2D.group(e+".bottomgroup");r.setRelativePosition("SOUTH_WEST"),r.panelChangeListener=function(e){if("bounds"==e){var n=t.getRealWorldXMin(),i=t.getRealWorldXMax(),o=t.getRealWorldYMin(),s=t.getRealWorldYMax(),a=Math.abs(i-n),l=Math.abs(s-o);return r.setSize([a,l]),r.setPosition([n,o]),!0}},r.panelChangeListener("bounds");var n=EJSS_DRAWING2D.grid(e+".grid");n.setGroup(r),n.setRelativePosition("SOUTH_WEST"),n.setLineColorX("lightgray"),n.setShapeRenderingX("RENDER_CRISPEDGES"),n.setLineColorY("lightgray"),n.setShapeRenderingY("RENDER_CRISPEDGES"),n.setSize([1,1]),n.setPosition([0,0]),n.panelChangeListener=function(e){if("bounds"==e){var r=t.getRealWorldXMin(),i=t.getRealWorldXMax();n.setScaleX([r,i]),n.setTicksXMode(t.getTypeScaleX());var o=t.getRealWorldYMin(),s=t.getRealWorldYMax();return n.setScaleY([o,s]),n.setTicksYMode(t.getTypeScaleY()),!0}};var i=EJSS_DRAWING2D.group(e+".topgroup");i.setRelativePosition("SOUTH_WEST"),i.panelChangeListener=function(e){if("bounds"==e){var r=t.getRealWorldXMin(),n=t.getRealWorldXMax(),o=t.getRealWorldYMin(),s=t.getRealWorldYMax(),a=Math.abs(n-r),l=Math.abs(s-o);return i.setSize([a,l]),i.setPosition([r,o]),!0}},i.panelChangeListener("bounds");var o=EJSS_DRAWING2D.axis(e+".axisX");o.setGroup(i),o.setRelativePosition("WEST"),o.getStyle().setLineColor("black"),o.getStyle().setShapeRendering("RENDER_CRISPEDGES"),o.getFont().setFontSize(10),o.setSize([1,1]),o.setPosition([0,0]),o.setOrient("AXIS_HORIZONTAL"),o.panelChangeListener=function(e){if("bounds"==e){var r=t.getRealWorldXMin(),n=t.getRealWorldXMax();return o.setScale([r,n]),o.setTicksMode(t.getTypeScaleX()),t.getInvertedScaleY()?(o.setTextPosition("TICKS_DOWN"),
a.setMarginY(-30),u.setMarginY(20)):(o.setTextPosition("TICKS_UP"),a.setMarginY(30),u.setMarginY(-20)),!0}},o.setTicksMode(t.getTypeScaleX());var s=EJSS_DRAWING2D.axis(e+".axisY");s.setGroup(i),s.setRelativePosition("SOUTH"),s.getStyle().setLineColor("black"),s.getStyle().setShapeRendering("RENDER_CRISPEDGES"),s.getFont().setFontSize(10),s.setSize([1,1]),s.setPosition([0,0]),s.setOrient("AXIS_VERTICAL"),s.panelChangeListener=function(e){if("bounds"==e){var r=t.getRealWorldYMin(),n=t.getRealWorldYMax();return s.setScale([r,n]),s.setTicksMode(t.getTypeScaleY()),s.setInvertedScaleY(t.getInvertedScaleY()),!0}},s.setTicksMode(t.getTypeScaleY());var a=EJSS_DRAWING2D.text(e+".titleX");a.setGroup(i),a.setRelativePosition("CENTER"),a.getFont().setFontSize(12),a.setPosition([.5,0]),a.setMarginY(30),a.setText("x");var l=EJSS_DRAWING2D.text(e+".titleY");l.setGroup(i),l.setRelativePosition("CENTER"),l.getFont().setFontSize(12),l.setWritingMode("MODE_DOWNTOP"),l.setPosition([0,.5]),l.setMarginX(-40),l.setText("y");var u=EJSS_DRAWING2D.text(e+".title");return u.setGroup(i),u.setRelativePosition("CENTER"),u.getFont().setFontSize(12),u.setPosition([.5,1]),u.setMarginY(-20),u.setText("Plot"),t.getStyle().setLineColor("black"),t.getStyle().setFillColor("white"),t.getStyle().setShapeRendering("RENDER_CRISPEDGES"),t.setGutters([50,50,50,50]),t.getGuttersStyle().setLineColor("black"),t.getGuttersStyle().setFillColor("rgb(211,216,255)"),t.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),t.addDecoration(r),t.addDecoration(n),t.addDecoration(i,-1,!0),t.addDecoration(o,-1,!0),t.addDecoration(s,-1,!0),t.addDecoration(a,-1,!0),t.addDecoration(l,-1,!0),t.addDecoration(u,-1,!0),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Polygon={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PointsX",e.setPointsX),t.registerProperty("PointsY",e.setPointsY),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint)}},EJSS_DRAWING2D.polygon=function(e){function t(e,t){isNaN(e)||isNaN(t)||(n[n.length]=[e,t])}var r=EJSS_DRAWING2D.element(e),n=(EJSS_DRAWING2D.Style,[]),i=null,o=null;return r.getClass=function(){return"ElementPolygon"},r.addPoint=function(e,n){e instanceof Array?t(e[0],e[1]):t(e,n),r.setChanged(!0)},r.addPoints=function(e,n){if(void 0!=e&&null!=e&&void 0!=e[0]){if(e[0]instanceof Array)for(var i=0,o=e.length;o>i;i++)t(e[i][0],e[i][1]);else for(var o=Math.min(e.length,n.length),i=0;o>i;i++)t(e[i],n[i]);r.setChanged(!0)}},r.setPoints=function(e,t){r.clear(),r.addPoints(e,t),r.setChanged(!0)},r.setPointsX=function(e){null==o?i=e:(r.setPoints(e,o),o=null)},r.setPointsY=function(e){null==i?o=e:(r.setPoints(i,e),i=null)},r.getPoints=function(){return n},r.getLastPoint=function(){return n.length>0?n[n.length-1]:[]},r.clear=function(){n=[],r.setChanged(!0)},r.getBounds=function(e){var t,n,i,o,s=r.getPoints(),a=s.length;if(0==a)t=n=i=o=0;else{n=t=s[0][0],o=i=s[0][1];for(var l=1;a>l;l++){var u=s[l][0],g=s[l][1];u>n&&(n=u),g>o&&(o=g),t>u&&(t=u),i>g&&(i=g)}}var u=r.getX(),g=r.getY(),c=r.getSizeX(),S=r.getSizeY(),d=S/2,f=S/2,E=r.getRelativePositionOffset(c,S);return{left:u+E[0]-d+t*c,right:u+E[0]+d+n*c,top:g+E[1]+f+o*c,bottom:g+E[1]-f+i*c}},r.registerProperties=function(e){EJSS_DRAWING2D.Polygon.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Polygon.copyTo(r,e)},r.setSize([1,1]),r.setRelativePosition("SOUTH_WEST"),r},EJSS_DRAWING2D.PolygonSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)})}},EJSS_DRAWING2D.polygonSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.polygon,e),r=EJSS_DRAWING2D.PolygonSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Segment={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition)}},EJSS_DRAWING2D.segment=function(e){var t=EJSS_DRAWING2D.element(e);EJSS_DRAWING2D.Style;return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING2D.Segment.registerProperties(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.SegmentSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)})}},EJSS_DRAWING2D.segmentSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.segment,e);return t.registerProperties=function(e){EJSS_DRAWING2D.SegmentSet.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Shape={NONE:0,ELLIPSE:1,RECTANGLE:2,ROUND_RECTANGLE:3,WHEEL:4,POINT:5,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ShapeType",e.setShapeType),t.registerProperty("CornerRadius",e.setCornerRadius)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setShapeType(e.getShapeType()),t.setCornerRadius(e.getCornerRadius())}},EJSS_DRAWING2D.shape=function(e){var t=EJSS_DRAWING2D.element(e),r=10,n=EJSS_DRAWING2D.Shape.ELLIPSE;return t.setShapeType=function(e){n="string"==typeof e?EJSS_DRAWING2D.Shape[e.toUpperCase()]:e},t.getShapeType=function(){return n},t.setCornerRadius=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getCornerRadius=function(){return r},t.getClass=function(){return"ElementShape"},t.registerProperties=function(e){EJSS_DRAWING2D.Shape.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Shape.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t},EJSS_DRAWING2D.ShapeSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("ShapeType",function(t){e.setToEach(function(e,t){e.setShapeType(t)},t)}),t.registerProperty("CornerRadius",function(t){e.setToEach(function(e,t){e.setCornerRadius(t)},t)})}},EJSS_DRAWING2D.shapeSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.shape,e),r=EJSS_DRAWING2D.ShapeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SimplePanel={GRAPHICS2D_SVG:"SVG",GRAPHICS2D_CANVAS:"Canvas",registerProperties:function(e,t){t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS)}},EJSS_DRAWING2D.simplePanel=function(e){var t={},r=EJSS_GRAPHICS.svgGraphics(e),n=EJSS_DRAWING2D.style(e),i=[],o=!1,s=[],a={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,xorigin:0,yorigin:0,xscale:1,yscale:1},l=!0,u=!0;return t.getName=function(){return e},t.getGraphics=function(){return r},t.importGraphics=function(e){return r.importSVG(e)},t.getStyle=function(){return n},t.setGraphics=function(t){t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_CANVAS?console.log("WARNING: setGraphics() - Canvas not supported"):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==a.xminPreferred&&(a.xminPreferred=e,u=!0)},t.getWorldXMin=function(){return a.xminPreferred},t.setWorldXMax=function(e){e!==a.xmaxPreferred&&(a.xmaxPreferred=e,u=!0)},t.getWorldXMax=function(){return a.xmaxPreferred},t.setWorldYMin=function(e){e!==a.yminPreferred&&(a.yminPreferred=e,u=!0)},t.getWorldYMin=function(){return a.yminPreferred},t.setWorldYMax=function(e){e!==a.ymaxPreferred&&(a.ymaxPreferred=e,u=!0)},t.getWorldYMax=function(){return a.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.addElement=function(e,r){EJSS_TOOLS.addToArray(i,e,r),e.setPanel(t),e.dataCollected&&s.push(e),o=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(i,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(s,e),o=!0},t.getElements=function(){return i},t.indexOfElement=function(e){return i.indexOf(e)},t.toPixelAxisY=function(e){return a.yorigin-e-a.yscale*a.yminPreferred},t.toPixelAxisX=function(e){return a.xorigin+e-a.xscale*a.xminPreferred},t.toPixelPosition=function(e){var t=[];return t[0]=a.xorigin+a.xscale*(e[0]-a.xminPreferred),t[1]=a.yorigin+a.yscale*(e[1]-a.yminPreferred),t},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*a.xscale,t[1]=e[1]*a.yscale,t},t.toPanelPosition=function(e){var t=[];return t[0]=a.xminPreferred+(e[0]-a.xorigin)/a.xscale,t[1]=a.yminPreferred+(e[1]-a.yorigin)/a.yscale,t},t.toPanelMod=function(e){var t=[];return t[0]=0==a.xscale?0:e[0]/a.xscale,t[1]=0==a.yscale?0:e[1]/a.yscale,t},t.getPixelPositionWorldOrigin=function(){return[a.xorigin,a.yorigin]},t.recomputeScales=function(){var e=r.getWidth(),t=r.getHeight(),n=e/(a.xmaxPreferred-a.xminPreferred),i=t/(a.ymaxPreferred-a.yminPreferred);a.xscale=n,a.yscale=-i,a.xorigin=.5,a.yorigin=t+.5,u=!1},t.reset=function(){r.reset()},t.render=function(){var e=!1;o&&(r.reset(),e=!0,o=!1);for(var n=0,a=s.length;a>n;n++)s[n].dataCollected();u&&t.recomputeScales(),(l||e)&&r.drawPanel(t),r.draw(i,e),l=!1;for(var n=0,a=i.length;a>n;n++)i[n].setChanged(!1)},t.registerProperties=function(e){EJSS_DRAWING2D.SimplePanel.registerProperties(t,e)},n.setLineColor("black"),n.setFillColor("rgb(239,239,255)"),n.setChangeListener(function(e){l=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Spring={DEF_RADIUS:.05,DEF_LOOPS:8,DEF_PPL:15,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setSolenoid(e.getSolenoid()),t.setThinExtremes(e.getThinExtremes()),t.setLoops(e.getLoops()),t.setPointsPerLoop(e.getPointsPerLoop())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("Solenoid",e.setSolenoid,e.getSolenoid),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("Loops",e.setLoops,e.getLoops),t.registerProperty("PointsPerLoop",e.setPointsPerLoop,e.getPointsPerLoop)}},EJSS_DRAWING2D.spring=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i=(EJSS_DRAWING2D.Style,EJSS_DRAWING2D.Spring.DEF_RADIUS),o=0,s=!0;return n.getClass=function(){return"ElementSpring"},n.setRadius=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getRadius=function(){return i},n.setSolenoid=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getSolenoid=function(){return o},n.setThinExtremes=function(e){s!=e&&(s=e,n.setChanged(!0))},n.getThinExtremes=function(){return s},n.setLoops=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getLoops=function(){return t},n.setPointsPerLoop=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getPointsPerLoop=function(){return r},n.registerProperties=function(e){EJSS_DRAWING2D.Spring.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Spring.copyTo(n,e)},n.setSize([.1,.1]),n.setLoops(EJSS_DRAWING2D.Spring.DEF_LOOPS),n.setPointsPerLoop(EJSS_DRAWING2D.Spring.DEF_PPL),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SpringSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("Solenoid",function(t){e.setToEach(function(e,t){e.setSolenoid(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("Loops",function(t){e.setToEach(function(e,t){e.setLoops(t)},t)}),t.registerProperty("PointsPerLoop",function(t){e.setToEach(function(e,t){e.setPointsPerLoop(t)},t)})}},EJSS_DRAWING2D.springSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.spring,e),r=EJSS_DRAWING2D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Tank={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("LevelColor",e.setLevelColor),t.registerProperty("Level",e.setLevel),t.registerProperty("Closed",e.setClosed)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setLevel(e.getLevel()),t.setLevelColor(e.getLevelColor())}},EJSS_DRAWING2D.tank=function(e){var t=EJSS_DRAWING2D.element(e),r=0,n="blue",i=EJSS_DRAWING2D.Tank;EJSS_DRAWING2D.Style,EJSS_DRAWING2D.Element;return t.getClass=function(){return"ElementTank"},t.setLevel=function(e){r=e,t.setChanged(!0)},t.getLevel=function(){return r},t.setLevelColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=n&&(n=e,t.setChanged(!0)),t},t.getLevelColor=function(){return n},t.registerProperties=function(e){i.registerProperties(t,e)},t.copyTo=function(e){i.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("White"),t.getStyle().setLineColor("Black"),t.getStyle().setDrawFill(!1),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Text={MODE_TOPDOWN:0,MODE_RIGTHLEFT:1,MODE_DOWNTOP:2,MODE_LEFTRIGHT:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setWritingMode(e.getWritingMode())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Framed",e.setFramed),t.registerProperty("WritingMode",e.setWritingMode),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("OutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FillColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle),t.registerProperty("MarginX",e.getMarginX().setMarginX),t.registerProperty("MarginY",e.getMarginY().setMarginY)}},EJSS_DRAWING2D.text=function(e){var t=EJSS_DRAWING2D.element(e),r="",n=EJSS_DRAWING2D.Text.MODE_LEFTRIGHT,i=EJSS_DRAWING2D.font(e),o=!1,s=0,a=0;return t.getClass=function(){return"ElementText"},t.setText=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getText=function(){return r},t.setMarginX=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarginX=function(){return s},t.setMarginY=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarginY=function(){return a},t.getSizeX=function(){var e=r?r.length:0;return e*i.getFontSize()+e*i.getNumberLetterSpacing()},t.getSizeY=function(){return i.getFontSize()},t.getFont=function(){return i},t.setFramed=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getFramed=function(){return o},t.setWritingMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Text[e.toUpperCase()]),n!=e&&(n=e,t.setChanged(!0))},t.getWritingMode=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Text.copyTo(t,e)},i.setChangeListener(function(e){t.setChanged(!0)}),t.setPixelSize(!0),t},EJSS_DRAWING2D.TextSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Framed",function(t){e.setToEach(function(e,t){e.setFramed(t)},t)}),t.registerProperty("WritingMode",function(t){e.setToEach(function(e,t){e.setWritingMode(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("LetterSpacing",function(t){e.setToEach(function(e,t){e.getFont().setLetterSpacing(t)},t)}),t.registerProperty("OutlineColor",function(t){e.setToEach(function(e,t){e.getFont().setOutlineColor(t)},t)}),t.registerProperty("FontWeight",function(t){e.setToEach(function(e,t){e.getFont().setFontWeight(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)})}},EJSS_DRAWING2D.textSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.text,e),r=EJSS_DRAWING2D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trace={ELLIPSE:0,RECTANGLE:1,AREA:2,BAR:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Trail.copyTo(e,t),EJSS_DRAWING2D.Style.copyTo(e.getMarkStyle(),t.getMarkStyle()),t.setMarkType(e.getMarkType()),t.setMarkSize(e.getMarkSize())},registerProperties:function(e,t){EJSS_DRAWING2D.Trail.registerProperties(e,t),t.registerProperty("MarkType",e.setMarkType,e.getMarkType),t.registerProperty("MarkSize",e.setMarkSize,e.getMarkSize),t.registerProperty("MarkLineColor",e.getMarkStyle().setLineColor),t.registerProperty("MarkLineWidth",e.getMarkStyle().setLineWidth),t.registerProperty("MarkDrawLines",e.getMarkStyle().setDrawLines),t.registerProperty("MarkFillColor",e.getMarkStyle().setFillColor),t.registerProperty("MarkDrawFill",e.getMarkStyle().setDrawFill)}},EJSS_DRAWING2D.trace=function(e){var t=EJSS_DRAWING2D.trail(e),r=EJSS_DRAWING2D.Trace.ELLIPSE,n=EJSS_DRAWING2D.style(e),i=EJSS_DRAWING2D.Element.CENTER,o=0,s=0;return t.getClass=function(){return"ElementTrace"},t.setMarkRelativePosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Element[e.toUpperCase()]),i!=e&&(i=e,t.setChanged(!0))},t.getMarkRelativePosition=function(){return i},t.getMarkStyle=function(){return n},t.setMarkSize=function(e){(o!=e[0]||s!=e[1])&&(o=e[0],s=e[1],t.setChanged(!0))},t.getMarkSize=function(){return[o,s]},t.setMarkType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trace[e.toUpperCase()]),r!=e&&(r=e,t.setChanged(!0))},t.getMarkType=function(){return r},t.formatPoint=function(e){var t=e.length;return e[t++]=r,e[t]=EJSS_DRAWING2D.style(),EJSS_DRAWING2D.Style.copyTo(n,e[t++]),e[t++]=o,e[t]=s,e},t.registerProperties=function(e){EJSS_DRAWING2D.Trace.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trace.copyTo(t,e)},t},EJSS_DRAWING2D.TraceSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.TrailSet;r.registerProperties(e,t),t.registerProperty("MarkType",function(t){e.setToEach(function(e,t){e.setMarkType(t)},t)}),t.registerProperty("MarkSize",function(t){e.setToEach(function(e,t){e.setMarkSize(t)},t)}),t.registerProperty("MarkLineColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineColor(t)},t)}),t.registerProperty("MarkLineWidth",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineWidth(t)},t)}),t.registerProperty("MarkDrawLines",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawLines(t)},t)}),t.registerProperty("MarkFillColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setFillColor(t)},t)}),t.registerProperty("MarkDrawFill",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawFill(t)},t)}),t.registerProperty("MarkRelativePosition",function(t){e.setToEach(function(e,t){e.setMarkRelativePosition(t)},t)})}},EJSS_DRAWING2D.traceSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trace,e),r=EJSS_DRAWING2D.TraceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints)}},EJSS_DRAWING2D.trail=function(e){function t(e,t,n){return isNaN(e)||isNaN(t)?void(c=!0):void(i&&S[0]==e&&S[1]==t||(("undefined"==typeof n||null===n)&&(n=u),d=0,S=r.formatPoint([e,t,n]),s>0&&(g>0&&(d=r.formatPoint([e,t,n])),++g>=s&&(g=0)),0==d&&(l>2&&f.length>=l&&f.splice(0,1),f[f.length]=r.formatPoint([e,t,n]),c=!1)))}var r=EJSS_DRAWING2D.element(e),n=!0,i=!1,o=!1,s=0,a=["x","y"],l=0,u=EJSS_DRAWING2D.Trail.LINE_CONNECTION,g=0,c=!0,S=0,d=0,f=[],E=[],p=[],h=[],m=0,A=0;return r.getClass=function(){return"ElementTrail"},r.setActive=function(e){n!=e&&(n=e,r.setChanged(!0))},r.getActive=function(){return n},r.setNoRepeat=function(e){i!=e&&(i=e,r.setChanged(!0))},r.getNoRepeat=function(){return i},r.setClearAtInput=function(e){o!=e&&(o=e,r.setChanged(!0))},r.getClearAtInput=function(){return o},r.setSkip=function(e){s!=e&&(s=e,g=0,r.setChanged(!0))},r.getSkip=function(){return s},r.setInputLabels=function(e){(a[0]!=e[0]||a[1]!=e[1])&&(a[0]=e[0],a[1]=e[1],r.setChanged(!0))},r.getInputLabels=function(){return a},r.setMaximumPoints=function(e){var t=Math.max(e,2);l!=t&&(l=t,r.setChanged(!0))},r.getMaximumPoints=function(){return l},r.setConnected=function(e){e?r.setConnectionType(EJSS_DRAWING2D.Trail.LINE_CONNECTION):r.setConnectionType(EJSS_DRAWING2D.Trail.NO_CONNECTION)},r.isConnected=function(){return u===EJSS_DRAWING2D.Trail.LINE_CONNECTION},r.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trail[e.toUpperCase()]),u!=e&&(u=e,r.setChanged(!0))},r.getConnectionType=function(){return u},r.addPoint=function(e,i,s){n&&(o&&r.initialize(),e instanceof Array?t(e[0],e[1],s):t(e,i,s),r.setChanged(!0))},r.addPoints=function(e,i){if(n){if(o&&r.initialize(),"undefined"==typeof i||null===i)if(e[0]instanceof Array)for(var s=0,a=e.length;a>s;s++)t(e[s][0],e[s][1],u);else t(e[0],e[1],u);else for(var a=Math.min(e.length,i.length),s=0;a>s;s++)t(e[s],i[s],u);r.setChanged(!0)}},r.addXPoints=function(e){if(n){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)h[t]?h[t]=[e[t],h[t][1],h[t][2]]:h[t]=[e[t],A,u];m=e[t]}else h[t]?h[t]=[e,h[t][1],h[t][2]]:h[t]=[e,A,u],t++,m=e;for(;h[t];)h[t]=[m,h[t][1],h[t][2]],t++}},r.addYPoints=function(e){if(n){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)h[t]?h[t]=[h[t][0],e[t],h[t][2]]:h[t]=[m,e[t],u];A=e[t]}else h[t]?h[t]=[h[t][0],e,h[t][2]]:h[t]=[m,e,u],t++,A=e;for(;h[t];)h[t]=[h[t][0],A,h[t][2]],t++}},r.dataCollected=function(){h.length>0&&(r.addPoints(h),h=[],r.setChanged(!0))},r.setPoints=function(e,t,i){n&&(r.clear(),r.addPoints(e,t,i),r.setChanged(!0))},r.moveToPoint=function(e,i){n&&(o&&r.initialize(),e instanceof Array?t(e[0],e[1],EJSS_DRAWING2D.Trail.NO_CONNECTION):t(e,i,EJSS_DRAWING2D.Trail.NO_CONNECTION),r.setChanged(!0))},r.getSegmentsCount=function(){return E.length},r.getSegmentPoints=function(e){return E[e]},r.getSegmentStyle=function(e){return p[e]},r.getCurrentPoints=function(){return f},r.getPoints=function(){for(var e=[],t=E.length,r=0;t>r;r++)e=e.concat(E[r]);return e=e.concat(f)},r.getLastPoint=function(){return S},r.reset=function(){r.clear()},r.clear=function(){E=[],p=[],mCurrentSegment=0,r.initialize()},r.initialize=function(){f=[],d=0,c=!0,g=0,S=0,r.setChanged(!0)},r.newSegment=function(){if(0!=d){var e=f.length;f[e]=r.formatPoint(d)}var e=E.length;E[e]=f;var t=EJSS_DRAWING2D.style(r.getName()+" #"+e);EJSS_DRAWING2D.Style.copyTo(r.getStyle(),t),p[e]=t,r.initialize()},r.getBounds=function(e){var t,n,i,o,s=r.getPoints(),a=s.length;if(0==a)t=n=i=o=0;else{n=t=s[0][0],o=i=s[0][1];for(var l=1;a>l;l++){var u=s[l][0],g=s[l][1];u>n&&(n=u),g>o&&(o=g),t>u&&(t=u),i>g&&(i=g)}}var u=r.getX(),g=r.getY(),c=r.getSizeX(),S=r.getSizeY(),d=c/2,f=S/2,E=r.getRelativePositionOffset(c,S);return{left:u+E[0]-d+t*c,right:u+E[0]-d+n*c,top:g+E[1]-f+o*S,bottom:g+E[1]-f+i*S}},r.formatPoint=function(e){return e},r.registerProperties=function(e){EJSS_DRAWING2D.Trail.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(r,e)},r.setSize([1,1]),r.setRelativePosition("SOUTH_WEST"),r},EJSS_DRAWING2D.TrailSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)})}},EJSS_DRAWING2D.trailSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trail,e),r=EJSS_DRAWING2D.TrailSet;return t.reset=function(){for(var e=t.getElements(),r=0,n=e.length;n>r;r++)e[r].reset()},t.initialize=function(){for(var e=t.getElements(),r=0,n=e.length;n>r;r++)e[r].initialize()},t.clear=function(){for(var e=t.getElements(),r=0,n=e.length;n>r;r++)e[r].clear()},t.newSegment=function(e){t.getElements()[e].newSegment()},t.moveToPoint=function(e,r,n){t.getElements()[e].moveToPoint(r,n)},t.addPoint=function(e,r,n,i){t.getElements()[e].addPoint(r,n,i)},t.addPoints=function(e,r,n){t.getElements()[e].addPoints(r,n)},t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.colorCoded=function(e,t){var r=EJSS_DRAWING2D.colorMapper(e,t),n=!1;return r.setSymmetricZ=function(e){n=e},r.isSymmetricZ=function(){return n},r.setAutoscale=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,s=e.length;s>o;o++){var a=e[o];i=Math.max(i,a),t=Math.min(t,a)}var l=i,u=t;n&&(l=Math.max(Math.abs(t),Math.abs(i)),u=-l),r.setScale(u,l)},r.setAutoscaleArray2=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,s=e.length;s>o;o++)for(var a=0,l=e[o].length;l>a;a++){var u=e[o][a];i=Math.max(i,u),t=Math.min(t,u)}var g=i,c=t;n&&(g=Math.max(Math.abs(t),Math.abs(i)),c=-g),r.setScale(c,g)},r.setAutoscaleArray3=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,s=e.length;s>o;o++)for(var a=0,l=e[o].length;l>a;a++)for(var u=0,g=e[o][a].length;g>u;u++){var c=e[o][a][u];i=Math.max(i,c),t=Math.min(t,c)}var S=i,d=t;n&&(S=Math.max(Math.abs(t),Math.abs(i)),d=-S),r.setScale(d,S)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ColorMapper={CUSTOM:-1,SPECTRUM:0,GRAYSCALE:1,DUALSHADE:2,RED:3,GREEN:4,BLUE:5,BLACK:6,WIREFRAME:7,NORENDER:8,REDBLUE_SHADE:9,getColorPalette:function(e,t){function r(e,t,r){var n={h:Math.round(360*e),s:t,b:r},i={r:0,g:0,b:0};if(0===n.s)return i.r=i.g=i.b=n.h,i;var o=Math.floor(n.h/60),s=n.h/60-o,a=n.b*(1-n.s),l=n.b*(1-s*n.s),u=n.b*(1-(1-s)*n.s);switch(o){case 0:i.r=n.b,i.g=u,i.b=a;break;case 1:i.r=l,i.g=n.b,i.b=a;break;case 2:i.r=a,i.g=n.b,i.b=u;break;case 3:i.r=a,i.g=l,i.b=n.b;break;case 4:i.r=u,i.g=a,i.b=n.b;break;case 5:i.r=n.b,i.g=a,i.b=l}return i.r=Math.round(255*i.r),i.g=Math.round(255*i.g),i.b=Math.round(255*i.b),i}var n=EJSS_DRAWING2D.ColorMapper,i=[];2>e&&(e=2);for(var o=0;e>o;o++){var s=o/(e-1)*.8,a=1,l=1,u=0,g=0,c=0;switch(t){case n.REDBLUE_SHADE:u=Math.floor(255*Math.max(0,-e-1+2*o)/(e-1)),c=Math.floor(255*Math.max(0,e-1-2*o)/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.SPECTRUM:s=.8-s;var S=r(s,a,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")";break;case n.GRAYSCALE:case n.BLACK:u=g=c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.RED:u=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.GREEN:g=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.BLUE:c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.DUALSHADE:default:var d=o/(e-1);s=.8*(1-d),l=.2+1.6*Math.abs(.5-d);var S=r(s,a,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")"}}return i}},EJSS_DRAWING2D.colorMapper=function(e,t){var r,n,i,o=EJSS_DRAWING2D.ColorMapper,s={},a=[],l="darkgray",u="lightgray",g=-1,c=1;return s.setChangeListener=function(e){r=e},s.setPaletteType=function(t){"string"==typeof t&&(t=EJSS_DRAWING2D.ColorMapper[t.toUpperCase()]),n=t,l="darkgray",u="lightgray",(n==EJSS_DRAWING2D.ColorMapper.GRAYSCALE||n==EJSS_DRAWING2D.ColorMapper.BLACK)&&(l="rgb(64,64,128)",u="rgb(255,191,191)"),e=Math.max(2,e),a=o.getColorPalette(e,n),r&&r("palette")},s.getColors=function(){return a},s.getFloorColor=function(){return l},s.getCeilColor=function(){return u},s.getNumColors=function(){return e},s.setFloorCeilColor=function(e,t){l=e,u=t},s.setScale=function(e,t){g=e,c=t,i=new Array(a.length+1);for(var r=(c-g)/a.length,n=0,o=a.length;o>n;n++)i[n]=g+n*r;i[a.length]=c},s.getPaletteType=function(){return n},s.setColorPalette=function(t){l="darkgray",u="lightgray",a=t,e=t.length,n=EJSS_DRAWING2D.ColorMapper.CUSTOM,r&&r("colors")},s.setNumberOfColors=function(t){if(t!=e){if(e=t,n==EJSS_DRAWING2D.ColorMapper.CUSTOM){for(var i=[],o=0,a=Math.min(colors.length,e);a>o;o++)i[o]=colors[o];for(var o=colors.length;o<numColors;o++)i[o]=colors[colors.length-1];colors=i}else s.setPaletteType(n);r&&r("numColors")}},s.getNumberOfColors=function(){
return e},s.doubleToIndex=function(e){if(g-e>Number.MIN_VALUE)return-1;if(e-c>Number.MIN_VALUE)return a.length;var t=0;return c!=g&&(t=Math.floor(a.length*(e-g)/(c-g))),t=Math.max(0,t),Math.min(t,a.length-1)},s.indexToColor=function(e){return 0>e?l:e>=a.length?u:a[e]},s.getColorThresholds=function(){return i},s.setPaletteType(t),s.setScale(-1,1),s};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Font={copyTo:function(e,t){t.setFontFamily(e.getFontFamily()),t.setFontSize(e.getFontSizeString()),t.setLetterSpacing(e.getLetterSpacing()),t.setOutlineColor(e.getOutlineColor()),t.setFontWeight(e.getFontWeight()),t.setFillColor(e.getFillColor())}},EJSS_DRAWING2D.font=function(e){var t,r=(EJSS_DRAWING2D.Font,{}),n="Arial",i="20",o="normal",s="none",a="normal",l="black",u="none";return r.setChangeListener=function(e){t=e},r.setFontFamily=function(e){n!=e&&(n=e,t&&t("fontFamily"))},r.getFontFamily=function(){return n},r.setFontSize=function(e){i!=e&&(i=e,t&&t("fontSize"))},r.getFontSize=function(){var e;return e=isNaN(i)?-1!=i.indexOf("em")?10*+i.substr(0,i.indexOf("em")):-1!=i.indexOf("px")?+i.substr(0,i.indexOf("px")):0:+i},r.getFontSizeString=function(){return i},r.setLetterSpacing=function(e){o!=e&&(o=e,t&&t("letterSpacing"))},r.getLetterSpacing=function(){return o},r.getNumberLetterSpacing=function(){var e;return e=isNaN(o)?-1!=o.indexOf("px")?+o.substr(0,o.indexOf("px")):1:+o},r.setOutlineColor=function(e){s!=e&&(s=e,t&&t("lineColor"))},r.getOutlineColor=function(){return s},r.setFontWeight=function(e){a!=e&&(a=e,t&&t("fontWeight"))},r.getFontWeight=function(){return a},r.setFillColor=function(e){l!=e&&(l=e,t&&t("fillColor"))},r.getFillColor=function(){return l},r.setFontStyle=function(e){u!=e&&(u=e,t&&t("fontstyle"))},r.getFontStyle=function(){return u},r.getFont=function(){return u+" "+mLineWidth+" "+i+" "+n},r.setFont=function(e){if(!("string"!=typeof e||e.length<=0)){var t=e.split(" ");u=t[0],a=t[1];var r=t[2].split("/");i=r[0],t[3]&&(n=e.substring(e.indexOf(t[3])))}},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.functionsParser=function(){function e(e){function t(){}return t.prototype=e,new t}function t(e,t,r,n){this.type_=e,this.index_=t||0,this.prio_=r||0,this.number_=void 0!==n&&null!==n?n:0,this.toString=function(){switch(this.type_){case m:return this.number_;case A:case y:case D:return this.index_;case v:return"CALL";default:return"Invalid Token"}}}function r(e,t,r,n){this.tokens=e,this.ops1=t,this.ops2=r,this.functions=n}function n(e){return"string"==typeof e?(P.lastIndex=0,P.test(e)?"'"+e.replace(P,function(e){var t=I[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+e+"'"):e}function i(e,t){return Number(e)+Number(t)}function o(e,t){return e-t}function s(e,t){return e*t}function a(e,t){return e/t}function l(e,t){return e%t}function u(e,t){return""+e+t}function g(e){return-e}function c(e){return Math.random()*(e||1)}function S(e){e=Math.floor(e);for(var t=e;e>1;)t*=--e;return t}function d(e,t){return Math.sqrt(e*e+t*t)}function f(e){return 0>e?0:1}function E(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:(e=e.slice(),e.push(t),e)}function p(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":g,exp:Math.exp},this.ops2={"+":i,"-":o,"*":s,"/":a,"%":l,"^":Math.pow,",":E,"||":u},this.functions={random:c,fac:S,min:Math.min,max:Math.max,pyt:d,step:f,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,pi:Math.PI,PI:Math.PI}}var h={},m=0,A=1,y=2,D=3,v=4,P=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,I={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};r.prototype={simplify:function(n){n=n||{};var i,o,s,a,l=[],u=[],g=this.tokens.length,c=0;for(c=0;g>c;c++){a=this.tokens[c];var S=a.type_;if(S===m)l.push(a);else if(S===D&&a.index_ in n)a=new t(m,0,0,n[a.index_]),l.push(a);else if(S===y&&l.length>1)o=l.pop(),i=l.pop(),s=this.ops2[a.index_],a=new t(m,0,0,s(i.number_,o.number_)),l.push(a);else if(S===A&&l.length>0)i=l.pop(),s=this.ops1[a.index_],a=new t(m,0,0,s(i.number_)),l.push(a);else{for(;l.length>0;)u.push(l.shift());u.push(a)}}for(;l.length>0;)u.push(l.shift());return new r(u,e(this.ops1),e(this.ops2),e(this.functions))},substitute:function(n,i){i instanceof r||(i=(new p).parse(String(i)));var o,s=[],a=this.tokens.length,l=0;for(l=0;a>l;l++){o=this.tokens[l];var u=o.type_;if(u===D&&o.index_===n)for(var g=0;g<i.tokens.length;g++){var c=i.tokens[g],S=new t(c.type_,c.index_,c.prio_,c.number_);s.push(S)}else s.push(o)}var d=new r(s,e(this.ops1),e(this.ops2),e(this.functions));return d},evaluate:function(e){e=e||{};var t,r,n,i,o=[],s=this.tokens.length,a=0;for(a=0;s>a;a++){i=this.tokens[a];var l=i.type_;if(l===m)o.push(i.number_);else if(l===y)r=o.pop(),t=o.pop(),n=this.ops2[i.index_],o.push(n(t,r));else if(l===D)if(i.index_ in e)o.push(e[i.index_]);else{if(!(i.index_ in this.functions))throw new Error("undefined variable: "+i.index_);o.push(this.functions[i.index_])}else if(l===A)t=o.pop(),n=this.ops1[i.index_],o.push(n(t));else{if(l!==v)throw new Error("invalid Expression");if(t=o.pop(),n=o.pop(),!n.apply||!n.call)throw new Error(n+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?o.push(n.apply(void 0,t)):o.push(n.call(void 0,t))}}if(o.length>1)throw new Error("invalid Expression (parity)");return o[0]},toString:function(e){var t,r,i,o,s=[],a=this.tokens.length,l=0;for(l=0;a>l;l++){o=this.tokens[l];var u=o.type_;if(u===m)s.push(n(o.number_));else if(u===y)r=s.pop(),t=s.pop(),i=o.index_,e&&"^"==i?s.push("Math.pow("+t+","+r+")"):s.push("("+t+i+r+")");else if(u===D)s.push(o.index_);else if(u===A)t=s.pop(),i=o.index_,"-"===i?s.push("("+i+t+")"):s.push(i+"("+t+")");else{if(u!==v)throw new Error("invalid Expression");t=s.pop(),i=s.pop(),s.push(i+"("+t+")")}}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]},variables:function(){for(var e=this.tokens.length,t=[],r=0;e>r;r++){var n=this.tokens[r];n.type_===D&&-1==t.indexOf(n.index_)&&t.push(n.index_)}return t},toJSFunction:function(e,t){var r=new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }");return r}},h.parse=function(e){return(new p).parse(e)},h.evaluate=function(e,t){return p.parse(e).evaluate(t)},p.Expression=r,p.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:c,fac:S,exp:Math.exp,min:Math.min,max:Math.max,pyt:d,step:f,pow:Math.pow,atan2:Math.atan2,E:Math.E,pi:Math.PI,PI:Math.PI};var _=1,R=2,C=4,T=8,N=16,O=32,M=64,b=128,G=256;return p.prototype={parse:function(n){this.errormsg="",this.success=!0;var i=[],o=[];this.tmpprio=0;var s=_|T|C|M,a=0;for(this.expression=n,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&s&M?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",a++,this.addfunc(o,i,A)),s=_|T|C|M):this.isComment()||(0===(s&R)&&this.error_parsing(this.pos,"unexpected operator"),a+=2,this.addfunc(o,i,y),s=_|T|C|M);else if(this.isNumber()){0===(s&_)&&this.error_parsing(this.pos,"unexpected number");var l=new t(m,0,0,this.tokennumber);o.push(l),s=R|N|O}else if(this.isString()){0===(s&_)&&this.error_parsing(this.pos,"unexpected string");var l=new t(m,0,0,this.tokennumber);o.push(l),s=R|N|O}else if(this.isLeftParenth())0===(s&T)&&this.error_parsing(this.pos,'unexpected "("'),s&b&&(a+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(o,i,v)),s=_|T|C|M|G;else if(this.isRightParenth()){if(s&G){var l=new t(m,0,0,[]);o.push(l)}else 0===(s&N)&&this.error_parsing(this.pos,'unexpected ")"');s=R|N|O|T|b}else if(this.isComma())0===(s&O)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(o,i,y),a+=2,s=_|T|C|M;else if(this.isConst()){0===(s&_)&&this.error_parsing(this.pos,"unexpected constant");var u=new t(m,0,0,this.tokennumber);o.push(u),s=R|N|O}else if(this.isOp2())0===(s&C)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,y),a+=2,s=T;else if(this.isOp1())0===(s&C)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,A),a++,s=T;else if(this.isVar()){0===(s&_)&&this.error_parsing(this.pos,"unexpected variable");var g=new t(D,this.tokenindex,0,0);o.push(g),s=R|N|O|T|b}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');i.length>0;){var c=i.pop();o.push(c)}return a+1!==o.length&&this.error_parsing(this.pos,"parity"),new r(o,e(this.ops1),e(this.ops2),e(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,r,n){for(var i=new t(n,this.tokenindex,this.tokenprio+this.tmpprio,0);r.length>0&&i.prio_<=r[r.length-1].prio_;)e.push(r.pop());r.push(i)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var r=this.expression.charCodeAt(this.pos);if(!(r>=48&&57>=r||46===r))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e.charAt(i);if(n){switch(o){case"'":r.push("'");break;case"\\":r.push("\\");break;case"/":r.push("/");break;case"b":r.push("\b");break;case"f":r.push("\f");break;case"n":r.push("\n");break;case"r":r.push("\r");break;case"t":r.push("	");break;case"u":var s=parseInt(e.substring(i+1,i+5),16);r.push(String.fromCharCode(s)),i+=4;break;default:throw this.error_parsing(t+i,"Illegal escape sequence: '\\"+o+"'")}n=!1}else"\\"==o?n=!0:r.push(o)}return r.join("")},isString:function(){var e=!1,t="",r=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){var n=this.expression.charAt(this.pos);if("'"==n&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,r),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}return e},isConst:function(){var e;for(var t in this.consts){var r=t.length;if(e=this.expression.substr(this.pos,r),t===e)return this.tokennumber=this.consts[t],this.pos+=r,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else{if(94!==e)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e?!0:!1},isPositiveSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 43===e?!0:!1},isNegativeSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e?!0:!1},isLeftParenth:function(){var e=this.expression.charCodeAt(this.pos);return 40===e?(this.pos++,this.tmpprio+=10,!0):!1},isRightParenth:function(){var e=this.expression.charCodeAt(this.pos);return 41===e?(this.pos++,this.tmpprio-=10,!0):!1},isComma:function(){var e=this.expression.charCodeAt(this.pos);return 44===e?(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0):!1},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return 32===e||9===e||10===e||13===e?(this.pos++,!0):!1},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0&&e in this.ops1?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0&&e in this.ops2?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0?(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0):!1},isComment:function(){var e=this.expression.charCodeAt(this.pos-1);return 47===e&&42===this.expression.charCodeAt(this.pos)?(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0):!1}},h};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InteractionTarget={ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,SENSITIVITY_BOTH:0,SENSITIVITY_HORIZONTAL:1,SENSITIVITY_VERTICAL:2,SENSITIVITY_ANY:3,copyTo:function(e,t){t.setMotionEnabled(e.getMotionEnabled()),t.setAffectsGroup(e.getAffectsGroup()),t.setActionCommand(e.getActionCommand()),t.setDataObject(e.getDataObject()),t.setSensitivity(e.getSensitivity())}},EJSS_DRAWING2D.interactionTarget=function(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i={},o=EJSS_DRAWING2D.Element,s=n.ENABLED_NONE,a=!1,l=null,u=null,g=20,c=n.SENSITIVITY_BOTH;return i.getElement=function(){return e},i.getType=function(){return t},i.setMotionEnabled=function(e){s="string"==typeof e?n[e.toUpperCase()]:e},i.getMotionEnabled=function(){return s},i.setSensitivityType=function(e){c="string"==typeof e?n[e.toUpperCase()]:e},i.getSensitivityType=function(){return c},i.isEnabled=function(){return s!=n.ENABLED_NONE},i.setPositionOffset=function(e){r=e},i.getPixelPosition=function(){var t=e.getPixelPosition(),n=e.getPixelSizes(),i=e.getRelativePositionOffset(n),s=t[0]+i[0],a=t[1]+i[1],l=e.getPanel().getInvertedScaleY(),u=o.getRelativePositionOffset(r,n[0],n[1],l);return[s-u[0],a-u[1]]},i.getPosition=function(){var t=e.getAbsolutePosition(),n=e.getAbsoluteSize(),i=e.getPanel().getInvertedScaleY(),s=o.getRelativePositionOffset(r,n[0],n[1],i),a=e.getRelativePositionOffset(n),l=t[0]+a[0]-s[0],u=t[1]+a[1]-s[1];return[l,u]},i.setAffectsGroup=function(e){a=e},i.getAffectsGroup=function(){return a},i.setSensitivity=function(e){g=e},i.getSensitivity=function(){return g},i.setActionCommand=function(e){l=e},i.getActionCommand=function(){return l},i.setDataObject=function(e){u=e},i.getDataObject=function(){return u},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PanelInteraction={TARGET_POSITION:0,TARGET_SIZE:1},EJSS_DRAWING2D.panelInteraction=function(e){function t(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i=EJSS_DRAWING2D.PanelInteraction;EJSS_DRAWING2D.Element;if(t.getType()===i.TARGET_POSITION){var o=t.getPosition(),s=r[0]-o[0],a=r[1]-o[1];switch(t.getMotionEnabled()){case n.ENABLED_ANY:e.setX(e.getX()+s),e.setY(e.getY()+a),e.getController().propertiesChanged("Position","X","Y");break;case n.ENABLED_X:e.setX(e.getX()+s),e.getController().propertiesChanged("Position","X");break;case n.ENABLED_Y:e.setY(e.getY()+a),e.getController().propertiesChanged("Position","Y")}}else if(t.getType()===i.TARGET_SIZE){var o=t.getPosition(),s=r[0]-o[0],a=r[1]-o[1],l=t.getElement(),u=l.getAbsoluteSize();0===u[0]&&(u[0]=1e-5),0===u[1]&&(u[1]=1e-5);var g=[s/u[0],a/u[1]];switch(t.getMotionEnabled()){case n.ENABLED_ANY:e.setSizeX(e.getSizeX()+e.getSizeX()*g[0]),e.setSizeY(e.getSizeY()+e.getSizeY()*g[1]),e.getController().propertiesChanged("Size","SizeX","SizeY");break;case n.ENABLED_X:e.setSizeX(e.getSizeX()+e.getSizeX()*g[0]),e.getController().propertiesChanged("Size","SizeX");break;case n.ENABLED_Y:e.setSizeY(e.getSizeY()+e.getSizeY()*g[1]),e.getController().propertiesChanged("Size","SizeY")}}}function r(t){var r=e.getGraphics().getOffsetLeft(),n=e.getGraphics().getOffsetTop(),i=[];if("undefined"!=typeof t.changedTouches)for(var o=0;o<t.changedTouches.length;o++)i[o]=[],i[o][0]=t.changedTouches[o].pageX-window.pageXOffset-r,i[o][1]=t.changedTouches[o].pageY-window.pageYOffset-n;else i[0]=[],i[0][0]=(t.clientX||t.x)-r,i[0][1]=(t.clientY||t.y)-n;return i}var n={},i=EJSS_DRAWING2D.PanelInteraction,o=!1,s=!1,a=[],l=[],u=null,g=!1,c=0,S="move",d=0;n.getPanel=function(){return e},n.getEnabled=function(){return o},n.setStopGestures=function(e){s!=e&&(s=e,s?(n.setHandler("gesturestart",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gesturechange",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gestureend",function(e){return e.preventDefault(),e.stopPropagation(),!1})):(n.setHandler("gesturestart",function(){return!0}),n.setHandler("gesturechange",function(){return!0}),n.setHandler("gestureend",function(){return!0})))},n.setEnabled=function(e){o!=e&&(o=e,o?(n.setHandler("move",n.handleMouseMoveEvent),n.setHandler("down",n.handleMouseDownEvent),n.setHandler("up",n.handleMouseUpEvent)):(n.setHandler("move",function(){return!0}),n.setHandler("down",function(){return!0}),n.setHandler("up",function(){return!0})))},n.setCursorTypeForMove=function(e){S=e},n.getInteractionPoint=function(){return a},n.getInteractionBounds=function(){return 0==l.length||0==a.length?[]:[l[0],a[0],l[1],a[1]]},n.getInteractionElement=function(){return u},n.getOrientation=function(){return window.orientation},n.handleMouseMoveEvent=function(i){s&&(i.preventDefault(),i.stopPropagation());var l=r(i);if(a=e.toPanelPosition(l[l.length-1]),g)if(null!=u){var c=u.getAffectsGroup()?u.getElement().getGroup():u.getElement();t(c,u,a),c.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else for(var d=0;d<l.length;d++){var f=n.findInteractionTarget(e.getElements(),l[d]);if(null!=f){var c=f.getAffectsGroup()?f.getElement().getGroup():f.getElement(),E=e.toPanelPosition(l[d]);t(c,f,E),c.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else o&&e.getController().invokeAction("OnDrag")}else{var f=n.findInteractionTarget(e.getElements(),l[0]);null===f?(null!=u&&u.getElement().getController().invokeAction("OnExit"),o&&e.getController().invokeAction("OnMove"),i.target.style.cursor="default"):(u!=f&&(null!=u&&u.getElement().getController().invokeAction("OnExit"),f.getElement().getController().invokeAction("OnEnter")),f.isEnabled()?i.target.style.cursor=S:i.target.style.cursor="default"),u=f}return e.getController().reportInteractions(),!1},n.handleMouseDownEvent=function(t){g=!0,s&&(t.preventDefault(),t.stopPropagation());var i=r(t);l=e.toPanelPosition(i[0]),a=e.toPanelPosition(i[i.length-1]);for(var c=null,d=0;d<i.length;d++)c=n.findInteractionTarget(e.getElements(),i[d]),null!==c?(c.getElement().getController().invokeAction("OnPress"),t.target.style.cursor=S):o&&e.getController().invokeAction("OnPress");var f="undefined"!=typeof t.touches?t.touches.length:1;return u=1==i.length&&1==f?c:null,e.getController().reportInteractions(),!1},n.handleMouseUpEvent=function(t){g=!1,s&&(t.preventDefault(),t.stopPropagation());var i=r(t);if(a=e.toPanelPosition(i[i.length-1]),null!=u)u.getElement().getController().invokeAction("OnRelease");else for(var l=0;l<i.length;l++){var S=n.findInteractionTarget(e.getElements(),i[l]);null!==S?S.getElement().getController().invokeAction("OnRelease"):o&&e.getController().invokeAction("OnRelease")}return t.timeStamp-c<500&&e.getController().invokeAction("OnDoubleClick"),c=t.timeStamp,t.target.style.cursor="default",e.getController().reportInteractions(),!1},n.findInteractionTarget=function(t,r){for(var o=EJSS_DRAWING2D.InteractionTarget,s=null,a=t.length-1;a>=0;a--){var l=t[a];if(l.isGroupVisible())if(l.getElements){if(s=n.findInteractionTarget(l.getElements(),r),null!==s)return s}else{for(var u=l.getInteractionTargets(),g=0;g<u.length;g++)if(u[g].isEnabled()){var c=u[g].getSensitivity();if(c>0){var S=u[g].getPixelPosition(),f=!1;switch(u[g].getSensitivityType()){case o.SENSITIVITY_HORIZONTAL:f=Math.abs(S[1]-r[1])<c;break;case o.SENSITIVITY_VERTICAL:f=Math.abs(S[0]-r[0])<c;break;case o.SENSITIVITY_ANY:f=Math.abs(S[0]-r[0])<c||Math.abs(S[1]-r[1])<c;break;default:f=Math.abs(S[0]-r[0])<c&&Math.abs(S[1]-r[1])<c}if(f)return d=a,u[g]}}if(s=l.getInteractionTarget(i.TARGET_POSITION),s.isEnabled()&&!s.getSensitivity()){var E=l.getBounds(),p=e.toPanelPosition(r);if(E.left<p[0]&&E.right>p[0]&&E.bottom<p[1]&&E.top>p[1])return d=a,s}}}return null},n.getIndexElement=function(){return d},n.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"gesturestart":i.addEventListener("gesturestart",r,!1);break;case"gesturechange":i.addEventListener("gesturechange",r,!1);break;case"gestureend":i.addEventListener("gestureend",r,!1)}return!1};var f=window.onorientationchange;window.onorientationchange=function(){f&&f(),e.getController().invokeAction("OnOrientationChange"),e.getController().reportInteractions()};var E=window.onresize;return window.onresize=function(){E&&E(),e.getController().invokeAction("OnResize"),e.getController().reportInteractions()},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Style={RENDER_AUTO:"auto",RENDER_OPTSPEED:"optimizeSpeed",RENDER_CRISPEDGES:"crispEdges",RENDER_GEOPRECISION:"geometricPrecision",copyTo:function(e,t){t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setAttributes(e.getAttributes()),t.setShapeRendering(e.getShapeRendering())}},EJSS_DRAWING2D.style=function(e){var t,r=EJSS_DRAWING2D.Style,n={},i=!0,o="black",s=.5,a=!0,l="none",u=r.RENDER_AUTO,g={};return n.setChangeListener=function(e){t=e},n.setDrawLines=function(e){e!=i&&(i=e,t&&t("drawlines"))},n.getDrawLines=function(){return i},n.setLineColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=o&&(o=e,t&&t("linecolor")),n},n.getLineColor=function(){return o},n.setLineWidth=function(e){e!=s&&(s=e,t&&t("linewidth"))},n.getLineWidth=function(){return s},n.setDrawFill=function(e){e!=a&&(a=e,t&&t("drawfill"))},n.getDrawFill=function(){return a},n.setFillColor=function(e){"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=l&&(l=e,t&&t("fillcolor"))},n.getFillColor=function(){return l},n.setShapeRendering=function(e){"RENDER"==e.substring(0,6)&&(e=r[e.toUpperCase()]),u!=e&&(u=e,t&&t("shaperendering"))},n.getShapeRendering=function(){return u},n.setAttributes=function(e){e!=g&&(g=e,t&&t("attributes"))},n.getAttributes=function(){return g},n.serialize=function(){return{mDrawLines:i,mLineColor:o,mLineWidth:s,mDrawFill:a,mFillColor:l,mShapeRendering:u,mAttributes:g}},n.unserialize=function(e){i=e.mDrawLines,o=e.mLineColor,s=e.mLineWidth,a=e.mDrawFill,l=e.mFillColor,u=e.mShapeRendering,g=e.mAttributes},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Transformation={compare:function(e,t){return e.radians==t.radians&&e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.e==t.e&&e.f==t.f}},EJSS_DRAWING2D.transformation=function(e){e=e||{a:1,b:0,c:0,d:1,e:0,f:0};var t={a:e.a,c:e.c,e:e.e,b:e.b,d:e.d,f:e.f,radians:0};return t.toString=function(){return"a="+t.a+", c="+t.c+", e="+t.e+"\nb="+t.b+", d="+t.d+", f="+t.f},t.setToIdentity=function(){t.a=1,t.c=0,t.e=0,t.b=0,t.d=1,t.f=0,radians=0},t.setTransform=function(e){Array.isArray(e)&&e.length>5?(t.a=e[0],t.c=e[2],t.e=e[4],t.b=e[1],t.d=e[3],t.f=e[5]):(t.a=e.a,t.c=e.c,t.e=e.e,t.b=e.b,t.d=e.d,t.f=e.f,t.radians=e.radians)},t.setToTranslation=function(e,r){t.a=1,t.c=0,t.e=e,t.b=0,t.d=1,t.f=r},t.setToRotation=function(e){var r=Math.cos(e),n=Math.sin(e);t.a=r,t.c=-n,t.e=0,t.b=n,t.d=r,t.f=0,t.radians=e},t.getRotation=function(){return t.radians},t.translate=function(e,r){t.e+=e,t.f+=r},t.scale=function(e,r){t.a*=e,t.b*=e,t.c*=r,t.d*=r},t.concatenate=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,s=t.e,a=t.f;t.a=r*e.a+i*e.b,t.b=n*e.a+o*e.b,t.c=r*e.c+i*e.d,t.d=n*e.c+o*e.d,t.e=r*e.e+i*e.f+s,t.f=n*e.e+o*e.f+a,t.radians+=e.radians},t.transform=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n+t.e,e[1]=t.b*r+t.d*n+t.f,e},t.transformVector=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n,e[1]=t.b*r+t.d*n,e},t.inverseTransform=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,s=t.e,a=t.f,l=r*o-n*i;if(0===l)return null;var u=e[0],g=e[1];return e[0]=(o*u-i*g+(i*a-o*s))/l,e[1]=(-n*u+r*g+(n*s-r*a))/l,e},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Video={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("VideoUrl",e.setVideoUrl),t.registerProperty("CurrentTime",e.setCurrentTime),t.registerProperty("ShowControls",e.setControls),t.registerProperty("AutoPlay",e.setAutoPlay),t.registerProperty("Type",e.setType),t.registerProperty("Poster",e.setPoster),t.registerProperty("Loop",e.setLoop),t.registerProperty("WebCam",e.setWebCam)}},EJSS_DRAWING2D.video=function(e){var t,r=EJSS_DRAWING2D.element(e),n=!1,i=!1,o="",s="",a=!0,l=0,u=!0,g=!0;return r.getClass=function(){return"ElementVideo"},r.setLoop=function(e){n!=e&&(n=e,r.setChanged(!0))},r.getLoop=function(){return n},r.setPoster=function(e){s!=e&&(s=e,r.setChanged(!0))},r.getPoster=function(){return s},r.setType=function(e){o!=e&&(o=e,r.setChanged(!0))},r.getType=function(){return o},r.setAutoPlay=function(e){a!=e&&(a=e,g=e,r.setChanged(!0))},r.getAutoPlay=function(){return a},r.setWebCam=function(e){i!=e&&(i=e,r.setChanged(!0))},r.getWebCam=function(){return i},r.setVideoUrl=function(e){t!=e&&(t=e,r.setChanged(!0))},r.getVideoUrl=function(){return t},r.setCurrentTime=function(e){l!=e&&(l=e,r.setChanged(!0))},r.getCurrentTime=function(){return l},r.setControls=function(e){u!=e&&(u=e,r.setChanged(!0))},r.getControls=function(){return u},r.play=function(){1!=g&&(g=!0,r.setChanged(!0))},r.stop=function(){0!=g&&(g=!1,a=!1,r.setChanged(!0))},r.isPlay=function(){return g},r.registerProperties=function(e){EJSS_DRAWING2D.Video.registerProperties(r,e)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Web={TICKS_LOG:5,TICKS_NUM:6,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode)}},EJSS_DRAWING2D.web=function(e){var t=EJSS_DRAWING2D.element(e),r=0,n=0,i=EJSS_DRAWING2D.Axis.TICKS_NUM;return t.getClass=function(){return"ElementWeb"},t.setStep=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getStep=function(){return r},t.setTicks=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getTicks=function(){return n},t.setTicksMode=function(e){var r=EJSS_DRAWING2D.Web.TICKS_NUM;"string"==typeof e&&(r=EJSS_DRAWING2D.Web[e.toUpperCase()]),i!=r&&(i=r,t.setChanged(!0))},t.getTicksMode=function(){return i},t.registerProperties=function(e){EJSS_DRAWING2D.Web.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.WebCamImage={registerProperties:function(e,t){EJSS_DRAWING2D.Image.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("On",e.setOnOff,e.isOnOff)}},EJSS_DRAWING2D.webCamImage=function(e){var t=EJSS_DRAWING2D.image(e);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var r,n,i=!0;return t.setUrl=function(e){r=e},t.getUrl=function(){return r},t.setOnOff=function(e){e?i||t.play():i&&t.pause()},t.isOnOff=function(){return i},t.play=function(){r&&r!=t.getImageUrl()&&(n=t.getImageUrl(),"local:"==r?navigator.getUserMedia?navigator.getUserMedia({video:!0},function(e){window.webkitURL?t.forceImageUrl(window.webkitURL.createObjectURL(e)):t.forceImageUrl(e)},errorCallback):t.setImageUrl(n):t.setImageUrl(r)),i=!0},t.pause=function(){i=!1,n&&t.setImageUrl(n)},t.registerProperties=function(e){EJSS_DRAWING2D.WebCamImage.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticCurve={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints),t.registerProperty("MinValue",e.setMinValue),t.registerProperty("MaxValue",e.setMaxValue),t.registerProperty("Variable",e.setVariable),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticCurve=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,EJSS_DRAWING2D.functionsParser()),n="t",i="t",o="0",s=screen.width/10,a=0,l=0,u="t";return t.getClass=function(){return"ElementAnalyticCurve"},t.setNumPoints=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMinValue=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMaxValue=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints=function(){return s},t.getMinValue=function(){return a},t.getMaxValue=function(){return l},t.getVariable=function(){return u},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticCurve.registerProperties(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticSurface={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints1",e.setNumPoints1),t.registerProperty("MinValue1",e.setMinValue1),t.registerProperty("MaxValue1",e.setMaxValue1),t.registerProperty("Variable1",e.setVariable1),t.registerProperty("NumPoints2",e.setNumPoints2),t.registerProperty("MinValue2",e.setMinValue2),t.registerProperty("MaxValue2",e.setMaxValue2),t.registerProperty("Variable2",e.setVariable2),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticSurface=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,EJSS_DRAWING2D.functionsParser()),n="u",i="v",o="0",s=100,a=0,l=0,u="u",g=100,c=0,S=0,d="v";return t.getClass=function(){return"ElementAnalyticSurface"},t.setNumPoints1=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMinValue1=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMaxValue1=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable1=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setNumPoints2=function(e){g!=e&&(g=e,t.setMeshChanged(!0))},t.setMinValue2=function(e){c!=e&&(c=e,t.setMeshChanged(!0))},t.setMaxValue2=function(e){S!=e&&(S=e,t.setMeshChanged(!0))},t.setVariable2=function(e){d!=e&&(d=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints1=function(){return s},t.getMinValue1=function(){return a},t.getMaxValue1=function(){return l},t.getVariable1=function(){return u},t.getNumPoints2=function(){return g},t.getMinValue2=function(){return c},t.getMaxValue2=function(){return S},t.getVariable2=function(){return d},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o);
},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticSurface.registerProperties(t,e)},t.setSize([1,1,1]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Arrow={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setHeadHeight(e.getHeadHeight()),t.setHeadWidth(e.getHeadWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("HeadHeight",e.setHeadHeight),t.registerProperty("HeadWidth",e.setHeadWidth)}},EJSS_DRAWING3D.arrow=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,0),n=0,i=0,o=1,s=1,a=1,l=8,u=20;return t.getClass=function(){return"ElementArrow"},t.setHeadHeight=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.getHeadHeight=function(){return l},t.setHeadWidth=function(e){u!=e&&(u=wh,t.setMeshChanged(!0))},t.getHeadWidth=function(){return u},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getY=function(){return n},t.setZ=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getZ=function(){return i},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,n,i]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return s},t.getSizeZ=function(){return a},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.registerProperties=function(e){EJSS_DRAWING3D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Arrow.copyTo(t,e)},t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!0),t.getStyle().setLineWidth(3),t.setResolution([10,2]),t},EJSS_DRAWING3D.ArrowSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("HeadHeight",function(t){e.setToEach(function(e,t){e.setHeadHeight(t)},t)}),t.registerProperty("HeadWidth",function(t){e.setToEach(function(e,t){e.setHeadWidth(t)},t)})}},EJSS_DRAWING3D.arrowSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.arrow,e),r=EJSS_DRAWING3D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Basic={object_files:{},copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setVertices(e.getVertices()),t.setTriangles(e.getTriangles()),t.setNormals(e.getNormals()),t.setColors(e.getColors())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Description",e.setDescription),t.registerProperty("Vertices",e.setVertices),t.registerProperty("Triangles",e.setTriangles),t.registerProperty("Normals",e.setNormals),t.registerProperty("Colors",e.setColors)}},EJSS_DRAWING3D.basic=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,[]),n=[],i=[],o=[];return t.getClass=function(){return"ElementBasic"},t.setDescription=function(e){var r=t.getPanel();if(r&&r.supportsWebGL()){if("string"==typeof e){var n="Object3D_"+EJSS_TOOLS.File.plainName(e);return void t.setDescription(window[n])}e.vertices&&t.setVertices(e.vertices),e.triangles&&t.setTriangles(e.triangles),e.normals&&t.setNormals(e.normals),e.colors&&t.setColors(e.colors)}},t.setVertices=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getVertices=function(){return r},t.setTriangles=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getTriangles=function(){return n},t.setNormals=function(e){EJSS_TOOLS.compareArrays(i,e)||(i=e.slice(),t.setMeshChanged(!0))},t.getNormals=function(){return i},t.setColors=function(e){EJSS_TOOLS.compareArrays(o,e)||(o=e.slice(),t.setMeshChanged(!0))},t.getColors=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Basic.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Basic.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BasicSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Description",function(t){e.setToEach(function(e,t){e.setDescription(t)},t)}),t.registerProperty("Vertices",function(t){e.setToEach(function(e,t){e.setVertices(t)},t)}),t.registerProperty("Triangles",function(t){e.setToEach(function(e,t){e.setTriangles(t)},t)}),t.registerProperty("Normals",function(t){e.setToEach(function(e,t){e.setNormals(t)},t)}),t.registerProperty("Colors",function(t){e.setToEach(function(e,t){e.setColors(t)},t)})}},EJSS_DRAWING3D.basicSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.basic,e),r=EJSS_DRAWING3D.BasicSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Box={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setReduceZby(e.getReduceZby())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("ReduceZby",e.setReduceZby)}},EJSS_DRAWING3D.box=function(e){var t=EJSS_DRAWING3D.element(e),r=0;EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementBox"},t.setReduceZby=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getReduceZby=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Box.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Box.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BoxSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("ReduceZby",function(t){e.setToEach(function(e,t){e.setReduceZby(t)},t)})}},EJSS_DRAWING3D.boxSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.box,e),r=EJSS_DRAWING3D.BoxSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cone={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.cone=function(e){var t=EJSS_DRAWING3D.cylinder(e);EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementCone"},t.registerProperties=function(e){EJSS_DRAWING3D.Cone.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cone.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t},EJSS_DRAWING3D.ConeSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.coneSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cone,e),r=EJSS_DRAWING3D.ConeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cylinder={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU)}},EJSS_DRAWING3D.cylinder=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,0),n=360,i=1,o=1;return t.getClass=function(){return"ElementCylinder"},t.setOriginAndEnd=function(e,r){var n=(e[0]+r[0])/2,i=(e[1]+r[1])/2,o=(e[2]+r[2])/2,s=r[0]-e[0],a=r[1]-e[1],l=r[2]-e[2],u=Math.sqrt(s*s+a*a+l*l),g=Math.acos(l/u);t.setPosition([n,i,o]),t.setSizeZ(u),t.setFirstTransformation([[g,-a,s,0,n,i,o]])},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Cylinder.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cylinder.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.CylinderSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.cylinderSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cylinder,e),r=EJSS_DRAWING3D.CylinderSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Disk={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t),t.setBaseDetail(e.getBaseDetail())},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.disk=function(e){var t=EJSS_DRAWING3D.cylinder(e);EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementDisk"},t.registerProperties=function(e){EJSS_DRAWING3D.Disk.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Disk.copyTo(t,e)},t.setSize([1,1,0]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.DrawingPanel={GRAPHICS3D_WEBGL:"WebGL",registerProperties:function(e,t){e.setController(t),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("MinimumZ",e.setWorldZMin,e.getWorldZMin),t.registerProperty("MaximumZ",e.setWorldZMax,e.getWorldZMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("CameraAzimuth",e.setCamAzimuth,e.getCamAzimuth),t.registerProperty("CameraAltitude",e.setCamAltitude,e.getCamAltitude),t.registerProperty("CameraX",e.setCamLocX,e.getCamLocX),t.registerProperty("CameraY",e.setCamLocY,e.getCamLocY),t.registerProperty("CameraZ",e.setCamLocZ,e.getCamLocZ),t.registerProperty("CameraLocation",e.setCamLoc,e.getCamLoc),t.registerProperty("CameraFocusX",e.setCamFocusX,e.getCamFocusX),t.registerProperty("CameraFocusY",e.setCamFocusY,e.getCamFocusY),t.registerProperty("CameraFocusZ",e.setCamFocusZ,e.getCamFocusZ),t.registerProperty("CameraFocus",e.setCamFocus,e.getCamFocus),t.registerProperty("Perspective",e.setFOV,e.getFOV),t.registerProperty("FieldOfView",e.setFOV,e.getFOV),t.registerProperty("CameraNear",e.setNear,e.getNear),t.registerProperty("CameraFar",e.setFar,e.getFar),t.registerProperty("AmbientLight",e.setAmbientLight,e.getAmbientLight),t.registerProperty("Lights",e.setLights,e.getLights),t.registerProperty("DecorationType",e.setDecorationType),t.registerProperty("VisibleDecorationBox",e.setVisibleDecorationBox),t.registerProperty("VisibleDecorationAxis",e.setVisibleDecorationAxis),t.registerProperty("VisibleDecorationBasicAxis",e.setVisibleDecorationBasicAxis),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Draggable",e.setDraggable),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineColor",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineWidth",e.getGraphics().getStyle().setBorderWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint),t.registerAction("OnPress",e.getInteraction().getInteractionPoint),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds),t.registerAction("OnZoom",e.getInteraction().getZoomDelta,e.getOnZoomHandler)}},EJSS_DRAWING3D.drawingPanel=function(e){var t,r={},n=EJSS_GRAPHICS.webGLGraphics(e),i=EJSS_DRAWING3D.style(e),o=[],s=[],a=!0,l=1,u=!1,g=[],c={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,zminPreferred:-1,zmaxPreferred:1},S=!0,d=!0,f={location:new Vector(4,0,0),focus:new Vector(0,0,0),azimuth:0,altitude:0},E=45,p=1,h=1e4,m=1,A=1,y=1,D=[[1,2,3]],v=[.7,.7,.7],P=!0,I=!0,_={propertiesChanged:function(){},invokeAction:function(){}};r.getName=function(){return e},r.getGraphics=function(){return n},r.supportsWebGL=function(){return n.supportsWebGL()},r.getStyle=function(){return i},r.setGraphics=function(t){t==EJSS_DRAWING3D.DrawingPanel.GRAPHICS3D_WEBGL?n=EJSS_GRAPHICS.webGLGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported")},r.setWorldXMin=function(e){e!==c.xminPreferred&&(c.xminPreferred=e,I=!0)},r.getWorldXMin=function(){return c.xminPreferred},r.setWorldXMax=function(e){e!==c.xmaxPreferred&&(c.xmaxPreferred=e,I=!0)},r.getWorldXMax=function(){return c.xmaxPreferred},r.setWorldYMin=function(e){e!==c.yminPreferred&&(c.yminPreferred=e,I=!0)},r.getWorldYMin=function(){return c.yminPreferred},r.setWorldYMax=function(e){e!==c.ymaxPreferred&&(c.ymaxPreferred=e,I=!0)},r.getWorldYMax=function(){return c.ymaxPreferred},r.setWorldZMin=function(e){e!==c.zminPreferred&&(c.zminPreferred=e,I=!0)},r.getWorldZMin=function(){return c.zminPreferred},r.setWorldZMax=function(e){e!==c.zmaxPreferred&&(c.zmaxPreferred=e,I=!0)},r.getWorldZMax=function(){return c.zmaxPreferred},r.setWorldCoordinates=function(e){r.setWorldXMin(e[0]),r.setWorldXMax(e[1]),r.setWorldYMin(e[2]),r.setWorldYMax(e[3]),r.setWorldZMin(e[4]),r.setWorldZMax(e[5])},r.getWorldCoordinates=function(){return[r.getWorldXMin(),r.getWorldXMax(),r.getWorldYMin(),r.getWorldYMax(),r.getWorldZMin(),r.getWorldZMax()]},r.getCamLocX=function(){return f.location.getx()},r.getCamLocY=function(){return f.location.gety()},r.getCamLocZ=function(){return f.location.getz()},r.getCamLoc=function(){f.location.toArray()},r.setCamLocX=function(e){f.location.getx()!=e&&(f.location.setx(e),S=!0),d=!1},r.setCamLocY=function(e){f.location.gety()!=e&&(f.location.sety(e),S=!0),d=!1},r.setCamLocZ=function(e){f.location.getz()!=e&&(f.location.setz(e),S=!0),d=!1},r.setCamLoc=function(e){r.setCamLocX(e[0]),r.setCamLocY(e[1]),r.setCamLocZ(e[2])},r.setCamAzimuth=function(e){f.azimuth!=e&&(f.azimuth=e,S=!0)},r.getCamAzimuth=function(){return f.azimuth},r.setCamAltitude=function(e){f.altitude!=e&&(f.altitude=e,S=!0)},r.getCamAltitude=function(){return f.altitude},r.getCamFocusX=function(){return f.focus.getx()},r.getCamFocusY=function(){return f.focus.gety()},r.getCamFocusZ=function(){return f.focus.getz()},r.getCamFocus=function(){f.focus.toArray()},r.setCamFocusX=function(e){f.focus.getx()!=e&&(f.focus.setx(e),S=!0),d=!1},r.setCamFocusY=function(e){f.focus.gety()!=e&&(f.focus.sety(e),S=!0),d=!1},r.setCamFocusZ=function(e){f.focus.getz()!=e&&(f.focus.setz(e),S=!0),d=!1},r.setCamFocus=function(e){r.setCamFocusX(e[0]),r.setCamFocusY(e[1]),r.setCamFocusZ(e[2])},r.setLights=function(e){D=e,I=!0},r.getLights=function(){return D},r.setAmbientLight=function(e){v=e,I=!0},r.getAmbientLight=function(){return v},r.setSizeX=function(e){m!==e&&(m=e,I=!0)},r.getSizeX=function(){return m},r.setSizeY=function(e){A!==e&&(A=e,I=!0)},r.getSizeY=function(){return A},r.setSizeZ=function(e){y!==e&&(y=e,I=!0)},r.getSizeZ=function(){return y},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setImageUrl=function(e){u=!0,null!=r.getResourcePath?e=r.getResourcePath(e):console.log("No getResourcePath function for panel. Texture = "+e),r.getGraphics().getStyle().setBackgroundImage(e)},r.isImageUrl=function(){return u},r.addDecoration=function(e,t){return EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(r),r},r.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),e.setPanel&&e.setPanel(null),r},r.setVisibleDecorationBasicAxis=function(e){O.setVisible(e),M.setVisible(e),b.setVisible(e)},r.setVisibleDecorationAxis=function(e){C.setVisible(e),T.setVisible(e),N.setVisible(e)},r.setVisibleDecorationBox=function(e){R.setVisible(e)},r.setDecorationType=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"AXES":e=1;break;case"CUBE":e=2;break;case"CENTERED_AXES":e=3}switch(e){case 0:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 1:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!0);break;default:case 2:r.setVisibleDecorationBox(!0),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 3:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!0),r.setVisibleDecorationAxis(!1)}},r.addElement=function(e,t){EJSS_TOOLS.addToArray(s,e,t),e.setPanel(r),e.dataCollected&&g.push(e),a=!0},r.removeElement=function(e){EJSS_TOOLS.removeFromArray(s,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(g,e),a=!0},r.getElements=function(){return s},r.indexOfElement=function(e){return s.indexOf(e)},r.getFOV=function(){return E},r.setFOV=function(e){E!==e&&(E=e,I=!0)},r.getFar=function(){return h},r.setFar=function(e){h!==e&&(h=e,I=!0)},r.getNear=function(){return p},r.setNear=function(e){p!==e&&(p=e,I=!0)},r.reset=function(){n.reset(E,p,h)},r.render=function(){a&&n.reset(E,p,h);for(var e=0,t=g.length;t>e;e++)g[e].dataCollected();if((P||a)&&n.drawPanel(r),I){for(e=0,t=o.length;t>e;e++)o[e].panelChangeListener&&o[e].panelChangeListener("bounds");if(d){var i=new Vector(m,A,y),l=new Vector(c.xminPreferred,c.yminPreferred,c.zminPreferred),u=new Vector(c.xmaxPreferred,c.ymaxPreferred,c.zmaxPreferred);f.focus=u.add(l).divide(2).multiply(i);var D=new Vector(c.xmaxPreferred,c.yminPreferred,c.zminPreferred),v=n.getAspect(),_=(c.ymaxPreferred-c.yminPreferred)*A/v,R=(c.zmaxPreferred-c.zminPreferred)*y*v,C=_>R?_:R,T=1.5*(C/4)/Math.tan(E*Math.PI/360),N=D.subtract(l).unit().multiply(T);f.location=f.focus.add(N)}}n.putCamera(f),n.draw(o),n.draw(s),I=!1,P=!1,S=!1,a=!1;for(var e=0,t=s.length;t>e;e++)s[e].setProjChanged(!1),s[e].setMeshChanged(!1)},r.setEnabled=function(e){t.setEnabled(e)},r.setDraggable=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"ANY":e=1;break;case"AZIMUTH":e=2;break;case"ALTITUDE":e=3}l=e},r.getPanelInteraction=function(){return t},r.getController=function(){return _},r.setController=function(e){_=e},r.getInteraction=function(){return t},r.registerProperties=function(e){EJSS_DRAWING3D.DrawingPanel.registerProperties(r,e)},r.getOnDragHandler=function(){if(l>0){var e=r.getPanelInteraction().getInteractionDeltas();if((2==l||1==l)&&(f.azimuth+=e[0]),3==l||1==l){var t=Math.abs(f.azimuth%360);t>=270||90>=t?f.altitude+=e[1]:f.altitude-=e[1]}}r.getController().propertiesChanged("CameraAzimuth","CameraAltitude"),S=!0},r.getOnZoomHandler=function(){var e=r.getPanelInteraction().getInteractionZoomDelta(),t=f.focus.subtract(f.location);e>0?f.location=f.focus.subtract(t.multiply(1.1)):f.location=f.focus.subtract(t.divide(1.1)),r.getController().propertiesChanged("CameraLocation","CameraX","CameraY","CameraZ"),S=!0},i.setFillColor([.83,.85,1]),i.setMeshChangeListener(function(e){P=!0}),i.setProjChangeListener(function(e){P=!0});var R=EJSS_DRAWING3D.box(e+"box");R.getStyle().setDrawFill(!1),R.getStyle().setDrawLines(!0),R.getStyle().setLineWidth(2),R.getStyle().setLineColor("black"),R.setVisible(!0),R.setSize([2,2,2]),R.panelChangeListener=function(e){if("bounds"==e)var t=(c.xmaxPreferred+c.xminPreferred)/2;var r=(c.ymaxPreferred+c.yminPreferred)/2,n=(c.zmaxPreferred+c.zminPreferred)/2,i=Math.abs(c.xmaxPreferred-c.xminPreferred),o=Math.abs(c.ymaxPreferred-c.yminPreferred),s=Math.abs(c.zmaxPreferred-c.zminPreferred);R.setPosition([t,r,n]),R.setSize([i,o,s])},r.addDecoration(R,0);var C=EJSS_DRAWING3D.arrow(e+"axisX");C.getStyle().setLineWidth(2),C.setColor("red"),C.setVisible(!1),C.panelChangeListener=function(e){"bounds"==e&&C.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.xmaxPreferred-c.xminPreferred);C.setSize([t,0,0])},r.addDecoration(C,0);var T=EJSS_DRAWING3D.arrow(e+"axisY");T.setPosition([0,0,0]),T.setSize([0,1,0]),T.getStyle().setLineWidth(2),T.setColor("green"),T.setVisible(!1),T.panelChangeListener=function(e){"bounds"==e&&T.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.ymaxPreferred-c.yminPreferred);T.setSize([0,t,0])},r.addDecoration(T,0);var N=EJSS_DRAWING3D.arrow(e+"axisZ");N.setPosition([0,0,0]),N.setSize([0,0,1]),N.getStyle().setLineWidth(2),N.setColor("blue"),N.setVisible(!1),N.panelChangeListener=function(e){"bounds"==e&&N.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.zmaxPreferred-c.zminPreferred);N.setSize([0,0,t])},r.addDecoration(N,0);var O=EJSS_DRAWING3D.arrow(e+"baxisX");O.setPosition([0,0,0]),O.setSize([1,0,0]),O.getStyle().setLineWidth(2),O.setColor("red"),O.setVisible(!1),O.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.xmaxPreferred-c.xminPreferred)/2;O.setSize([t,0,0])},r.addDecoration(O,0);var M=EJSS_DRAWING3D.arrow(e+"baxisY");M.setPosition([0,0,0]),M.setSize([0,1,0]),M.getStyle().setLineWidth(2),M.setColor("green"),M.setVisible(!1),M.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.ymaxPreferred-c.yminPreferred)/2;M.setSize([0,t,0])},r.addDecoration(M,0);var b=EJSS_DRAWING3D.arrow(e+"baxisZ");return b.setPosition([0,0,0]),b.setSize([0,0,1]),b.getStyle().setLineWidth(2),b.setColor("blue"),b.setVisible(!1),b.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.zmaxPreferred-c.zminPreferred)/2;b.setSize([0,0,t])},r.addDecoration(b,0),t=EJSS_DRAWING3D.panelInteraction(r),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Element={copyTo:function(e,t){EJSS_DRAWING3D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setSize(e.getSize()),t.setTransformation(e.getTransformation()),t.setExtraTransformation(e.getExtraTransformation()),t.setTextureUrl(e.getTextureUrl()),t.setResolution(e.getResolution()),t.setParent(e.getParent())},registerProperties:function(e,t){EJSS_DRAWING3D.Element;e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Z",e.setZ,e.getZ),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("TextureUrl",e.setTextureUrl,e.getTextureUrl),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transparency",e.getStyle().setTransparency,e.getStyle().getTransparency),t.registerProperty("LineColor",e.getStyle().setLineColor,e.getStyle().getLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth,e.getStyle().getLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines,e.getStyle().getDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor,e.getStyle().getFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill,e.getStyle().getDrawFill),t.registerProperty("ClosedTop",e.getStyle().setClosedTop,e.getStyle().getClosedTop),t.registerProperty("ClosedBottom",e.getStyle().setClosedBottom,e.getStyle().getClosedBottom),t.registerProperty("ClosedLeft",e.getStyle().setClosedLeft,e.getStyle().getClosedLeft),t.registerProperty("ClosedRight",e.getStyle().setClosedRight,e.getStyle().getClosedRight),t.registerProperty("Resolution",e.setResolution),t.registerProperty("Color",e.setColor),t.registerProperty("EnabledPosition",function(e){}),t.registerProperty("MovesGroup",function(e){}),t.registerProperty("EnabledSize",function(e){}),t.registerProperty("ResizesGroup",function(e){}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition),t.registerAction("OnLoadTexture",null,null,function(){e.setProjChanged(!0)})}},EJSS_DRAWING3D.element=function(e){function t(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i.length>4?t.push(i):t.push(i.concat(r.getPosition()))}return t}var r={},n=EJSS_DRAWING3D.Element,i=(EJSS_DRAWING3D.Style,EJSS_DRAWING3D.style(e)),o=!0,s=!0,a="",l=0,u=0,g=0,c=1,S=1,d=1,f=[],E=[],p=[],h=null,m=null,A=null,y=-1,D=!0,v=!0,P=20,I=20,_=0,R={propertiesChanged:function(){},invokeAction:function(){}};return r.copyTo=function(e){n.copyTo(r,e)},r.getName=function(){return e.replace(/\[|\]/g,"")},r.setTextureUrl=function(e){var t=null!=A?A.getResourcePath:r.getResourcePath;null!=t?e=t(e):console.log("No getResourcePath function for "+r.getName()+". Texture = "+e),a=e},r.getTextureUrl=function(){return a},r.setVisible=function(e){o=e},r.isVisible=function(){return o},r.isGroupVisible=function(){for(var e=m;"undefined"!=typeof e&&null!==e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},r.getStyle=function(){return i},r.setMeasured=function(e){s=e},r.isMeasured=function(){return s},r.setColor=function(e){r.getStyle().setFillColor(e),r.getStyle().setLineColor(e)},r.setResolution=function(e){Array.isArray(e)?(r.setResolutionU(e[0]),r.setResolutionV(e[1]),e[2]&&r.setResolutionR(e[2])):(r.setResolutionU(e),r.setResolutionV(e))},r.getResolution=function(){return[P,I,_]},r.setResolutionU=function(e){P!=e&&(P=e,D=!0)},r.getResolutionU=function(){return P},r.setResolutionV=function(e){I!=e&&(I=e,D=!0)},r.getResolutionV=function(){return I},r.setResolutionR=function(e){_!=e&&(_=e,D=!0)},r.getResolutionR=function(){return _},r.setX=function(e){l!=e&&(l=e,v=!0)},r.getX=function(){return l},r.setY=function(e){u!=e&&(u=e,v=!0)},r.getY=function(){return u},r.setZ=function(e){g!=e&&(g=e,v=!0)},r.getZ=function(){return g},r.setPosition=function(e){r.setX(e[0]),r.setY(e[1]),r.setZ(e[2])},r.getPosition=function(){return[l,u,g]},r.setSizeX=function(e){c!=e&&(c=e,v=!0)},r.getSizeX=function(){return c},r.setSizeY=function(e){S!=e&&(S=e,v=!0)},r.getSizeY=function(){return S},r.setSizeZ=function(e){d!=e&&(d=e,v=!0)},r.getSizeZ=function(){return d},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setPanel=function(e){h=e,v=!0},r.getPanel=function(){return h},r.getGroupPanel=function(){for(var e=r;e.getGroup();)e=e.getGroup();return e.getPanel()},r.setGroup=function(e){m=e,v=!0},r.getGroup=function(){return m},r.setSet=function(e,t){A=e,y=t},r.getSetIndex=function(){return y},r.setParent=function(e){e.render?(r.setGroup(null),e.addElement(r),r.setPanel(e)):"ElementGroup"==e.getClass()?(r.setGroup(e),r.getGroupPanel().addElement(r),r.setPanel(r.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},r.getParent=function(){var e;return e=null!==m?r.getGroup():r.getPanel()},r.setTransformation=function(e){("undefined"==typeof e||null===e)&&(e=[]),EJSS_TOOLS.compareArrays(f,e)||(f=e,v=!0)},r.setFirstTransformation=function(e){("undefined"==typeof e||null===e)&&(e=[]),EJSS_TOOLS.compareArrays(f,e)||(p=e,v=!0)},r.setExtraTransformation=function(e){E=e},r.getExtraTransformation=function(){return E},r.addExtraTransformation=function(e){"undefined"!=typeof e&&null!==e&&(E.push(e),v=!0)},r.removeExtraTransformation=function(e){if("undefined"!=typeof e&&null!==e)for(var t=0;t<E.length;t++){var r=E[t];if(r===e)return E.splice(t,1),void(v=!0)}},r.getFullTransformation=function(){for(var e=t(p).concat(t(f)),r=0;r<E.length;r++)e.push(E[r].getArray());return e},r.getTransformation=function(){return f},r.getGroupTransformation=function(){for(var e=EJSS_DRAWING3D.transformation(),t=r;"undefined"!=typeof t&&null!==t;)e.concatenate(t.getFullTransformation()),t=t.getGroup();return e},r.isMeshChanged=function(){return D},r.setMeshChanged=function(e){D=e},r.isProjChanged=function(){return v},r.setProjChanged=function(e){v=e},r.isGroupChanged=function(){for(var e=r.getGroup();"undefined"!=typeof e&&null!==e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},r.getController=function(){return R},r.setController=function(e){R=e},r.registerProperties=function(e){n.registerProperties(r,e)},i.setMeshChangeListener(function(e){D=!0}),i.setProjChangeListener(function(e){v=!0}),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.ElementSet={registerProperties:function(e,t){EJSS_DRAWING3D.Element;e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Z",function(t){e.setToEach(function(e,t){e.setZ(t)},t)},function(){return e.getFromEach(function(e){return e.getZ()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("SizeZ",function(t){e.setToEach(function(e,t){e.setSizeZ(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeZ()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("TextureUrl",function(t){e.setToEach(function(e,t){e.setTextureUrl(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){
e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("ClosedTop",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedBottom",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedLeft",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedRight",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Resolution",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Color",function(t){e.setToEach(function(e,t){e.setColor(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){},t)});var r=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",r),t.registerAction("OnExit",r),t.registerAction("OnPress",r),t.registerAction("OnDrag",r),t.registerAction("OnRelease",r),t.registerAction("OnLoadTexture",null,null,function(){element.setProjChanged(!0)})}},EJSS_DRAWING3D.elementSet=function(e,t){var r=EJSS_DRAWING3D.group(t),n=EJSS_DRAWING3D.ElementSet,i=[],o=-1,s=[];r.setNumberOfElements=function(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){s=i.splice(t,o);for(var a=0;a<s.length;a++){var l=s[a].getPanel();l&&l.removeElement(s[a])}}else if(0>o){s=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;t>c;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}},r.getElements=function(){return i},r.getLastElements=function(){var e=s.slice();return s=[],e},r.setElementInteracted=function(e){o=e},r.getElementInteracted=function(){return o};var a=r.setPanel;r.setPanel=function(e){a(e);for(var t=0,r=i.length;r>t;t++)i[t].setPanel(e)},r.setProjChanged=function(e){for(var t=0,r=i.length;r>t;t++)i[t].setProjChanged(e)},r.setToEach=function(e,t){if(Array.isArray(t)){1==i.length&&r.setNumberOfElements(t.length);for(var n=0,o=Math.min(i.length,t.length);o>n;n++)e(i[n],t[n])}else for(var n=0,o=i.length;o>n;n++)e(i[n],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;n>r;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var l=e(t+"[0]");return l.setController(r.getController()),l.setSet(r,0),i.push(l),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Ellipsoid={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setMinAngleU(e.getMinAngleU()),t.setMaxAngleU(e.getMaxAngleU()),t.setMinAngleV(e.getMinAngleV()),t.setMaxAngleV(e.getMaxAngleV())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU),t.registerProperty("MinAngleV",e.setMinAngleV),t.registerProperty("MaxAngleV",e.setMaxAngleV)}},EJSS_DRAWING3D.ellipsoid=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=-90,o=90;EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementEllipsoid"},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setMinAngleV=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMinAngleV=function(){return i},t.setMaxAngleV=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getMaxAngleV=function(){return o},t.copyTo=function(e){EJSS_DRAWING3D.Ellipsoid.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Ellipsoid.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.EllipsoidSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("MinAngleV",function(t){e.setToEach(function(e,t){e.setMinAngleV(t)},t)}),t.registerProperty("MaxAngleV",function(t){e.setToEach(function(e,t){e.setMaxAngleV(t)},t)})}},EJSS_DRAWING3D.ellipsoidSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.ellipsoid,e),r=EJSS_DRAWING3D.EllipsoidSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Group={},EJSS_DRAWING3D.group=function(e){var t=EJSS_DRAWING3D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.panelInteraction=function(e){function t(t){var r,n;"undefined"!=typeof t.changedTouches&&1===t.changedTouches.length?(r=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(r=t.x||t.clientX,n=t.y||t.clientY);var i=e.getGraphics().getOffsetLeft(),o=e.getGraphics().getOffsetTop();return[r-i,n-o]}var r={},n=!1,i=[0,0],o=0,s=0,a=!1,l=0,u=0,g=0;return r.getPanel=function(){return e},r.getEnabled=function(){return n},r.setEnabled=function(e){n!=e&&(n=e,n?(r.setHandler("move",r.handleMouseMoveEvent),r.setHandler("down",r.handleMouseDownEvent),r.setHandler("up",r.handleMouseUpEvent),r.setHandler("mousewheel",r.handleMouseWheelEvent),r.setHandler("pinch",r.handlePinchGesture)):(r.setHandler("move",function(){}),r.setHandler("down",function(){}),r.setHandler("up",function(){}),r.setHandler("mousewheel",function(){}),r.setHandler("pinch",function(){})))},r.getInteractionPoint=function(){return i},r.getInteractionDeltas=function(){return[o,s]},r.getInteractionZoomDelta=function(){return u/3},r.handleMouseWheelEvent=function(t){var r="undefined"!=typeof t.touches?t.touches.length:0;0==r&&(t.preventDefault(),u=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},r.handlePinchGesture=function(t){t.timeStamp-l>100&&(t.preventDefault(),t.scale<g?u=1:t.scale>=g&&(u=-1),g=t.scale,e.getController().invokeAction("OnZoom"),e.getController().reportInteractions(),l=t.timeStamp)},r.handleMouseMoveEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;if(1==n){var l=i[0],u=i[1];i=t(r),o=i[0]-l,s=i[1]-u,a?(e.getController().invokeAction("OnDrag"),r.target.style.cursor="move"):r.target.style.cursor="default",e.getController().reportInteractions()}},r.handleMouseDownEvent=function(n){var o="undefined"!=typeof n.touches?n.touches.length:1;1==o&&(a=!0,i=t(n),e.getController().invokeAction("OnPress"),r.pick(i[0],i[1]),n.preventDefault(),e.getController().reportInteractions())},r.handleMouseUpEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;1==n&&(a=!1,i=t(r),e.getController().invokeAction("OnRelease"),r.target.style.cursor="default",r.timeStamp-l<500&&e.getController().invokeAction("OnDoubleClick"),l=r.timeStamp,e.getController().reportInteractions())},r.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;default:case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"mousewheel":i.addEventListener("mousewheel",r,!1);break;case"pinch":i.addEventListener("gesturestart",function(e){g=1},!1),i.addEventListener("gesturechange",r,!1)}return!1},r.pick=function(t,r){var n=t-1,i=r-1,o=1,s=1,a=e.getGraphics().getContext();if(a){var l=new Uint8Array(o*s*4);a.readPixels(n,i,o,s,a.RGBA,a.UNSIGNED_BYTE,l),l.data&&(l=l.data)}},r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Style={copyTo:function(e,t){t.setClosedTop(e.getClosedTop()),t.setClosedBottom(e.getClosedBottom()),t.setClosedLeft(e.getClosedLeft()),t.setClosedRight(e.getClosedRight()),t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setTransparency(e.getTransparency())}},EJSS_DRAWING3D.style=function(e){var t,r,n=(EJSS_DRAWING3D.Style,{}),i=!0,o=!0,s=!0,a=!0,l=[0,0,0],u=[0,0,0],g=.5,c=!1,S=!0,d=0;return n.setProjChangeListener=function(e){t=e},n.setMeshChangeListener=function(e){r=e},n.setClosedTop=function(e){e!=i&&(i=e,r&&r("closedtop"))},n.getClosedTop=function(){return i},n.setClosedBottom=function(e){e!=o&&(o=e,r&&r("closedbottom"))},n.getClosedBottom=function(){return o},n.setClosedLeft=function(e){e!=s&&(s=e,r&&r("closedleft"))},n.getClosedLeft=function(){return s},n.setClosedRight=function(e){e!=a&&(a=e,r&&r("closedright"))},n.getClosedRight=function(){return a},n.setDrawLines=function(e){e!=c&&(c=e,t&&t("drawlines"))},n.getDrawLines=function(){return c},n.setLineColor=function(e){return"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,l)||(l=e.slice(),t&&t("linecolor")),n},n.getLineColor=function(){return l},n.setLineWidth=function(e){e!=g&&(g=e,t&&t("linewidth"))},n.getLineWidth=function(){return g},n.setDrawFill=function(e){e!=S&&(S=e,t&&t("drawfill"))},n.getDrawFill=function(){return S},n.setFillColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,u)||(u=e.slice(),t&&t("fillcolor"))},n.getFillColor=function(){return u},n.setTransparency=function(e){e!=d&&(d=e,t&&t("transparency"))},n.getTransparency=function(){return d},n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Transformation={registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("Axis",e.setAxis,e.getAxis),t.registerProperty("Angle",e.setAngle,e.getAngle),t.registerProperty("Origin",e.setOrigin,e.getOrigin)}},EJSS_DRAWING3D.rotationX=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([1,0,0]),t},EJSS_DRAWING3D.rotationY=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,1,0]),t},EJSS_DRAWING3D.rotationZ=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,0,1]),t},EJSS_DRAWING3D.transformation=function(e){var t={},r=null,n=[0,0,0,1,0,0,0],i={propertiesChanged:function(){},invokeAction:function(){}};return t.getArray=function(){return n},t.setChanged=function(e){e&&r.setProjChanged(!0)},t.setParent=function(e){r&&r.removeExtraTransformation(t),r=e,r&&r.addExtraTransformation(t)},t.getParent=function(){return r},t.setAngle=function(e){n[0]=e},t.getAngle=function(){return n[0]},t.setAxis=function(e){n[1]=e[0],n[2]=e[1],n[3]=e[2]},t.getAxis=function(){return n.slice(1,4)},t.setOrigin=function(e){n[4]=e[0],n[5]=e[1],n[6]=e[2]},t.getOrigin=function(){return n.slice(5)},t.getController=function(){return i},t.setController=function(e){i=e},t.registerProperties=function(e){EJSS_DRAWING3D.Transformation.registerProperties(t,e)},t};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticCurve=function(e,t){evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getNumPoints(),i=t.getMinValue(),o=t.getMaxValue(),s=Math.abs((o-i)/(n-1)),a=t.getExpressionX(),l=t.getExpressionY(),u=t.getExpressionZ(),g=t.getVariable(),c=i,S=0;n>S;S++){var d=evaluate(a,g,c),f=evaluate(l,g,c),E=evaluate(u,g,c);r.vertices.push([d,f,E]),0!=S&&r.lines.push([S-1,S]),c+=s}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticSurface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;e-1>i;i++)for(var o=0;t-1>o;o++){var s=r[o+i*t],a=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.vertices.push(u)}for(var g=(e-1)*(t-1)/2,i=0;8*g>i;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])},evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=t.getNumPoints1(),n=t.getMinValue1(),i=t.getMaxValue1(),o=t.getNumPoints2(),s=t.getMinValue2(),a=t.getMaxValue2(),l=Math.abs((i-n)/(r-1)),u=Math.abs((a-s)/(o-1)),g=t.getExpressionX(),c=t.getExpressionY(),S=t.getExpressionZ(),d=t.getVariable1(),f=t.getVariable2(),E=new Array,p=0,h=n,m=0;r>m;m++){for(var A=s,y=0;o>y;y++){var D=evaluate(g,d,h,f,A),v=evaluate(c,d,h,f,A),P=evaluate(S,d,h,f,A);E[p]=[D,v,P],p++,A+=u}h+=l}var I=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());return createSurfaceBuffers(r,o,E,I),I.computeNormals(),I.compile(),e.addElement(t.getName()+".mesh",I),I};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.arrow=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=new Vector(t.getSize()),i=(new Vector(t.getPosition()),n.length()),o=t.getResolutionV(),s=t.getResolutionU()+1,a=t.getHeadWidth(),l=t.getHeadHeight(),u=[],g=0;o>g;g++)for(var c=g/(o-1),S=c/a*i,d=0;s>d;d++){var f=d/(s-1),E=S*Math.sin(f*Math.PI*2),p=S*Math.cos(f*Math.PI*2),h=-c/l*i;u.push(new Vector(E,p,h))}var m=n.cross(new Vector(0,0,1));0==m.length()&&(m.y=1);var A=n.angle(new Vector(0,0,1)),y=new Matrix;Matrix.rotate(-A,m.x,m.y,m.z,0,0,0,y);for(var D=0;D<u.length;D++){var v=y.transformPoint(u[D]);r.vertices.push(v.add(n).toArray())}r.vertices.push(n.toArray()),r.vertices.push([0,0,0]),r.lines.push([r.vertices.length-1,r.vertices.length-2]);for(var g=0;o-1>g;g++)for(var d=0;s-1>d;d++){var P=g*s+d,I=(g+1)*s+d,_=(g+1)*s+d+1,R=g*s+d+1;r.triangles.push([_,I,P]),r.triangles.push([R,_,P]),r.lines.push([_,I]),r.lines.push([R,_]),r.lines.push([P,R])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.basic=function(e,t){return mesh=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),mesh.setVertices(t.getVertices()),mesh.setCoords(t.getVertices()),mesh.setTriangles(t.getTriangles()),mesh.setColors(t.getColors()),0!=t.getNormals().length?mesh.setNormals(t.getNormals()):mesh.computeNormals(),mesh.computeWireframe(),mesh.compile(),e.addElement(t.getName()+".mesh",mesh),mesh};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.box=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],i=[[0,0],[1,0],[0,1],[1,1]],o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],s=[[0,2,4,6],[1,3,5,7],[0,4,1,5],[2,6,3,7],[0,2,1,3],[4,6,5,7]],a=t.getStyle().getClosedTop(),l=t.getStyle().getClosedBottom(),u=t.getStyle().getClosedRight(),g=t.getStyle().getClosedLeft(),c=t.getReduceZby(),S=0;S<s.length;S++){for(var d=s[S],f=4*S,E=0;4>E;E++){var p=d[E];6==p||7==p?r.vertices.push([n[p][0],n[p][1],n[p][2]-2*c]):r.vertices.push(n[p]),r.coords.push(i[E]),r.normals.push(o[S])}2==S&&!g||3==S&&!u||4==S&&!a||5==S&&!l||(r.triangles.push([f,f+1,f+2]),r.triangles.push([f+2,f+1,f]),r.triangles.push([f+2,f+1,f+3]),r.triangles.push([f+3,f+1,f+2])),r.lines.push([f,f+1]),r.lines.push([f,f+2]),r.lines.push([f+2,f+3]),r.lines.push([f+1,f+3])}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.cylinder=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getResolutionV(),i=t.getResolutionU()+1,o=t.getRadiusTop(),s=t.getRadiusBottom(),a=t.getMinAngleU(),l=t.getMaxAngleU(),u=0,g=0,c=0;n>c;c++){var S=c/(n-1),d=S*(s-o)+o;g=Math.floor(a*i/360),u=Math.floor(l*i/360);for(var f=g;u>f;f++){var E=f/(i-1),p=d*Math.sin(E*Math.PI*2),h=d*Math.cos(E*Math.PI*2),m=2*-S+1;r.vertices.push([p,h,m]),r.coords.push([E,S])}}for(var c=0;n>c;c++){var m=-1+c*(2/(n-1));r.vertices.push([0,0,m]),r.coords.push([1,c/(n-1)])}for(var A=u-g,c=0;n-1>c;c++){for(var f=0;A-1>f;f++){var y=c*A+f,D=(c+1)*A+f,v=(c+1)*A+f+1,P=c*A+f+1;r.triangles.push([v,D,y]),r.triangles.push([P,v,y]),r.lines.push([v,D]),r.lines.push([P,v]),r.lines.push([y,P])}if(0!=a||360!=l){var I=r.vertices.length-(c+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([v,P,I-1]),r.triangles.push([P,I,I-1]),r.lines.push([v,I-1]),r.lines.push([P,I]),r.lines.push([I,I-1])),t.getStyle().getClosedRight()){var _=c*A,R=(c+1)*A;r.triangles.push([I-1,_,R]),r.triangles.push([I-1,I,_]),r.lines.push([R,_]),r.lines.push([R,I-1]),r.lines.push([_,I]),r.lines.push([I,I-1])}}}var C=t.getStyle().getClosedTop();if(C&&o>0){r.vertices.push([0,0,1]);for(var T=0;A-1>T;T++)r.triangles.push([r.vertices.length-1,T+1,T]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}var N=t.getStyle().getClosedBottom();if(N&&s>0){r.vertices.push([0,0,-1]);for(var T=(n-1)*A;A*n>T;T++)r.triangles.push([T,T+1,r.vertices.length-1]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}return 0==a&&360==l?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.ellipsoid=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=(EJSS_WEBGLGRAPHICS.indexer(),t.getResolutionV()),i=t.getResolutionU(),o=0;n>=o;o++)for(var s=o*Math.PI/n,a=Math.sin(s),l=Math.cos(s),u=0;i>=u;u++){var g=2*u*Math.PI/i,c=Math.sin(g),S=Math.cos(g),d=S*a,f=-l,E=-c*a,p=1-u/i,h=o/n;r.vertices.push([-E,d,f]),r.coords.push([p,h])}for(var o=0;n>=o;o++){var h=o/n,s=o*Math.PI/n,f=-Math.cos(s);r.vertices.push([0,0,f]),r.coords.push([0,h])}var o,m=t.getMinAngleU(),A=t.getMaxAngleU(),y=t.getMinAngleV()+90,D=t.getMaxAngleV()+90,v=Math.floor(y*n/180),P=Math.floor(D*n/180);for(o=v;P>o;o++){var u,I,_,R=Math.floor(m*i/360),C=Math.floor(A*i/360);for(u=R;C>u;u++)I=o*(i+1)+u,_=I+i+1,r.triangles.push([I,_,I+1]),r.triangles.push([_,_+1,I+1]),r.lines.push([I,_]),r.lines.push([I,I+1]),r.lines.push([_,_+1]);if(0!=m||360!=A){var T=r.vertices.length-(n-o+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([I+1,_+1,T]),r.triangles.push([_+1,T+1,T]),r.lines.push([I+1,_+1]),r.lines.push([I+1,T]),r.lines.push([_+1,T+1]),r.lines.push([T,T+1])),t.getStyle().getClosedRight()){var N=o*(i+1)+R,O=N+i+1;r.triangles.push([T,O,N]),r.triangles.push([T,T+1,O]),r.lines.push([N,O]),r.lines.push([N,T]),r.lines.push([O,T+1]),r.lines.push([T,T+1])}}}if(t.getStyle().getClosedBottom()&&y>0){var I,u,M;for(u=R;C>u;u++)I=v*(i+1)+u,M=r.vertices.length-(n-v+1),r.triangles.push([I+1,M,I]),r.lines.push([I+1,M]),r.lines.push([I,I+1])}if(t.getStyle().getClosedTop()&&180>D){var I,u,M;for(u=R;C>u;u++)I=P*(i+1)+u,M=r.vertices.length-(n-P+1),r.triangles.push([I,M,I+1]),r.lines.push([I+1,M]),r.lines.push([I,I+1])}return 0==m&&360==A?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var hasFloat32Array="undefined"!=typeof Float32Array;Matrix.prototype={inverse:function(){return Matrix.inverse(this,new Matrix)},transpose:function(){return Matrix.transpose(this,new Matrix)},multiply:function(e){return Matrix.multiply(this,e,new Matrix)},transformPoint:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11]).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},Matrix.inverse=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;n[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],n[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],n[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],n[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],n[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],n[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],n[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],n[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],n[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],n[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],n[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],n[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],n[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],n[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],n[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],n[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var i=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12],o=0;16>o;o++)n[o]/=i;return t},Matrix.transpose=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;return n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],t},Matrix.multiply=function(e,t,r){r=r||new Matrix;var n=e.m,i=t.m,o=r.m;return o[0]=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],o[1]=n[0]*i[1]+n[1]*i[5]+n[2]*i[9]+n[3]*i[13],o[2]=n[0]*i[2]+n[1]*i[6]+n[2]*i[10]+n[3]*i[14],o[3]=n[0]*i[3]+n[1]*i[7]+n[2]*i[11]+n[3]*i[15],o[4]=n[4]*i[0]+n[5]*i[4]+n[6]*i[8]+n[7]*i[12],o[5]=n[4]*i[1]+n[5]*i[5]+n[6]*i[9]+n[7]*i[13],o[6]=n[4]*i[2]+n[5]*i[6]+n[6]*i[10]+n[7]*i[14],o[7]=n[4]*i[3]+n[5]*i[7]+n[6]*i[11]+n[7]*i[15],o[8]=n[8]*i[0]+n[9]*i[4]+n[10]*i[8]+n[11]*i[12],o[9]=n[8]*i[1]+n[9]*i[5]+n[10]*i[9]+n[11]*i[13],o[10]=n[8]*i[2]+n[9]*i[6]+n[10]*i[10]+n[11]*i[14],o[11]=n[8]*i[3]+n[9]*i[7]+n[10]*i[11]+n[11]*i[15],o[12]=n[12]*i[0]+n[13]*i[4]+n[14]*i[8]+n[15]*i[12],o[13]=n[12]*i[1]+n[13]*i[5]+n[14]*i[9]+n[15]*i[13],o[14]=n[12]*i[2]+n[13]*i[6]+n[14]*i[10]+n[15]*i[14],o[15]=n[12]*i[3]+n[13]*i[7]+n[14]*i[11]+n[15]*i[15],r},Matrix.identity=function(e){e=e||new Matrix;var t=e.m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},Matrix.perspective=function(e,t,r,n,i){var o=Math.tan(e*Math.PI/360)*r,s=o*t;return Matrix.frustum(-s,s,-o,o,r,n,i)},Matrix.frustum=function(e,t,r,n,i,o,s){s=s||new Matrix;var a=s.m;return a[0]=2*i/(t-e),a[1]=0,a[2]=(t+e)/(t-e),a[3]=0,a[4]=0,a[5]=2*i/(n-r),a[6]=(n+r)/(n-r),a[7]=0,a[8]=0,a[9]=0,a[10]=-(o+i)/(o-i),a[11]=-2*o*i/(o-i),a[12]=0,a[13]=0,a[14]=-1,a[15]=0,s},Matrix.ortho=function(e,t,r,n,i,o,s){s=s||new Matrix;var a=s.m;return a[0]=2/(t-e),a[1]=0,a[2]=0,a[3]=-(t+e)/(t-e),a[4]=0,a[5]=2/(n-r),a[6]=0,a[7]=-(n+r)/(n-r),a[8]=0,a[9]=0,a[10]=-2/(o-i),a[11]=-(o+i)/(o-i),a[12]=0,a[13]=0,a[14]=0,a[15]=1,s},Matrix.scale=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.translate=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=e,i[4]=0,i[5]=1,i[6]=0,i[7]=t,i[8]=0,i[9]=0,i[10]=1,i[11]=r,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.rotate=function(e,t,r,n,i,o,s,a){if(!e||!t&&!r&&!n)return Matrix.identity(a);a=a||new Matrix;var l=a.m,u=Math.sqrt(t*t+r*r+n*n);t/=u,r/=u,n/=u;var g=Math.cos(e),c=Math.sin(e),S=1-g;return l[0]=t*t*S+g,l[1]=t*r*S-n*c,l[2]=t*n*S+r*c,l[3]=i-l[0]*i-l[1]*o-l[2]*s,l[4]=r*t*S+n*c,l[5]=r*r*S+g,l[6]=r*n*S-t*c,l[7]=o-l[4]*i-l[5]*o-l[6]*s,l[8]=n*t*S-r*c,l[9]=n*r*S+t*c,l[10]=n*n*S+g,l[11]=s-l[8]*i-l[9]*o-l[10]*s,l[12]=0,l[13]=0,l[14]=0,l[15]=1,a},Matrix.lookAt=function(e,t,r,n,i,o,s,a,l,u){u=u||new Matrix;var g=u.m,c=new Vector(e,t,r),S=new Vector(n,i,o),d=new Vector(s,a,l),f=c.subtract(S).unit(),E=d.cross(f).unit(),p=f.cross(E).unit();return g[0]=E.x,g[1]=E.y,g[2]=E.z,g[3]=-E.dot(c),g[4]=p.x,g[5]=p.y,g[6]=p.z,g[7]=-p.dot(c),g[8]=f.x,g[9]=f.y,g[10]=f.z,g[11]=-f.dot(c),g[12]=0,g[13]=0,g[14]=0,g[15]=1,u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.mesh=function(e,t,r){var n={};r=r||{coords:!0,normals:!0,triangles:!0,lines:!0,colors:!0},t=t||"mesh";var i={},o={};return n.getId=function(){return t},n.getVertexBuffers=function(){return i},n.getIndexBuffers=function(){return o},n.setVertices=function(e){n.vertices=e},n.getVertices=function(){return n.vertices},n.setCoords=function(e){n.coords=e},n.getCoords=function(){return n.coords},n.setNormals=function(e){n.normals=e},n.getNormals=function(){return n.normals},n.setColors=function(e){n.colors=e},n.getColors=function(){return n.colors},n.setTriangles=function(e){n.triangles=e},n.getTriangles=function(){return n.triangles},n.setLines=function(e){n.lines=e},n.getLines=function(){return n.lines},n.setBuffer=function(e,t){n[e]=t},n.addVertexBuffer=function(t,r){var o=i[r]=EJSS_WEBGLGRAPHICS.buffer(e,e.ARRAY_BUFFER,Float32Array);o.setName(t),n[t]=[]},n.addIndexBuffer=function(t){o[t]=EJSS_WEBGLGRAPHICS.buffer(e,e.ELEMENT_ARRAY_BUFFER,Uint16Array);n[t]=[]},n.compile=function(){for(var e in i){var t=i[e];t.setData(n[t.getName()]),t.compile()}for(var r in o){var t=o[r];t.setData(n[r]),t.compile()}},n.transform=function(e){if(n.vertices=n.vertices.map(function(t){return e.transformPoint(Vector.fromArray(t)).toArray()}),n.normals){var t=e.inverse().transpose();n.normals=n.normals.map(function(e){return t.transformVector(Vector.fromArray(e)).unit().toArray()})}return n.compile(),n},n.computeNormals=function(){n.normals||n.addVertexBuffer("normals","gl_Normal");for(var e=0;e<n.vertices.length;e++)n.normals[e]=new Vector;for(var e=0;e<n.triangles.length;e++){var t=n.triangles[e],r=Vector.fromArray(n.vertices[t[0]]),i=Vector.fromArray(n.vertices[t[1]]),o=Vector.fromArray(n.vertices[t[2]]),s=i.subtract(r).cross(o.subtract(r)).unit();n.normals[t[0]]=n.normals[t[0]].add(s),n.normals[t[1]]=n.normals[t[1]].add(s),n.normals[t[2]]=n.normals[t[2]].add(s)}for(var e=0;e<n.vertices.length;e++)n.normals[e]=n.normals[e].unit().toArray();return n.compile(),n},n.computeWireframe=function(){for(var e=EJSS_WEBGLGRAPHICS.indexer(),t=0;t<n.triangles.length;t++)for(var r=n.triangles[t],i=0;i<r.length;i++){var o=r[i],s=r[(i+1)%r.length];e.add([Math.min(o,s),Math.max(o,s)])}return n.lines||n.addIndexBuffer("lines"),n.lines=e.getUnique(),n.compile(),n},n.getAABB=function(){var e={min:new Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<n.vertices.length;t++){var r=Vector.fromArray(n.vertices[t]);e.min=Vector.min(e.min,r),e.max=Vector.max(e.max,r)}return e},n.getBoundingSphere=function(){for(var e=n.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0},r=0;r<n.vertices.length;r++)t.radius=Math.max(t.radius,Vector.fromArray(n.vertices[r]).subtract(t.center).length());return t},n.addVertexBuffer("vertices","gl_Vertex"),r.coords&&n.addVertexBuffer("coords","gl_TexCoord"),r.normals&&n.addVertexBuffer("normals","gl_Normal"),r.colors&&n.addVertexBuffer("colors","gl_Color"),"triangles"in r&&!r.triangles||n.addIndexBuffer("triangles"),r.lines&&n.addIndexBuffer("lines"),n},EJSS_WEBGLGRAPHICS.indexer=function(){var e={},t=[],r={};return e.getUnique=function(){return t},e.add=function(e){var n=JSON.stringify(e);return n in r||(r[n]=t.length,t.push(e)),r[n]},e},EJSS_WEBGLGRAPHICS.buffer=function(e,t,r){var n={},i=null,t=t,r=r,o="",s=[];return n.setData=function(e){s=e},n.setName=function(e){o=e},n.getBuffer=function(){return i},n.getName=function(){return o},n.compile=function(n){for(var o=[],a=0,l=1e4;a<s.length;a+=l)o=Array.prototype.concat.apply(o,s.slice(a,a+l));var u=s.length?o.length/s.length:0;if(u!=Math.round(u))throw"buffer elements not of consistent size, average size is "+u;i=i||e.createBuffer(),i.length=o.length,i.spacing=u,e.bindBuffer(t,i),e.bufferData(t,new r(o),n||e.STATIC_DRAW)},n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.plane=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getDirectionA(),i=t.getDirectionB(),o=t.getSizeA(),s=t.getSizeB(),a=Vector.cross(new Vector(n),new Vector(i),new Vector),l=a.unit().toArray(),u=new Matrix([n[0],i[0],l[0],0,n[1],i[1],l[1],0,n[2],i[2],l[2],0,0,0,0,1]),g=t.getResolutionU(),c=0;g>=c;c++)for(var S=c/g*s,d=0;g>=d;d++){var f=d/g*o,E=new Vector([2*f-1,2*S-1,0]),p=u.transformVector(E);if(r.vertices.push(p.toArray()),r.coords.push([f,S]),r.normals.push([0,0,1]),g>d&&g>c){var h=d+c*(g+1);r.triangles.push([h+g+1,h+1,h]),r.triangles.push([h+g+2,h+1,h+g+1]),r.lines.push([h+g+1,h]),r.lines.push([h+1,h]),r.lines.push([h+g+2,h+1]),r.lines.push([h+g+2,h+g+1])}}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.segment=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1});return r.vertices.push([0,0,0]),r.vertices.push([2,2,2]),r.lines.push([0,1]),r.compile(),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Shader={BasicVS:"void main() {       gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",BasicFS:"uniform vec3 color;      uniform float opacity;      void main() {          gl_FragColor = vec4(color, opacity);      }",ColorVS:"varying vec4 color;      void main() {       color = gl_Color;       gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",ColorFS:"varying vec4 color;      void main() {       gl_FragColor = color;      }",LightVS:"uniform vec3 color;      uniform vec3 light[10];      uniform int numlight;      uniform vec3 ambient;      varying vec3 tmpcolor;      void main() {        vec3 normal = normalize(gl_NormalMatrix * gl_Normal);        tmpcolor = vec3(0);      	for(int i = 0; i < 10; i++) {       		if(i == numlight) break;      		vec3 nlight = normalize((gl_ViewMatrix * vec4(light[i], 0.0)).xyz);       		float diffuse = max(0.0, dot(nlight, normal));       		float specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse);       		tmpcolor += mix(color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);      	}        gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",LightFS:"uniform float opacity;      varying vec3 tmpcolor;      void main() {   	    gl_FragColor = vec4(tmpcolor, opacity);      }",LightAndColorVS:"uniform vec3 color;      uniform vec3 light[10];      uniform int numlight;      uniform vec3 ambient;      varying vec3 tmpcolor;      void main() {        vec3 normal = normalize(gl_NormalMatrix * gl_Normal);        tmpcolor = vec3(0);      	for(int i = 0; i < 10; i++) {       		if(i == numlight) break;      		vec3 nlight = normalize(light[i]);       		float diffuse = max(0.0, dot(nlight, normal));       		float specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse);       		tmpcolor += mix(gl_Color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);      	}        gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",LightAndColorFS:"uniform float opacity;      varying vec3 tmpcolor;      void main() {   	    gl_FragColor = vec4(tmpcolor, opacity);      }",BasicVSwithTex:"varying vec2 coord;	  void main() {	    coord = gl_TexCoord.xy;	    gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);	  }",
BasicFSwithTex:"uniform sampler2D texture;	  varying vec2 coord;	  void main() {	    gl_FragColor = texture2D(texture, coord);	  }"},EJSS_WEBGLGRAPHICS.shader=function(e,t,r,n){function i(e,r){var n=e+r,i={};return EJSS_WEBGLGRAPHICS.Utils.regexMap(/\b(gl_[^;]*)\b;/g,l,function(e){var r=e[1];if(-1!=n.indexOf(r)){var o=r.replace(/[a-z_]/g,"");i[o]=t+r}}),i}function o(e,r){var n={},i=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(r);return r=i?i[1]+e+r.substr(i[1].length):e+r,EJSS_WEBGLGRAPHICS.Utils.regexMap(/\bgl_\w+\b/g,e,function(e){e in n||(r=r.replace(new RegExp("\\b"+e+"\\b","g"),t+e),n[e]=!0)}),r}function s(t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(n);return n}var a={},l="    uniform mat3 gl_NormalMatrix;    uniform mat4 gl_ModelMatrix;    uniform mat4 gl_ViewMatrix;    uniform mat4 gl_ProjectionMatrix;  ",u=l+"    attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;    attribute vec3 gl_Normal;    attribute vec4 gl_Color;  ",g="precision highp float;"+l,c={},S={};a.uniforms=function(t){e.useProgram(d);for(var r in t){var n=S[r]||e.getUniformLocation(d,r);if(n){S[r]=n;var i=t[r];if(i instanceof Vector?i=[i.x,i.y,i.z]:i instanceof Matrix&&(i=i.m),EJSS_WEBGLGRAPHICS.Utils.isArray(i))if(EJSS_WEBGLGRAPHICS.Utils.isArray(i[0])){for(var o=[],s=0;s<i.length;s++)o.push(i[s][0]),o.push(i[s][1]),o.push(i[s][2]);e.uniform3fv(n,new Float32Array(o))}else switch(i.length){case 1:e.uniform1fv(n,new Float32Array(i));break;case 2:e.uniform2fv(n,new Float32Array(i));break;case 3:e.uniform3fv(n,new Float32Array(i));break;case 4:e.uniform4fv(n,new Float32Array(i));break;case 9:e.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw"don't know how to load uniform \""+r+'" of length '+i.length}else{if(!EJSS_WEBGLGRAPHICS.Utils.isNumber(i))throw'attempted to set uniform "'+r+'" to invalid value '+i;(-1!=r.indexOf("texture")||-1!=r.indexOf("num")?e.uniform1i:e.uniform1f).call(e,n,i)}}}},a.setLineWidth=function(e){lineWidth=e},a.draw=function(t,r){a.drawBuffers(t.getVertexBuffers(),t.getIndexBuffers()[r==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:r)},a.drawBuffers=function(o,s,l){var u=i(r,n),g=e.modelMatrix,S=e.viewMatrix,f=e.projectionMatrix,E={};if(u.MM&&(E[u.MM]=g),u.VM&&(E[u.VM]=S),u.PM&&(E[u.PM]=f),u.NM){var p=S.multiply(g).inverse().m;E[u.NM]=[p[0],p[4],p[8],p[1],p[5],p[9],p[2],p[6],p[10]]}a.uniforms(E);var h=0;for(var m in o){var A=o[m],y=c[m]||e.getAttribLocation(d,m.replace(/^(gl_.*)$/,t+"$1"));-1!=y&&A.getBuffer()&&(c[m]=y,e.bindBuffer(e.ARRAY_BUFFER,A.getBuffer()),e.enableVertexAttribArray(y),e.vertexAttribPointer(y,A.getBuffer().spacing,e.FLOAT,!1,0,0),h=A.getBuffer().length/A.getBuffer().spacing)}for(var m in c)m in o||e.disableVertexAttribArray(c[m]);l==e.LINES&&e.lineWidth(lineWidth),!h||s&&!s.getBuffer()||(s?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.getBuffer()),e.drawElements(l,s.getBuffer().length,e.UNSIGNED_SHORT,0)):e.drawArrays(l,0,h))};var d=e.createProgram();if(e.attachShader(d,s(e.VERTEX_SHADER,o(u,r))),e.attachShader(d,s(e.FRAGMENT_SHADER,o(g,n))),e.linkProgram(d),!e.getProgramParameter(d,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(d);return a};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.spring=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=element.getRadius(),i=t.getResolutionV(),o=t.getResolutionU()+1,s=t.getRadiusTop(),a=t.getRadiusBottom(),l=(t.getThinExtremes(),2*Math.PI/o,0),u=0;i>u;u++)for(var g=u/(i-1),n=g*(a-s)+s,c=0;o>c;c++){var S=c/(o-1),d=n*Math.sin(S*Math.PI*2),f=n*Math.cos(S*Math.PI*2),E=-2*l/(i*o)+1;r.vertices.push([d,f,E]),0!=l&&r.lines.push([l-1,l]),l++}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.surface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;e-1>i;i++)for(var o=0;t-1>o;o++){var s=r[o+i*t],a=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.vertices.push(u)}for(var g=(e-1)*(t-1)/2,i=0;8*g>i;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])};var r=t.getData();if(r||r.length>0){for(var n=r.length,i=r[0].length,o=new Array,s=0,a=0;n>a;a++)for(var l=0;i>l;l++)o[s]=r[a][l],s++;var u=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());createSurfaceBuffers(n,i,o,u),u.computeNormals(),u.compile(),e.addElement(t.getName()+".mesh",u)}return u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.text=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getFont(),i=t.getBackground(),o=t.getText(),s=n.getFillColor(),a=n.getFontSize(),l=n.getFontStyle(),u=n.getFontFamily(),g=n.getFontWeight(),c=document.createElement("canvas"),S=c.getContext("2d");S=c.getContext("2d"),S.font=l+" "+g+" "+a+"pt "+u,i&&(S.fillStyle=i,S.fillRect(0,0,c.width,c.height)),S.textAlign="center",S.textBaseline="middle",S.fillStyle=s,S.fillText(o,c.width/2,c.height/2);var d=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,c);e.addElement(t.getName()+".texture",d);for(var f=1,E=0;f>=E;E++)for(var p=E/f,h=0;f>=h;h++){var m=h/f;if(r.vertices.push([0,2*p-1,2*m-1]),r.coords.push([p,m]),f>h&&f>E){var A=h+E*(f+1);r.triangles.push([A,A+1,A+f+1]),r.triangles.push([A+f+1,A+1,A+f+2])}}return r.computeNormals(),r.computeWireframe(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Texture={fromImage:function(e,t,r){r=r||{};var n=EJSS_WEBGLGRAPHICS.texture(e,t.width,t.height,r);try{e.texImage2D(e.TEXTURE_2D,0,n.getFormat(),n.getFormat(),n.getType(),t)}catch(i){throw"file:"==location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return r.minFilter&&r.minFilter!=e.NEAREST&&r.minFilter!=e.LINEAR&&e.generateMipmap(e.TEXTURE_2D),n},fromURL:function(e,t,r,n){checkerboardCanvas=function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var r=0;r<e.canvas.width;r+=16)e.fillStyle=16&(r^t)?"#FFF":"#DDD",e.fillRect(r,t,16,16);return e.canvas}();var i=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,checkerboardCanvas,r),o=new Image;return o.onload=function(){EJSS_WEBGLGRAPHICS.Texture.fromImage(e,o,r).swapWith(i),n()},o.src=t,i}},EJSS_WEBGLGRAPHICS.texture=function(e,t,r,n){var i={};n=n||{};var o,s,a=e.createTexture(),l=n.format||e.RGBA,u=n.type||e.UNSIGNED_BYTE;return i.getId=function(){return a},i.setId=function(e){a=e},i.getFormat=function(){return l},i.setFormat=function(e){l=e},i.getType=function(){return u},i.setType=function(e){u=e},i.getWidth=function(){return t},i.setWidth=function(e){t=e},i.getHeight=function(){return r},i.setHeight=function(e){r=e},i.bind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,a)},i.unbind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},i.drawTo=function(n){var i=e.getParameter(e.VIEWPORT);o=o||e.createFramebuffer(),s=s||e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,o),e.bindRenderbuffer(e.RENDERBUFFER,s),(t!=s.width||r!=s.height)&&(s.width=t,s.height=r,e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,s),e.viewport(0,0,t,r),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.viewport(i[0],i[1],i[2],i[3])},i.swapWith=function(e){var n;n=e.getId(),e.setId(a),a=n,n=e.getWidth(),e.setWidth(t),t=n,n=e.getHeight(),e.setHeight(r),r=n},e.bindTexture(e.TEXTURE_2D,a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.filter||n.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.filter||n.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap||n.wrapS||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap||n.wrapT||e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,l,t,r,0,l,u,null),i};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.trail=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getPoints(),i=[],o=[],s=0,a=0;a<n.length;a++)i[a]=[n[a][0],n[a][1],n[a][2]],0!=a&&1==n[a][3]&&(o[s++]=[a-1,a]);return r.setVertices(i),o.length>0&&r.setLines(o),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Utils={},EJSS_WEBGLGRAPHICS.Utils.regexMap=function(e,t,r){for(;null!=(result=e.exec(t));)r(result)},EJSS_WEBGLGRAPHICS.Utils.isArray=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"==t||"[object Float32Array]"==t},EJSS_WEBGLGRAPHICS.Utils.isNumber=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t},Vector.prototype={setx:function(e){this.x=e},sety:function(e){this.y=e},setz:function(e){this.z=e},getx:function(){return this.x},gety:function(){return this.y},getz:function(){return this.z},negative:function(){return new Vector(-this.x,-this.y,-this.z)},add:function(e){return e instanceof Vector?new Vector(this.x+e.x,this.y+e.y,this.z+e.z):new Vector(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof Vector?new Vector(this.x-e.x,this.y-e.y,this.z-e.z):new Vector(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof Vector?new Vector(this.x*e.x,this.y*e.y,this.z*e.z):new Vector(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof Vector?new Vector(this.x/e.x,this.y/e.y,this.z/e.z):new Vector(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},angle:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new Vector(this.x,this.y,this.z)},init:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},Vector.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Vector.add=function(e,t,r){return t instanceof Vector?(r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z):(r.x=e.x+t,r.y=e.y+t,r.z=e.z+t),r},Vector.subtract=function(e,t,r){return t instanceof Vector?(r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z):(r.x=e.x-t,r.y=e.y-t,r.z=e.z-t),r},Vector.multiply=function(e,t,r){return t instanceof Vector?(r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z):(r.x=e.x*t,r.y=e.y*t,r.z=e.z*t),r},Vector.divide=function(e,t,r){return t instanceof Vector?(r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z):(r.x=e.x/t,r.y=e.y/t,r.z=e.z/t),r},Vector.cross=function(e,t,r){return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},Vector.unit=function(e,t){var r=e.length();return t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,t},Vector.fromAngles=function(e,t){return new Vector(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},Vector.randomDirection=function(){return Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},Vector.min=function(e,t){return new Vector(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},Vector.max=function(e,t){return new Vector(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},Vector.lerp=function(e,t,r){return t.subtract(e).multiply(r).add(e)},Vector.fromArray=function(e){return new Vector(e[0],e[1],e[2])};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.WebGLGraphics={},EJSS_GRAPHICS.webGLGraphics=function(e){function t(){i.MODEL=1|o,i.VIEW=2|o,i.PROJECTION=3|o;var e=new Matrix,t=new Matrix;i.modelMatrix=new Matrix,i.viewMatrix=new Matrix,i.projectionMatrix=new Matrix;var r,n,s=[],a=[],l=[];i.elements={},i.addElement=function(e,t){i.elements[e]=t},i.getElement=function(e){return i.elements[e]},i.removeElement=function(e){delete i.elements[e]},i.matrixMode=function(e){switch(e){case i.MODEL:r="modelMatrix",n=s;break;case i.VIEW:r="viewMatrix",n=a;break;case i.PROJECTION:r="projectionMatrix",n=l;break;default:throw"invalid matrix mode "+e}},i.loadIdentity=function(){Matrix.identity(i[r])},i.loadMatrix=function(e){for(var t=e.m,n=i[r].m,o=0;16>o;o++)n[o]=t[o]},i.multMatrix=function(e){i.loadMatrix(Matrix.multiply(i[r],e,t))},i.perspective=function(t,r,n,o){i.multMatrix(Matrix.perspective(t,r,n,o,e))},i.frustum=function(t,r,n,o,s,a){i.multMatrix(Matrix.frustum(t,r,n,o,s,a,e))},i.ortho=function(t,r,n,o,s,a){i.multMatrix(Matrix.ortho(t,r,n,o,s,a,e))},i.scale=function(t,r,n){i.multMatrix(Matrix.scale(t,r,n,e))},i.translate=function(t,r,n){i.multMatrix(Matrix.translate(t,r,n,e))},i.applyMatrix=function(e){i.multMatrix(new Matrix(e))},i.rotate=function(t,r,n,o,s,a,l){s=s||0,a=a||0,l=l||0,i.multMatrix(Matrix.rotate(t,r,n,o,s,a,l,e))},i.lookAt=function(t,r,n,o,s,a,l,u,g){i.multMatrix(Matrix.lookAt(t,r,n,o,s,a,l,u,g,e))},i.pushMatrix=function(){n.push(Array.prototype.slice.call(i[r].m))},i.popMatrix=function(){var e=n.pop();i[r].m=hasFloat32Array?new Float32Array(e):e},i.matrixMode(i.MODEL)}var r=EJSS_INTERFACE.webGLCanvas(e),n=r.getDOMElement(),i=r.getContext();r.supportsWebGL=function(){return i},r.getEventContext=function(){return n},r.getWidth=function(){return+n.width},r.getHeight=function(){return+n.height},r.getOffsetLeft=function(){return n.offsetLeft},r.getOffsetTop=function(){return n.offsetTop},r.getAspect=function(){var e=r.getWidth(),t=Math.max(1,r.getHeight());return e/t},r.getAspect=function(){var e=r.getWidth(),t=Math.max(1,r.getHeight());return e/t},r.remove=function(e){},r.reset=function(e,n,o){if(i){t();var s=r.getWidth(),a=Math.max(1,r.getHeight());i.viewport(0,0,s,a),i.matrixMode(i.PROJECTION),i.loadIdentity(),i.perspective(e,s/a,n,o),i.matrixMode(i.VIEW),i.disable(i.CULL_FACE),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)}},r.putCamera=function(e){i&&(i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.loadIdentity(),i.lookAt(e.location.x,e.location.y,e.location.z,e.focus.x,e.focus.y,e.focus.z,0,0,1),i.rotate(EJSS_TOOLS.Mathematics.radians(e.altitude),0,1,0,e.focus.x,e.focus.y,e.focus.z),i.rotate(EJSS_TOOLS.Mathematics.radians(e.azimuth),0,0,1,e.focus.x,e.focus.y,e.focus.z))},r.draw=function(e,t){if(i)for(var n=0,o=e.length;o>n;n++)if(element=e[n],element.getElements){for(var s=element.getLastElements(),a=0,l=s.length;l>a;a++)i.removeElement(s[a].getName()+".mesh");r.draw(element.getElements(),t)}else r.drawElement(element,t)},r.drawElement=function(e,t){var n=null;if(e.isGroupVisible()){var n=i.getElement(e.getName()+".mesh");if(!n||e.isMeshChanged())switch(e.getClass()){case"ElementArrow":n=EJSS_WEBGLGRAPHICS.arrow(i,e);break;case"ElementSegment":n=EJSS_WEBGLGRAPHICS.segment(i,e);break;case"ElementSphere":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementEllipsoid":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementBox":n=EJSS_WEBGLGRAPHICS.box(i,e);break;case"ElementCylinder":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementCone":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementTetrahedron":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementDisk":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementBasic":n=EJSS_WEBGLGRAPHICS.basic(i,e);break;case"ElementPlane":n=EJSS_WEBGLGRAPHICS.plane(i,e);break;case"ElementSurface":n=EJSS_WEBGLGRAPHICS.surface(i,e);break;case"ElementAnalyticSurface":n=EJSS_WEBGLGRAPHICS.analyticSurface(i,e);break;case"ElementText":n=EJSS_WEBGLGRAPHICS.text(i,e);break;case"ElementTrail":n=EJSS_WEBGLGRAPHICS.trail(i,e);break;case"ElementAnalyticCurve":n=EJSS_WEBGLGRAPHICS.analyticCurve(i,e);break;case"ElementSpring":n=EJSS_WEBGLGRAPHICS.spring(i,e)}if(n){i.matrixMode(i.MODEL),i.loadIdentity();for(var o=[],s=e;s.getGroup();)s=s.getGroup(),o.unshift(s);for(var a=0;a<o.length;a++){s=o[a];var l=s.getFullTransformation();if(l&&l.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(l[0]))for(var u=0;u<l.length;u++)i.rotate(l[u][0],l[u][1],l[u][2],l[u][3],l[u][4],l[u][5],l[u][6]);else i.rotate(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);i.translate(s.getX()*e.getPanel().getSizeX(),s.getY()*e.getPanel().getSizeY(),s.getZ()*e.getPanel().getSizeZ()),i.scale(s.getSizeX(),s.getSizeY(),s.getSizeZ())}var g=e.getFullTransformation();if(g&&g.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(g[0]))for(var u=0;u<g.length;u++)i.rotate(g[u][0],g[u][1],g[u][2],g[u][3],g[u][4],g[u][5],g[u][6]);else 16==g.length?i.applyMatrix(g):i.rotate(g[0],g[1],g[2],g[3],g[4],g[5],g[6]);i.translate(e.getX()*e.getPanel().getSizeX(),e.getY()*e.getPanel().getSizeY(),e.getZ()*e.getPanel().getSizeZ()),"ElementArrow"==e.getClass()?i.scale(e.getPanel().getSizeX(),e.getPanel().getSizeY(),e.getPanel().getSizeZ()):"ElementTrail"==e.getClass()?i.scale(e.getPanel().getSizeX()*e.getSizeX(),e.getPanel().getSizeY()*e.getSizeY(),e.getPanel().getSizeZ()*e.getSizeZ()):i.scale(e.getPanel().getSizeX()*e.getSizeX()/2,e.getPanel().getSizeY()*e.getSizeY()/2,e.getPanel().getSizeZ()*e.getSizeZ()/2),e.getStyle().getTransparency()>0&&(i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.DEPTH_TEST)),r.drawMesh(i,e,n),e.getStyle().getTransparency()>0&&(i.disable(i.BLEND),i.enable(i.DEPTH_TEST)),i.matrixMode(i.VIEW)}}return n},r.drawPanel=function(e){if(i){var t=e.getStyle();if(e.isImageUrl())i.clearColor(0,0,0,0);else{var n=t.getFillColor();i.clearColor(n[0],n[1],n[2],void 0!==typeof n[3]?n[3]:1)}return r}},r.drawMesh=function(e,t,r){var n=1-t.getStyle().getTransparency()/255,i=t.getTextureUrl();if("ElementText"==t.getClass()||i&&i.length>0){var o=e.getElement(r.getId()+".shader_tex"),s=e.getElement(r.getId()+".texture");if(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_tex",EJSS_WEBGLGRAPHICS.Shader.BasicVSwithTex,EJSS_WEBGLGRAPHICS.Shader.BasicFSwithTex),s)s.bind(),o.uniforms({texture:0}),o.draw(r),s.unbind(),e.addElement(r.getId()+".texture",s);else{var a=EJSS_WEBGLGRAPHICS.Texture.fromURL(e,i,{},function(e){t.getController().invokeAction("OnLoadTexture"),t.getController().reportInteractions()});a.bind(),o.uniforms({texture:0}),o.draw(r),a.unbind(),e.addElement(r.getId()+".texture",a)}e.addElement(r.getId()+".shader_tex",o)}else{var l=t.getStyle().getDrawLines();if(l){var o=e.getElement(r.getId()+".shader_lines");o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_lines",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getLineColor(),opacity:n}),o.setLineWidth(t.getStyle().getLineWidth()),o.draw(r,e.LINES),e.addElement(r.getId()+".shader_lines",o)}var u=t.getStyle().getDrawFill();if(u){var o=e.getElement(r.getId()+".shader_fill"),g=t.getColors&&t.getColors().length>0,c=t.getGroupPanel().getLights().length>0;c?g?o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightAndColorVS,EJSS_WEBGLGRAPHICS.Shader.LightAndColorFS):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightVS,EJSS_WEBGLGRAPHICS.Shader.LightFS),o.uniforms({color:t.getStyle().getFillColor()})):g?o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.ColorVS,EJSS_WEBGLGRAPHICS.Shader.ColorFS):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getFillColor()}));var S=t.getGroupPanel().getLights(),d=S.length,f=t.getGroupPanel().getAmbientLight();o.uniforms({numlight:d,ambient:f,light:S,opacity:n}),o.draw(r,e.TRIANGLES),e.addElement(r.getId()+".shader_fill",o)}}};var o=305397760;return r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Plane={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setDirectionA(e.getDirectionA()),t.setDirectionB(e.getDirectionB()),t.setSizeA(e.getSizeA()),t.setSizeB(e.getSizeB())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("DirectionA",e.setDirectionA),t.registerProperty("DirectionB",e.setDirectionB),t.registerProperty("SizeA",e.setSizeA),t.registerProperty("SizeB",e.setSizeB)}},EJSS_DRAWING3D.plane=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,[1,0,0]),n=[0,1,0],i=1,o=1;return t.getClass=function(){return"ElementPlane"},t.setDirectionA=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getDirectionA=function(){return r},t.setDirectionB=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getDirectionB=function(){return n},t.setSizeA=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getSizeA=function(){return i},t.setSizeB=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getSizeB=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Plane.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Plane.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.PlaneSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("DirectionA",function(t){e.setToEach(function(e,t){e.setDirectionA(t)},t)}),t.registerProperty("DirectionB",function(t){e.setToEach(function(e,t){e.setDirectionB(t)},t)}),t.registerProperty("SizeA",function(t){e.setToEach(function(e,t){e.setSizeA(t)},t)}),t.registerProperty("SizeB",function(t){e.setToEach(function(e,t){e.setSizeB(t)},t)})}},EJSS_DRAWING3D.planeSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.plane,e),r=EJSS_DRAWING3D.PlaneSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Segment={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t)}},EJSS_DRAWING3D.segment=function(e){var t=EJSS_DRAWING3D.element(e);EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING3D.Segment.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Segment.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t},EJSS_DRAWING3D.SegmentSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.segmentSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.segment,e),r=EJSS_DRAWING3D.SegmentSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Sphere={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Ellipsoid.copyTo(e,t),t.setRadius(e.getRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Ellipsoid.registerProperties(e,t),t.registerProperty("Radius",e.setRadius)}},EJSS_DRAWING3D.sphere=function(e){var t=EJSS_DRAWING3D.ellipsoid(e),r=.5;EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementSphere"},t.setRadius=function(e){r=e,t.setSize([2*e,2*e,2*e])},t.getRadius=function(){return r},t.copyTo=function(e){EJSS_DRAWING3D.Sphere.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Sphere.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.SphereSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)})}},EJSS_DRAWING3D.sphereSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.sphere,e),r=EJSS_DRAWING3D.SphereSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Spring={DEF_RADIUS:1,copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setThinExtremes(e.getThinExtremes()),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop)}},EJSS_DRAWING3D.spring=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,EJSS_DRAWING3D.Spring.DEF_RADIUS),n=!0,i=1,o=1;return t.getClass=function(){return"ElementSpring"},t.setRadius=function(e){r=e,t.setSize([e,e,e])},t.getRadius=function(){return r},t.setThinExtremes=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getThinExtremes=function(){return n},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Spring.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Spring.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t.setResolution([50,8]),t},EJSS_DRAWING3D.SpringSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.springSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.spring,e),r=EJSS_DRAWING3D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Surface={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setData(e.getData())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData)}},EJSS_DRAWING3D.surface=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,[]);return t.getClass=function(){return"ElementSurface"},t.setData=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getData=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Surface.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Surface.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.SurfaceSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Data",function(t){e.setToEach(function(e,t){e.setData(t)},t)})}},EJSS_DRAWING3D.surfaceSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.surface,e),r=EJSS_DRAWING3D.SurfaceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Tetrahedron={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedron=function(e){var t=EJSS_DRAWING3D.cylinder(e);EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementTetrahedron"},t.registerProperties=function(e){EJSS_DRAWING3D.Tetrahedron.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Tetrahedron.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t.setResolutionU(4),t},EJSS_DRAWING3D.TetrahedronSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedronSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.tetrahedron,e),r=EJSS_DRAWING3D.TetrahedronSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Text={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setTextBackground(e.getTextBackground()),t.setTextMargin(e.getTextMargin())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Background",e.setBackground),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("FontColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle)}},EJSS_DRAWING3D.text=function(e){var t=EJSS_DRAWING3D.element(e),r=(EJSS_DRAWING3D.Style,EJSS_DRAWING2D.font(e)),n="",i="rgba(255,255,255,0)";return t.getClass=function(){return"ElementText"},t.setBackground=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setMeshChanged(!0)),t},t.getBackground=function(){return i},t.setText=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getText=function(){return n},t.getFont=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Text.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setTransparency(255),t},EJSS_DRAWING3D.TextSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Background",function(t){e.setToEach(function(e,t){e.setBackground(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("FontColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)}),t.registerProperty("FontStyle",function(t){e.setToEach(function(e,t){e.getFont().setFontStyle(t)},t)})}},EJSS_DRAWING3D.textSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.text,e),r=EJSS_DRAWING3D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),
t.registerProperty("InputY",e.addYPoints),t.registerProperty("InputZ",e.addZPoints)}},EJSS_DRAWING3D.trail=function(e){function t(e,t,n,o){return isNaN(e)||isNaN(t)?void(c=!0):void(i&&S[0]==e&&S[1]==t&&S[2]==n||(("undefined"==typeof o||null===o)&&(o=u),d=0,S=r.formatPoint([e,t,n,o]),s>0&&(g>0&&(d=r.formatPoint([e,t,n,o])),++g>=s&&(g=0)),0==d&&(l>2&&f.length>=l&&f.splice(0,1),f[f.length]=r.formatPoint([e,t,n,o]),c=!1)))}var r=EJSS_DRAWING3D.element(e),n=!0,i=!1,o=!1,s=0,a=["x","y","z"],l=0,u=EJSS_DRAWING3D.Trail.LINE_CONNECTION,g=0,c=!0,S=0,d=0,f=[],E=[],p=[],h=0,m=0,A=0;return r.getClass=function(){return"ElementTrail"},r.setActive=function(e){n!=e&&(n=e,r.setMeshChanged(!0))},r.getActive=function(){return n},r.setNoRepeat=function(e){i!=e&&(i=e,r.setMeshChanged(!0))},r.getNoRepeat=function(){return i},r.setClearAtInput=function(e){o!=e&&(o=e,r.setMeshChanged(!0))},r.getClearAtInput=function(){return o},r.setSkip=function(e){s!=e&&(s=e,g=0,r.setMeshChanged(!0))},r.getSkip=function(){return s},r.setInputLabels=function(e){(a[0]!=e[0]||a[1]!=e[1]||a[2]!=e[2])&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],r.setMeshChanged(!0))},r.getInputLabels=function(){return a},r.setMaximumPoints=function(e){var t=Math.max(e,2);l!=t&&(l=t,r.setMeshChanged(!0))},r.getMaximumPoints=function(){return l},r.setConnected=function(e){e?r.setConnectionType(EJSS_DRAWING3D.Trail.LINE_CONNECTION):r.setConnectionType(EJSS_DRAWING3D.Trail.NO_CONNECTION)},r.isConnected=function(){return u===EJSS_DRAWING3D.Trail.LINE_CONNECTION},r.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING3D.Trail[e.toUpperCase()]),u!=e&&(u=e,r.setMeshChanged(!0))},r.getConnectionType=function(){return u},r.addPoint=function(e,n,i,s){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],s):t(e,n,i,s),r.setMeshChanged(!0)},r.addPoints=function(e,n,i){if(o&&r.initialize(),e[0]instanceof Array)for(var s=0,a=e.length;a>s;s++)t(e[s][0],e[s][1],e[s][2],u);else if(e&&n&&i)for(var a=Math.min(e.length,n.length,i.length),s=0;a>s;s++)t(e[s],n[s],i[s],u);r.setMeshChanged(!0)},r.addXPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[e[t],p[t][1],p[t][2],p[t][3]]:p[t]=[e[t],m,A,u];h=e[t]}else p[t]?p[t]=[e,p[t][1],p[t][2],p[t][3]]:p[t]=[e,m,A,u],t++,h=e;for(;p[t];)p[t]=[h,p[t][1],p[t][2],p[t][3]],t++},r.addYPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[p[t][0],e[t],p[t][2],p[t][3]]:p[t]=[h,e[t],A,u];m=e[t]}else p[t]?p[t]=[p[t][0],e,p[t][2],p[t][3]]:p[t]=[h,e,A,u],t++,m=e;for(;p[t];)p[t]=[p[t][0],m,p[t][2],p[t][3]],t++},r.addZPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[p[t][0],p[t][1],e[t],p[t][3]]:p[t]=[h,m,e[t],u];A=e[t]}else p[t]?p[t]=[p[t][0],p[t][1],e,p[t][3]]:p[t]=[h,m,e,u],t++,A=e;for(;p[t];)p[t]=[p[t][0],p[t][1],A,p[t][3]],t++},r.dataCollected=function(){p.length>0&&(r.addPoints(p),p=[],r.setMeshChanged(!0))},r.setPoints=function(e,t,n,i){r.clear(),r.addPoints(e,t,n,i),r.setMeshChanged(!0)},r.moveToPoint=function(e,n,i){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],EJSS_DRAWING3D.Trail.NO_CONNECTION):t(e,n,i,EJSS_DRAWING3D.Trail.NO_CONNECTION),r.setMeshChanged(!0)},r.getPoints=function(){for(var e=[],t=E.length,r=0;t>r;r++)e=e.concat(E[r]);return e=e.concat(f)},r.getLastPoint=function(){return S},r.reset=function(){r.clear()},r.clear=function(){E=[],mCurrentSegment=0,r.initialize()},r.initialize=function(){f=[],d=0,c=!0,g=0,S=0,r.setMeshChanged(!0)},r.newSegment=function(){if(0!=d){var e=f.length;f[e]=r.formatPoint(d)}var e=E.length;E[e]=f,r.initialize()},r.formatPoint=function(e){return e},r.registerProperties=function(e){EJSS_DRAWING3D.Trail.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(r,e)},r.setSize([1,1,1]),r.getStyle().setDrawFill(!1),r.getStyle().setDrawLines(!0),r},EJSS_DRAWING3D.TrailSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)}),t.registerProperty("InputZ",function(t){e.setToEach(function(e,t){e.addZPoints(t)},t)})}},EJSS_DRAWING3D.trailSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.trail,e),r=EJSS_DRAWING3D.TrailSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ArrayPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Editable",e.setEditable,e.getEditable),t.registerProperty("Transpose",e.setTranspose,e.getTranspose),t.registerProperty("DataArray",e.setDataArray,e.getDataArray),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight),t.registerProperty("EditableBkgd",e.setEditableBkgd,e.getEditableBkgd),t.registerProperty("NonEditableBkgd",e.setNonEditableBkgd,e.getNonEditableBkgd),t.registerAction("OnChange",e.getElementInteracted)}},EJSS_INTERFACE.arrayPanel=function(e){function t(){if(D.innerHTML="",v.innerHTML="",o){var e=document.createElement("tr");e.style.border="inherit";for(var t=o.length,r=0;t>r;r++){var E=document.createElement("th");i&&i[r]&&("number"==typeof i[r]?E.style.width=i[r]+"px":"string"==typeof i[r]&&(E.style.width[r]=i[r])),a&&a[r]&&EJSS_INTERFACE.Style.setCSS(E,a[r]),E.innerHTML=o[r],e.appendChild(E)}1==t&&(E.colSpan="100%"),v.appendChild(e)}if(u){var p=0,h=0;if(S){h=u.length;for(var r=0;h>r;r++)p=Math.max(p,u[r].length)}else{p=u.length;for(var r=0;p>r;r++)h=Math.max(h,u[r].length)}if(0>=p||0>=h)return;for(var r=0;p>r;r++){var e=document.createElement("tr");e.style.border="inherit";for(var m=0;h>m;m++){var A=document.createElement("td");i&&i[m]&&("number"==typeof i[m]?A.style.width=i[m]+"px":"string"==typeof i[m]&&(A.style.width=i[m]));var y;s&&(y=s instanceof Array?s[m]:s);var P;P=g instanceof Array?g[m]:"undefined"==typeof g?!0:g,S?r>=u[m].length?P=!1:A.innerHTML=n(u[m][r],y):m>=u[r].length?P=!1:A.innerHTML=n(u[r][m],y),P?(A.contentEditable=!0,A.onblur=c.handleOnBlur,A.onfocus=c.handleOnFocus,A.onkeydown=c.handleOnKeydown,A.style.backgroundColor=d):A.style.backgroundColor=f,l&&l[m]&&EJSS_INTERFACE.Style.setCSS(A,l[m]),e.appendChild(A)}D.appendChild(e)}}}function r(e){var t=/(<([^>]+)>)/gi,r=e.innerHTML.replace(t,""),n=parseFloat(r);if(!isNaN(n)&&isFinite(r)){if(e.style.backgroundColor=A,m!=r){var i=e.cellIndex,s=e.parentNode.rowIndex;o&&(s-=1),S?u[i][s]=n:u[s][i]=n;var a=c.getController();a&&(a.propertiesChanged("DataArray"),S?(E.row=i,E.column=s):(E.row=s,E.column=i),a.invokeAction("OnChange"),a.reportInteractions())}}else e.style.backgroundColor="red"}function n(e,t){if("undefined"!=typeof t&&t.length>0){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(-1==n){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}var i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return e}var i,o,s,a,l,u,g,c=EJSS_INTERFACE.element(e),S=!1,d="White",f="LightGrey",E={row:-1,column:-1},p=!0,h=!1,m="",A="";c.enableEPub=function(){c.getDOMElement().disabled&&(c.getDOMElement().disabled=!1)},c.setTranspose=function(e){S!=e&&(S=e,p=!0)},c.getTranspose=function(){return S},c.setEditable=function(e){g=e,p=!0},c.getEditable=function(){return g},c.setDataArray=function(e){u=e,p=!0},c.getDataArray=function(){return u},c.setColumnsWidth=function(e){i=e,p=!0},c.getColumnsWidth=function(){return i},c.setHeadersText=function(e){o=e,p=!0},c.getHeadersText=function(){return o},c.setCellsFormat=function(e){s=e,p=!0},c.getCellsFormat=function(){return s},c.setHeadersCSS=function(e){a=e,p=!0},c.getHeadersCSS=function(){return a},c.setCellsCSS=function(e){l=e,p=!0},c.getCellsCSS=function(){return l},c.setEditableBkgd=function(e){d!=e&&(d=e,p=!0)},c.getEditableBkgd=function(e){return d},c.setNonEditableBkgd=function(e){f!=e&&(f=e,p=!0)},c.getNonEditableBkgd=function(e){return f},c.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),D.style.height=e},c.getBodyHeight=function(){return D.style.height},c.getElementInteracted=function(){return E},c.registerProperties=function(e){EJSS_INTERFACE.ArrayPanel.registerProperties(c,e)},c.enableEPub=function(){c.getDOMElement().disabled&&(c.getDOMElement().disabled=!1)},c.render=function(){p&&!h&&(t(),p=!1),"undefined"!=typeof _isEPub&&_isEPub&&c.enableEPub()},c.handleOnBlur=function(e){var t=e.target||e.srcElement;h&&(h=!1,r(t))},c.handleOnFocus=function(e){var t=e.target||e.srcElement;m=t.innerHTML,A=t.style.backgroundColor},c.handleOnKeydown=function(e){var t=e||window.event,n=t.which?t.which:t.keyCode,i=t.target||t.srcElement;13==n?(h=!1,r(i),m=i.innerHTML):27==n?i.innerHTML=m:(i.style.backgroundColor="yellow",h=!0)};var y=document.createElement("table"),D=document.createElement("tbody"),v=document.createElement("thead");return y.style.display="inline-block",y.appendChild(v),y.appendChild(D),y.id=e,document.body.appendChild(y),c.setDOMElement(y),c};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Audio={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("AudioUrl",e.setUrl)}},EJSS_INTERFACE.audio=function(e){var t=EJSS_INTERFACE.media(e);t.registerProperties=function(e){EJSS_INTERFACE.Audio.registerProperties(t,e)};var r=document.createElement("audio");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.BoxPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t)},showOkDialog:function(e,t,r){var n=document.getElementById(".myBoxPanelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelOk").getDOMElement(),i=document.getElementById(".myBoxPanelOk.back"),o=document.getElementById(".myBoxPanelOk.msg");o.style.visibility="visible",o.innerHTML=e+"<br/>";var s=document.getElementById(".myBoxPanelOk.okbt");s.onclick=t,s.style.display="inline",n.style.width=r||"200px",n.style.marginLeft=parseFloat(n.style.width)/-2+"px",n.style.visibility="visible",i.style.visibility="visible"},showOkCancelDialog:function(e,t,r,n){var i=document.getElementById(".myBoxPanelCancelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelCancelOk").getDOMElement(),o=document.getElementById(".myBoxPanelCancelOk.back"),s=document.getElementById(".myBoxPanelCancelOk.msg");s.style.visibility="visible",s.innerHTML=e+"<br/>";var a=document.getElementById(".myBoxPanelCancelOk.okbt");a.onclick=t,a.style.display="inline";var l=document.getElementById(".myBoxPanelCancelOk.cancelbt");l.onclick=r,l.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showInputDialog:function(e,t,r,n){var i=document.getElementById(".BoxPanelInput")||EJSS_INTERFACE.boxPanel(".BoxPanelInput").getDOMElement(),o=document.getElementById(".BoxPanelInput.back"),s=document.getElementById(".BoxPanelInput.msg");s.style.visibility="visible",s.innerHTML=e;var a=document.getElementById(".BoxPanelInput.input");a.style.display="inline";var l=document.getElementById(".BoxPanelInput.okbt");l.onclick=function(){t(a.value)},l.style.display="inline";var u=document.getElementById(".BoxPanelInput.cancelbt");u.onclick=r,u.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showSelectDialog:function(e,t,r,n,i,o){var s=document.getElementById(".BoxPanelSelect")||EJSS_INTERFACE.boxPanel(".BoxPanelSelect").getDOMElement(),a=document.getElementById(".BoxPanelSelect.back"),l=document.getElementById(".BoxPanelSelect.msg");l.style.visibility="visible",l.innerHTML=e;var u=document.getElementById(".BoxPanelSelect.select");u.innerHTML="";for(var g=0;g<t.text.length;g++){var c=document.createElement("option");c.value&&c.value[g]&&c.setAttribute("value",t.value[g]),c.innerHTML=t.text[g],u.appendChild(c)}i&&(u.size=i),u.style.display="block",u.style.margin="0 auto";var S=document.getElementById(".BoxPanelSelect.okbt");S.onclick=function(){r(t.value[u.selectedIndex])},S.style.display="inline";var d=document.getElementById(".BoxPanelSelect.cancelbt");d.onclick=n,d.style.display="inline",s.style.width=o||"200px",s.style.marginLeft=parseFloat(s.style.width)/-2+"px",s.style.visibility="visible",a.style.visibility="visible"}},EJSS_INTERFACE.boxPanel=function(e){var t=EJSS_INTERFACE.panel(e);EJSS_INTERFACE.boxPanel;t.setVisibility=function(e){mElement.style.visibility=e,t.getStyle().setVisibility(e)},t.registerProperties=function(e){EJSS_INTERFACE.BoxPanel.registerProperties(t,e)};var r=document.createElement("div");document.body.appendChild(r),r.className="myBoxPanelBackground",r.id=e+".back",r.style.backgroundColor="rgba(255, 255, 255, 0.3)",r.style.position="fixed",r.style.top="1%",r.style.left="1%",r.style.width="98%",r.style.height="98%",r.style.zIndex="99998",r.style.visibility="hidden";var n=document.createElement("span");n.id=e+".msg",n.style.visibility="hidden",t.getDOMElement().appendChild(n);var i=document.createElement("input");i.id=e+".input",i.type="text",i.style.display="none",i.size="20",t.getDOMElement().appendChild(i);var o=document.createElement("select");o.id=e+".select",o.style.display="none",o.size="4",t.getDOMElement().appendChild(o);var s=document.createElement("button");s.id=e+".okbt",s.innerHTML="Ok",s.style.verticalAlign="middle",s.style.display="none",s.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(s);var a=document.createElement("button");return a.id=e+".cancelbt",a.innerHTML="Cancel",a.style.verticalAlign="middle",a.style.display="none",a.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(a),t.getDOMElement().className="BoxPanel",t.getStyle().setCSS({position:"fixed",top:"25%",left:"50%"}),t.getStyle().setCSS({zIndex:"99999",visibility:"hidden"}),t.getStyle().setCSS({marginLeft:"-250px",width:"500px"}),t.getStyle().setCSS({background:"lightgray"}),t.getStyle().setCSS({borderWidth:"1px"}),t.getStyle().setCSS({borderStyle:"solid"}),t.getStyle().setCSS({borderColor:"red"}),t.getStyle().setCSS({overflow:"hidden",wordWrap:"break-word"}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Button={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease")}},EJSS_INTERFACE.button=function(e){function t(){r.getDOMElement().innerHTML="",n.length>0&&(r.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+n+'"/>'),i.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+i.toString()+"</span>")}var r=EJSS_INTERFACE.element(e),n="",i="";r.setDisabled=function(e){r.getDOMElement().disabled=e},r.getDisabled=function(){return r.getDOMElement().disabled},r.setText=function(e){i!=e&&(i=e,t())},r.getText=function(){return i},r.setImageUrl=function(e){var i=r.getResourcePath(e);i!=n&&(n=i,t())},r.getImageUrl=function(){return n},r.registerProperties=function(e){EJSS_INTERFACE.Button.registerProperties(r,e)};var o=document.createElement("button");return o.id=e,o.style.verticalAlign="middle",document.body.appendChild(o),r.setDOMElement(o),r.getDOMElement().onmousedown=function(){var e=r.getController();return e&&e.invokeAction("OnPress").reportInteractions(),!1},r.getDOMElement().ontouchstart=function(){var e=r.getController();return e&&e.invokeAction("OnPress").reportInteractions(),!1},r.getDOMElement().onmouseup=function(){var e=r.getController();return e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions()),!1},r.getDOMElement().ontouchend=function(){var e=r.getController();return e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions()),!1},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Canvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth),t.registerProperty("ImageData",e.setImageData),t.registerProperty("Enabled",e.setEnabled,e.isEnabled),t.registerAction("OnPress",e.getMousePosition),t.registerAction("OnDrag",e.getMousePosition),t.registerAction("OnRelease",e.getMousePosition),t.registerAction("OnEnter",e.getMousePosition),t.registerAction("OnExit",e.getMousePosition),t.registerAction("OnMove",e.getMousePosition)}},EJSS_INTERFACE.canvas=function(e){function t(e){var t=e.currentTarget,r=EJSS_GRAPHICS.SvgGraphics.getOffsetRect(t);return[e.clientX-r.left,e.clientY-r.top]}function r(e){var r=u.getController();r&&(S=t(e),r.invokeAction("OnPress").reportInteractions()),d=!0}function n(e){var r=u.getController();d&&r&&(S=t(e),r.invokeAction("OnRelease").reportInteractions()),d=!1}function i(e){var r=u.getController();d=!1,r&&(S=t(e),r.invokeAction("OnEnter").reportInteractions())}function o(e){var r=u.getController();d=!1,r&&(S=t(e),r.invokeAction("OnExit").reportInteractions())}function s(e){var r=u.getController();r&&(S=t(e),d?r.invokeAction("OnDrag").reportInteractions():r.invokeAction("OnMove").reportInteractions())}var a,l,u=EJSS_INTERFACE.element(e),g=(EJSS_INTERFACE.Canvas,0),c=0,S=[0,0],d=!1;u.render=function(){a&&E.putImageData(a,0,0)},u.setImageData=function(e){a||(a=E.createImageData(c,g)),e.data&&(e=e.data);for(var t=0;t<e.length;t++)a.data[t]=e[t]},u.clear=function(){E.clearRect(0,0,c,g)},u.setWidth=function(e){return c!=e?(c=e,a=void 0,u.getDOMElement().width=c,!0):!1},u.getWidth=function(){return c},u.setHeight=function(e){return g!=e?(g=e,a=void 0,u.getDOMElement().height=g,!0):!1},u.getHeight=function(){return g},u.getContext=function(){return E},u.registerProperties=function(e){EJSS_INTERFACE.Canvas.registerProperties(u,e)},u.setEnabled=function(e){l=e;var t=u.getDOMElement();l?(t.onmousedown=r,t.ontouchstart=r,t.onmouseup=n,t.ontouchend=n,t.onmouseover=i,t.onmouseout=o,t.onmousemove=s,t.ontouchmove=s):(t.onmousedown=void 0,t.ontouchstart=void 0,t.onmouseup=void 0,t.ontouchend=void 0,t.onmouseover=void 0,t.onmouseout=void 0,t.onmousemove=void 0,t.ontouchmove=void 0)},u.isEnabled=function(){return l},u.getMousePosition=function(){return S};var f=document.createElement("canvas");f.id=e;var E=f.getContext("2d");return document.body.appendChild(f),u.setDOMElement(f),u.setEnabled(!0),u};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.CheckBox={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.checkBox=function(e){function t(){c.innerHTML="",g.checked?i.src.length>0?c.appendChild(i):a.length>0?c.innerHTML=a.toString():n.src.length>0?c.appendChild(n):s.length>0&&(c.innerHTML=s.toString()):o.src.length>0?c.appendChild(o):l.length>0?c.innerHTML=l.toString():n.src.length>0?c.appendChild(n):s.length>0&&(c.innerHTML=s.toString())}var r=EJSS_INTERFACE.element(e),n=new Image,i=new Image,o=new Image,s="",a="",l="";r.setText=function(e){s=e,t()},r.setImageUrl=function(e){n.src=r.getResourcePath(e),t()},r.setTextOff=function(e){l=e,t()},r.getTextOff=function(){return l},r.setImageOffUrl=function(e){o.src=r.getResourcePath(e),t()},r.getImageUrlOff=function(){return o.src},r.setTextOn=function(e){a=e,t()},r.getTextOn=function(){return a},r.setImageOnUrl=function(e){i.src=r.getResourcePath(e),t()},r.getImageUrlOn=function(){return i.src},r.setChecked=function(e){g.checked!=e&&(g.checked=e,t())},r.getChecked=function(){return g.checked},r.setValue=function(e){g.value=e},r.getValue=function(){return g.value},r.registerProperties=function(e){EJSS_INTERFACE.CheckBox.registerProperties(r,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),r.setDOMElement(u);var g=document.createElement("input");g.id=e+".checkbox",g.type="checkbox",u.appendChild(g),g.onchange=function(){t();var e=r.getController();e&&(e.propertiesChanged("Checked"),e.invokeAction("OnChange"),g.checked?e.invokeAction("OnCheckOn"):e.invokeAction("OnCheckOff"),e.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",u.appendChild(c),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ComboBox={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Options",e.setOptions,e.getOptions),t.registerProperty("SelectedOptions",e.setSelectedOptions,e.getSelectedOptions),t.registerProperty("Multiple",e.setMultiple),t.registerProperty("Size",e.setSize),t.registerAction("OnChange"),t.registerAction("OnFocus")}},EJSS_INTERFACE.comboBox=function(e){var t=EJSS_INTERFACE.element(e),r=[];t.registerProperties=function(e){EJSS_INTERFACE.ComboBox.registerProperties(t,e)},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setSelectedOptions=function(e){for(var r=t.getDOMElement(),n=0;n<r.options.length;n++){r.options[n].selected=!1;for(var i=0;i<e.length;i++)if(r.options[n].value==e[i]){r.options[n].selected=!0;break}}},t.getSelectedOptions=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=r.options[i].value);return e},t.getSelectedOptionsIndexes=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=i);return e},t.setOptions=function(e){if(!EJSS_TOOLS.compareArrays(r,e)){r=[];var n=t.getSelectedOptions(),i=t.getDOMElement();i.innerHTML="";for(var o=0;o<e.length;o++){var s=document.createElement("option");s.setAttribute("value",e[o]),s.innerHTML=e[o],i.appendChild(s),r[o]=e[o]}t.setSelectedOptions(n)}},t.getOptions=function(){for(var e=[],r=t.getDOMElement(),n=0;n<r.options.length;n++)e[n]=r.options[n].value;return e},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly};var n=document.createElement("select");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onfocus=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("Options"),e.invokeAction("OnFocus"),e.reportInteractions())},t.getDOMElement().onchange=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("SelectedOptions"),e.invokeAction("OnChange"),e.reportInteractions())},t.getDOMElement().onkeydown=function(){t.getStyle().setBackgroundColor("yellow")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.DataTable={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.isActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.isNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.isClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("AddToTop",e.setAddToTop,e.isAddToTop),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("Input",e.appendRow),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("Width",e.setWidth,e.getStyle().getWidth),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight)}},EJSS_INTERFACE.dataTable=function(e){function t(){if(I.innerHTML="",_.innerHTML="","undefined"!=typeof d&&d.length>0){var e=document.createElement("tr");e.style.border="inherit";for(var t=0,r=d.length;r>t;t++){var n=document.createElement("th");S[t]&&("string"!=typeof S[t]?n.style.width=S[t]+"px":n.style.width=S[t]),E[t]&&EJSS_INTERFACE.Style.setCSS(n,E[t]),n.innerHTML=d[t],e.appendChild(n)}_.appendChild(e)}A=0,D=!1}function r(e){var t=document.createElement("tr");t.style.border="inherit";for(var r=0;e>r;r++){var n=document.createElement("td");S[r]&&("string"!=typeof S[r]?n.style.width=S[r]+"px":n.style.width=S[r]),p[r]&&EJSS_INTERFACE.Style.setCSS(n,p[r]),t.appendChild(n)}I.appendChild(t),A++}function n(){v=!1;for(var e="undefined"!=typeof f,t=0,n=h.length;n>t;t++){var o=h[t];t>=A&&r(o.length);var s=I.rows[t];if(e)for(var l=0,u=o.length;u>l;l++)s.cells[l].innerHTML=i(o[l],f[l]);else for(var l=0,u=o.length;u>l;l++)s.cells[l].innerHTML=i(o[l])}if(a){if(h.length>=0){var g=I.rows[0];I.scrollTop=g.offsetBottom}}else if(h.length>0){var c=I.rows[h.length-1];I.scrollTop=c.offsetTop}}function i(e,t){if("number"!=typeof e)return e;if("undefined"!=typeof t){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(-1==n){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}var i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return parseFloat(e).toFixed(3)}var o=EJSS_INTERFACE.element(e),s=!0,a=!1,l=!1,u=!1,g=0,c=0,S=[],d=[],f=[],E=[],p=[],h=[],m=[],A=0,y=0,D=!0,v=!0;o.setActive=function(e){s=e},o.isActive=function(){return s},o.setAddToTop=function(e){a=e},o.isAddToTop=function(){return a},o.setNoRepeat=function(e){l=e},o.isNoRepeat=function(){return norepeat},o.setClearAtInput=function(e){u=e},o.isClearAtInput=function(){return u},o.setSkip=function(e){g=e},o.getSkip=function(){return g},o.setMaximumPoints=function(e){c=e,h.length>c&&(a?h=h.slice(0,c):h.splice(0,h.length-c),D=!0)},o.getMaximumPoints=function(){return c},o.setColumnsWidth=function(e){EJSS_TOOLS.compareArrays(S,e)||(S=e,D=!0)},o.getColumnsWidth=function(){return S},o.setHeadersText=function(e){EJSS_TOOLS.compareArrays(d,e)||(d=e,D=!0)},o.getHeadersText=function(){return d},o.setCellsFormat=function(e){EJSS_TOOLS.compareArrays(f,e)||(f=e,v=!0)},o.getCellsFormat=function(){return f},o.setHeadersCSS=function(e){EJSS_TOOLS.compareArrays(E,e)||(E=e,D=!0)},o.getHeadersCSS=function(){return E},o.setCellsCSS=function(e){EJSS_TOOLS.compareArrays(p,e)||(p=e,D=!0)},o.getCellsCSS=function(){return p},o.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),I.style.height=e},o.getBodyHeight=function(){return I.style.height},o.setWidth=function(e){"string"!=typeof e&&(e+="px"),I.style.width=e,_.style.width=e,o.getStyle().setWidth(e)},o.registerProperties=function(e){EJSS_INTERFACE.DataTable.registerProperties(o,e)},o.reset=function(){o.clear()},o.initialize=function(){o.clear()},o.clear=function(e){h=[],y=0,D=!0},o.appendRow=function(e){if(s)if(u&&o.clear(),e[0]instanceof Array)for(var t=0,r=e.length;r>t;t++)o.addPoint(e[t]);else o.addPoint(e)},o.addPoint=function(e){if(g>0){if(g>y)return void y++;y=0}l&&EJSS_TOOLS.compareArrays(e,m)||(m=e.slice(0),a?(c>0&&h.length>=c&&h.pop(),h.unshift(m)):(c>0&&h.length>=c&&h.shift(),h.push(m)),v=!0)},o.dataCollected=function(){},o.render=function(){D?(t(),n()):v&&n()};var P=document.createElement("table"),I=document.createElement("tbody"),_=document.createElement("thead");return P.style.display="inline-block",P.appendChild(_),P.appendChild(I),P.id=e,document.body.appendChild(P),o.setDOMElement(P),o};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Element={registerProperties:function(e,t){e.setController(t),t.registerProperty("Tooltip",e.setTitle),t.registerProperty("Foreground",e.getStyle().setColor),t.registerProperty("Background",e.getStyle().setBackgroundColor),t.registerProperty("BackgroundImage",e.getStyle().setBackgroundImage),t.registerProperty("BorderWidth",e.getStyle().setBorderWidth),t.registerProperty("BorderColor",e.getStyle().setBorderColor),t.registerProperty("BorderStyle",e.getStyle().setBorderStyle),t.registerProperty("Padding",e.getStyle().setPadding),t.registerProperty("Width",e.getStyle().setWidth,e.getStyle().getWidth),t.registerProperty("Height",e.getStyle().setHeight,e.getStyle().getHeight),t.registerProperty("LineHeight",e.getStyle().setLineHeight,e.getStyle().getLineHeight),t.registerProperty("TextAlign",e.getStyle().setTextAlign),t.registerProperty("VerticalAlign",e.getStyle().setVerticalAlign),t.registerProperty("Visibility",e.getStyle().setVisibility),t.registerProperty("Display",e.getStyle().setDisplay),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("Float",e.getStyle().setFloat),t.registerProperty("Position",e.getStyle().setPosition),t.registerProperty("Left",e.getStyle().setLeft),t.registerProperty("Top",e.getStyle().setTop),t.registerProperty("Bottom",e.getStyle().setBottom),t.registerProperty("Overflow",e.getStyle().setOverflow),t.registerProperty("BoxShadow",e.getStyle().setShadow),t.registerProperty("Margin",e.getStyle().setMargin),t.registerProperty("Parent",e.setParent),t.registerProperty("ClassName",e.setClassName),t.registerProperty("CSS",e.getStyle().setCSS),t.registerProperty("Font",e.getStyle().setFont),t.registerProperty("FontFamily",e.getStyle().setFontFamily),t.registerProperty("FontSize",e.getStyle().setFontSize),t.registerProperty("LetterSpacing",e.getStyle().setLetterSpacing),t.registerProperty("OutlineColor",e.getStyle().setOutlineColor),t.registerProperty("FontWeight",e.getStyle().setFontWeight),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("FontStyle",e.getStyle().setFontStyle),t.registerProperty("Transform",e.getStyle().setTransform),t.registerProperty("WhiteSpace",e.getStyle().setWhiteSpace)}
},EJSS_INTERFACE.element=function(e){var t,r,n={},i=EJSS_INTERFACE.style(e),o=null;return n.getDOMElement=function(){return t},n.setDOMElement=function(e){t=e},n.setParent=function(e){if(r=e,"string"==typeof e){var t=document.getElementById(e);t.appendChild(n.getDOMElement())}else e.getDOMElement?e.appendChild(n):e.appendChild(n.getDOMElement())},n.getParent=function(){return r},n.getName=function(){return e},n.getResourcePath=function(e){return e},n.setClassName=function(e){n.getDOMElement().className=e},n.getClassName=function(){return n.getDOMElement().className},n.setDisabled=function(e){n.getDOMElement().disabled=e},n.getDisabled=function(){return n.getDOMElement().disabled},n.setTitle=function(e){n.getDOMElement().title=e},n.getTitle=function(){return n.getDOMElement().title},n.getStyle=function(){return i},n.getController=function(){return o},n.setController=function(e){o=e},n.registerProperties=function(e){EJSS_INTERFACE.Element.registerProperties(n,e)},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FunctionField={registerProperties:function(e,t){EJSS_INTERFACE.TextField.registerProperties(e,t),t.registerAction("OnError")}},EJSS_INTERFACE.functionField=function(e){var t,r=EJSS_INTERFACE.textField(e),n=EJSS_DRAWING2D.functionsParser(),i=n.parse("0"),o=r.setValue,s={},a=r.getStyle().getBackgroundColor();return r.registerProperties=function(e){EJSS_INTERFACE.FunctionField.registerProperties(r,e)},r.setParameters=function(e){for(var t in e)s[t]=e[t]},r.parseValue=function(e){if(e){if(e!=t){try{i=n.parse(e),r.getStyle().setBackgroundColor(a)}catch(o){r.getController().invokeAction("OnError"),console.log('FunctionField: Error parsing function "'+e+'" : '+o.message+"\n"),r.getStyle().setBackgroundColor("red")}t=e}}else t="0",i=n.parse("0"),r.getStyle().setBackgroundColor(a)},r.setValue=function(e){o(e),r.parseValue(e)},r.evaluate=function(e){var t={};for(var n in s)t[n]=s[n];for(var o in e)t[o]=e[o];try{return i.evaluate(t)}catch(a){return r.getController().invokeAction("OnError"),NaN}},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Html={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml),t.registerProperty("Url",e.setUrl)}},EJSS_INTERFACE.html=function(e){var t=EJSS_INTERFACE.element(e);t.setHtml=function(e){var r=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;r.write(e)},t.getHtml=function(){var e=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;return e.body.innerHTML},t.setUrl=function(e){0==e.indexOf("http:")||0==e.indexOf("https:")||(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.registerProperties=function(e){EJSS_INTERFACE.Html.registerProperties(t,e)};var r=document.createElement("iframe");return r.id=e,r.src="about:blank",r.width="100%",document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setBorderStyle("none"),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Image={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl)}},EJSS_INTERFACE.image=function(e){var t=EJSS_INTERFACE.element(e);t.setImageUrl=function(e){t.getDOMElement().src=e.toString()},t.getImageUrl=function(){return t.getDOMElement().src},t.registerProperties=function(e){EJSS_INTERFACE.Image.registerProperties(t,e)};var r=document.createElement("img");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ImageAndTextButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick")}},EJSS_INTERFACE.imageAndTextButton=function(e){var t=EJSS_INTERFACE.element(e),r="",n="";t.setText=function(e){r=e.toString(),t.getDOMElement().innerHTML=n+r},t.getText=function(){return r},t.setImageUrl=function(e){n='<img src="'+t.getResourcePath(e)+'"/>',t.getDOMElement().innerHTML=n+r},t.getImageUrl=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.ImageAndTextButton.registerProperties(t,e)};var i=document.createElement("button");return i.id=e,i.style.borderStyle="none",i.style.background="inherit",i.style.cursor="inherit",i.style.webkitBoxShadow="inset 0 0px 0 rgba(255,255,255,0),0 0px 0px rgba(0,0,0,0)",document.body.appendChild(i),t.setDOMElement(i),t.getDOMElement().onclick=function(){var e=t.getController();return e&&e.invokeAction("OnClick").reportInteractions(),!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Label={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText)}},EJSS_INTERFACE.label=function(e){var t=EJSS_INTERFACE.element(e);t.setText=function(e){t.getDOMElement().innerHTML='<span style="white-space:pre;">'+e.toString()+"</span>"},t.getText=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Label.registerProperties(t,e)};var r=document.createElement("label");return r.id=e,r.style.display="inline-block",document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MathML={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Content",e.setContent,e.getContent)}},EJSS_INTERFACE.mathML=function(e){var t=EJSS_INTERFACE.element(e);t.setContent=function(e){t.getDOMElement().innerHTML=e},t.getContent=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.MathML.registerProperties(t,e)};var r=document.createElement("math");return r.setAttribute("id",e),document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Media={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("Controls",e.setControls),t.registerProperty("Loop",e.setLoop),t.registerProperty("CurrentTime",e.setCurrentTime,e.getCurrentTime),t.registerProperty("Volume",e.setVolume),t.registerProperty("Autoplay",e.setAutoplay),t.registerProperty("Type",e.setType),t.registerAction("OnEnded"),t.registerAction("OnLoadedData"),t.registerAction("OnPlay"),t.registerAction("OnPause")}},EJSS_INTERFACE.media=function(e){var t=EJSS_INTERFACE.element(e);return t.setUrl=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.getUrl=function(){return t.getDOMElement().src},t.setType=function(e){t.getDOMElement().type=e},t.getType=function(){return t.getDOMElement().type},t.setControls=function(e){e?t.getDOMElement().setAttribute("controls","controls"):t.getDOMElement().removeAttribute("controls")},t.play=function(){t.getDOMElement().play()},t.pause=function(){t.getDOMElement().pause()},t.getCurrentTime=function(){return t.getDOMElement().currentTime},t.setCurrentTime=function(e){t.getDOMElement().currentTime=e},t.setLoop=function(e){t.getDOMElement().loop=e},t.getVolume=function(){return t.getDOMElement().volume},t.setVolume=function(e){t.getDOMElement().volume=e},t.getAutoplay=function(){return t.getDOMElement().autoplay},t.setAutoplay=function(e){t.getDOMElement().autoplay=e},t.isPaused=function(){return t.getDOMElement().paused},t.isEnded=function(){return t.getDOMElement().ended},t.getDuration=function(){return t.getDOMElement().duration},t.addDOMEvents=function(){t.getDOMElement().onended=function(){var e=t.getController();e&&e.invokeAction("OnEnded").reportInteractions()},t.getDOMElement().onloadeddata=function(){var e=t.getController();e&&e.invokeAction("OnLoadedData").reportInteractions()},t.getDOMElement().onplay=function(){var e=t.getController();e&&e.invokeAction("OnPlay").reportInteractions()},t.getDOMElement().onpause=function(){var e=t.getController();e&&e.invokeAction("OnPause").reportInteractions()}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MotionJPEG={registerProperties:function(e,t){EJSS_INTERFACE.Canvas.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("AsBackground",e.setAsBackground,e.isAsBackground),t.registerProperty("On",e.setOnOff,e.isOnOff),t.registerProperty("UseWebCam",e.useWebCam)}},EJSS_INTERFACE.motionJPEG=function(e){var t,r=EJSS_INTERFACE.canvas(e),n=new Image(400,400),i=document.createElement("video"),o=!1,s=!0,a=!1;return r.useWebCam=function(e){function n(e){t=window.webkitURL?window.webkitURL.createObjectURL(e):e,s&&(i.src=t),console.log("Success = "+t)}function o(e){console.log("Error = "+e)}a!=e&&(a=e,a?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},n,o)):(t=null,r.pause()))},r.setUrl=function(e){r.getResourcePath&&(e=r.getResourcePath(e)),t=e,t&&s&&(n.src=t),a=!1},r.getUrl=function(){return t},r.setOnOff=function(e){e?s||r.play():s&&r.pause()},r.isOnOff=function(){return s},r.play=function(){t&&(a?i.src=t:n.src=t),s=!0},r.pause=function(){s=!1,r.clear()},r.getCanvasContext=function(){return r.getContext()},r.getSnapshot=function(){return r.getContext().getImageData(0,0,r.getWidth(),r.getHeight())},r.isAsBackground=function(){return o},r.setAsBackground=function(e){e!=o&&(o=e,o?r.getStyle().setCSS({position:"absolute","z-index":"-100"}):r.getStyle().setCSS({position:" ","z-index":" "}))},r.render=function(){s&&t&&a&&(i.readyState===i.HAVE_ENOUGH_DATA?r.getContext().drawImage(i,0,0):r.getContext().drawImage(n,0,0))},r.registerProperties=function(e){EJSS_INTERFACE.MotionJPEG.registerProperties(r,e)},i.autoplay="true",i.style="display:none;",r.getStyle().setBackgroundColor("rgb(239,239,255)"),r.setEnabled(!1),r.setWidth(500),r.setHeight(500),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.NumberField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Format",e.setFormat),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.numberField=function(e){function t(){var e=r.getDOMElement().value;if(!isNaN(parseFloat(e))&&isFinite(e)){if(r.getStyle().setBackgroundColor("white"),s!=e){var t=r.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}else{if("∞"!==e&&"-∞"!==e&&"∅"!==e)return r.getStyle().setBackgroundColor("red"),!1;r.getStyle().setBackgroundColor("white")}return!0}var r=EJSS_INTERFACE.element(e),n=3,i=!1,o=!1,s="";r.registerProperties=function(e){EJSS_INTERFACE.NumberField.registerProperties(r,e)},r.enableEPub=function(){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(r.render=function(){r.enableEPub()}),r.setValue=function(e){o||("undefined"==typeof e?r.getDOMElement().value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)?i?r.getDOMElement().value=parseFloat(e).toExponential(n):r.getDOMElement().value=parseFloat(e).toFixed(n):e===Number.POSITIVE_INFINITY?r.getDOMElement().value="∞":e===Number.NEGATIVE_INFINITY?r.getDOMElement().value="-∞":isNaN(e)&&(r.getDOMElement().value="∅"))},r.getValue=function(){var e=r.getDOMElement().value;return!isNaN(parseFloat(e))&&isFinite(e)?e=parseFloat(e):"∞"===e?e=Number.POSITIVE_INFINITY:"-∞"===e?e=Number.NEGATIVE_INFINITY:"∅"===e&&(e=Number.NaN),e},r.setEditable=function(e){r.getDOMElement().readOnly=!e},r.getEditable=function(){return!r.getDOMElement().readOnly},r.setSize=function(e){r.getDOMElement().size=e},r.getSize=function(){return r.getDOMElement().size},r.setFormat=function(e){var t=e.indexOf("."),o=e.toUpperCase().indexOf("E");if(-1==o){var s=0;t>=0&&(s=Number(e.length-t-1)),(i||n!=s)&&(n=s,i=!1,r.setValue(r.getValue()))}else{var s=0;t>=0&&(s=Number(o-t-1)),i&&n==s||(n=s,i=!0,r.setValue(r.getValue()))}};var a=document.createElement("input");return a.type="tel",a.id=e,a.value=0,document.body.appendChild(a),r.setDOMElement(a),r.getDOMElement().onkeydown=function(e){var n=r.getDOMElement();if(!n.readOnly){var i=e||window.event,a=i.which?i.which:i.keyCode;13==a?(o=!1,t()&&(s=r.getDOMElement().value)):27==a?r.getDOMElement().value=s:(r.getStyle().setBackgroundColor("yellow"),o=!0)}},r.getDOMElement().onfocus=function(e){s=r.getDOMElement().value},r.getDOMElement().onblur=function(e){!e.readOnly&&o&&(o=!1,t())},r.getDOMElement().ontouchstart=function(e){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1),r.getDOMElement().focus(),e.stop()},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Panel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml,e.getHtml)}},EJSS_INTERFACE.panel=function(e){var t=EJSS_INTERFACE.element(e);EJSS_INTERFACE.panel;t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)},t.setHtml=function(e){t.getDOMElement().innerHTML=e},t.getHtml=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Panel.registerProperties(t,e)};var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({display:"block","margin-left":"auto","margin-right":"auto"}),t.getDOMElement().ontouchstart=function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.PasswordField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.passwordField=function(e){var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.PasswordField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return mValue},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size};var r=document.createElement("input");return r.id=e,r.type="password",document.body.appendChild(r),t.setDOMElement(r),t.getDOMElement().onkeydown=function(e){var r=t.getDOMElement();if(!r.readOnly){var n=e||window.event,i=n.which?n.which:n.keyCode;if(13==i){t.getStyle().setBackgroundColor("white");var o=t.getController();o&&(o.propertiesChanged("Value"),o.invokeAction("OnChange"),o.reportInteractions())}else t.getStyle().setBackgroundColor("yellow")}},t.getDOMElement().onblur=function(e){e.readOnly||t.getStyle().setBackgroundColor("white")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.RadioButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Parent",function(t){e.setParent(t),e.setKey(e.getDOMElement().parentNode.id)}),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.radioButton=function(e){function t(){c.innerHTML="",g.checked?i.src.length>0?c.appendChild(i):a.length>0?c.innerHTML=a.toString():n.src.length>0?c.appendChild(n):s.length>0&&(c.innerHTML=s.toString()):o.src.length>0?c.appendChild(o):l.length>0?c.innerHTML=l.toString():n.src.length>0?c.appendChild(n):s.length>0&&(c.innerHTML=s.toString())}var r=EJSS_INTERFACE.element(e),n=new Image,i=new Image,o=new Image,s="",a="",l="";r.setKey=function(e){g.name=e},r.getKey=function(){return g.name},r.setText=function(e){s=e,t()},r.setImageUrl=function(e){n.src=r.getResourcePath(e),t()},r.setTextOff=function(e){l=e,t()},r.getTextOff=function(){return l},r.setImageOffUrl=function(e){o.src=r.getResourcePath(e),t()},r.getImageUrlOff=function(){return o.src},r.setTextOn=function(e){a=e,t()},r.getTextOn=function(){return a},r.setImageOnUrl=function(e){i.src=r.getResourcePath(e),t()},r.getImageUrlOn=function(){return i.src},r.setChecked=function(e){g.checked!=e&&(g.checked=e,t())},r.getChecked=function(){return g.checked},r.setValue=function(e){g.value=e},r.getValue=function(){return g.value},r.registerProperties=function(e){EJSS_INTERFACE.RadioButton.registerProperties(r,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),r.setDOMElement(u);var g=document.createElement("input");g.id=e+".radio",g.type="radio",u.appendChild(g),g.onchange=function(){g.remoteonchange();for(var e=document.getElementsByTagName("fieldset"),t=0;t<e.length;t++)if(e[t].childNodes&&e[t].childNodes[0]){var r=e[t].childNodes[0];"radio"==r.type&&r.remoteonchange&&r.name==g.name&&r.id!=g.id&&r.remoteonchange()}},g.remoteonchange=function(e){t();var n=r.getController();n&&(n.propertiesChanged("Checked"),n.invokeAction("OnChange"),g.checked?n.invokeAction("OnCheckOn"):n.invokeAction("OnCheckOff"),n.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",u.appendChild(c),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Separator={HORIZONTAL:0,VERTICAL:1,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Orientation",e.setOrientation),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.separator=function(e){var t=EJSS_INTERFACE.element(e),r=EJSS_INTERFACE.Separator.HORIZONTAL,n="100%",i="2px";t.setOrientation=function(e){"string"==typeof e&&(e=EJSS_INTERFACE.Separator[e.toUpperCase()]),r!=e&&(r=e,r==EJSS_INTERFACE.Separator.VERTICAL?(t.getDOMElement().style.display="inline",t.getDOMElement().style.height=t.getDOMElement().style.width,t.getDOMElement().style.width=i):(t.getDOMElement().style.display="none",t.getDOMElement().style.width=t.getDOMElement().style.height,t.getDOMElement().style.height=i))},t.getOrientation=function(){return r},t.setWidth=function(e){n!=e&&(n=e,r==EJSS_INTERFACE.Separator.VERTICAL?t.getDOMElement().style.height=n:t.getDOMElement().style.width=n)},t.getWidth=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.Separator.registerProperties(t,e)};var o=document.createElement("hr");return o.id=e,o.style.height=i,o.style.width=n,document.body.appendChild(o),t.setDOMElement(o),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Slider={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMin),t.registerProperty("Maximum",e.setMax),t.registerProperty("Step",e.setStep),t.registerProperty("TextWidth",e.setTextWidth),t.registerProperty("ShowText",e.setShowText),t.registerProperty("Format",e.setFormat),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("RangeCSS",e.setRangeCSS),t.registerAction("OnChange",e.getValue)}},EJSS_INTERFACE.slider=function(e){var t=EJSS_INTERFACE.element(e),r=!1,n=3;t.registerProperties=function(e){EJSS_INTERFACE.Slider.registerProperties(t,e)},t.setValue=function(e){"undefined"==typeof e?a.value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)&&(a.value=parseFloat(e),r&&(o.innerHTML=parseFloat(e).toFixed(n)))},t.getValue=function(){var e=a.value;return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):e},t.setFormat=function(e){var r=e.indexOf("."),i=0;r>=0&&(i=Number(e.length-r-1)),n!=i&&(n=i,t.setValue(t.getValue()))},t.setStep=function(e){a.step=e},t.getStep=function(){return a.step},t.setMax=function(e){a.max=e,0==a.step.length&&a.min.length>0&&(a.step=(e-a.min)/100)},t.getMax=function(){return a.max},t.setMin=function(e){a.min=e,0==a.step.length&&a.max.length>0&&(a.step=(a.max-e)/100)},t.getMin=function(){return a.min},t.setShowText=function(e){r=e,r&&(o.innerHTML="")},t.getShowText=function(){return r},t.setTextWidth=function(e){o.style.width=e},t.getTextWidth=function(e){return o.style.width},t.setDisabled=function(e){a.disabled=e},t.getDisabled=function(){return a.disabled},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(o,e)},t.setRangeCSS=function(e){EJSS_INTERFACE.Style.setCSS(a,e)};var i=document.createElement("div");i.id=e,i.style.display="inline-block",i.style.overflow="hidden",i.style.textAlign="left",i.style.verticalAlign="middle",document.body.appendChild(i),t.setDOMElement(i);var o=document.createElement("label");o.id=e+".label",o.style["float"]="left",i.appendChild(o);var s=document.createElement("div");s.id=e+".div2",s.style.overflow="hidden",i.appendChild(s);var a=document.createElement("input");return a.style.verticalAlign="middle",a.style.width="98%",a.style.height="98%",a.type="range",a.id=e+".slider",a.value=0,s.appendChild(a),a.oninput=function(){var e=t.getController();e&&(e.propertiesChanged("Value"),e.invokeAction("OnChange"),e.reportInteractions())},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Style={BORDER_SOLID:"solid",BORDER_DOTTED:"dotted",BORDER_DASHED:"dashed",TEXTA_LEFT:"left",TEXTA_RIGHT:"right",TEXTA_CENTER:"center",TEXTA_JUSTIFY:"justify",VISIB_VISIBLE:"visible",VISIB_HIDDEN:"hidden",FLOAT_LEFT:"left",FLOAT_RIGHT:"right",FLOAT_NONE:"none",FLOAT_CENTER:"none",POSITION_STATIC:"static",POSITION_ABSOLUTE:"absolute",POSITION_FIXED:"fixed",POSITION_RELATIVE:"relative",POSITION_INHERIT:"inherit",OVERFLOW_VISIBLE:"visible",OVERFLOW_HIDDEN:"hidden",OVERFLOW_SCROLL:"scroll",OVERFLOW_AUTO:"auto",setCSS:function(e,t){var r=/-([\da-z])/gi,n=function(e,t){return(t+"").toUpperCase()},i=e.style;if("object"!=typeof t){var o=t.trim().split("{");if(o[0]&&o[0].length>0){var s,a=o[0].trim(),l=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(s=0;s<l.length&&l[s].selectorText!=a;s++);var u=l[s].cssText?l[s].cssText:l[s].style.cssText;u=u.match(/{.*}/g)[0];var g=u.slice(1,u.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),d=c[1].trim(),f=S.replace(r,n);i[f]=d}}}if(o[1]){var E=o[1].trim(),g=E.slice(0,E.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),d=c[1].trim(),f=S.replace(r,n);i[f]=d}}}}else for(var p in t){var f=p.replace(r,n);i[f]=t[p]}}},EJSS_INTERFACE.style=function(e){var t=EJSS_INTERFACE.Style,r={},n="white",i=0,o=t.BORDER_SOLID;return r.setCSS=function(r){t.setCSS(document.getElementById(e),r)},r.setVisibility=function(t){document.getElementById(e).style.visibility=t?"visible":"hidden"},r.getVisibility=function(){return"visible"==document.getElementById(e).style.visibility},r.setVerticalAlign=function(t){document.getElementById(e).style.verticalAlign=t},r.getVerticalAlign=function(){return document.getElementById(e).style.verticalAlign},r.setTextAlign=function(r){"TEXTA_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.textAlign=r},r.getTextAlign=function(){return document.getElementById(e).style.textAlign},r.setLineHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.lineHeight=t},r.getLineHeight=function(){return document.getElementById(e).style.lineHeight},r.setHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.height=t},r.getHeight=function(){return document.getElementById(e).style.height},r.setWidth=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.width=t},r.getWidth=function(){return document.getElementById(e).style.width},r.setOverflow=function(r){"OVERFL"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.overflow=r},r.getOverflow=function(){return document.getElementById(e).style.overflow},r.setPosition=function(r){"POSITI"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.position=r},r.getPosition=function(){return document.getElementById(e).style.position},r.setFloat=function(r){"FLOAT_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style["float"]=r},r.getFloat=function(){return document.getElementById(e).style["float"]},r.setDisplay=function(t){document.getElementById(e).style.display=t},r.getDisplay=function(){return document.getElementById(e).style.display},r.setTop=function(t){document.getElementById(e).style.top=t},r.getTop=function(){return document.getElementById(e).style.top},r.setBottom=function(t){document.getElementById(e).style.bottom=t},r.getBottom=function(){return document.getElementById(e).style.bottom},r.setLeft=function(t){document.getElementById(e).style.left=t},r.getLeft=function(){return document.getElementById(e).style.left},r.setBorderStyle=function(r){"BORDER"==r.substring(0,6)&&(r=t[r.toUpperCase()]),o=r,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderStyle=function(){return o},r.setBorderWidth=function(t){i=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderWidth=function(){return i},r.setBorderColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),n=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderColor=function(){return n},r.setPadding=function(t){document.getElementById(e).style.padding=t},r.getPadding=function(){return document.getElementById(e).style.padding},r.setShadow=function(t){t?document.getElementById(e).style.boxShadow=t:document.getElementById(e).style.boxShadow=""},r.getShadow=function(){return""!=document.getElementById(e).style.boxShadow},r.setMargin=function(t){document.getElementById(e).style.margin=t},r.getMargin=function(){return document.getElementById(e).style.margin},r.setBackgroundImage=function(t){document.getElementById(e).style.backgroundImage="url("+t+")",document.getElementById(e).style.backgroundSize="100% 100%"},r.getBackgroundImage=function(){return document.getElementById(e).style.backgroundImage},r.setBackgroundColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.backgroundColor=t},r.getBackgroundColor=function(){return document.getElementById(e).style.backgroundColor},r.setColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.color=t},r.getColor=function(){return document.getElementById(e).style.color},r.getFont=function(){return document.getElementById(e).style.font},r.setFont=function(t){var r=document.getElementById(e).style,n=t.split(" ");r.fontStyle=n[0],r.fontWeight=n[1];var i=n[2].split("/");r.fontSize=i[0],i[1]&&(r.lineHeight=i[1]),n[3]&&(r.fontFamily=t.substring(t.indexOf(n[3])))},r.setFontStyle=function(t){document.getElementById(e).style.fontStyle=t},r.getFontStyle=function(){return document.getElementById(e).style.fontStyle},r.setFontFamily=function(t){document.getElementById(e).style.fontFamily=t},r.getFontFamily=function(){return document.getElementById(e).style.fontFamily},r.setFontSize=function(t){document.getElementById(e).style.fontSize=t},r.getFontSize=function(){return document.getElementById(e).style.fontSize},r.setLetterSpacing=function(t){document.getElementById(e).style.letterSpacing=t},r.getLetterSpacing=function(){return document.getElementById(e).style.letterSpacing},r.setOutlineColor=function(t){document.getElementById(e).style.stroke=t},r.getOutlineColor=function(){return document.getElementById(e).style.stroke},r.setFontWeight=function(t){document.getElementById(e).style.fontWeight=t},r.getFontWeight=function(){return document.getElementById(e).style.fontWeight},r.setFillColor=function(t){document.getElementById(e).style.fill=t},r.getFillColor=function(){return document.getElementById(e).style.fill},r.setTransform=function(t){document.getElementById(e).style.transform=t,document.getElementById(e).style["-ms-transform"]=t,document.getElementById(e).style["-webkit-transform"]=t},r.getTransform=function(){return document.getElementById(e).style.transform},r.setWhiteSpace=function(t){document.getElementById(e).style.whiteSpace=t},r.getWhiteSpace=function(){return document.getElementById(e).style.whiteSpace},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.SvgGraphics={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.svgGraphics=function(e){var t=EJSS_INTERFACE.element(e),r=(EJSS_INTERFACE.SvgGraphics,0),n=0;t.setWidth=function(e){if(n!=e){n=e;var r="string"==typeof n&&-1!=n.indexOf("%")?n:parseFloat(n);return t.getDOMElement().setAttribute("width",r),!0}return!1},t.getWidth=function(){return n},t.setHeight=function(e){if(r!=e){r=e;var n="string"==typeof r&&-1!=r.indexOf("%")?r:parseFloat(r);return t.getDOMElement().setAttribute("height",n),!0}return!1},t.getHeight=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.SvgGraphics.registerProperties(t,e)};var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("id",e),i.setAttribute("width",500),i.setAttribute("height",500),i.style.overflow="hidden",i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(i),t.setDOMElement(i),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextArea={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Rows",e.setRows),t.registerProperty("Columns",e.setCols),t.registerProperty("ChangeColorOnEdit",e.setChangeColorOnEdit),t.registerAction("OnChange")}},EJSS_INTERFACE.textArea=function(e){var t=EJSS_INTERFACE.element(e),r=!0;t.registerProperties=function(e){EJSS_INTERFACE.TextArea.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setChangeColorOnEdit=function(e){r=e},t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setCols=function(e){t.getDOMElement().cols=e},t.getCols=function(){return t.getDOMElement().cols},t.setRows=function(e){t.getDOMElement().rows=e},t.getRows=function(){return t.getDOMElement().rows};var n=document.createElement("textarea");return n.id=e,n.style.verticalAlign="middle",document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onkeydown=function(e){var n=t.getDOMElement();n.readOnly||r&&t.getStyle().setBackgroundColor("yellow")},t.getDOMElement().onblur=function(e){if(!e.readOnly){r&&t.getStyle().setBackgroundColor("white");var n=t.getController();n&&(n.propertiesChanged("Value"),n.invokeAction("OnChange"),n.reportInteractions())}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.textField=function(e){function t(){
var e=r.getDOMElement().value;if(r.getStyle().setBackgroundColor("white"),r.parseValue&&r.parseValue(e),i!=e){var t=r.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}var r=EJSS_INTERFACE.element(e),n=!1,i="";r.registerProperties=function(e){EJSS_INTERFACE.TextField.registerProperties(r,e)},r.enableEPub=function(){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(r.render=function(){r.enableEPub()}),r.setValue=function(e){n||("undefined"==typeof e?r.getDOMElement().value="value undefined":r.getDOMElement().value=e)},r.getValue=function(){return r.getDOMElement().value},r.setEditable=function(e){r.getDOMElement().readOnly=!e},r.getEditable=function(){return!r.getDOMElement().readOnly},r.setSize=function(e){r.getDOMElement().size=e},r.getSize=function(){return r.getDOMElement().size};var o=document.createElement("input");return o.id=e,o.type="text",document.body.appendChild(o),r.setDOMElement(o),r.getDOMElement().onkeydown=function(e){var o=r.getDOMElement();if(!o.readOnly){var s=e||window.event,a=s.which?s.which:s.keyCode;13==a?(n=!1,t(),i=r.getDOMElement().value):27==a?r.getDOMElement().value=i:(r.getStyle().setBackgroundColor("yellow"),n=!0)}},r.getDOMElement().onfocus=function(e){i=r.getDOMElement().value},r.getDOMElement().onblur=function(e){!e.readOnly&&n&&(t(),n=!1)},r.getDOMElement().ontouchstart=function(e){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1),r.getDOMElement().focus(),e.stop()},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TwoStateButton={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageUrlOn),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageUrlOff),t.registerProperty("State",e.setState,e.getState),t.registerAction("OnClick"),t.registerAction("OffClick")}},EJSS_INTERFACE.twoStateButton=function(e){function t(){n.getDOMElement().innerHTML="",l?(i.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+i+'"/>'),s.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+s.toString()+"</span>")):(o.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+o+'"/>'),a.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+a.toString()+"</span>"))}var r=EJSS_INTERFACE.TwoStateButton,n=EJSS_INTERFACE.element(e),i="",o="",s="",a="",l=-1;n.setTextOff=function(e){a=e,t()},n.getTextOff=function(){return a},n.setImageUrlOff=function(e){o=n.getResourcePath(e),t()},n.getImageUrlOff=function(){return o},n.setTextOn=function(e){s=e,t()},n.getTextOn=function(){return s},n.setImageUrlOn=function(e){i=n.getResourcePath(e),t()},n.getImageUrlOn=function(){return i},n.setState=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),e!=l&&(l=e,t())},n.getState=function(){return l},n.registerProperties=function(e){EJSS_INTERFACE.TwoStateButton.registerProperties(n,e)};var u=document.createElement("button");return u.id=e,u.style.verticalAlign="middle",document.body.appendChild(u),n.setDOMElement(u),n.getDOMElement().onclick=function(){var e=n.getState();n.setState(!e);var t=n.getController();return t&&(t.propertiesChanged("State"),e?t.invokeAction("OnClick"):t.invokeAction("OffClick"),t.reportInteractions()),!1},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Video={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("VideoUrl",e.setUrl),t.registerProperty("Background",e.setBackground,e.getBackground),t.registerProperty("PosterUrl",e.setPoster)}},EJSS_INTERFACE.video=function(e){var t=EJSS_INTERFACE.media(e),r=!1;t.setPoster=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().poster=e},t.getPoster=function(){return t.getDOMElement().poster},t.getBackground=function(){return r},t.setBackground=function(e){e!=r&&(r=e,r?(t.getStyle().setWidth("100%"),t.getStyle().setHeight("100%"),t.getStyle().setCSS({position:"absolute","z-index":"-100"})):(t.getStyle().setWidth(" "),t.getStyle().setHeight(" "),t.getStyle().setCSS({position:" ","z-index":" "})))},t.registerProperties=function(e){EJSS_INTERFACE.Video.registerProperties(t,e)};var n=document.createElement("video");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WebGLCanvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.webGLCanvas=function(e){var t,r=EJSS_INTERFACE.element(e),n=(EJSS_INTERFACE.WebGLCanvas,0),i=0;r.setWidth=function(e){return i!=e?(i=e,r.getDOMElement().setAttribute("width",i),!0):!1},r.getWidth=function(){return i},r.setHeight=function(e){return n!=e?(n=e,r.getDOMElement().setAttribute("height",n),!0):!1},r.getHeight=function(){return n},r.getContext=function(){return t},r.registerProperties=function(e){EJSS_INTERFACE.WebGLCanvas.registerProperties(r,e)};var o=document.createElement("canvas");o.setAttribute("id",e),o.setAttribute("width",500),o.setAttribute("height",500),document.body.appendChild(o),r.setDOMElement(o),r.getStyle().setBorderColor("black"),r.getStyle().setBorderWidth(2);try{t=o.getContext("webgl")}catch(s){}try{t=t||o.getContext("experimental-webgl")}catch(s){}try{t=t||o.getContext("webkit-3d")}catch(s){}try{t=t||o.getContext("moz-webgl")}catch(s){}if(!t){r.getStyle().setBackgroundColor("rgb(239,239,255)");var a=o.getContext("2d");a.font="bold 16px Arial",a.fillText("WebGL not supported!",100,100)}return r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WrappedPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Parent",e.setDoubleParent)}},EJSS_INTERFACE.wrappedPanel=function(e){if("undefined"==typeof _isEPub||!_isEPub)return EJSS_INTERFACE.panel(e);var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.WrappedPanel.registerProperties(t,e)},t.adjustPosition=function(){r.style.height=n.getBoundingClientRect().height+"px",r.style.width=n.getBoundingClientRect().width+"px";var e=r.getBoundingClientRect().top,t=r.getBoundingClientRect().left,i=document.body,o=document.documentElement,s=window.pageYOffset||o.scrollTop||i.scrollTop,a=window.pageXOffset||o.scrollLeft||i.scrollLeft;n.style.top=e+s+"px",n.style.left=t+a+"px"},t.setDoubleParent=function(e){if("string"==typeof e){var n=document.getElementById(e);n.appendChild(r)}else e.getDOMElement?e.getDOMElement().appendChild(r):e.appendChild(r);t.setParent(e)},t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)};var r=document.createElement("div");EJSS_INTERFACE.Style.setCSS(r,{display:"block","margin-left":"auto","margin-right":"auto","page-break-inside":"avoid"}),document.body.appendChild(r);var n=document.createElement("div");return n.id=e,n.contenteditable=!0,document.body.appendChild(n),t.setDOMElement(n),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({"page-break-inside":"avoid",display:"inline-block","margin-left":"auto","margin-right":"auto",position:"absolute"}),t.getDOMElement().ontouchstart=function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1},t};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Model={MODE_JAVA_STYLE:1,MODE_RESPECT_TIME:2,MODE_RESPECT_DELAY:3},EJSS_CORE.createAnimation=function(){function e(e){for(var t=0,r=e.length;r>t;t++)if(S=!1,e[t](),S)return}var t,r,n={},i=1,o="Choose a name for the file",s="Select a file to read",a=i,l=1,u=!1,g=!0,c=!1,S=!1,d=+new Date,f=!1,E=null,p=NaN,h=a,m=0,A=10,y=!0,D=!1,v=EJSS_CORE.Model.MODE_JAVA_STYLE;n.setView=function(e){E=e,E._setReportInteractionMethod(function(){f||E._readInteractions(M,r,f)&&(n.automaticResetSolvers(),n.update())})},n.getView=function(){return E},n.serialize=function(){var e={};n._userSerialize&&(e=n._userSerialize());var t=E.serialize(),r={model:e,view:t};return JSON.stringify(r,function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})},n.unserialize=function(e){var t=JSON.parse(e,function(e,t){return"__NaN"==t?t=NaN:"__Infinity"==t&&(t=1/0),t});if(t.model){var r=t.model;n._userUnserialize&&n._userUnserialize(r)}if(t.view){var i=t.view;E.unserialize(i)}};var P,I,_,R,C;n.sendCallback=function(){},n.setStatusParams=function(e,t,r,i,o,s){P=e,I=t,_=r,R=i,C=o,s&&(n.sendCallback=s)},n.sendSnapshot=function(e,t,r,n){if(R){var i=t.split(".").pop();i==t.split(".")[0]&&(i="");var o=t.split(".")[0]+"_context_id_"+P+"_user_id_"+I+"_ejsapp_id_"+_+i;e.importGraphics(function(e){var t=new XMLHttpRequest,i="user_file="+o+"&file="+encodeURIComponent(e)+"&type=png";t.open("POST",R,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&200==t.status?r&&r():n&&n()},t.send(i)})}},n.sendState=function(e,t,r){if(R){var i=e.split(".").pop();i==e.split(".")[0]&&(i="");var o=e.split(".")[0]+"_context_id_"+P+"_user_id_"+I+"_ejsapp_id_"+_+i,s=n.serialize(),a=new XMLHttpRequest,l="user_file="+o+"&file="+encodeURIComponent(s)+"&type=json";a.open("POST",R,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?t&&t():r&&r()},a.send(l)}},n.sendText=function(e,t,r,n,i){if(R){if(r)o="."+r;else{r="txt";var o="."+e.split(".").pop();o=="."+e.split(".")[0]&&(o="")}var s=e.split(".")[0]+"_context_id_"+P+"_user_id_"+I+"_ejsapp_id_"+_+o,a=new XMLHttpRequest,l="user_file="+s+"&file="+encodeURIComponent(t)+"&type="+r;a.open("POST",R,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?n&&n():i&&i()},a.send(l)}},n.getState=function(e,t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Cache-Control","no-cache"),i.onreadystatechange=function(){4==i.readyState&&200==i.status?(n.unserialize(i.responseText),t&&t()):r&&r()},i.send()},n.getText=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?t&&t(n.responseText):r&&r()},n.send()},n.getStateFiles=function(e,t,r){if(_){var i=(n.serialize(),new XMLHttpRequest),o=C+"?ejsapp_id="+_+"&type="+e;i.open("GET",o,!0),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var e=i.responseText.split(";"),n={};n.name=[],n.url=[];for(var o=0;o+1<e.length;o++)n.name.push(e[o]),n.url.push(e[++o]);t&&t(n)}else r&&r()},i.send()}},n.saveText=function(e,t,r){if(!r){var r=t;t=null}P?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendText(e,r,t,function(){n.sendCallback()})}):n.sendText(e,r,t,function(){n.sendCallback()})},n.saveState=function(e){P?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendState(e,function(){n.sendCallback()})}):n.sendState(e,function(){n.sendCallback()})},n.saveImage=function(e,t){P?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendSnapshot(E[t],e,function(){n.sendCallback()})}):n.sendSnapshot(E[t],e,function(){n.sendCallback()})},n.readState=function(e,t){if(e)n.getState(e);else{var r="undefined"!=typeof t?t:".json";n.getStateFiles(r,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(s,t,function(e){n.getState(e)})})}},n.readText=function(e,t,r){e?n.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,n._userUnserialize(t)}}):n.getStateFiles(t,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(s,t,function(e){n.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,n._userUnserialize(t)}})})})};var T,N,O=[],M=0,b={},G=!1;n.getEventInteractionsStream=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:e.timeStamp};n.runCount=M,n.runTime=r,n.event="mouse",T.send(JSON.stringify(n))},n.startCaptureStream=function(e,t,i,o,s){var a=window.location,l="https:"===a.protocol?"wss:":"ws:";l+="//"+a.host+":"+e;try{T=new WebSocket(l),"undefined"!=typeof t&&t(),T.onopen=o,T.onclose=function(e){n.stopCaptureStream(),s(e)},T.onmessage=function(e){console.log("Message is received: "+e.data)}}catch(u){return void("undefined"!=typeof i&&i(u))}M=0,r=+new Date,E.registerInteractions(T),document.addEventListener("mousemove",n.getEventInteractionsStream),document.addEventListener("touchmove",n.getEventInteractionsStream),document.addEventListener("mousedown",n.getEventInteractionsStream),document.addEventListener("touchstart",n.getEventInteractionsStream)},n.stopCaptureStream=function(){try{T.close()}catch(e){}E.unregisterInteractions(),document.removeEventListener("mousemove",n.getEventInteractionsStream),document.removeEventListener("touchmove",n.getEventInteractionsStream),document.removeEventListener("mousedown",n.getEventInteractionsStream),document.removeEventListener("touchstart",n.getEventInteractionsStream)},n.playCaptureStream=function(e,t,n,i,o){var s=10;if(!G){G=!0;var a=[];try{N=new EventSource(e),"undefined"!=typeof t&&t(),N.onopen=i,N.onclose=function(e){var t=document.getElementById("_my_mouse");t&&document.body.removeChild(t),o(e)},N.onmessage=function(e){var t=JSON.parse(e.data);console.log("Now: "+Date.now()+"-"+t.timeStamp),a=a.concat(t.interactions)}}catch(l){return void("undefined"!=typeof n&&n(l))}setTimeout(function(){M=0,r=+new Date,W=[];var e=0,t=M,n=0,i=0,o=0,l=setInterval(function(){for(var r=e;r<a.length;){var u=a[r++];if("undefined"!=typeof u.isPlaying&&u.isPlaying)W.push(u),e++;else if(u.runCount<=t&&n>=u.timeStamp-u.runTime){e++;for(var g in b){var c=E[g];c.getDOMElement().style.border=b[g]}if(b={},"undefined"!=typeof u.event){var S=u.pageX,d=u.pageY,f=u.target;if("undefined"!=typeof f&&f.length>0){var c=document.getElementById(f);i=u.offsetLeft-c.offsetLeft,o=u.offsetTop-c.offsetTop}S-=i,d+=o;var p=document.getElementById("_my_mouse");if(!p){var p=document.createElement("div");p.id="_my_mouse",p.style.position="absolute",p.style.margin="0",p.style.border="3px solid red",document.body.appendChild(p)}p.style.left=S+"px",p.style.top=d+"px"}else if("undefined"!=typeof u.property){var c=E[u.element];c.propertyChanged(u.property,u.data).reportInteractions()}else if("undefined"!=typeof u.action){var c=E[u.element];c.invokeAction(u.action).reportInteractions(),"undefined"==typeof b[c.getName()]&&(b[c.getName()]=c.getDOMElement().style.border),c.getDOMElement().style.border="1px solid red"}}}t!=M?(t=M,n=0):n+=s,G||clearInterval(l)},s)},1e3)}},n.pauseCaptureStream=function(){try{N.close()}catch(e){}G=!1},n.getEventInteractions=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:e.timeStamp};n.runCount=M,n.runTime=r,n.event="mouse",O.push(n)},n.startCapture=function(){M=0,r=+new Date,E.registerInteractions(),O=[],document.addEventListener("mousemove",n.getEventInteractions),document.addEventListener("touchmove",n.getEventInteractions),document.addEventListener("mousedown",n.getEventInteractions),document.addEventListener("touchstart",n.getEventInteractions)},n.stopCapture=function(){E.unregisterInteractions(),document.removeEventListener("mousemove",n.getEventInteractions),document.removeEventListener("touchmove",n.getEventInteractions),document.removeEventListener("mousedown",n.getEventInteractions),document.removeEventListener("touchstart",n.getEventInteractions);var e={interactions:E.getRegInteractions(),events:O};return e},n._readCapturedInteractions=function(){for(var e=W.length,t=0;e>t;t++){var r=W[t];if(r.runCount==M&&r.isPlaying){if("undefined"!==r.property){var n=E[r.element];n.propertyChanged(r.property,r.data).reportInteractions()}if("undefined"!==r.action){var n=E[r.element];n.invokeAction(r.action).reportInteractions(),"undefined"==typeof b[n.getName()]&&(b[n.getName()]=n.getDOMElement().style.border),n.getDOMElement().style.border="1px solid red"}r.runCount=-1}}};var x=!1,L=!1,J=1,w=!1,W=[];n.playCapture=function(e,t,i){var o=10,s=e.interactions,l=s.length,u=0,g=e.events,c=g.length,S=0;if(!x){x=!0,L=!1,n.reset(),"undefined"!=typeof i&&(J=i),a/=J,M=0,r=+new Date,W=s;var d=M,f=0,p=0,h=0,m=setInterval(function(){for(var e in b){var r=E[e];r.getDOMElement().style.border=b[e]}if(b={},x){for(;l>u&&s[u].runCount<=d&&f>=s[u].timeStamp-s[u].runTime;){if(!s[u].isPlaying){if("undefined"!==s[u].property){var r=E[s[u].element];r.propertyChanged(s[u].property,s[u].data).reportInteractions()}if("undefined"!==s[u].action){var r=E[s[u].element];r.invokeAction(s[u].action).reportInteractions(),"undefined"==typeof b[r.getName()]&&(b[r.getName()]=r.getDOMElement().style.border),r.getDOMElement().style.border="1px solid red"}}u++}for(;c>S&&g[S].runCount<=d&&f>=g[S].timeStamp-g[S].runTime;){var n=g[S].pageX,i=g[S].pageY,A=g[S].target;if("undefined"!=typeof A&&A.length>0){var r=document.getElementById(A);p=g[S].offsetLeft-r.offsetLeft,h=g[S].offsetTop-r.offsetTop}n-=p,i+=h;var y=document.getElementById("_my_mouse");if(!y){var y=document.createElement("div");y.id="_my_mouse",y.style.position="absolute",y.style.margin="0",y.style.border="3px solid red",document.body.appendChild(y)}y.style.left=n+"px",y.style.top=i+"px",S++}if(d!=M?(d=M,f=0):f+=o*J,S>=c&&u>=l){var y=document.getElementById("_my_mouse");y&&document.body.removeChild(y),clearInterval(m),x=!1,a*=J,W=[],t()}}L&&(clearInterval(m),x=!1,a*=J,W=[],t())},o)}},n.pauseCapture=function(){w=f,n.pause(),x=!1},n.resumeCapture=function(){w&&n.play(),x=!0},n.resetCapture=function(){L=!0},n.changeCaptureStep=function(e){a*=J,J=e,a/=J},n.setMode=function(e){n.setRunningMode(e)},n.setRunningMode=function(e){v="string"==typeof e?EJSS_CORE.Model[e.toUpperCase()]:e},n.getMode=function(){return v},n.setRunAlways=function(e){D=e},n.setPauseOnPageExit=function(e){D=!e},n.setFPS=function(e){a=Math.max(1e3/e,i)},n.getFPS=function(){return Math["int"](1e3/a)},n.setDelay=function(e){a=Math.max(e,0)},n.setMinimumDelay=function(e){A=Math.max(e,0)},n.setStepsPerDisplay=function(e){e>=1&&(l=e)},n.setUpdateView=function(e){g=e},n.setAutoplay=function(e){c=e},n.isPlaying=function(){return f},n.isPaused=function(){return!f},n.resetRealTime=function(){var e=+Date();p=1e3*n.getRealTime()-e},n.play=function(){f||(d=+new Date,h=a,f=!0,t=window.setTimeout(n.run,A))},n.pause=function(){f=!1,u=!0,0!=t&&(window.clearTimeout(t),t=0)},n.run=function(){M++,r=+new Date;var e,i=1;if(f){if(y||D){switch(v){default:case EJSS_CORE.Model.MODE_JAVA_STYLE:n.step(),d=+new Date,e=d-r,i=Math.max(A,a-e);break;case EJSS_CORE.Model.MODE_RESPECT_DELAY:n.step(),i=a,d=+new Date;break;case EJSS_CORE.Model.MODE_RESPECT_TIME:if(e=r-d,e>=h-m){var o=0;h&&(o=Math.floor((e+m)/h),m=e+m-o*h);var s=n.step(o);h&&s>e&&o>100&&(alert("Imposible running with delay "+h+" ms."),f=!1,m=0),h=a,d=r}}var l=t;if(n._readCapturedInteractions(),E._readInteractions(M,r,f)&&(n.automaticResetSolvers(),n.update()),l!=t)return}else d=+new Date;t=window.setTimeout(n.run,i)}},n.onExit=function(){n.pause(),E._readInteractions(M,r,f),n.freeMemory()},n.reset=function(e){e||(n.pause(),n.resetModel()),E._setReportNeeded(!1),E._reset(),e||(E._initValues(),E._initialize(),n.initializeModel()),n.updateModel(),g?(E._update(),E._render()):E._collectData(),E._setReportNeeded(!0),c&&n.play(),E._resized(window.innerWidth,window.innerHeight)},n.initialize=function(){E._initialize(),n.initializeModel(),n.updateModel(),g?(E._update(),E._render()):E._collectData()},n.update=function(){(y||D)&&(n.updateModel(),g?(E._update(),E._render()):E._collectData())},n.step=function(e){var t=+new Date;e||(e=1);var r=Math.max(e,l);if(r>1){u=!1;for(var i=1;r>i;i++){if(u)return void n.update();n.stepModel(),n.updateModel(),E._collectData()}}n.stepModel();var o=+new Date-t;return n.update(),o},n.setShouldBreak=function(e){S=e},n.getShouldBreak=function(){return S},n._autoSelectView=function(e){for(var t=screen.height,r=screen.width,n=[],i=Number.MAX_VALUE,o=0;o<e.length;o++){var s=r-e[o].width;s>=0&&(i>s?(i=s,n=[o]):s==i&&n.push(o))}var a=-1;i=Number.MAX_VALUE;for(var o=0;o<n.length;o++){var s=Math.abs(t-e[n[o]].height);i>s&&(i=s,a=n[o])}return a};var k=[],V=[],F=[],B=[];return n.getRealTime=function(){return NaN},n.automaticResetSolvers=function(){},n.freeMemory=function(){},n.addToReset=function(e){k.push(e)},n.addToInitialization=function(e){V.push(e)},n.addToEvolution=function(e){F.push(e)},n.addToFixedRelations=function(e){B.push(e)},n.resetModel=function(){e(k)},n.initializeModel=function(){e(V)},n.stepModel=function(){e(F)},n.updateModel=function(){e(B)},window.onblur=function(){y=!1},window.onfocus=function(){y=!0},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Bootstrap2IntervalData={},EJSS_ODE_INTERPOLATION.bootstrap2IntervalData=function(e,t,r,n,i){var o,s,a,l,u=EJSS_ODE_INTERPOLATION.bootstrapIntervalData(e,t,r,n,i);u.interpolate=function(e,t){var r=u.getDeltaTime(),n=u.getLeftState(),i=u.getLeftRate(),g=(e-u.getLeft())/r;return n[t]+g*(r*i[t]+g*(o[t]+g*(s[t]+g*(a[t]+g*l[t]))))},u.interpolateState=function(e,t,r,n){return u.bootstrap2((e-u.getLeft())/u.getDeltaTime(),t,r,n),t},u.bootstrap2=function(e,t,r,n){for(var i=u.getDeltaTime(),g=u.getLeftState(),c=u.getLeftRate(),S=r,d=0;n>d;d++)t[d]=g[S]+e*(i*c[S]+e*(o[S]+e*(s[S]+e*(a[S]+e*l[S])))),S++};var g=.7,c=.85,S=2*g*(g-1)*c*(c-1)*(c-g)*(10*g*c-5*c-5*g+3),d=g*(-3*g+2),f=g*(-3*g+4)-1,E=6*g*(g-1),p=c*(-3*c+2),h=c*(-3*c+4)-1,m=6*c*(c-1),A=g*(2+g*(-6+4*g)),y=c*(2+c*(-6+4*c)),D=g*(4+g*(-9+5*g*g)),v=c*(4+c*(-9+5*c*c)),P=e.length,I=P-1,_=u.getDeltaTime(),R=new Array(P),C=new Array(P),T=new Array(P);o=new Array(P),s=new Array(P),a=new Array(P),l=new Array(P),u.bootstrap1(g,R,0,I),R[I]=u.getLeft()+g*_,i.getRate(R,C),u.bootstrap1(c,R,0,I),R[I]=u.getLeft()+c*_,i.getRate(R,T);for(var N=0;P>N;N++){var O=r[N]-e[N],M=_*t[N],b=_*n[N],G=_*C[N]+d*b+f*M+E*O,x=_*T[N]+p*b+h*M+m*O,L=(v*G-D*x)/S,J=(A*x-y*G)/S,w=b+M-2*O-2*L-3*J;l[N]=J,a[N]=L,s[N]=w,o[N]=O-M-w-L-J}return u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.BootstrapIntervalData={},EJSS_ODE_INTERPOLATION.bootstrapIntervalData=function(e,t,r,n,i){var o,s,a,l=EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,n);l.interpolate=function(e,t){var r=l.getDeltaTime(),n=l.getLeftState(),i=l.getLeftRate(),u=(e-l.getLeft())/r;return n[t]+u*(r*i[t]+u*(o[t]+u*(s[t]+u*a[t])))},l.interpolateState=function(e,t,r,n){return l.bootstrap1((e-l.getLeft())/l.getDeltaTime(),t,r,n),t},l.bootstrap1=function(e,t,r,n){for(var i=l.getDeltaTime(),u=l.getLeftState(),g=l.getLeftRate(),c=r,S=0;n>S;S++)t[S]=u[c]+e*(i*g[c]+e*(o[c]+e*(s[c]+e*a[c]))),c++};var u=.25,g=u*(u-1)*(4*u-2),c=u*(-3*u+2),S=u*(-3*u+4)-1,d=6*u*(u-1),f=e.length,E=l.getDeltaTime(),p=new Array(f),h=new Array(f);o=new Array(f),s=new Array(f),a=new Array(f),l.hermite(u,p,0,f-1),p[f-1]=l.getLeft()+u*E,i.getRate(p,h);for(var m=0;f>m;m++){var A=r[m]-e[m],y=E*t[m],D=E*n[m],v=(E*h[m]+c*D+S*y+d*A)/g,P=D+y-2*A-2*v;a[m]=v,s[m]=P,o[m]=A-y-P-v}return l};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ConstantConditionData={},EJSS_ODE_INTERPOLATION.constantConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(e,r){return t[r]},r.interpolateState=function(e,r,n,i){for(var o=n,s=0;i>s;s++)r[s]=t[o],o++;return r};var n=e.length;t=new Array(n);for(var i=0;n>i;i++)t[i]=e[i];return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri5IntervalData={},EJSS_ODE_INTERPOLATION.dopri5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*o[4][t])))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),s=1-o,a=n.getCoeffs(),l=r,u=0;i>u;u++)t[u]=a[0][l]+o*(a[1][l]+s*(a[2][l]+o*(a[3][l]+s*a[4][l]))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri853IntervalData={},EJSS_ODE_INTERPOLATION.dopri853IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*(o[4][t]+r*(o[5][t]+i*(o[6][t]+r*o[7][t]))))))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),s=1-o,a=n.getCoeffs(),l=r,u=0;i>u;u++)t[u]=a[0][l]+o*(a[1][l]+s*(a[2][l]+o*(a[3][l]+s*(a[4][l]+o*(a[5][l]+s*(a[6][l]+o*a[7][l])))))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerIntervalData={},EJSS_ODE_INTERPOLATION.eulerIntervalData=function(e,t,r){var n,i,o=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);o.interpolate=function(e,t){var r=e-o.getLeft();return n[t]+r*i[t]},o.interpolateState=function(e,t,r,s){for(var a=e-o.getLeft(),l=r,u=0;s>u;u++)t[u]=n[l]+a*i[l],l++;return t};var s=e.length;n=new Array(s),i=new Array(s);for(var a=0;s>a;a++)n[a]=e[a],i[a]=t[a];return o};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerRichardsonIntervalData={},EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData=function(e,t,r,n){var i,o,s,a,l,u=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);u.interpolate=function(e,t){var r=(e-u.getLeft())/o,n=r*r*o,i=o*r-n;return s[t]+i*a[t]+n*l[t]},u.interpolateState=function(e,t,r,n){for(var i=(e-u.getLeft())/o,g=i*i*o,c=o*i-g,S=r,d=0;n>d;d++)t[d]=s[S]+c*a[S]+g*l[S],S++;return t};var g=e.length;s=new Array(g),a=new Array(g),l=new Array(g);for(var c=0;g>c;c++)s[c]=e[c],a[c]=t[c],l[c]=n[c];return i=g-1,o=r-e[i],u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ExtraStepsIntervalData={},EJSS_ODE_INTERPOLATION.extraStepsIntervalData=function(e,t,r){var n,i,o,s=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],t[t.length-1]);s.getTimeIndex=function(){return n},s.getDeltaTime=function(){return i},s.getCoeffs=function(){return o};var a=e.length;n=a-1,i=t[n]-e[n];var l=r.length;o=new Array(l);for(var u=0;l>u;u++){o[u]=new Array(a);for(var g=0;a>g;g++)o[u][g]=r[u][g]}return s};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.HermiteIntervalData={},EJSS_ODE_INTERPOLATION.hermiteIntervalData=function(e,t,r,n){var i,o,s,a,l,u,g=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r[r.length-1]);g.getTimeIndex=function(){return i},g.getDeltaTime=function(){return o},g.getLeftState=function(){return s},g.getLeftRate=function(){return a},g.interpolate=function(e,t){var r=(e-g.getLeft())/o,n=r-1,i=r*n,c=i*(1-2*r),S=-n-c,d=r+c,f=i*n*o,E=i*r*o;return S*s[t]+d*l[t]+f*a[t]+E*u[t]},g.interpolateState=function(e,t,r,n){return g.hermite((e-g.getLeft())/o,t,r,n),t},g.hermite=function(e,t,r,n){for(var i=e-1,g=e*i,c=g*(1-2*e),S=-i-c,d=e+c,f=g*i*o,E=g*e*o,p=r,h=0;n>h;h++)t[h]=S*s[p]+d*l[p]+f*a[p]+E*u[p],p++};var c=e.length;s=new Array(c),a=new Array(c),l=new Array(c),u=new Array(c);for(var S=0;c>S;S++)s[S]=e[S],a[S]=t[S],l[S]=r[S],u[S]=n[S];return i=c-1,o=r[i]-e[i],g};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.InitialConditionData={},EJSS_ODE_INTERPOLATION.initialConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(r,n){return e.getInitialCondition(r,t),t[n]},r.interpolateState=function(r,n,i,o){e.getInitialCondition(r,t);for(var s=i,a=0;o>a;a++)n[a]=t[s],s++;return n};var n=e.getState(),i=n.length;return t=new Array(i),r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.IntervalData={},EJSS_ODE_INTERPOLATION.intervalData=function(e,t){var r={};return r.getLeft=function(){return e},r.getRight=function(){return t},r.setRight=function(e){t=e},r.interpolate=function(e,t){return Number.NaN},r.interpolateState=function(e,t,r,n){return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Radau5IntervalData={},EJSS_ODE_INTERPOLATION.radau5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r),i=bState[bState.length-1];return n.interpolate=function(e,t){var r=(e-i)/n.getDeltaTime(),o=n.getCoeffs(),s=EJSS_ODE_SOLVERS.Radau5.c1m1,a=EJSS_ODE_SOLVERS.Radau5.c2m1;return o[0][t]+r*(o[1][t]+(r-a)*(o[2][t]+(r-s)*o[3][t]))},n.interpolateState=function(e,t,r,o){for(var s=(e-i)/mDeltaTime,a=n.getCoeffs(),l=EJSS_ODE_SOLVERS.Radau5.c1m1,u=EJSS_ODE_SOLVERS.Radau5.c2m1,g=r,c=0;o>c;c++)t[c]=a[0][g]+s*(a[1][g]+(s-u)*(a[2][g]+(s-l)*a[3][g])),g++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.StateHistory={},EJSS_ODE_INTERPOLATION.stateHistory=function(e){var t,r={},n=[],i=!0,o=0,s=0,a=0;return r.setLength=function(e){s=Math.abs(e),a=Math.max(o,s)},r.setMinimumLength=function(e){o=Math.abs(e),a=Math.max(o,s)},r.addIntervalData=function(e){i=e.getLeft()<=e.getRight();n.length;if(n.length>0){var t=n.length-1,r=n[t],o=0;if(i){for(;null!=r&&r.getLeft()>=e.getLeft();)o++,t--,r=0>t?null:n[t];null!=r&&e.getLeft()<r.getRight()&&r.setRight(e.getLeft())}else{for(;null!=r&&r.getLeft()<=e.getLeft();)o++,t--,r=0>t?null:n[t];null!=r&&e.getLeft()>r.getRight()&&r.setRight(e.getLeft())}o>0&&n.splice(t,o)}n.push(e)},r.toString=function(){for(var e="History has now "+n.length+" intervals: ",t=0,r=n.length;r>t;t++){var i=n[t];t>0&&(e+=", "),e+=" ["+i.getLeft()+","+i.getRight()+")"}return e},r.clearAll=function(){n=[]},r.clean=function(e){if(isFinite(a)){if(0==a)return void clearAll();var t=0,r=n.length;if(i){e-=a;for(var o=0;r>o;o++){var s=n[o];if(s.getRight()>e)break;t++}}else{e+=a;for(var o=0;r>o;o++){var s=n[o];if(s.getRight()<e)break;t++}}t>0&&n.splice(0,t)}},r.findInterval=function(e){var r=n.length;if(i)for(var o=r-1;o>=0;o--){var s=n[o];if(s.getLeft()<=e)return s}else for(var o=r-1;o>=0;o--){var s=n[o];if(s.getLeft()>=e)return s}return t},r.interpolate=function(e,t){var n=r.findInterval(e);return n.interpolate(e,t)},r.interpolateState=function(e,t,n,i){var o=r.findInterval(e);return i||(i=t.length),n||(n=0),o.interpolateState(e,t,n,i)},e.getInitialCondition?(t=EJSS_ODE_INTERPOLATION.initialConditionData(e),e.setStateHistory(r)):t=EJSS_ODE_INTERPOLATION.constantConditionData(e.getState()),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EVENT_TYPE={STATE_EVENT:0,POSITIVE_EVENT:1,CROSSING_EVENT:2},EJSS_ODE_SOLVERS.EVENT_METHOD={BISECTION:0,SECANT:1},EJSS_ODE_SOLVERS.ERROR={NO_ERROR:0,INTERNAL_SOLVER_ERROR:1,EVENT_NOT_FOUND:2,ILLEGAL_EVENT_STATE:3,ZENO_EFFECT:4,TOO_MANY_STEPS_ERROR:5,DISCONTINUITY_PRODUCED_ERROR:6,DID_NOT_CONVERGE:7},EJSS_ODE_SOLVERS.DISCONTINUITY_CODE={DISCONTINUITY_PRODUCED_ERROR:0,NO_DISCONTINUITY_ALONG_STEP:1,DISCONTINUITY_ALONG_STEP:2,DISCONTINUITY_JUST_PASSED:3,DISCONTINUITY_EXACTLY_ON_STEP:4},EJSS_ODE_SOLVERS.InterpolatorEventSolver={},EJSS_ODE_SOLVERS.interpolatorEventSolver=function(e,t){function r(t,r){h?e.bestInterpolate(t,r):e.interpolate(t,r)}function n(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];if(o+i[S]==o)return 0;var s=e.getMaximumTime(!1);return isNaN(s)?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]):o==s&&(s=e.internalStep(!1),isNaN(s))?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at max step at "+n[S]):(r(s,n),s-o)}function i(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];
if(o+i[S]==o)return 0;var s=n[S]+m,a=e.getMaximumTime(!1);if(isNaN(a))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);var l=0;if(R)for(;s>a;){if(a=e.internalStep(!1),isNaN(a))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);if(++l>_){var u=n[S],g=e.bestInterpolate(s,new Array(c))[S];return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the maximum of "+_+" internal steps\nat "+g+", starting from "+u+" for an step of "+m)}}else for(;a>s;){if(a=e.internalStep(!1),isNaN(a))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver backwards at "+n[S]);if(++l>_)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S])}return r(s,n),m}function o(){var n=t.getState();if(v>0&&L>v&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var s=e.getMaximumTime(k);if(isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);if(i==s&&(s=e.internalStep(k),isNaN(s)))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);null!=x&&(isNaN(x.getMaxAdvance())||(s=R?Math.min(s,x.getMaxAdvance()):Math.max(s,x.getMaxAdvance())));for(var u=R?Math.min(i+D,s):Math.max(i-D,s);;){var g=null;if(w=null,r(u,d),g=E.findFirstEvent(n,u,d),null==g&&null!=V&&V.getTime()<=u&&(g=V),null!=g){if(w=g,h)e.bestInterpolate(g.getTime(),n);else for(var f=0;c>f;f++)n[f]=d[f];var p=n[S];return g.action(),E.reinitialize(),n=t.getState(),p!=n[S]?(L=0,x=null,w=null,g.reset(n),g.getTime()-i):(null!=x&&(Math.abs(G-g.getTime())<P?L++:L=0),x=g,G=g.getTime(),g.getTime()-i)}if(u==s){for(var f=0;c>f;f++)n[f]=d[f];return a(n[S]),s-i}u=R?Math.min(u+D,s):Math.max(u-D,s)}}function s(){var n=t.getState();if(v>0&&L>v&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var s=i+m,u=e.getMaximumTime(k);if(isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);for(var g=R?Math.min(i+D,s):Math.max(i-D,s),f=0;;){var p=null;w=null;var A=R?g>u:u>g;if(A){if(e.bestInterpolate(u,d),p=E.findFirstEvent(n,u,d),null==p&&(p=V),null==p){for(var y=0;c>y;y++)n[y]=d[y];if(a(n[S]),u=e.internalStep(k),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver looking for an event at "+n[S]);if(++f>_)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S]);continue}}else if(r(g,d),p=E.findFirstEvent(n,g,d),null==p&&null!=V&&V.time<=g&&(p=V),null==p){if(g==s){for(var y=0;c>y;y++)n[y]=d[y];return a(n[S]),s-i}g=R?Math.min(g+D,s):Math.max(g-D,s);continue}if(w=p,h)e.bestInterpolate(p.getTime(),n);else for(var y=0;c>y;y++)n[y]=d[y];var C=n[S],T=p.action();if(E.reinitialize(),f=0,n=t.getState(),C!=n[S])return L=0,x=null,w=null,p.reset(n),p.getTime()-i;if(null!=x&&(Math.abs(G-p.getTime())<P?(L++,I&&(T=!1)):L=0),x=p,G=p.getTime(),T)return p.getTime()-i;if(v>0&&L>v&&l(n))return p.getTime()-i;if(V=null,u=e.getMaximumTime(k),isNaN(p.getMaxAdvance())||(u=R?Math.min(u,p.getMaxAdvance()):Math.max(u,p.getMaxAdvance())),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver after an event at "+n[S])}}function a(e){var t,r;for(r=O.length,t=0;r>t;t++){var n=O[t];n.findPosition(e,n.getH())}for(r=F.length,t=0;r>t;t++){var n=F[t];n.findPosition(e,n.getH())}}function l(e){if(J.length<=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ZENO_EFFECT,"A Zeno-like effect has been detected.\nLast event was "+x.getProblem()+" which took place at "+G),!0;var t,r=!1,n=J.length;for(t=0;n>t;t++){var i=J[t];i.zenoEffectAction(x.getProblem(),e)&&(r=!0)}return L=0,r}function u(e,t,r,n){r.splice(0,r.length);for(var i=O.length,o=0;i>o;o++){var s=O[o];switch(s.setH(s.getEvent().evaluate(t)),s.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:s.getH()<=0&&r.push(s);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(s.getH()<=0&&(s.hasPositiveFlag()||s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT))return s;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(s.getH()<0){if(s.hasPositiveFlag()||s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return s}else if(s.getH()>0&&s.hasNegativeFlag()&&s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)return s;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT){if(s.getH()<=-s.getEvent().getTolerance())return s}else if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT&&s.hasNegativeFlag()&&s.getH()>=0)return s;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)s.getH()>=0&&r.push(s);else if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e+" for the state event "+s.getEvent()),s}}return null}function g(e,t,r){var n,i,o=e.length,s=r,a=r-t,l=(t+r)/2;if(R)for(n=0;o>n;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:s=Math.min(s,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),s=Math.min(s,t-i*a/(u.getHAfter()-i))}}else for(n=0;o>n;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:s=Math.max(s,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),s=Math.max(s,t-i*a/(u.getHAfter()-i))}}return s}var c,S,d,f,E={},p=!0,h=!1,m=.1,A=Number.NaN,y=Number.NaN,D=Number.POSITIVE_INFINITY,v=500,P=2*Number.MIN_VALUE,I=!0,_=1e4,R=m>0,C=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",N=0,O=[],M=[],b=[],G=Number.NaN,x=null,L=0,J=[],w=null,W=!1,k=!1,V=null,F=[],B=null,z=100,H=1e-8,Y=Number.NaN;return E.getEPSILON=function(){if(isNaN(Y)){for(Y=1;Y+1!=1;)Y/=2;Y*=2}return Y},E.setEnableExceptions=function(e){p=e},E.setBestInterpolation=function(e){h=e},E.setHistoryLength=function(t){e.getStateHistory().setLength(t)},E.setStepSize=function(t){m!=t&&(m=t,R=m>0,E.setInternalStepSize(e.getStepSize()))},E.getStepSize=function(){return m},E.setEstimateFirstStep=function(t){e.setEstimateFirstStep(t)},E.setInternalStepSize=function(t){e.setStepSize(R?Math.abs(t):-Math.abs(t))},E.setMaximumInternalStepSize=function(t){e.setMaximumStepSize(t)},E.setMaximumInternalSteps=function(e){_=e},E.setTolerances=function(t,r){e.setTolerances(A=Math.abs(t),y=Math.abs(r))},E.setTolerance=function(e){setTolerances(e,0)},E.getTolerance=function(){return Math.max(A,y)},E.setDDETolerance=function(e){H=e},E.getDDETolerance=function(){return H},E.setDDEIterations=function(e){z=e},E.getDDEIterations=function(){return z},E.addEvent=function(e){O.push(EJSS_ODE_SOLVERS.eventData(E,e,t.getState())),W=!0},E.removeEvent=function(e){for(var t=-1,r=O.length,n=0;r>n;n++){var i=O[n];if(i.getEvent()==e){t=n;break}}if(t>=0){var o=O[t];x==o&&(x=null,L=0),w==o&&(w=null),O.splice(t,1)}W=k||O.length>0},E.addDiscontinuity=function(e){F.push(EJSS_ODE_SOLVERS.discontinuityData(E,e,t.getState())),k=!0,W=!0},E.removeDiscontinuity=function(e){for(var t=-1,r=F.length,n=0;r>n;n++){var i=F[n];if(i.getDiscontinuity()==e){t=n;break}}t>=0&&F.splice(t,1),k=F.length>0,W=k||O.length>0},E.removeAllEvents=function(){O=[],F=[],k=!1,W=!1,null!=B&&E.addDiscontinuity(B)},E.setMaximumEventStep=function(e){D=Math.abs(e)},E.getMaximumEventStep=function(){return D},E.setCoalesceCloseEvents=function(e){I=e},E.isCoalesceCloseEvents=function(){return I},E.setEventProximityThreshold=function(e){P=e},E.getEventProximityThreshold=function(){return P},E.setZenoEffectDetection=function(e){v=e},E.getZenoEffectDetection=function(){return v},E.addZenoEffectListener=function(e){J.push(e)},E.removeZenoEffectListener=function(e){for(var t=J.length,r=0;t>r;r++)if(J[r]==e)return void J.splice(r,1)},E.setZeroZenoCounter=function(){L=0},E.getSolverEngine=function(){return e},E.getODE=function(){return t},E.getStateHistory=function(){return e.getStateHistory()},E.getErrorCode=function(){return C},E.getErrorMessage=function(){return T},E.getCounter=function(){return e.getCounter()},E.getNumberOfAttempts=function(){return N},E.getInternalStepSize=function(){return e.getInternalStepSize()},E.getIndependentVariableValue=function(){return t.getState()[S]},E.getCurrentTime=function(){return t.getState()[S]},E.getRunsForwards=function(){return R},E.getCurrentEventData=function(){return w},E.getLastEventData=function(){return x},E.getLastEventDataTime=function(){return G},E.initialize=function(r){var n,i,o;for(m=r,R=m>0,e.initialize(m),o=t.getState(),c=o.length,S=c-1,d=new Array(c),f=new Array(c),C=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",L=0,x=null,w=null,null!==B&&(B.initialize(o),E.removeDiscontinuity(B),E.addDiscontinuity(B)),i=O.length,n=0;i>n;n++)O[n].reset(o);for(i=F.length,n=0;i>n;n++)F[n].reset(o)},E.step=function(){return W?s():i()},E.maxStep=function(){return W?o():n()},E.userReinitialize=function(){w=null,E.reinitialize()},E.reinitialize=function(){var r,n,i=t.getState();for(e.reinitialize(i),C=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",null!=B&&B.reset(i),n=O.length,r=0;n>r;r++)O[r].reset(i);for(n=F.length,r=0;n>r;r++)F[r].reset(i);V=null},E.resetDiscontinuities=function(e){if(null!==B){B.reset(e);for(var t=F.length,r=0;t>r;r++)F[r].reset(e)}},E.checkDiscontinuity=function(e,t){for(var r=F.length,n=null,i=0;r>i;i++){var o=F[i],s=o.getDiscontinuity().evaluate(e);switch(o.setH(s),o.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:if(0>=s)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;s<o.getDiscontinuity().getTolerance()&&(n=o);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(0>=s&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(0>s&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;if(s>0&&o.hasNegativeFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(o.hasNegativeFlag()&&s>=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(s>0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;s>-o.getDiscontinuity().getTolerance()&&(n=o)}}return null!=n?(t&&(V=n,V.setTime(e[S])),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP):EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},E.error=function(t,r){if(C=t,T=r,p)throw{name:"ODE Solver exception",solver:e,message:r};return Number.NaN},E.findFirstEvent=function(t,n,i){var o,s;N=0;var a=u(t[S],i,M,"at t1");if(null!=a){for(a.time=t[S],a.maxAdvance=n,o=0;c>o;o++)i[o]=t[o];return a}if(M.length<=0)return null;var l=!0;for(s=O.length,o=0;s>o;o++){var d=O[o];d.setHAfter(d.getH())}for(;l;){N++;var p=g(M,t[S],n);r(p,f);var h=u(t[S],f,b,"short");if(null!=h){for(h.time=t[S],h.maxAdvance=p,o=0;c>o;o++)i[o]=t[o];return h}if(b.length<=0){var m=null;for(s=M.length,o=0;s>o;o++){var d=M[o];if(d.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(d.getH()<d.getEvent().getTolerance()){m=d;break}}else if(d.getH()>-d.getEvent().getTolerance()){m=d;break}}if(null!=m){for(m.time=p,m.maxAdvance=n,o=0;c>o;o++)i[o]=f[o];return m}for(o=0;c>o;o++)t[o]=f[o];for(s=O.length,o=0;s>o;o++){var d=O[o];d.findPosition(t[S],d.getH())}var A=u(t[S],i,M,"at tTest");if(null!=A){for(A.time=t[S],A.maxAdvance=n,o=0;c>o;o++)i[o]=t[o];return A}}else{var y=!0,m=null;for(s=b.length,o=0;s>o;o++){var D=b[o];if(D.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(D.getH()<=-D.getEvent().getTolerance()){y=!1;break}m=D}else{if(D.getH()>=D.getEvent().getTolerance()){y=!1;break}m=D}}if(y&&null!=m){for(m.time=p,m.maxAdvance=n,o=0;c>o;o++)i[o]=f[o];return m}for(n=p,o=0;c>o;o++)i[o]=f[o];for(s=O.length,o=0;s>o;o++){var d=O[o];d.setHAfter(d.getH())}for(M=[],s=b.length,o=0;s>o;o++)M.push(b[o])}for(s=M.length,o=0;s>o;o++){var D=M[o];if(N>D.getEvent().getMaxIterations()){l=!1;break}}}var v=M[0];return E.error(EJSS_ODE_SOLVERS.ERROR.EVENT_NOT_FOUND,"Warning : Event not found after "+N+" attempts at t="+t[S]+" h = "+v.getH()+".\nPlease check the code of your event, decrease the initial step size, the tolerance of the solver,\nor the event maximum step, or increase the maximum number of attempts.\nFirst event remaining in the queue: "+v.getEvent()),v.setTime((t[S]+n)/2),v.setMaxAdvance(Number.NaN),e.bestInterpolate(v.time,i),v},t.getDelays&&(B=EJSS_ODE_SOLVERS.ddeDiscontinuity(E,t)),e.setODE(E,t),E};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.BogackiShampine23={B3_1:2/9,B3_2:1/3,B3_3:4/9,B2_1:7/24,B2_2:.25,B2_3:1/3,B2_4:1/8},EJSS_ODE_SOLVERS.bogackiShampine23=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(3),i=n.allocateOtherArrays;return n.getNumberOfEvaluations=function(){return 3},n.allocateOtherArrays=function(){i(),e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(r,i){var o,s=r/2,a=n.getODE(),l=n.getInitialState(),u=n.getInitialRate(),g=n.getDimension(),c=g-1,S=(u[c],EJSS_ODE_SOLVERS.BogackiShampine23);for(o=0;g>o;o++)i[o]=l[o]+s*u[o];a.getRate(i,e);var d=.75*r;for(o=0;g>o;o++)i[o]=l[o]+d*e[o];for(a.getRate(i,t),o=0;c>o;o++)i[o]=l[o]+r*(S.B3_1*u[o]+S.B3_2*e[o]+S.B3_3*t[o]);i[c]=n.getInitialTime()+r*u[c]},n.computeCarefulIntermediateStep=function(r,i,o){var s,a=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,d=(g[S],EJSS_ODE_SOLVERS.BogackiShampine23),f=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(s=0;c>s;s++)o[s]=u[s]+a*g[s];switch(r.checkDiscontinuity(o,!1)){case f.DISCONTINUITY_PRODUCED_ERROR:return f.DISCONTINUITY_PRODUCED_ERROR;case f.DISCONTINUITY_JUST_PASSED:return f.DISCONTINUITY_JUST_PASSED;case f.DISCONTINUITY_ALONG_STEP:return f.DISCONTINUITY_ALONG_STEP;case f.DISCONTINUITY_EXACTLY_ON_STEP:break;case f.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(o,e);var E=.75*i;for(s=0;c>s;s++)o[s]=u[s]+E*e[s];switch(r.checkDiscontinuity(o,!1)){case f.DISCONTINUITY_PRODUCED_ERROR:return f.DISCONTINUITY_PRODUCED_ERROR;case f.DISCONTINUITY_JUST_PASSED:return f.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case f.DISCONTINUITY_ALONG_STEP:return f.DISCONTINUITY_ALONG_STEP;case f.DISCONTINUITY_EXACTLY_ON_STEP:break;case f.NO_DISCONTINUITY_ALONG_STEP:}for(l.getRate(o,t),s=0;S>s;s++)o[s]=u[s]+i*(d.B3_1*g[s]+d.B3_2*e[s]+d.B3_3*t[s]);return o[S]=n.getInitialTime()+i*g[S],r.checkDiscontinuity(o,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=(n.getODE(),n.getInitialState()),t=n.getInitialRate(),r=n.getFinalState(),i=n.getFinalRate();return EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,i)},n.computeApproximation=function(i){var o=n.getODE(),s=n.getTimeIndex(),a=n.getInitialState(),l=n.getInitialRate(),u=n.getFinalState(),g=n.getFinalRate();o.getRate(u,g);for(var c=EJSS_ODE_SOLVERS.BogackiShampine23,S=0;s>S;S++)r[S]=a[S]+i*(c.B2_1*l[S]+c.B2_2*e[S]+c.B2_3*t[S]+c.B2_4*g[S]);return r[s]=n.getInitialTime()+i*l[s],n.computeError(r)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.CashKarp45={A_11:.2,A_21:.075,A_22:.225,A_31:.3,A_32:-.9,A_33:1.2,A_41:-11/54,A_42:2.5,A_43:-70/27,A_44:35/27,A_51:1631/55296,A_52:175/512,A_53:575/13824,A_54:44275/110592,A_55:253/4096,B4_1:2825/27648,B4_2:0,B4_3:18575/48384,B4_4:13525/55296,B4_5:277/14336,B4_6:.25,B5_1:37/378,B5_2:0,B5_3:250/621,B5_4:125/594,B5_5:0,B5_6:512/1771},EJSS_ODE_SOLVERS.cashKarp45=function(){var e,t,r,n,i,o,s=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),a=s.allocateOtherArrays;return s.getNumberOfEvaluations=function(){return 6},s.allocateOtherArrays=function(){a(),e=new Array(s.getDimension()),t=new Array(s.getDimension()),r=new Array(s.getDimension()),n=new Array(s.getDimension()),i=new Array(s.getDimension()),o=new Array(s.getDimension())},s.computeIntermediateStep=function(o,a){var l,u=s.getODE(),g=s.getInitialState(),c=s.getInitialRate(),S=s.getDimension(),d=S-1,f=(c[d],EJSS_ODE_SOLVERS.CashKarp45);for(l=0;S>l;l++)a[l]=g[l]+o*f.A_11*c[l];for(u.getRate(a,e),l=0;S>l;l++)a[l]=g[l]+o*(f.A_21*c[l]+f.A_22*e[l]);for(u.getRate(a,t),l=0;S>l;l++)a[l]=g[l]+o*(f.A_31*c[l]+f.A_32*e[l]+f.A_33*t[l]);for(u.getRate(a,r),l=0;S>l;l++)a[l]=g[l]+o*(f.A_41*c[l]+f.A_42*e[l]+f.A_43*t[l]+f.A_44*r[l]);for(u.getRate(a,n),l=0;S>l;l++)a[l]=g[l]+o*(f.A_51*c[l]+f.A_52*e[l]+f.A_53*t[l]+f.A_54*r[l]+f.A_55*n[l]);for(u.getRate(a,i),l=0;d>l;l++)a[l]=g[l]+o*(f.B5_1*c[l]+f.B5_2*e[l]+f.B5_3*t[l]+f.B5_4*r[l]+f.B5_5*n[l]+f.B5_6*i[l]);a[d]=s.getInitialTime()+o*c[d]},s.computeCarefulIntermediateStep=function(o,a,l){var u,g=s.getODE(),c=s.getInitialState(),S=s.getInitialRate(),d=s.getDimension(),f=d-1,E=(S[f],EJSS_ODE_SOLVERS.CashKarp45),p=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(u=0;d>u;u++)l[u]=c[u]+a*E.A_11*S[u];switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,e),u=0;d>u;u++)l[u]=c[u]+a*(E.A_21*S[u]+E.A_22*e[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,t),u=0;d>u;u++)l[u]=c[u]+a*(E.A_31*S[u]+E.A_32*e[u]+E.A_33*t[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,r),u=0;d>u;u++)l[u]=c[u]+a*(E.A_41*S[u]+E.A_42*e[u]+E.A_43*t[u]+E.A_44*r[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,n),u=0;d>u;u++)l[u]=c[u]+a*(E.A_51*S[u]+E.A_52*e[u]+E.A_53*t[u]+E.A_54*r[u]+E.A_55*n[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,i),u=0;f>u;u++)l[u]=c[u]+a*(E.B5_1*S[u]+E.B5_2*e[u]+E.B5_3*t[u]+E.B5_4*r[u]+E.B5_5*n[u]+E.B5_6*i[u]);return l[f]=s.getInitialTime()+a*S[f],o.checkDiscontinuity(l,!0)},s.computeFinalRateAndCreateIntervalData=function(){var e=s.getODE(),t=s.getInitialState(),r=s.getInitialRate(),n=s.getFinalState(),i=s.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},s.computeApproximation=function(a){for(var l=s.getTimeIndex(),u=s.getInitialState(),g=s.getInitialRate(),c=EJSS_ODE_SOLVERS.CashKarp45,S=0;l>S;S++)o[S]=u[S]+a*(c.B4_1*g[S]+c.B4_2*e[S]+c.B4_3*t[S]+c.B4_4*r[S]+c.B4_5*n[S]+c.B4_6*i[S]);return o[l]=s.getInitialTime()+a*g[l],s.computeError(o)},s};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Euler={},EJSS_ODE_SOLVERS.euler=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return e.getNumberOfEvaluations=function(){return 1},e.computeIntermediateStep=function(t,r){for(var n=e.getDimension(),i=e.getInitialState(),o=e.getInitialRate(),s=0;n>s;s++)r[s]=i[s]+t*o[s]},e.computeCarefulIntermediateStep=function(t,r,n){return e.computeIntermediateStep(r,n),t.checkDiscontinuity(n,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),r=e.getInitialState(),n=e.getInitialRate(),i=e.getFinalState(),o=e.getFinalRate();return t.getRate(i,o),EJSS_ODE_INTERPOLATION.eulerIntervalData(r,n,i[e.getTimeIndex()])},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Radau5={c1:(4-Math.sqrt(6))/10,c2:(4+Math.sqrt(6))/10,c1m1:(4-Math.sqrt(6))/10-1,c2m1:(4+Math.sqrt(6))/10-1,c1mc2:(4-Math.sqrt(6))/10-(4+Math.sqrt(6))/10};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.RungeKutta4={},EJSS_ODE_SOLVERS.rungeKutta4=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return n.getNumberOfEvaluations=function(){return 4},n.allocateOtherArrays=function(){e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(i,o){var s,a=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,d=g[S];for(s=0;c>s;s++)o[s]=u[s]+a*g[s];for(l.getRate(o,e),s=0;c>s;s++)o[s]=u[s]+a*e[s];for(l.getRate(o,t),s=0;c>s;s++)o[s]=u[s]+i*t[s];for(l.getRate(o,r),s=0;S>s;s++)o[s]=u[s]+i*(g[s]+2*e[s]+2*t[s]+r[s])/6;o[S]=n.getInitialTime()+i*d},n.computeCarefulIntermediateStep=function(i,o,s){var a,l=o/2,u=n.getODE(),g=n.getInitialState(),c=n.getInitialRate(),S=n.getDimension(),d=S-1,f=c[d],E=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(a=0;S>a;a++)s[a]=g[a]+l*c[a];switch(i.checkDiscontinuity(s,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(s,e),a=0;S>a;a++)s[a]=g[a]+l*e[a];switch(i.checkDiscontinuity(s,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(s,t),a=0;S>a;a++)s[a]=g[a]+o*t[a];switch(i.checkDiscontinuity(s,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(s,r),a=0;d>a;a++)s[a]=g[a]+o*(c[a]+2*e[a]+2*t[a]+r[a])/6;return s[d]=n.getInitialTime()+o*f,i.checkDiscontinuity(s,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=n.getODE(),t=n.getInitialState(),r=n.getInitialRate(),i=n.getFinalState(),o=n.getFinalRate();return e.getRate(i,o),EJSS_ODE_INTERPOLATION.bootstrapIntervalData(t,r,i,o,e)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTime={},EJSS_ODE_SOLVERS.solverEngineDiscreteTime=function(){var e,t,r,n,i,o,s,a,l,u={},g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,c=0,S=.1,d=Number.POSITIVE_INFINITY,f=0,E=0;return u.getNumberOfEvaluations=function(){return 0},u.allocateOtherArrays=function(){},u.computeIntermediateStep=function(e,t){return null},u.computeCarefulIntermediateStep=function(e,t,r){return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},u.computeFinalRateAndCreateIntervalData=function(){return null},u.getODE=function(){return s},u.getEventSolver=function(){return a},u.getDimension=function(){return e},u.getTimeIndex=function(){return t},u.getInitialTime=function(){return f},u.getInitialState=function(){return r},u.getInitialRate=function(){return n},u.getFinalState=function(){return i},u.getFinalRate=function(){return o},u.setFinalTime=function(e){E=e},u.getFinalTime=function(){return E},u.setErrorCode=function(e){g=e},u.addToEvaluations=function(e){c+=e},u.setODE=function(r,n){a=r,s=n;var i=s.getState();e=i.length,t=e-1,l=EJSS_ODE_INTERPOLATION.stateHistory(n),s.getMaximumDelay&&l.setMinimumLength(s.getMaximumDelay())},u.initialize=function(a){S=a;var g=s.getState();(null==r||r.length!=g.length)&&(e=g.length,t=e-1,r=new Array(e),n=new Array(e),i=new Array(e),o=new Array(e),u.allocateOtherArrays()),c=0,l.clearAll(),s.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(s.getMaximumDelay()),Math.abs(a))):l.setMinimumLength(a),u.reinitialize(g)},u.reinitialize=function(i){f=i[t];for(var o=0;e>o;o++)r[o]=i[o];s.getRate(r,n),E=Number.NaN,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR},u.getCurrentRate=function(){return n},u.setStepSize=function(e){S=e,s.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(s.getMaximumDelay()),Math.abs(e))):l.setMinimumLength(e)},u.setMaximumStepSize=function(e){d=Math.abs(e)},u.getMaximumStepSize=function(){return d},u.getStepSize=function(){return S},u.getInternalStepSize=function(){return E-f},u.setEstimateFirstStep=function(e){},u.setTolerances=function(e,t){},u.getMaximumTime=function(e){return g!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR?Number.NaN:(isNaN(E)&&u.computeOneStep(e),E)},u.internalStep=function(t){var s;for(f=E,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,s=0;e>s;s++)r[s]=i[s];for(s=0;e>s;s++)n[s]=o[s];return u.computeOneStep(t),E},u.getCounter=function(){return c},u.getStateHistory=function(){return l},u.interpolate=function(e,t){return l.interpolateState(e,t)},u.bestInterpolate=function(t,n){var o;if(isNaN(E))return null;if(t==E){for(o=0;e>o;o++)n[o]=i[o];return n}if(t==f){for(o=0;e>o;o++)n[o]=r[o];return n}return u.computeIntermediateStep(t-f,n),n},u.getActualStepSize=function(){return S},u.findTheDiscontinuity=function(e){for(var r=0,n=0,o=e,s=0,l=a.getDDEIterations(),g=a.getEPSILON();l>r&&!(Math.abs(n-o)<g);){var c=(n+o)/2;switch(u.computeCarefulIntermediateStep(a,c,i)){default:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:s=i[t],n=c;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:return i[t];case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:o-=(o-n)/4;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:o=c}r++}return u.computeCarefulIntermediateStep(a,s,i),s},u.computeOneStep=function(e){var r=S;if(e){switch(u.computeCarefulIntermediateStep(a,r,i)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void(E=Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:E=i[t];break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E=u.findTheDiscontinuity(r)}if(isNaN(E))return void(g=EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else u.computeIntermediateStep(r,i),E=i[t];c+=u.getNumberOfEvaluations(),l.clean(f),l.addIntervalData(u.computeFinalRateAndCreateIntervalData())},u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive={FAC1:.33,FAC2:6,BETA:0,SAFE:.9},EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive=function(e){function t(e){var t=0;return 0!=e?(t=Math.pow(e,l),g=t/Math.exp(EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*Math.log(u)),g=Math.max(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2,Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE))):(t=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2),1>=e?(u=Math.max(e,1e-4),i/g):i/Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,t/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE)}function r(e){var t,r,n,i=a.getODE();if(e>=0){if(i.getDelays)for(t=i.getDelays(a.getInitialState()),n=t.length,r=0;n>r;r++)e=Math.min(e,t[r]/2);return Math.min(e,a.getMaximumStepSize())}if(i.getDelays)for(t=i.getDelays(a.getInitialState()),n=t.length,r=0;n>r;r++)e=Math.max(e,t[r]/2);return Math.max(e,-a.getMaximumStepSize())}function n(t){var r,n=a.getDimension(),i=a.getInitialState(),l=a.getInitialRate(),u=a.getODE(),g=0>t?-1:1;t=Math.abs(t);var c=0,S=0;for(r=0;n>r;r++){var d=o[r]+s[r]*Math.abs(i[r]),f=l[r]/d;c+=f*f,f=i[r]/d,S+=f*f}var E;if(E=1e-10>=c||1e-10>=S?1e-6:.01*Math.sqrt(S/c),E=g*Math.min(E,t),u.getDelays){var p=a.getEventSolver();p.resetDiscontinuities(i);for(var h=0,m=!1;!m;){for(r=0;n>r;r++)finalState[r]=i[r]+E*l[r];switch(p.checkDiscontinuity(finalState,!1)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E/=2;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:m=!0;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:m=!0}if(++h>100)return Number.NaN}}else for(r=0;n>r;r++)finalState[r]=i[r]+E*l[r];u.getRate(finalState,finalRate);var A=0;for(r=0;n>r;r++){var d=o[r]+s[r]*Math.abs(i[r]),f=(finalRate[r]-l[r])/d;A+=f*f}A=Math.sqrt(A)/E;var y,D=Math.max(Math.abs(A),Math.sqrt(c));return y=1e-15>=D?Math.max(1e-6,.001*Math.abs(E)):Math.exp(1/e*Math.log(.01/D)),E=g*Math.min(100*E,y),0!=t&&(E=g*Math.min(Math.abs(E),t)),E}var i,o,s,a=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),l=1/e-.75*EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA,u=1e-4,g=0,c=!1,S=Number.NaN,d=Number.NaN,f=a.reinitialize,E=a.setMaximumStepSize;return a.computeApproximation=function(e){},a.getAbsTol=function(){return o},a.getRelTol=function(){return s},a.allocateOtherArrays=function(){var e=a.getDimension();o=new Array(e),s=new Array(e),a.setTolerances(1e-6,1e-6)},a.reinitialize=function(e){f(e),i=r(c?n(a.getStepSize()):a.getStepSize())},a.setEstimateFirstStep=function(e){c=e},a.setMaximumStepSize=function(e){E(e),i=r(i)},a.setTolerances=function(e,t){var l,u=a.getDimension();if(e instanceof Array)for(S=d=Number.NaN,l=0;u>l;l++)o[l]=e[l],s[l]=t[l];else{if(S==e&&d==t)return;for(S=e,d=t,l=0;u>l;l++)o[l]=e,s[l]=t}mFinalTime=Number.NaN,mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,i=r(c?n(a.getStepSize()):a.getStepSize())},a.computeOneStep=function(e){var n=a.getEventSolver(),o=a.getFinalState();mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(var s=0;500>s;s++){if(e){switch(a.computeCarefulIntermediateStep(n,i,o)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void a.setFinalTime(Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:a.setFinalTime(o[a.getTimeIndex()]);break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:var l=a.findTheDiscontinuity(i);a.setFinalTime(l),i=l-a.getInitialTime()}if(isNaN(a.getFinalTime()))return void a.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else a.computeIntermediateStep(i,o),a.setFinalTime(o[a.getTimeIndex()]);var u=a.computeApproximation(i);if(a.addToEvaluations(a.getNumberOfEvaluations()),
1>=u)return a.getStateHistory().clean(a.getInitialTime()),a.getStateHistory().addIntervalData(a.computeFinalRateAndCreateIntervalData()),void(i=r(s>0?i>0?Math.min(i,t(u)):Math.max(i,t(u)):t(u)));i=r(i>0?Math.min(i,t(u)):Math.max(i,t(u)))}a.setFinalTime(Number.NaN),a.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DID_NOT_CONVERGE)},a.getActualStepSize=function(){return i},a.computeError=function(e){for(var t=0,r=a.getDimension(),n=a.getInitialState(),i=a.getFinalState(),l=0;r>l;l++){var u=o[l]+s[l]*Math.max(Math.abs(i[l]),Math.abs(n[l])),g=(i[l]-e[l])/u;t+=g*g}return Math.sqrt(t/r)},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DDEDiscontinuity={},EJSS_ODE_SOLVERS.ddeDiscontinuity=function(e,t){function r(r){var n,a=t.getDelays(r),l=a.length,u=o.length,g=r.length-1;if(e.getRunsForwards())for(n=0;l>n;n++)for(var c=r[g]-a[n]+i.getTolerance(),S=s[n];u>S;S++){var d=o[S];if(d>c){s[n]=S;break}}else for(n=0;l>n;n++)for(var c=r[g]-a[n]-i.getTolerance(),S=s[n];u>S;S++){var d=o[S];if(c>d){s[n]=S;break}}}function n(r){var n,o=r.length,s=o-1,l=i.getTolerance()/20,u=e.getDDEIterations(),g=e.getStateHistory(),c=0;if(e.getRunsForwards())for(;++c<u;){for(t.getRate(r,a),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,a,r[s]+l)),n=0;o>n;n++)r[n]+=l*a[n];var S=i.evaluate(r);if(0>S)return r[s]}else for(;++c<u;){for(t.getRate(r,a),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,a,r[s]-l)),n=0;o>n;n++)r[n]-=l*a[n];var S=evaluate(r);if(S>0)return r[s]}return Number.NaN}var i={},o=[],s=[],a=[];return i.initialize=function(r){e.getRunsForwards()?o.push(Number.NEGATIVE_INFINITY):o.push(Number.POSITIVE_INFINITY);var n=t.getInitialConditionDiscontinuities();if(null!=n)for(var l=n.length,u=0;l>u;u++)o.push(n[u]);o.push(r[r.length-1]);var g=t.getDelays(r);s=new Array(g.length),i.reset(r),a=new Array(r.length)},i.reset=function(e){for(var t=s.length,n=0;t>n;n++)s[n]=0;r(e)},i.evaluate=function(r){var n,i=r[r.length-1],a=t.getDelays(r),l=a.length;if(e.getRunsForwards()){var u=Number.POSITIVE_INFINITY;for(n=0;l>n;n++){var g=o[s[n]];u=Math.min(u,a[n]+g-i)}return u}var c=Number.NEGATIVE_INFINITY;for(n=0;l>n;n++){var g=o[s[n]];c=Math.max(c,a[n]+g-i)}return c},i.action=function(){var r=t.getState(),i=n(r);o.push(i);var s=e.findFirstEvent(r,i,r);return null!=s&&(mCurrentEventData=s,s.action()),!0},i.getTolerance=function(){return e.getDDETolerance()},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ProblemData={POSITIVE:2,SMALL_POSITIVE:1,ZERO:0,SMALL_NEGATIVE:-1,NEGATIVE:-2},EJSS_ODE_SOLVERS.eventData=function(e,t,r){var n,i,o,s,a,l,u,g,c={},S=t.getTypeOfEvent(),d=r.length-1;return c.getEvent=function(){return t},c.getEventType=function(){return S},c.setH=function(e){l=e},c.getH=function(){return l},c.getTime=function(){return u},c.setTime=function(e){u=e},c.hasPositiveFlag=function(){return n},c.hasNegativeFlag=function(){return i},c.getHBefore=function(){return s},c.setHAfter=function(e){a=e},c.getHAfter=function(){return a},c.getCurrentPosition=function(){return o},c.getMaxAdvance=function(){return g},c.setMaxAdvance=function(e){g=e},c.action=function(){return t.action()},c.getProblem=function(){return t},c.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);c.findPosition(r[d],o),e.getCurrentEventData()!=c&&(S==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT?o>0?n=!0:0>o&&(i=!0):S==EJSS_ODE_SOLVERS.EVENT_TYPE.POSITIVE_EVENT&&o>0&&(n=!0))},c.findPosition=function(r,a){if(s=a,s>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):s>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==s?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:s>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0),S==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT&&o==EJSS_ODE_SOLVERS.ProblemData.NEGATIVE){var l="The state event "+t+" is in an illegal state: "+s+" at "+r;l+=null==e.getLastEventData()?"\nThere was no previous event":"\nLast previous event was "+e.getLastEventData().getProblem()+", which took place at "+e.getLastEventDataTime(),e.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,l)}},c.reset(r),c},EJSS_ODE_SOLVERS.discontinuityData=function(e,t,r){var n,i,o,s,a,l,u={},g=r.length-1;return u.getDiscontinuity=function(){return t},u.setH=function(e){a=e},u.getH=function(){return a},u.setTime=function(e){l=e},u.getTime=function(){return l},u.hasPositiveFlag=function(){return n},u.hasNegativeFlag=function(){return i},u.getHBefore=function(){return s},u.setHAfter=function(e){mHAfter=e},u.getHAfter=function(){return mHAfter},u.getCurrentPosition=function(){return o},u.getMaxAdvance=function(){return Number.NaN},u.action=function(){return t.action()},u.getProblem=function(){return t},u.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);u.findPosition(r[g],o),e.getCurrentEventData()!=u&&(o>0?n=!0:0>o&&(i=!0))},u.findPosition=function(e,r){s=r,s>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):s>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==s?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:s>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0)},u.reset(r),u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ODEMultistepSolver={NO_ERROR:0,DID_NOT_CONVERGE:1},EJSS_ODE_SOLVERS.createODEMultistepSolver=function(e){function t(){var e=g.getTolerance(),t=l;(g.getStepSize()<=0||g.getStepSize()>l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;t>e*l;){r++;var n=t;if(t<g.getStepSize()){var u=g.getStepSize();g.setStepSize(t);var c=g.step();t-=c,g.setStepSize(u)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10>g.getStepSize()||r>o){if(a="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,s)throw a;mMaxMessages>0&&(mMaxMessages--,console.log(a));break}}return t}function r(){var e=g.getTolerance(),t=l;(g.getStepSize()>=0||g.getStepSize()<l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;e*l>t;){r++;var n=t;if(t>g.getStepSize()){var s=g.getStepSize();g.setStepSize(t);var u=g.step();t-=u,g.setStepSize(s)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10<g.getStepSize()||r>o){if(a="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,enableExceptions)throw a;mMaxMessages>0&&(mMaxMessages--,console.log(a))}}return t}var n={},i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,o=200,s=!1,a="",l=.1,u=EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE(e),g=EJSS_ODE_SOLVERS.createCashKarp45(u);return n.enableRuntimeExceptions=function(e){s=e},n.setMaxIterations=function(e){o=Math.max(1,e)},n.setTolerance=function(e){e=Math.abs(e),g.setTolerance(e)},n.getTolerance=function(){return g.getTolerance()},n.getErrorCode=function(){return i},n.initialize=function(e){mMaxMessages=4,a="",i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=e,u.setInitialConditions(),g.initialize(e)},n.setStepSize=function(e){mMaxMessages=4,l=e,0>e?g.setStepSize(Math.max(-Math.abs(g.getStepSize()),e)):g.setStepSize(Math.min(g.getStepSize(),e))},n.setMaximumNumberOfErrorMessages=function(e){mMaxMessages=e},n.getStepSize=function(){return l},n.step=function(){i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,u.setInitialConditions();var e=0;return e=l>0?t():r(),u.update(),l-e},n},EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE=function(e){var t={},r=[];return t.getRate=function(t,r){e.getRate(t,r)},t.getState=function(){return r},t.setInitialConditions=function(){var t=e.getState();if(null!=t){(null==r||r.length!=t.length)&&(r=new Array(t.length));for(var n=0,i=t.length;i>n;n++)r[n]=t[n]}},t.update=function(){for(var t=e.getState(),n=0,i=t.length;i>n;n++)t[n]=r[n]},t.setInitialConditions(),t},EJSS_ODE_SOLVERS.createCashKarp45=function(e){var t,r={},n=[[.2],[.075,.225],[.3,-.9,1.2],[-11/54,2.5,-70/27,35/27],[1631/55296,175/512,575/13824,44275/110592,253/4096]],i=[37/378,0,250/621,125/594,0,512/1771],o=[277/64512,0,-6925/370944,6925/202752,277/14336,-277/7084],s=6,a=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=.01,u=0,g=[],c=[],S=1e-6,d=!1;return r.enableRuntimeExpecptions=function(e){d=e},r.setStepSize=function(e){l=e},r.getStepSize=function(){return l},r.setTolerance=function(e){if(S=Math.abs(e),1e-12>S){var t="Error: Cash-Karp ODE solver tolerance cannot be smaller than 1.0e-12.";if(d)throw t;console.log(t),S=1e-12}},r.getTolerance=function(){return S},r.getErrorCode=function(){return a},r.initialize=function(t){l=t;var r=e.getState();if(null!=r&&u!=r.length){u=r.length,g=new Array(u),c=new Array(s);for(var n=0;s>n;n++)c[n]=new Array(u)}},r.step=function(){var r,f,E,p=10,h=l,m=0,A=e.getState();a=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,e.getRate(A,c[0]);do{for(p--,h=l,E=1;s>E;E++){for(r=0;u>r;r++)for(g[r]=A[r],f=0;E>f;f++)g[r]=g[r]+l*n[E-1][f]*c[f][r];e.getRate(g,c[E])}for(m=0,r=0;u>r;r++){for(t=0,E=0;s>E;E++)t+=l*o[E]*c[E][r];m=Math.max(m,Math.abs(t))}if(m<=Number.MIN_VALUE&&(m=S/1e5),m>S){var y=.9*Math.pow(m/S,-.25);l*=Math.max(y,.1)}else if(S/10>m){var y=.9*Math.pow(m/S,-.2);y>1&&(l*=Math.min(y,10))}}while(m>S&&p>0);for(r=0;u>r;r++)for(E=0;s>E;E++)A[r]+=h*i[E]*c[E][r];if(0==p&&(a=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,d))throw"DormanPrince45 ODE solver did not converge.";return h},r.initialize(l),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createEulerODESolver=function(e){var t,r=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n=r.initialize;return r.initialize=function(e){n(e),t=new Array(r.getDimension())},r.computeIntermediateStep=function(r,n){e.getRate(n,t);for(var i=0,o=n.length;o>i;i++)n[i]=n[i]+r*t[i];return n},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createRungeKutta4ODESolver=function(e){var t,r,n,i,o,s=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),a=s.initialize;return s.initialize=function(e){a(e),t=new Array(s.getDimension()),r=new Array(s.getDimension()),n=new Array(s.getDimension()),i=new Array(s.getDimension()),o=new Array(s.getDimension())},s.computeIntermediateStep=function(s,a){e.getRate(a,r);for(var l=0,u=a.length;u>l;l++)t[l]=a[l],a[l]=t[l]+s*r[l]/2;e.getRate(a,n);for(var l=0,u=a.length;u>l;l++)a[l]=t[l]+s*n[l]/2;e.getRate(a,i);for(var l=0,u=a.length;u>l;l++)a[l]=t[l]+s*i[l];e.getRate(a,o);for(var l=0,u=a.length;u>l;l++)a[l]=t[l]+s*(r[l]+2*n[l]+2*i[l]+o[l])/6;return a},s};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverInterpolatorDiscreteTime={},EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime=function(e){var t,r={},n=.1,i=(Number.POSITIVE_INFINITY,0);return r.getNumberOfEvaluations=function(){return 0},r.allocateOtherArrays=function(){},r.computeIntermediateStep=function(e,t){return null},r.computeCarefulIntermediateStep=function(e,t,r){return 0},r.setTolerance=function(e){i=Math.abs(e)},r.getDimension=function(){return t},r.initialize=function(r){n=r;var i=e.getState();t=i.length},r.step=function(){var t=e.getState();return r.computeIntermediateStep(n,t),0},r.setStepSize=function(e){n=e},r.getStepSize=function(){return n},r};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createRemoteView=function(e,t,r,n){function i(e,t){if(c){void 0!==t?a.send(e+JSON.stringify(t)):a.send(e);var r=a.onmessage;a.onmessage=null,a.onmessage=r}}function o(e){var t;switch(e.charAt(0)){case"R":l._reset();break;case"I":l._initialize();break;case"U":d=JSON.parse(e.substring(1)),s(l._update);break;case"C":d=JSON.parse(e.substring(1)),s(l._collectData);break;case"M":t=JSON.parse(e.substring(1)),l[t.method]&&console.log("View function: <"+t.method+"> with data: <"+t.data+"> ignored. View function does not exist."),l[t.method](t.data);break;case"P":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element].setProperty(t.property,t.value):console.log("setProperty<"+t.property+"> with value: <"+t.value+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"E":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"F":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message with object <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;default:console.log("view process input error : Unrecognised command: "+e)}}function s(e){e(),l._render(),i("O")}var a,l=EJSS_CORE.createView(e),u=10,g=500,c=!1,S=0,d={},f=[],E=[],p=[],h=[],m="",A=!0,y=0,D="";if(l.getClass=function(){return"ConnectionWS"},l._connectToServer=function(){try{a=new WebSocket(D),console.log("Connecting... (readyState "+a.readyState+")"),a.onopen=function(e){c=!0,S=0,console.log("Openhd Event: "+e.type+" - Message: "+e.data),i("A",{variables:f,actions:E})},a.onclose=function(e){u>S&&(window.setTimeout(function(){l._connectToServer()},g),S++),c=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data+" - Reopen: "+S)},a.onerror=function(e){c=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},a.onmessage=function(e){o(e.data)}}catch(e){console.log(e)}l._update(),l._render()},l._getValue=function(e){return c?d[e]:l._getInitialValue(e)},super_registerVariable=l._registerVariable,super_registerAction=l._registerAction,super_startUp=l._startUp,l._startUp=function(){super_startUp(),l._connectToServer()},l._registerVariable=function(e,t,r){super_registerVariable(e,t),r?l._linkVariable(e,function(){return l._getValue(e)},null,t):(f.push(e),l._linkVariable(e,function(){return l._getValue(e)},function(t){p.push({name:e,value:t})},t))},l._registerAction=function(e){super_registerAction(e),E.push(e),l._setAction(e,function(t){h.push({name:e,argument:t})})},l._reportInteraction=function(){l._readInteractions(),i("I",{properties:p,actions:h}),p=[],h=[]},l._interactionsNumber=function(){return h.length},l.getLinkingURL=function(){return m},l.createLinkingButtons=function(){l._addElement(EJSS_INTERFACE.button,"_linkingButton_").setAction("OnClick",function(){var e=l.getLinkingURL();window.alert(e.toString())}).setProperties({Text:"@",FontSize:"8px"}),l._addElement(EJSS_INTERFACE.button,"_qrButton_").setAction("OnClick",function(){var e=encodeURIComponent(l.getLinkingURL()),t="https://chart.googleapis.com/chart?cht=qr&chl="+e+"&chs=400";window.open(t,"_blank")}).setProperties({Text:"QR",FontSize:"8px"})},l.hiddenLinkingButtons=function(){_view._linkingButton_.setVisibility("hidden"),_view._qrButton_.setVisibility("hidden")},l.showLinkingButtons=function(){_view._linkingButton_.setVisibility("visible"),_view._qrButton_.setVisibility("visible")},-1!=window.location.protocol.indexOf("file"))("undefined"==typeof t||null===t||0==t)&&(t=8800),D="ws://localhost:"+t,A=!1;else{if(history.state&&(y=history.state.mServerModelPort,A=!1),"undefined"==typeof r||null===r||""==r){var v=window.location.host,P=window.location.protocol;r=P+"//"+v+"/ejsS_library/models"}if("undefined"==typeof n||null===n||""==n){var I=window.location.href.lastIndexOf("/_view");n=window.location.href.slice(r.length,I)}var _=new XMLHttpRequest;y>0?_.open("GET",r+"/broker.php?model="+n+"&port="+y,!0):_.open("GET",r+"/broker.php?model="+n,!0),_.onreadystatechange=function(){if(4==_.readyState&&200==_.status){var e=JSON.parse(_.responseText);D=e.webserver,m=r+"/linking.php?model="+n+"&port="+e.port,A&&l.createLinkingButtons(),l._startUp()}else console.log("WARNING: server no response!")},_.send()}return l};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.addToArray=function(e,t,r){EJSS_TOOLS.removeFromArray(e,t),r>=0?e.splice(r,0,t):e.push(t)},EJSS_TOOLS.removeFromArray=function(e,t){var r=e.indexOf(t);r>=0&&e.splice(r,1)},EJSS_TOOLS.compareArrays=function(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!EJSS_TOOLS.compareArrays(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.ConnectionWS={},EJSS_TOOLS.connectionWS=function(e){function t(){try{a=new WebSocket(e),console.log("Connecting... (readyState "+a.readyState+")")}catch(t){console.log(t)}}function r(e,t){switch(e){case"onopen":a.onopen=function(e){t(e)};break;case"onmessage":a.onmessage=function(e){t(e)};break;case"onclose":a.onclose=function(e){t(e)};break;case"onerror":a.onerror=function(e){t(e)}}}function n(e){var t=e.data.split(" ");g[t[0]]=e.data.substring(t[0].length+1)}function i(e){l=!0,console.log("Openhd Event: "+e.type+" - Message: "+e.data)}function o(e){l=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data)}function s(e){l=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}var a,l,u={},g={};return u.getClass=function(){return"ConnectionWS"},u.get=function(e){var t=g[e];return"undefined"!=typeof t||null==t?t:void 0},u.set=function(e,t){if(console.log("set:"+e+":"+t.toString()),console.log("set:is open="+l),l){var r=e+" "+t.toString();a.send(r),u.reset()}},u.reset=function(){var e=a.onmessage;a.onmessage=null,a.onmessage=e},t(),r("onopen",i),r("onclose",o),r("onerror",s),r("onmessage",n),u};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.DisplayColors={phaseColors:{},lineColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],markerColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],arrayColors:{black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,160],darkcyan:[0,240,240],darkgray:[64,64,64],darkgreen:[0,240,0],darkgrey:[64,64,64],darkyellow:[240,240,0],gray:[125,125,125],green:[0,255,0],grey:[125,125,125],lightblue:[173,216,230],lightgray:[192,192,192],lightgrey:[192,192,192],magenta:[255,0,255],maroon:[128,0,0],olive:[128,128,0],orange:[255,165,0],pink:[255,175,175],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]},getLineColor:function(e){var t=EJSS_TOOLS.DisplayColors.lineColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,50%)",EJSS_TOOLS.DisplayColors.lineColors[e]=t}return t},getMarkerColor:function(e){var t=EJSS_TOOLS.DisplayColors.markerColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,100%)",EJSS_TOOLS.DisplayColors.markerColors[e]=t}return t},getArrayColor:function(e){if(e=e.toLowerCase(),0==e.indexOf("rgb"))var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");else if(0==e.indexOf("#")){e=e.slice(1),e=e.toUpperCase();for(var r,n,i="0123456789ABCDEF",t=new Array(3),o=0,s=0;6>s;s+=2)r=i.indexOf(e.charAt(s)),n=i.indexOf(e.charAt(s+1)),t[o]=16*r+n,o++}else{var t=EJSS_TOOLS.DisplayColors.arrayColors[e];void 0===t&&(t=EJSS_TOOLS.DisplayColors.arrayColors.black)}return[t[0]/255,t[1]/255,t[2]/255]}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Worker=function(){function e(e,t){if(e){var r=new XMLHttpRequest;r.open("GET",e),r.onreadystatechange=function(){4==r.readyState&&200==r.status?t(r.responseText):console.log("Warning: impossible to read "+e)},r.send()}else t("")}var t={};if("undefined"==typeof Worker)return t;if(!window.Worker)return t;if(!window.URL)return t;if(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident")>0)return t;t.dummy=function(e){var e=e.data.params;t.postMessage({result:"dummy"})};var r=new Blob(['onmessage = function (oEvent) { 		postMessage({ 			"id": oEvent.data.id, 			"evaluated": eval(oEvent.data.code) 		}); 	}   '],{type:"text/javascript"}),n=window.URL.createObjectURL(r),i=[],o=new Worker(n);o.onmessage=function(e){i[e.data.id]&&i[e.data.id](e.data.evaluated),delete i[e.data.id]},t.runCode=function(e,t){i.push(t||null),o.postMessage({id:i.length-1,code:e})};var s={};return t.runFunction=function(t,r,n,i,o){if("function"==typeof r)if("undefined"==typeof s[t])e(o,function(e){var o=e;o+=";onmessage = "+r.toString();var a=new Blob([o],{type:"text/javascript"}),l=window.URL.createObjectURL(a);s[t]=l;var u=new Worker(l);u.postMessage({id:t,params:n}),u.onmessage=function(e){i&&i(e.data)}});else{var a=s[t],l=new Worker(a);l.postMessage({id:t,params:n})}},t.runMultipleFunction=function(t,r,n,i,o,a){if("function"==typeof n&&i instanceof Array&&i.length>=r)if("undefined"==typeof s[t])e(a,function(e){var a=e;a+=";onmessage = "+n.toString();var l=new Blob([a],{type:"text/javascript"}),u=window.URL.createObjectURL(l);s[t]=u;for(var g=0;r>g;g++){var c=new Worker(u),e=[];c.onmessage=function(t){e.push(t.data),e.length==r&&o&&o(e)},c.postMessage({id:t,params:i[g]})}});else for(var l=s[t],u=0;r>u;u++){var g=new Worker(l),c=[];g.onmessage=function(e){c.push(e.data),c.length==r&&o&&o(c)},g.postMessage({id:t,params:i[u]})}},t}();var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.enumeration=function(e){var t=function(){throw"Can't Instantiate Enumerations"},r=t.prototype={constructor:t,toString:function(){return this.name},valueOf:function(){return this.value},toJSON:function(){return this.name}};t.values=[];for(var n in e){var i=inherit(r);i.name=n,i.value=e[n],t[n]=i,t.values.push(i)}return t.foreach=function(e,t){for(var r=0;r<this.values.length;r++)e.call(t,this.values[r])},t};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.File={JSLoaded:"",loadJSfile:function(e,t){if(-1!=EJSS_TOOLS.File.JSLoaded.indexOf("["+e+"]"))return console.log("File already loaded "+e),void t();EJSS_TOOLS.File.JSLoaded+="["+e+"]";var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),"undefined"!=typeof t&&(r.onload=t),document.getElementsByTagName("head")[0].appendChild(r)},plainName:function(e){var t=e.lastIndexOf("/");return t>=0&&(e=e.substring(t+1)),t=e.indexOf("."),t>0&&(e=e.substring(0,t)),e},download:function(e,t){var r=document.createElement("a");r.setAttribute("href","data:application/ejss;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.click()},loadScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJSONFile:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);t(e)}},r.open("GET",e,!0),r.send()},requestShortUrl:function(e,t){var r=escape("http://urlecho.appspot.com/echo?status=200&Content-Type=text/plain&body="+e);if(EJSS_TOOLS.File.CALLBACK=t,EJSS_TOOLS.File.callFunction=function(e){EJSS_TOOLS.File.CALLBACK(e.shortUrl)},null==document.getElementById("__rtShortUrl")){var n=document.createElement("script");n.type="text/javascript",n.id="__rtShortUrl",n.innerHTML="function rtShortUrl(data) { EJSS_TOOLS.File.callFunction(data); }",document.getElementsByTagName("head")[0].appendChild(n)}var i=document.getElementById("_requestShortUrl");null!=i&&document.getElementsByTagName("head")[0].removeChild(i),i=document.createElement("script"),i.id="_requestShortUrl",i.type="text/javascript",i.src="http://b1t.co/Site/api/External/MakeUrlWithGet?callback=rtShortUrl&url="+r,document.getElementsByTagName("head")[0].appendChild(i)}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcBuilder={template:{METHOD:"${METHOD}",PARAMS:"${PARAMS}",ID:"${ID}",REQUEST:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',RESPONSE_OK:'{jsonrpc: "2.0", result: ${RESULT}, params: ${PARAMS}, id: ${ID}}',RESPONSE_ERROR:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',ERROR:'{code: "2.0", message: ${MESSAGE}, data: ${DATA}}'},request:function(e,t,r){if(t&&!(t instanceof Array))throw new InvalidParamsException;var n={jsonrpc:"2.0",method:e};return t&&(n.params=t),r&&(n.id=r),n},response:function(e,t){return{jsonrpc:"2.0",result:e,id:t}},responseWithError:function(e,t){return{jsonrpc:"2.0",error:e,id:t}},error:function(e,t,r){return{code:e,message:t,data:r}},parseResponse:function(e){var t=null;try{t=JSON.parse(e)}catch(r){console.log(r)}return null!=t?t.result:null}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcClient={methods:{connect:"connect",open:"open",getMetadata:"getMetadata",getValue:"getValue",setValue:"setValue",close:"close",disconnect:"disconnect"}},EJSS_TOOLS.jsonrpcClient=function(e,t){function r(e){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;e>n;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function n(e,t,n,i){var s=i?i:r(12);n&&(d[s]=n);var a=S.request(e,t,s);o.send(JSON.stringify(a))}function i(){o.onopen=function(e){s&&s(e),console.log("Openhd Event: "+e.type+" - Message: "+e.data)},o.onmessage=function(e){var t=JSON.parse(e.data);u&&u(d),t.id&&d[t.id]&&d[t.id](t.result)},o.onclose=function(e){a&&a(message),console.log("Closehd Event: "+message.type+" - Message: "+message.data)},o.onerror=function(e){l&&l(e),console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}}var o,s,a,l,u,g={},c=EJSS_TOOLS.JsonrpcClient,S=EJSS_TOOLS.JsonrpcBuilder,d={};return g.connect=function(e){return n(c.methods.connect,null,e)},g.open=function(e){return n(c.methods.open,null,e)},g.getValue=function(e,t){return n(c.methods.getValue,[e],t)},g.setValue=function(e,t){return n(c.methods.setValue,e,t)},g.getMetadata=function(e){return n(c.methods.getMetadata,null,e)},g.disconnect=function(e){return n(c.methods.disconnect,null,e)},g.close=function(e){return n(c.methods.close,null,e)},g.init=function(r,n,g,c){try{s=r,l=g,a=c,u=n;var S="ws://"+e;t&&(S+=":"+t),o=new WebSocket(S),i(),console.log("Connecting... (readyState "+o.readyState+")")}catch(d){console.log(d)}},g.finish=function(){try{o.close()}catch(e){console.log(e)}},g};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Mathematics={TWO_PI:6.2831852,TO_RADIANS:Math.PI/180,LOG10SCALE:1/Math.log(10),cosineAndSine:[],cosineAndSineForDegrees:function(e){e%=360,0>e&&(e+=360);var t=this.cosineAndSine[e];if(void 0===t){var r=e*this.TO_RADIANS;t=[Math.cos(r),Math.sin(r)]}return t},radians:function(e){return e*Math.PI/180},degrees:function(e){var t=180*e/Math.PI,r=t%360;return t=0>360*r?r+360:r},norm:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return Math.sqrt(t)},crossProduct:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},normalize:function(e){var t=EJSS_TOOLS.Mathematics.norm(e);return 0==t?e:[e[0]/t,e[1]/t,e[2]/t]},normalTo:function(e){if(0==e[0])return[1,0,0];if(0==e[1])return[0,1,0];if(0==e[2])return[0,0,1];var t=EJSS_TOOLS.Mathematics.norm(e);return[-e[1]/t,e[0]/t,0]}},sensors={iOS_accelerometer:{x:0,y:0,z:0},iOS_gyroscope:{x:0,y:0,z:0},setAccelerometer:function(accvalue){var value=JSON.parse(accvalue),accelerometer=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_accelerometer={x:accelerometer.y,y:-accelerometer.x,z:accelerometer.z}:sensors.iOS_accelerometer=accelerometer},setGyroscope:function(gyrvalue){var value=JSON.parse(gyrvalue),gyroscope=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_gyroscope={x:gyroscope.y,y:-gyroscope.x,z:gyroscope.z}:sensors.iOS_gyroscope=gyroscope},iOS_staccelerometer:{x:0,y:0,z:0},iOS_stgyroscope:{x:0,y:0,z:0},iOS_stmagnetometer:{x:0,y:0,z:0},iOS_sthumidity:0,iOS_sttempamb:0,iOS_sttempir:0,iOS_stpressure:0,setSensorTag:function(stvalue){var value=JSON.parse(stvalue),results=eval(value.result);sensors.iOS_staccelerometer={x:results.accx,y:results.accy,z:results.accz},sensors.iOS_stgyroscope={x:results.gyrox,y:results.gyroy,z:results.gyroz},sensors.iOS_stmagnetometer={x:results.magx,y:results.magy,z:results.magz},sensors.iOS_sthumidity=results.hum,sensors.iOS_sttempamb=results.tamb,sensors.iOS_sttempir=results.tir,sensors.iOS_stpressure=results.press},calliOSFunction:function(e,t,r,n){var i="ejss://",o={};o.functionname=e,r&&(o.success=r),n&&(o.error=n),t&&(o.args=t),i+=JSON.stringify(o),window.location=i},isSupportedSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e},runSensorTag:function(e,t){var r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(r){var n=[];n[0]=e,n[1]=t,sensors.calliOSFunction("runSensorTag",n,"sensors.setSensorTag")}},stopSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e&&sensors.calliOSFunction("stopSensorTag")},getSensorTagAccelerometer:function(){return sensors.iOS_staccelerometer},getSensorTagGyroscope:function(){return sensors.iOS_stgyroscope},getSensorTagMagnetometer:function(){return sensors.iOS_stmagnetometer},getSensorTagTempAmb:function(){return sensors.iOS_sttempamb},getSensorTagTempIR:function(){return sensors.iOS_sttempir},getSensorTagPressure:function(){return sensors.iOS_stpressure},getSensorTagHumidity:function(){return sensors.iOS_sthumidity},isAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runAccelerometer():t&&sensors.calliOSFunction("runAccelerometer","","sensors.setAccelerometer")},stopAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopAccelerometer():t&&sensors.calliOSFunction("stopAccelerometer")},getAccelerometer:function(){var is_Androidwebview=window.android&&window.android.isAccelerometer(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getAccelerometer());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_accelerometer:{x:0,y:0,z:0}},isGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runGyroscope():t&&sensors.calliOSFunction("runGyroscope","","sensors.setGyroscope")},stopGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopGyroscope():t&&sensors.calliOSFunction("stopGyroscope")},getGyroscope:function(){var is_Androidwebview=window.android&&window.android.isGyroscope(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getGyroscope());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_gyroscope:{x:0,y:0,z:0}},isGravity:function(){var e=window.android&&window.android.isGravity();return e},runGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.runGravity()},stopGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.stopGravity()},getGravity:function(){var e=window.android&&window.android.isGravity();return e?window.android.getGravity():{x:0,y:0,z:0}},isLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e},runLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.runLinearAcceleration()},stopLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.stopLinearAcceleration()},getLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e?window.android.getLinearAcceleration():{x:0,y:0,z:0}},isRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e},runRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.runRotationVector()},stopRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.stopRotationVector();
},getRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e?window.android.getRotationVector():{x:0,y:0,z:0}},isMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e},runMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.runMagneticField()},stopMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.stopMagneticField()},getMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e?window.android.getMagneticField():{x:0,y:0,z:0}},isAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e},runAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.runAmbientTemperature()},stopAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.stopAmbientTemperature()},getAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e?window.android.getAmbientTemperature():0},isLight:function(){var e=window.android&&window.android.isLight();return e},runLight:function(){var e=window.android&&window.android.isLight();e&&window.android.runLight()},stopLight:function(){var e=window.android&&window.android.isLight();e&&window.android.stopLight()},getLight:function(){var e=window.android&&window.android.isLight();return e?window.android.getLight():0},isPressure:function(){var e=window.android&&window.android.isPressure();return e},runPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.runPressure()},stopPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.stopPressure()},getPressure:function(){var e=window.android&&window.android.isPressure();return e?window.android.getPressure():0},isHumidity:function(){var e=window.android&&window.android.isHumidity();return e},runHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.runHumidity()},stopHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.stopHumidity()},getHumidity:function(){var e=window.android&&window.android.isHumidity();return e?window.android.getHumidity():0}};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createView=function(e){function t(e,t){return e.match("^"+t)==t}var r,n,i,o,s={},a={},l={},u=[],g=[],c=[],S=[],d=[],f=[],E=[],p=[],h=[],m=[],A=[],y=[],D=!1,v=!0,P=[],I=[],_=!1;return s._clearAll=function(){s[e].innerHTML="",a={},l={},u=[],g=[],P=[],c=[],S=[],d=[],f=[],E=[],h=[],m=[],A=[],y=[],p=[],D=!1,v=!0},s._setResourcePath=function(e){n=e},s._getResourcePath=function(e){if(null==e||e.length<=0)return e;if(t(e,"local:"))return e;if(t(e,"data:"))return e;if(t(e,"http:")||t(e,"https:")||t(e,"ws:"))return e;if("undefined"!=typeof __base64Images){var r=__base64Images[e];if(r)return r}if(i&&!t(e,i)&&"/"==e.charAt(0)?e=i+"images"+e:n&&!t(e,n)&&"/"!=e.charAt(0)&&(e=n+e),t(window.location.protocol,"ibooks")){var o=window.location.pathname;o=o.substring(0,o.lastIndexOf("/")),t(e,"./")&&(e=e.substring(2)),e="ibooksimg://"+window.location.host+"/"+o+"/"+e}return e},s._setLibraryPath=function(e){i=e},s._registerVariable=function(e,t){a[e]={getter:null,setter:null,listeners:[],collectors:[],value:t}},s._registerVariables=function(e){for(var t=0;t<e.length;t++)s._registerVariable(e[t])},s._registerAction=function(e){l[e]={action:null}},s._registerActions=function(e){for(var t=0;t<e.length;t++)s._registerAction(e[t])},s._addElement=function(e,t,r){var n=EJSS_CORE.promoteToControlElement(e(t),s,t);return n.render&&d.push(n),n.touch&&f.push(n),n.dataCollected&&E.push(n),n.reset&&c.push(n),n.initialize&&S.push(n),n.enableEPub&&h.push(n),n.adjustPosition&&m.push(n),t&&(s[t]=n),r&&n.setProperty("Parent",r),n},s._getInitialValue=function(e){var t=a[e];return void 0!==t?t.value:void 0},s._startUp=function(){s._reset(),s._initValues(),s._initialize(),s._update(),s._render()},s._setReportInteractionMethod=function(e){r=e},s._linkVariable=function(e,t,r,n){var i=a[e];if(i){i.getter=t,i.setter=r,i.value=n;var o=g.indexOf(i);i.getter?i.listeners.length>0&&0>o&&g.push(i):o>=0&&g.splice(o,1),o=P.indexOf(i),i.value?i.listeners.length>0&&0>o&&P.push(i):o>=0&&P.splice(o,1)}else console.log("WARNING: view._setAccessors() - Variable not found : "+e);return i},s._setAction=function(e,t){var r=l[e];return r?r.action=t:console.log("WARNING: view._setAction() - Action not found : "+e),r},s._setReportNeeded=function(e){v=e},s._reset=function(){for(var e=0,t=c.length;t>e;e++)c[e].reset()},s._initValues=function(){for(var e=0,t=P.length;t>e;e++){var r=P[e],n=r.value;if(n)for(var i=r.listeners,o=0,s=i.length;s>o;o++)i[o](n)}},s._initialize=function(){for(var e=0,t=S.length;t>e;e++)S[e].initialize()},s._update=function(){var e,t;for(e=0,t=g.length;t>e;e++)for(var r=g[e],n=r.listeners,i=r.getter(),o=0,s=n.length;s>o;o++)n[o](i);for(e=0,t=u.length;t>e;e++){var a=u[e];a.propertySetter(a.getter())}},s._collectData=function(){var e,t;for(e=0,t=g.length;t>e;e++)for(var r=g[e],n=r.collectors,i=r.getter(),o=0,s=n.length;s>o;o++)n[o](i);for(e=0,t=u.length;t>e;e++){var a=u[e];a.isCollector&&a.propertySetter(a.getter())}for(e=0,t=E.length;t>e;e++)E[e].dataCollected()},s._render=function(){for(var e=0,t=d.length;t>e;e++)d[e].render()},s._touch=function(){for(var e=0,t=f.length;t>e;e++)f[e].touch()},s._enableEPub=function(){if("undefined"!=typeof _isEPub&&_isEPub)for(var e=0,t=h.length;t>e;e++)h[e].enableEPub()},s._addFontResizeListener=function(e){A.push(e)},s._fontResized=function(e,t,r){for(var n=0,i=m.length;i>n;n++)m[n].adjustPosition();if(e)for(var o=0,s=A.length;s>o;o++)A[o](e,t,r)},s._addResizeListener=function(e){y.push(e)},s._resized=function(e,t){for(var r=0,n=m.length;n>r;r++)m[r].adjustPosition();for(var i=0,o=y.length;o>i;i++)y[i](e,t)},s._readInteractions=function(e,t,r){var n=p.length;if(0>=n)return!1;D=!0;for(var i=0;n>i;i++){var o=p[i];if(s.isRegInteractions()){var a=o.interaction;a.data=o.data,a.runCount=e,a.runTime=t,a.isPlaying=r,a.timeStamp=Date.now(),s.pushRegInteractions(a)}o.what(o.data)}return p=[],D=!1,!0},s._interactionsNumber=function(){return p.length},s._reportInteraction=function(){r&&v&&r()},s._addListener=function(e,t,r){var n=a[e];return n?(n.listeners.indexOf(t)<0&&(n.listeners.push(t),r&&n.collectors.push(t)),n.getter&&g.indexOf(n)<0&&g.push(n),n.value&&P.indexOf(n)<0&&P.push(n)):console.log("WARNING: view._addListener() - Variable not found : "+e),n},s._addUnkownListener=function(e,t,r){for(var n=!1,i=0,o=u.length;o>i;i++){var s=u[i];if(s.propertySetter===t){s.getter=e,n=!0;break}}return n||u.push({getter:e,propertySetter:t,isCollector:r}),n},s._getAction=function(e){var t=l[e];return t||console.log("WARNING: view._getAction() - Action not found : "+e),t},s._addInteraction=function(e,t,n){return r?void(!D&&v&&p.push({what:e,data:t,interaction:n})):void e(t)},s._format=function(e,t){var r=t.indexOf("."),n=0;return r>=0&&(n=Number(t.length-r-1)),parseFloat(e).toFixed(n)},s.print=function(e){var t=document.getElementsByTagName("textarea");t.length?t[0].innerHTML=e:console.log(e)},s._setVisible=function(t){t?document.getElementById(e).style.display="inherit":document.getElementById(e).style.display="none"},s._switchVisibility=function(){s._setVisible("none"==document.getElementById(e).style.display)},s.serialize=function(){var e={};for(key in s)s[key].serialize&&(e[key]=s[key].serialize());return e},s.unserialize=function(e){for(key in e)s[key]&&s[key].unserialize?s[key].unserialize(e[key]):console.log("Impossible unserialize: "+key)},s.registerInteractions=function(e){I=[],o=e,_=!0},s.unregisterInteractions=function(){_=!1},s.getRegInteractions=function(){return I},s.isRegInteractions=function(){return _},s.pushRegInteractions=function(e){"undefined"!=typeof o?o.send(JSON.stringify(e)):I.push(e)},s[e]=document.getElementById(e),s},EJSS_CORE.promoteToControlElement=function(e,t,r){r=r||"unnamed";var n={},i={};return e.setName=function(e){r=e},e.getName=function(){return r},e.getResourcePath=function(e){return t._getResourcePath(e)},e.registerProperty=function(t,r,i){return n[t]={setter:r,getter:i,variable:null,variableSetter:null},e},e.registerAction=function(t,r,n,o){return i[t]={action:null,helper:r,process:n},o&&e.setAction(t,o),e},e.setProperty=function(t,r){var o=i[t];if(o)return e.setAction(t,r);var s=n[t];return s?s.setter(r):console.log("WARNING: ControlElement setProperty() - Property not registered : "+t+" for element : "+e.getName()),e},e.setProperties=function(t){for(var r in t)e.setProperty(r,t[r]);return e},e.linkProperty=function(r,i,o){var s=n[r];if(!s)return console.log("WARNING: ControlElement linkProperty() - Element property not registered : "+r+" for element : "+e.getName()),e;if("string"==typeof i){var a=t._addListener(i,s.setter,e.dataCollected);if(!a)return console.log("WARNING: ControlElement linkProperty() - element : "+e.getName()+" - property :"+r+" - View variable not registered : "+i),e;"InputOnly"===o||(s.variable=a),s.variableSetter=null}else t._addUnkownListener(i,s.setter,e.dataCollected),s.variableSetter=o,s.variable=null;return e},e.linkProperties=function(t){for(var r in t)e.linkProperty(r,t[r]);return e},e.setAction=function(r,n){var o=i[r];if(!o)return console.log("WARNING: ControlElement setAction() - action not registered : "+r+" for element : "+e.getName),e;if("string"==typeof n){var s=t._getAction(n);if(!s)return console.log("WARNING: ControlElement setAction() - element : "+e.getName()+" - View action not registered : "+n),e;o.action=s}else o.action={action:n};return e},e.setActions=function(t){for(var r in t)e.setAction(r,t[r]);return e},e.invokeAction=function(r){var n={};t.isRegInteractions()&&(n={action:r,element:e.getName(),timeStamp:Date.now()});var o=i[r];if(o&&(o.process&&t._addInteraction(o.process,null,n),o.action)){var s=o.helper?o.helper():null;t._addInteraction(o.action.action,s,n)}return e},e.propertiesChanged=function(){for(var t=0,r=arguments.length;r>t;t++)e.propertyChanged(arguments[t]);return e},e.propertyChanged=function(r,i){var o={};t.isRegInteractions()&&(o={property:r,element:e.getName(),timeStamp:Date.now()});var s=n[r];if(s){var a=s.variableSetter;if(a||s.variable&&(a=s.variable.setter),a||s.setter&&(a=s.setter),a){var l="undefined"!=typeof i?i:s.getter();t._addInteraction(a,l,o)}}return e},e.reportInteractions=function(r,n){var i,o;if(r)for(i=0,o=r.length;o>i;i++)e.invokeAction(r[i]);if(n)for(i=0,o=n.length;o>i;i++)e.propertiesChanged(n[i]);return t._interactionsNumber()>0&&t._reportInteraction(),e},e.getProperty=function(e,t){var r=n[e];return r&&r.getter?r.getter():void 0},e.getProperties=function(){return n},e.registerProperty("name",e.setName,e.getName),e.registerProperties&&e.registerProperties(e),e};
